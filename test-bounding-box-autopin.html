<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ PureBoundingBoxAutoPin Áµ±Âêà„ÉÜ„Çπ„Éà</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: linear-gradient(45deg, #f0f0f0, #e0e0e0);
            min-height: 100vh;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .hero-section {
            position: relative;
            width: 90vw;
            max-width: none;  /* Âà∂ÈôêËß£Èô§„Åß„Éï„É´ÈÄ£Âãï */
            min-width: 400px;
            height: 60vh;
            min-height: 300px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            margin: 20px auto;
            overflow: visible;
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
        }
        
        .background-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('https://images.unsplash.com/photo-1519452575417-564c1401ecc0?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80') no-repeat center;
            background-size: cover;
            transition: all 0.3s ease;
        }
        
        /* üÜï IMGË¶ÅÁ¥†Áâà„ÉÜ„Çπ„Éà„Çª„ÇØ„Ç∑„Éß„É≥ */
        .img-test-section {
            position: relative;
            width: 100%;
            height: 500px;
            margin-top: 20px;
            border: 2px dashed #007bff;
            border-radius: 8px;
            overflow: visible;
        }
        
        .img-test-section img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
        }
        
        .img-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            /* üîß ‰øÆÊ≠£: „É¨„Ç§„Ç¢„Ç¶„ÉàÁî®transform + Á∑®ÈõÜÁî®transform„ÅÆÂêàÊàê */
            transform: translate(-50%, -50%) var(--pbx-edit, none);
            color: white;
            background: rgba(0, 123, 255, 0.8);
            padding: 15px 20px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            z-index: 2;
        }
        
        /* „Éí„Éº„É≠„ÉºÁîªÂÉè„ÅÆ„Ç™„Éº„Éê„Éº„É¨„Ç§ */
        .background-image::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, rgba(102, 126, 234, 0.7), rgba(118, 75, 162, 0.7));
            z-index: 1;
        }
        
        /* „ÉÜ„Ç≠„Çπ„Éà„Ç™„Éº„Éê„Éº„É¨„Ç§ */
        .background-image::after {
            content: "üéØ Hero Background Image\AResize window to test auto-pin tracking";
            white-space: pre;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            z-index: 2;
        }
        
        .spine-character {
            position: absolute;
            left: 35%;
            top: 40%;
            width: 120px;   /* Spine„Ç≠„É£„É©„ÇØ„Çø„ÉºÊ®ôÊ∫ñ„Çµ„Ç§„Ç∫ */
            height: 120px; 
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            border: 3px solid #c23616;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
            text-align: center;
            line-height: 1.2;
            transition: transform 0.3s ease;
            user-select: none;
            z-index: 150;
            transform: translate(-50%, -50%);
        }
        
        /* ËøΩÂä†ÁîªÂÉèË¶ÅÁ¥†„ÅÆ„Çπ„Çø„Ç§„É´ */
        .additional-image {
            position: relative;
            width: 300px;
            height: 200px;
            margin: 20px auto;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            background: url('https://images.unsplash.com/photo-1516026672322-bc52d61a55d5?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80') no-repeat center;
            background-size: cover;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        
        .additional-image:hover {
            transform: scale(1.02);
        }
        
        .additional-image::after {
            content: "üì∏ Additional Test Image\AClick to test pin attachment";
            white-space: pre;
            position: absolute;
            bottom: 10px;
            left: 10px;
            color: white;
            font-size: 12px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            background: rgba(0,0,0,0.5);
            padding: 5px 8px;
            border-radius: 4px;
        }
        
        /* Spine Canvas „Çπ„Çø„Ç§„É´ */
        .spine-canvas {
            position: absolute;
            z-index: 9999; /* ÊúÄÂâçÈù¢„Å´Ë°®Á§∫ */
            pointer-events: auto; /* „ÇØ„É™„ÉÉ„ÇØÂèØËÉΩ„Å´Â§âÊõ¥ */
            cursor: pointer; /* „ÇØ„É™„ÉÉ„ÇØÂèØËÉΩ„Åß„ÅÇ„Çã„Åì„Å®„ÇíÁ§∫„Åô */
            border-radius: 4px;
        }
        
        /* Spine„Ç≠„É£„É©„ÇØ„Çø„ÉºÁî®„ÅÆ„Ç≥„É≥„ÉÜ„Éä */
        .spine-container {
            position: relative;
            display: inline-block;
        }
        
        .spine-character:hover {
            transform: translate(-50%, -50%) scale(1.05);
        }
        
        .control-panel {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .control-button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .primary-button {
            background: #28a745;
            color: white;
        }
        
        .primary-button:hover {
            background: #218838;
            transform: translateY(-1px);
        }
        
        .secondary-button {
            background: #6c757d;
            color: white;
        }
        
        .secondary-button:hover {
            background: #5a6268;
        }
        
        .danger-button {
            background: #dc3545;
            color: white;
        }
        
        .danger-button:hover {
            background: #c82333;
        }
        
        .info-panel {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        /* „Éî„É≥Ë°®Á§∫Áî®„Çπ„Çø„Ç§„É´ */
        .autopin-marker {
            position: absolute;
            width: 16px;
            height: 16px;
            background: #ff4757;
            border: 2px solid #fff;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(255, 71, 87, 0.6);
            z-index: 9999;
            pointer-events: none;
            transform: translate(-50%, -50%);
            animation: pin-pulse 2s infinite;
        }
        
        .autopin-marker::before {
            content: 'üìç';
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            white-space: nowrap;
        }
        
        .autopin-marker.anchor-TL::after { content: 'TL'; }
        .autopin-marker.anchor-TC::after { content: 'TC'; }
        .autopin-marker.anchor-TR::after { content: 'TR'; }
        .autopin-marker.anchor-ML::after { content: 'ML'; }
        .autopin-marker.anchor-MC::after { content: 'MC'; }
        .autopin-marker.anchor-MR::after { content: 'MR'; }
        .autopin-marker.anchor-BL::after { content: 'BL'; }
        .autopin-marker.anchor-BC::after { content: 'BC'; }
        .autopin-marker.anchor-BR::after { content: 'BR'; }
        
        .autopin-marker::after {
            position: absolute;
            bottom: -18px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            color: #fff;
            background: rgba(0, 0, 0, 0.7);
            padding: 2px 4px;
            border-radius: 3px;
            white-space: nowrap;
        }
        
        @keyframes pin-pulse {
            0% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }
        
        .hidden-pins .autopin-marker {
            display: none;
        }
        
        .status-success { background: #28a745; }
        .status-warning { background: #ffc107; }
        .status-danger { background: #dc3545; }
        
        .log-container {
            background: #000;
            color: #0f0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            padding: 15px;
            border-radius: 4px;
            max-height: 300px;
            overflow-y: auto;
            margin: 20px 0;
        }
        
        /* „É°„Ç§„É≥„É¨„Ç§„Ç¢„Ç¶„Éà */
        .main-layout-container {
            display: flex;
            gap: 20px;
            align-items: flex-start;
            margin-top: 20px;
        }
        
        .left-column {
            flex: 1;
            min-width: 0;
        }
        
        .right-sidebar {
            width: 350px;
            flex-shrink: 0;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid #dee2e6;
        }
        
        .right-sidebar h3 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 16px;
            text-align: center;
        }
        
        /* CanvasResizeController iframe */
        .canvas-resize-iframe {
            width: 100%;
            height: 600px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: white;
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .feature-card {
            background: #fff;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .feature-card h3 {
            margin: 0 0 10px 0;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        @media (max-width: 768px) {
            .hero-section {
                width: 100%;
                max-width: 600px;
                height: 400px;
            }
            
            .spine-character {
                left: 50%;
                transform: translateX(-50%);
            }
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üéØ PureBoundingBoxAutoPin Áµ±Âêà„ÉÜ„Çπ„Éà</h1>
        <p>„Éê„Ç¶„É≥„Éá„Ç£„É≥„Ç∞„Éú„ÉÉ„ÇØ„ÇπËá™Âãï„Éî„É≥„Ç∑„Çπ„ÉÜ„É†„ÅÆÂãï‰ΩúÁ¢∫Ë™ç„ÉÜ„Çπ„Éà„Éö„Éº„Ç∏„Åß„Åô„ÄÇ</p>
        
        <!-- „ÉÜ„Çπ„ÉàÁî®Hero Section -->
        <div class="hero-section" id="test-hero">
            <div class="background-image" id="background-element"></div>
            <!-- Spine„Ç≠„É£„É©„ÇØ„Çø„ÉºÔºà„Éû„Éã„É•„Ç¢„É´Ê∫ñÊã†ÂÆüË£ÖÔºâ -->
            <canvas id="spine-canvas" width="400" height="400" style="position: absolute; left: 30%; top: 50%; transform: translate(-50%, -50%); z-index: 9999; pointer-events: auto; cursor: pointer;"></canvas>
        </div>
        
        <!-- ËøΩÂä†„ÅÆÁîªÂÉèË¶ÅÁ¥† -->
        <div class="additional-image" id="additional-image">
            <!-- ÁîªÂÉè„ÅØCSS background„ÅßË°®Á§∫ -->
        </div>
        
        <!-- üÜï IMGË¶ÅÁ¥†Áâà„ÉÜ„Çπ„Éà„Çª„ÇØ„Ç∑„Éß„É≥ÔºàËá™ÁÑ∂„Çµ„Ç§„Ç∫ÂèñÂæó„ÅÆ„Åü„ÇÅÔºâ -->
        <div class="img-test-section" id="img-test-section">
            <img id="test-img" 
                 src="https://images.unsplash.com/photo-1441974231531-c6227db76b6e?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80" 
                 alt="Test Image for Content Rect Calculation">
            <div class="img-overlay">
                üìê IMGË¶ÅÁ¥†„ÉÜ„Çπ„Éà<br>
                Ëá™ÁÑ∂„Çµ„Ç§„Ç∫: <span id="natural-size">Loading...</span>
            </div>
        </div>
        
        <!-- „É°„Ç§„É≥„É¨„Ç§„Ç¢„Ç¶„Éà„Ç≥„É≥„ÉÜ„Éä -->
        <div class="main-layout-container">
            <!-- Â∑¶ÂÅ¥Ôºö„É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
            <div class="left-column">
                <!-- „Ç≥„É≥„Éà„É≠„Éº„É´„Éë„Éç„É´ -->
                <div class="control-panel">
            <button class="control-button primary-button" onclick="loadSpineCharacter()">
                üéÆ Spine„Ç≠„É£„É©„ÇØ„Çø„ÉºË™≠„ÅøËæº„Åø
            </button>
            <button class="control-button primary-button" onclick="testBasicBoundingBox()">
                üì¶ Âü∫Êú¨„Éê„Ç¶„É≥„Éá„Ç£„É≥„Ç∞„Éú„ÉÉ„ÇØ„Çπ„ÉÜ„Çπ„Éà
            </button>
            <button class="control-button primary-button" onclick="testRightClickMenu()">
                üñ±Ô∏è Âè≥„ÇØ„É™„ÉÉ„ÇØ„É°„Éã„É•„Éº„ÉÜ„Çπ„Éà
            </button>
            <button class="control-button secondary-button" onclick="switchCharacter()">
                üîÑ „Ç≠„É£„É©„ÇØ„Çø„ÉºÂàá„ÇäÊõø„Åà (Purattokun/Nezumi)
            </button>
            <button class="control-button secondary-button" onclick="testCanvasResize()">
                üìê Canvas„É™„Çµ„Ç§„Ç∫„ÉÜ„Çπ„Éà
            </button>
            <button class="control-button secondary-button" onclick="showModuleStatus()">
                ‚öôÔ∏è „É¢„Ç∏„É•„Éº„É´Áä∂ÊÖãÁ¢∫Ë™ç
            </button>
            <button class="control-button secondary-button" onclick="testResize()">
                üìê „É™„Çµ„Ç§„Ç∫„ÉÜ„Çπ„Éà
            </button>
            <button class="control-button secondary-button" onclick="testModifierKeys()">
                üéÆ ‰øÆÈ£æ„Ç≠„Éº„ÉÜ„Çπ„Éà
            </button>
            <button class="control-button secondary-button" onclick="debugBBSystem()">
                üîç BBË®∫Êñ≠
            </button>
            <button class="control-button secondary-button" onclick="testIMGElementContentRect()">
                üñºÔ∏è IMGË¶ÅÁ¥†„Ç≥„É≥„ÉÜ„É≥„ÉÑÁü©ÂΩ¢„ÉÜ„Çπ„Éà
            </button>
            <button class="control-button secondary-button" onclick="showAnchorPoint()" style="background: #ff6b35;">
                üìç „Ç¢„É≥„Ç´„Éº„Éù„Ç§„É≥„ÉàË°®Á§∫
            </button>
            <button class="control-button secondary-button" onclick="hideAnchorPoint()" style="background: #666;">
                üö´ „Ç¢„É≥„Ç´„Éº„Éù„Ç§„É≥„ÉàÈùûË°®Á§∫
            </button>
            <button class="control-button secondary-button" onclick="showUserPin()" style="background: #007bff;">
                üìå „É¶„Éº„Ç∂„Éº„Éî„É≥Ë°®Á§∫
            </button>
            <button class="control-button secondary-button" onclick="hideUserPin()" style="background: #666;">
                üö´ „É¶„Éº„Ç∂„Éº„Éî„É≥ÈùûË°®Á§∫
            </button>
            <button class="control-button secondary-button" onclick="showDragHandle()" style="background: #ff6b35;">
                üñ±Ô∏è „Éâ„É©„ÉÉ„Ç∞„Éè„É≥„Éâ„É´Ë°®Á§∫
            </button>
            <button class="control-button secondary-button" onclick="hideDragHandle()" style="background: #666;">
                üö´ „Éâ„É©„ÉÉ„Ç∞„Éè„É≥„Éâ„É´ÈùûË°®Á§∫
            </button>
            <button class="control-button secondary-button" onclick="diagnosePinDuplication()" style="background: #e74c3c;">
                üîç „Éî„É≥ÈáçË§áË®∫Êñ≠
            </button>
            <button class="control-button secondary-button" onclick="cleanupAllPins()" style="background: #e67e22;">
                üßπ ÂÖ®„Éî„É≥„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
            </button>
            
            <!-- üéØ SpineSettingsPersistenceÁµ±Âêà„ÉÜ„Çπ„Éà -->
            <button class="control-button test-button" onclick="testSpineSettingsPersistenceIntegration()" style="background: #4CAF50;">
                üß™ SpineSettingsÁµ±Âêà„ÉÜ„Çπ„Éà
            </button>
            
            <!-- üéØ ÂäπÁéáÁöÑ„Éî„É≥„Ç∑„Çπ„ÉÜ„É† v2.0 „ÉÜ„Çπ„Éà„Éú„Çø„É≥ -->
            <button class="control-button primary-button" onclick="testEfficientPinSystem()" style="background: linear-gradient(135deg, #2ed573, #17a085);">
                üéØ ÂäπÁéáÁöÑ„Éî„É≥„Ç∑„Çπ„ÉÜ„É† v2.0 „ÉÜ„Çπ„Éà
            </button>
            
            <!-- üîÑ Phase 2 Áµ±Âêà„ÉÜ„Çπ„Éà„Éú„Çø„É≥ -->
            <button class="control-button primary-button" onclick="testParallelSystemIntegration()" style="background: linear-gradient(135deg, #3742fa, #2f3542);">
                üîÑ Phase 2: ‰∏¶Ë°åÁ®ºÂÉç„ÉÜ„Çπ„Éà
            </button>
            <button class="control-button primary-button" onclick="performanceBenchmark()" style="background: linear-gradient(135deg, #ff6b6b, #ee5a52);">
                üöÄ Phase 3: „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„Éô„É≥„ÉÅ„Éû„Éº„ÇØ
            </button>
            <button class="control-button primary-button" onclick="testEfficientFirstMode()" style="background: linear-gradient(135deg, #5f27cd, #341f97);">
                üéØ efficient-first„É¢„Éº„Éâ„ÉÜ„Çπ„Éà
            </button>
            <button class="control-button primary-button" onclick="testFullMigration()" style="background: linear-gradient(135deg, #00d2d3, #54a0ff);">
                üèÅ Phase 3: ÂÆåÂÖ®ÁßªË°å„ÉÜ„Çπ„Éà
            </button>
            
            <!-- 2ÊÆµÈöéUIÁµ±Âêà„ÉÜ„Çπ„Éà -->
            <button class="control-button primary-button" onclick="testTwoStageUI()" style="background: linear-gradient(135deg, #ff6b35, #f7931e);">
                üéØ 2ÊÆµÈöéUIÁµ±Âêà„ÉÜ„Çπ„Éà
            </button>
            
            <!-- Spine„Ç≠„É£„É©„ÇØ„Çø„ÉºÂÆüÊà¶„ÉÜ„Çπ„Éà -->
            <button class="control-button primary-button" onclick="initializeSpineCharacterTest()" style="background: linear-gradient(135deg, #ff6b6b, #ee5a24);">
                üéÆ Spine„Ç≠„É£„É©„ÇØ„Çø„ÉºÂÆüÊà¶„ÉÜ„Çπ„Éà
            </button>
            
            <button class="control-button secondary-button" onclick="testSystemSwitching()">
                ‚öñÔ∏è „Ç∑„Çπ„ÉÜ„É†Âàá„ÇäÊõø„Åà„ÉÜ„Çπ„Éà
            </button>
            <button class="control-button secondary-button" onclick="debugWindowResizeImpact()">
                üîç „Ç¶„Ç£„É≥„Éâ„Ç¶„É™„Çµ„Ç§„Ç∫ÂΩ±ÈüøË®∫Êñ≠
            </button>
            <button class="control-button secondary-button" onclick="runMinimalDiagnosis()" style="background: #28a745; color: white; font-weight: bold;">
                üîç ÊúÄÂ∞èË®∫Êñ≠ÂÆüË°å
            </button>
            <button class="control-button secondary-button" onclick="togglePinVisibility()">
                üìç „Éî„É≥Ë°®Á§∫Âàá„ÇäÊõø„Åà
            </button>
            <button class="control-button primary-button" onclick="testAutoPinSystem()">
                üéØ AutoPin „Ç∑„Çπ„ÉÜ„É†„ÉÜ„Çπ„Éà
            </button>
            <button class="control-button secondary-button" onclick="clearLog()">
                üóëÔ∏è „É≠„Ç∞„ÇØ„É™„Ç¢
            </button>
            <button class="control-button secondary-button" onclick="clearOriginalBounds()">
                üìè ÂàùÊúüboundsÂâäÈô§
            </button>
                </div>
                
                <!-- Êìç‰ΩúÊâãÈ†Ü„Ç¨„Ç§„Éâ -->
        <div class="info-panel" style="background: #e8f4fd; border: 2px solid #0066cc;">
            <h3>üìã ÂÆüÈ®ìÊâãÈ†Ü„Ç¨„Ç§„Éâ</h3>
            <div style="display: grid; grid-template-columns: auto 1fr; gap: 15px; align-items: start;">
                <div style="background: #0066cc; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-weight: bold;">1</div>
                <div><strong>üéÆ Spine„Ç≠„É£„É©„ÇØ„Çø„ÉºË™≠„ÅøËæº„Åø</strong><br><small>„ÄåüéÆ Spine„Ç≠„É£„É©„ÇØ„Çø„ÉºË™≠„ÅøËæº„Åø„Äç„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ ‚Üí ÂÆüÈöõ„ÅÆSpine„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô</small></div>
                
                <div style="background: #0066cc; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-weight: bold;">2</div>
                <div><strong>üì¶ „Éê„Ç¶„É≥„Éá„Ç£„É≥„Ç∞„Éú„ÉÉ„ÇØ„ÇπË°®Á§∫</strong><br><small>„Äåüì¶ Âü∫Êú¨„Éê„Ç¶„É≥„Éá„Ç£„É≥„Ç∞„Éú„ÉÉ„ÇØ„Çπ„ÉÜ„Çπ„Éà„Äç„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ ‚Üí „Ç≠„É£„É©„ÇØ„Çø„ÉºÂë®„Çä„Å´Á∑®ÈõÜÊû†„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô</small></div>
                
                <div style="background: #0066cc; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-weight: bold;">3</div>
                <div><strong>üñ±Ô∏è ‰ΩçÁΩÆ„Éª„Çµ„Ç§„Ç∫Ë™øÊï¥</strong><br><small>Êû†„Çí„Éâ„É©„ÉÉ„Ç∞„Åß‰ΩçÁΩÆË™øÊï¥„ÄÅËßí„Éè„É≥„Éâ„É´„Åß„Çµ„Ç§„Ç∫Ë™øÊï¥„Åå„Åß„Åç„Åæ„Åô</small></div>
                
                <div style="background: #0066cc; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-weight: bold;">4</div>
                <div><strong>üéØ Ëá™Âãï„Éî„É≥ÈÅ©Áî®</strong><br><small>Á∑®ÈõÜÊû†‰∏ä„ÅßÂè≥„ÇØ„É™„ÉÉ„ÇØ ‚Üí „Äå‰øùÂ≠ò„Äç„ÇíÈÅ∏Êäû ‚Üí Ëá™Âãï„Éî„É≥Ê©üËÉΩ„ÅåÊúâÂäπÂåñ„Åï„Çå„Åæ„Åô</small></div>
                
                <div style="background: #0066cc; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-weight: bold;">5</div>
                <div><strong>üìê „É™„Çµ„Ç§„Ç∫„ÉÜ„Çπ„Éà</strong><br><small>„Äåüìê „É™„Çµ„Ç§„Ç∫„ÉÜ„Çπ„Éà„Äç„Éú„Çø„É≥„Åß„Ç¶„Ç£„É≥„Éâ„Ç¶„Çµ„Ç§„Ç∫„ÇíÂ§âÊõ¥ ‚Üí Ëá™ÂãïËøΩÂæìÂãï‰Ωú„ÇíÁ¢∫Ë™ç</small></div>
                
                <div style="background: #28a745; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-weight: bold;">üîç</div>
                <div><strong>üîç ÊúÄÂ∞èË®∫Êñ≠ÂÆüË°å</strong><br><small>Ê≠™„ÅøÂïèÈ°åÁô∫ÁîüÊôÇ„ÅÆÊ†πÊú¨ÂéüÂõ†ÁâπÂÆö„ÄÇÁ∑®ÈõÜÁä∂ÊÖã„ÅßÂÆüË°å„Åó„ÄÅ„Ç≥„É≥„ÇΩ„Éº„É´ÔºàF12Ôºâ„ÅßË©≥Á¥∞Á¢∫Ë™ç</small></div>
            </div>
        </div>
        
        <!-- Ê©üËÉΩË™¨Êòé -->
        <div class="feature-grid">
            <div class="feature-card">
                <h3>üéØ ÈÄèÊòéËá™Âãï„Éî„É≥„Ç∑„Çπ„ÉÜ„É†</h3>
                <p>„Ç≠„É£„É©„ÇØ„Çø„Éº„Çí„ÇØ„É™„ÉÉ„ÇØ ‚Üí „Éâ„É©„ÉÉ„Ç∞Ë™øÊï¥ ‚Üí <strong>Âè≥„ÇØ„É™„ÉÉ„ÇØ ‚Üí ‰øùÂ≠ò</strong>„ÅßËá™ÂãïËøΩÂæìÊ©üËÉΩ„ÅåÊúâÂäπÂåñ„Åï„Çå„Åæ„Åô„ÄÇ</p>
                <ul>
                    <li>ËÉåÊôØË¶ÅÁ¥†„ÅÆËá™ÂãïÊ§úÂá∫</li>
                    <li>9„Ç¢„É≥„Ç´„Éº„Éù„Ç§„É≥„ÉàÊúÄÈÅ©Âåñ</li>
                    <li>ElementObserver Phase 3-BÁµ±Âêà</li>
                    <li>üÜï Âè≥„ÇØ„É™„ÉÉ„ÇØ„É°„Éã„É•„ÉºÊìç‰Ωú</li>
                    <li>üéÆ ÂÆüÈöõ„ÅÆSpine„Ç≠„É£„É©„ÇØ„Çø„ÉºÂØæÂøú</li>
                </ul>
            </div>
            
            <div class="feature-card">
                <h3>üîç ËÉåÊôØÊ§úÂá∫„Ç¢„É´„Ç¥„É™„Ç∫„É†</h3>
                <p>4„Å§„ÅÆÊ§úÂá∫Êà¶Áï•„ÅßÊúÄÈÅ©„Å™ËÉåÊôØË¶ÅÁ¥†„ÇíËá™ÂãïÈÅ∏ÊäûÔºö</p>
                <ol>
                    <li>ËÉåÊôØÁîªÂÉè‰ªò„ÅçË¶™Ë¶ÅÁ¥†</li>
                    <li>ËøëÊé•Â§ßÂûãÁîªÂÉèË¶ÅÁ¥†</li>
                    <li>„Çª„ÇØ„Ç∑„Éß„É≥„Ç≥„É≥„ÉÜ„Éä</li>
                    <li>„É°„Ç§„É≥„Ç≥„É≥„ÉÜ„Éä</li>
                </ol>
            </div>
            
            <div class="feature-card">
                <h3>üìç 9„Ç¢„É≥„Ç´„Éº„Éù„Ç§„É≥„Éà</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 5px; max-width: 150px; margin: 10px 0;">
                    <div style="background: #007cff; color: white; text-align: center; padding: 8px; border-radius: 3px; font-size: 10px;">TL</div>
                    <div style="background: #007cff; color: white; text-align: center; padding: 8px; border-radius: 3px; font-size: 10px;">TC</div>
                    <div style="background: #007cff; color: white; text-align: center; padding: 8px; border-radius: 3px; font-size: 10px;">TR</div>
                    <div style="background: #007cff; color: white; text-align: center; padding: 8px; border-radius: 3px; font-size: 10px;">ML</div>
                    <div style="background: #28a745; color: white; text-align: center; padding: 8px; border-radius: 3px; font-size: 10px;">MC</div>
                    <div style="background: #007cff; color: white; text-align: center; padding: 8px; border-radius: 3px; font-size: 10px;">MR</div>
                    <div style="background: #007cff; color: white; text-align: center; padding: 8px; border-radius: 3px; font-size: 10px;">BL</div>
                    <div style="background: #007cff; color: white; text-align: center; padding: 8px; border-radius: 3px; font-size: 10px;">BC</div>
                    <div style="background: #007cff; color: white; text-align: center; padding: 8px; border-radius: 3px; font-size: 10px;">BR</div>
                </div>
                <p><small>MCÔºà‰∏≠Â§ÆÔºâ„Åå„Éá„Éï„Ç©„É´„Éà„ÄÅ‰ΩçÁΩÆ„Å´Âøú„Åò„Å¶ÊúÄÈÅ©ÈÅ∏Êäû</small></p>
            </div>
            
            <div class="feature-card">
                <h3>üîç ÊúÄÂ∞èË®∫Êñ≠„Ç∑„Çπ„ÉÜ„É†</h3>
                <p>Ê≠™„ÅøÂïèÈ°åÁô∫ÁîüÊôÇ„ÅÆÊ†πÊú¨ÂéüÂõ†„ÇíÁâπÂÆö„Åô„Çã5„Å§„ÅÆË®∫Êñ≠Ê©üËÉΩÔºö</p>
                <ol>
                    <li><strong>Canvas‰∏âÂÖÑÂºü</strong>: Ë°®Á§∫„Çµ„Ç§„Ç∫„ÉªÂÜÖÈÉ®„Éê„ÉÉ„Éï„Ç°„ÉªDPR„ÅÆÈÅ©Ê≠£Èñ¢‰øÇÁ¢∫Ë™ç</li>
                    <li><strong>MatrixÁ≠âÊñπÊÄß</strong>: „Çπ„Ç±„Éº„É´„Éª„Çπ„Ç≠„É•„Éº„ÅÆÊ≠™„ÅøË¶ÅÂõ†Ê§úÂá∫</li>
                    <li><strong>Spine„Çπ„Ç±„Éº„É´1Êú¨Âåñ</strong>: Á´∂Âêà„Åô„Çã„Çπ„Ç±„Éº„É´ÁµåË∑Ø„ÅÆÁµ±‰∏Ä</li>
                    <li><strong>CanvasPXÂõ∫ÂÆö</strong>: Á∑®ÈõÜ‰∏≠„ÅÆ„Çµ„Ç§„Ç∫Â§âÂãïÈò≤Ê≠¢</li>
                    <li><strong>Transform „É¨„Ç§„É§„ÉºÁ¢∫Ë™ç</strong>: CSSÂ§âÊï∞ÂêàÊàê„ÅÆÊ≠£ÂΩìÊÄßÁ¢∫Ë™ç</li>
                </ol>
                <p><strong>‰ΩøÁî®ÊñπÊ≥ï:</strong> Á∑®ÈõÜÁä∂ÊÖã„Åß„Äåüîç ÊúÄÂ∞èË®∫Êñ≠ÂÆüË°å„Äç„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„Ç≥„É≥„ÇΩ„Éº„É´ÔºàF12Ôºâ„ÅßË©≥Á¥∞Á¢∫Ë™ç</p>
            </div>
        </div>
        
        <!-- „É¢„Ç∏„É•„Éº„É´Áä∂ÊÖã -->
        <div class="info-panel">
            <h3>üìä „Ç∑„Çπ„ÉÜ„É†Áä∂ÊÖã</h3>
            <div id="module-status">
                <div class="status-line">
                    <span class="status-indicator status-warning"></span>
                    <span>„É¢„Ç∏„É•„Éº„É´„ÉÅ„Çß„ÉÉ„ÇØ‰∏≠...</span>
                </div>
            </div>
        </div>
        
        <!-- Spine„Ç≠„É£„É©„ÇØ„Çø„ÉºÂÆüÊà¶„ÉÜ„Çπ„Éà „Ç®„É™„Ç¢ -->
        <div class="info-panel" id="spine-character-area" style="display: none;">
            <h3>üéÆ Spine„Ç≠„É£„É©„ÇØ„Çø„ÉºÂÆüÊà¶„ÉÜ„Çπ„Éà</h3>
            <div id="spine-character-container" style="position: relative; width: 100%; height: 400px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; overflow: visible; margin: 10px 0;">
                <!-- Spine„Ç≠„É£„É©„ÇØ„Çø„Éº„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô -->
                <canvas id="spine-test-canvas" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); pointer-events: auto; cursor: pointer;"></canvas>
                
                <!-- „Ç≠„É£„É©„ÇØ„Çø„ÉºÊÉÖÂ†±Ë°®Á§∫ -->
                <div id="spine-character-info" style="position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.7); color: white; padding: 8px; border-radius: 4px; font-size: 12px;">
                    „Ç≠„É£„É©„ÇØ„Çø„Éº: Êú™Ë™≠„ÅøËæº„Åø
                </div>
                
                <!-- 2ÊÆµÈöéUI„ÉÜ„Çπ„ÉàÂà∂Âæ° -->
                <div id="spine-ui-controls" style="position: absolute; top: 10px; right: 10px;">
                    <button class="control-button" onclick="startSpinePinTest()" style="padding: 6px 12px; font-size: 12px; background: #ff6b35; color: white; border: none; border-radius: 4px; cursor: pointer;">
                        üìç „Ç≠„É£„É©„ÇØ„Çø„Éº„Éî„É≥„ÉÜ„Çπ„Éà
                    </button>
                </div>
            </div>
            
            <div style="margin: 10px 0; font-size: 14px; color: #666;">
                üí° <strong>Êìç‰ΩúÊñπÊ≥ï</strong>: 
                „Äåüìç „Ç≠„É£„É©„ÇØ„Çø„Éº„Éî„É≥„ÉÜ„Çπ„Éà„Äç„Éú„Çø„É≥„Åß2ÊÆµÈöéUI„ÇíÈñãÂßã ‚Üí Spine„Ç≠„É£„É©„ÇØ„Çø„Éº„Çí„ÇØ„É™„ÉÉ„ÇØÈÅ∏Êäû ‚Üí ‰ΩçÁΩÆË™øÊï¥„Åß„Éî„É≥ÈÖçÁΩÆ
            </div>
        </div>
        
                <!-- „É≠„Ç∞Ë°®Á§∫ -->
                <div class="log-container" id="log-display">
                    üéØ PureBoundingBoxAutoPin Áµ±Âêà„ÉÜ„Çπ„Éà„É≠„Ç∞ - ÂàùÊúüÂåñ‰∏≠...\n
                </div>
            </div>
            
            <!-- Âè≥ÂÅ¥Ôºö„Çµ„Ç§„Éâ„Éê„Éº -->
            <div class="right-sidebar">
                <h3>üéØ Canvas Resize Controller</h3>
                <iframe 
                    id="canvas-resize-iframe" 
                    class="canvas-resize-iframe" 
                    src="./micromodules/canvas-resize/ui.html?v=1725439200"
                    title="Canvas Resize Controller">
                </iframe>
            </div>
        </div>
    </div>

    <!-- Spine WebGL -->
    <script src="https://unpkg.com/@esotericsoftware/spine-webgl@4.1.24/dist/iife/spine-webgl.js"></script>
    
    <!-- StableSpineRenderer -->
    <script src="micromodules/spine-renderer/StableSpineRenderer.js"></script>
    
    
    <!-- ÂøÖË¶Å„Å™„É¢„Ç∏„É•„Éº„É´Ë™≠„ÅøËæº„Åø -->
    <!-- ElementObserver Phase 1 (BBÁâπÂåñÁâà) -->
    <script src="micromodules/element-observer/ElementObserverCore.js"></script>
    <script src="micromodules/element-observer/ElementObserver.js"></script>
    
    <script src="micromodules/bounding-box/PureBoundingBoxCore.js"></script>
    <script src="micromodules/bounding-box/PureBoundingBoxBounds.js"></script>
    <script src="micromodules/bounding-box/PureBoundingBoxEvents.js"></script>
    <script src="micromodules/bounding-box/PureBoundingBoxUI.js"></script>
    <!-- üéØ 2ÊÆµÈöé„Éî„É≥Ë®≠ÂÆö„Ç∑„Çπ„ÉÜ„É† (ÊóßÁâà - Êñ∞Áâà„Å´Áµ±ÂêàÊ∏à„Åø) -->
    <!-- <script src="micromodules/bounding-box/ElementSelector.js"></script> -->
    <script src="micromodules/bounding-box/RelativeCoordinator.js"></script>
    
    <!-- AutoPin‰æùÂ≠ò„É¢„Ç∏„É•„Éº„É´ -->
    <script src="micromodules/bounding-box/AutoPinConfigManager.js"></script>
    <script src="micromodules/bounding-box/BackgroundDetector.js"></script>
    <script src="micromodules/bounding-box/AnchorCalculator.js"></script>
    <script src="micromodules/bounding-box/PersistenceManager.js"></script>
    <script src="micromodules/bounding-box/PinDisplayManager.js"></script>
    
    <script src="micromodules/bounding-box/PureBoundingBoxAutoPin.js"></script>
    <script src="micromodules/bounding-box/PureBoundingBox.js"></script>
    
    <!-- üéØ ÂäπÁéáÁöÑ„Éî„É≥„Ç∑„Çπ„ÉÜ„É† v2.0 - 3Â±§„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£ -->
    <script src="micromodules/bounding-box/ElementCalculator.js"></script>
    <script src="micromodules/bounding-box/PinRenderer.js"></script>
    <script src="micromodules/bounding-box/EfficientObserver.js"></script>
    
    <!-- üîÑ Phase 2: Êó¢Â≠ò„Ç∑„Çπ„ÉÜ„É†Áµ±Âêà„Ç¢„ÉÄ„Éó„Çø„Éº -->
    <script src="micromodules/bounding-box/ElementObserverAdapter.js"></script>
    
    <!-- üéØ 2ÊÆµÈöéUIÁµ±Âêà„Ç∑„Çπ„ÉÜ„É† - È´òÊ©üËÉΩ„Éî„É≥„Éâ„É©„ÉÉ„Ç∞UIÂæ©Êóß -->
    <!-- element-selectorÁâà„ÅÆ„Åø‰ΩøÁî®ÔºàÈáçË§á„Ç®„É©„ÉºÂõûÈÅøÔºâ -->
    <script src="micromodules/element-selector/ElementHighlighter.js"></script>
    <script src="micromodules/element-selector/ElementSelector.js"></script>
    <script src="micromodules/element-selector/TwoStageSelector.js"></script>
    
    <!-- üéØ SpineSettingsPersistence „Éû„Ç§„ÇØ„É≠„É¢„Ç∏„É•„Éº„É´Áµ±Âêà -->
    <script src="micromodules/spine-settings-persistence/SpineSettingsPersistence.js"></script>

    <script>
        // üö´ ÂÖ®„Å¶„ÅÆ„Ç≥„É≥„ÇΩ„Éº„É´„É≠„Ç∞„ÇíÂÆåÂÖ®ÁÑ°ÂäπÂåñÔºàË®∫Êñ≠Áî®„Å´ÂÖÉ„ÅÆÈñ¢Êï∞„Çí‰øùÂ≠òÔºâ
        window.originalConsoleLog = console.log;
        window.originalConsoleWarn = console.warn;
        window.originalConsoleInfo = console.info;
        window.originalConsoleDebug = console.debug;
        window.originalConsoleError = console.error;
        
        console.log = function() {};
        console.warn = function() {};  
        console.info = function() {};
        console.debug = function() {};
        console.error = function() {};
        
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let currentBoundingBox = null;
        let testCharacter = null;
        let logDisplay = null;
        let spineRenderer = null;
        let currentCharacterName = 'purattokun';  // „Éá„Éï„Ç©„É´„Éà„ÅØpurattokun
        
        // üéØ SpineSettingsPersistenceÁµ±Âêà
        let spinePersistence = null;
        
        // „É≠„Ç∞Èñ¢Êï∞
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const icon = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : 'üìù';
            const logMessage = `[${timestamp}] ${icon} ${message}\n`;
            
            if (logDisplay) {
                logDisplay.textContent += logMessage;
                logDisplay.scrollTop = logDisplay.scrollHeight;
            }
            
            // console.log(`${icon} ${message}`); // „Éá„Éê„ÉÉ„Ç∞„É≠„Ç∞ÁÑ°ÂäπÂåñ
        }
        
        // ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', async () => {
            testCharacter = document.getElementById('test-character');
            logDisplay = document.getElementById('log-display');
            
            log('üöÄ PureBoundingBoxAutoPin Áµ±Âêà„ÉÜ„Çπ„ÉàÈñãÂßã', 'info');
            
            // üéØ SpineSettingsPersistenceÂàùÊúüÂåñ
            initializeSpineSettingsPersistence();
            
            // „É¢„Ç∏„É•„Éº„É´Á¢∫Ë™ç
            await checkModules();
            
            // CanvasResizeControllerÈÄö‰ø°Ë®≠ÂÆö
            setupCanvasResizeMessaging();
            
            // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆö
            setupEventListeners();
            
            log('‚úÖ ÂàùÊúüÂåñÂÆå‰∫Ü - „ÉÜ„Çπ„ÉàÊ∫ñÂÇôÂÆå‰∫Ü', 'success');
        });
        
        // üéØ SpineSettingsPersistenceÂàùÊúüÂåñ
        function initializeSpineSettingsPersistence() {
            try {
                if (typeof SpineSettingsPersistence === 'function') {
                    spinePersistence = new SpineSettingsPersistence({
                        debug: true, // „Éá„Éê„ÉÉ„Ç∞„É≠„Ç∞ÊúâÂäπ
                        version: '1.0'
                    });
                    
                    // „Ç∞„É≠„Éº„Éê„É´„Å´ÂÖ¨ÈñãÔºà„Éá„Éê„ÉÉ„Ç∞Áî®Ôºâ
                    window.spinePersistence = spinePersistence;
                    
                    // üéØ SpineSettingsPersistenceÂàùÊúüÂåñÂÆå‰∫ÜÔºàÊóß„Éá„Éº„ÇøÁßªË°å„Ç∑„Çπ„ÉÜ„É†ÂâäÈô§Ê∏à„ÅøÔºâ
                    
                    log('üéØ SpineSettingsPersistenceÂàùÊúüÂåñÂÆå‰∫Ü', 'success');
                    return true;
                } else {
                    log('‚ùå SpineSettingsPersistence„ÇØ„É©„Çπ„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì', 'error');
                    return false;
                }
            } catch (error) {
                log(`‚ùå SpineSettingsPersistenceÂàùÊúüÂåñ„Ç®„É©„Éº: ${error.message}`, 'error');
                return false;
            }
        }
        
        // „É¢„Ç∏„É•„Éº„É´Á¢∫Ë™ç
        async function checkModules() {
            const modules = [
                { name: 'ElementObserverCore', obj: window.ElementObserverCore },
                { name: 'ElementObserver', obj: window.ElementObserver },
                { name: 'PureBoundingBoxCore', obj: window.PureBoundingBoxCore },
                { name: 'PureBoundingBoxUI', obj: window.PureBoundingBoxUI },
                // üéØ 2ÊÆµÈöé„Éî„É≥Ë®≠ÂÆö„Ç∑„Çπ„ÉÜ„É†
                { name: 'ElementHighlighter', obj: window.ElementHighlighter },
                { name: 'ElementSelector', obj: window.ElementSelector },
                { name: 'RelativeCoordinator', obj: window.RelativeCoordinator },
                { name: 'PureBoundingBoxAutoPin', obj: window.PureBoundingBoxAutoPin },
                { name: 'PureBoundingBox', obj: window.PureBoundingBox },
                { name: 'StableSpineRenderer', obj: window.StableSpineRenderer },
                // üéØ SpineSettingsPersistenceÁµ±Âêà
                { name: 'SpineSettingsPersistence', obj: window.SpineSettingsPersistence }
            ];
            
            let allLoaded = true;
            let statusHtml = '';
            
            for (const module of modules) {
                const loaded = typeof module.obj === 'function';
                const statusClass = loaded ? 'status-success' : 'status-danger';
                const statusText = loaded ? 'Ë™≠„ÅøËæº„ÅøÊ∏à„Åø' : 'Ë™≠„ÅøËæº„ÅøÂ§±Êïó';
                
                statusHtml += `
                    <div class="status-line">
                        <span class="status-indicator ${statusClass}"></span>
                        <span>${module.name}: ${statusText}</span>
                    </div>
                `;
                
                if (!loaded) {
                    allLoaded = false;
                    log(`‚ùå ${module.name} „É¢„Ç∏„É•„Éº„É´„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì`, 'error');
                } else {
                    log(`‚úÖ ${module.name} „É¢„Ç∏„É•„Éº„É´Ë™≠„ÅøËæº„ÅøÊàêÂäü`, 'success');
                }
            }
            
            document.getElementById('module-status').innerHTML = statusHtml;
            
            if (allLoaded) {
                log('üéâ ÂÖ®„É¢„Ç∏„É•„Éº„É´Ë™≠„ÅøËæº„ÅøÊàêÂäü', 'success');
            } else {
                log('‚ö†Ô∏è ‰∏ÄÈÉ®„É¢„Ç∏„É•„Éº„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'warning');
            }
        }
        
        // CanvasResizeController postMessageÈÄö‰ø°Ë®≠ÂÆö
        function setupCanvasResizeMessaging() {
            window.addEventListener('message', (event) => {
                // „Çª„Ç≠„É•„É™„ÉÜ„Ç£„ÉÅ„Çß„ÉÉ„ÇØÔºàÂêå„Åò„Ç™„É™„Ç∏„É≥„ÅÆ„ÅøÔºâ
                if (event.origin !== window.location.origin) {
                    return;
                }
                
                const { type, data } = event.data;
                
                switch (type) {
                    case 'canvasResize':
                        log(`üìê CanvasËß£ÂÉèÂ∫¶Â§âÊõ¥: ${data.size}px`, 'info');
                        if (spineRenderer && spineRenderer.canvas) {
                            // üö® Ê®™Ê≠™„Åø‰øÆÊ≠£: CanvasËß£ÂÉèÂ∫¶„ÇíÊ≠£ÊñπÂΩ¢„Å´Âº∑Âà∂Áµ±‰∏ÄÔºàDPRÂØæÂøúÔºâ
                            const cssSquareSize = data.size;
                            const dpr = window.devicePixelRatio || 1;
                            const bufferSquareSize = Math.round(cssSquareSize * dpr);
                            
                            spineRenderer.canvas.width = bufferSquareSize;
                            spineRenderer.canvas.height = bufferSquareSize;
                            
                            // CSSË°®Á§∫„Çµ„Ç§„Ç∫„ÇÇÊ≠£ÊñπÂΩ¢„Å´Áµ±‰∏ÄÔºàÊ≠™„ÅøÈò≤Ê≠¢Ôºâ
                            spineRenderer.canvas.style.width = `${cssSquareSize}px`;
                            spineRenderer.canvas.style.height = `${cssSquareSize}px`;
                            spineRenderer.canvas.style.aspectRatio = '1 / 1';
                            
                            spineRenderer.resize(cssSquareSize, cssSquareSize);
                            log(`‚úÖ CanvasËß£ÂÉèÂ∫¶Â§âÊõ¥ÂÆå‰∫ÜÔºàÊ≠£ÊñπÂΩ¢Áµ±‰∏Ä„ÉªDPRÂØæÂøúÔºâ: CSS ${cssSquareSize}px, „Éê„ÉÉ„Éï„Ç° ${bufferSquareSize}px`, 'success');
                            
                            // üéØ SpineSettingsPersistenceËá™Âãï‰øùÂ≠ò
                            saveSpineSettingsIntegrated(currentCharacterName, { canvasSize: data.size });
                        }
                        break;
                        
                    case 'scaleChanged':
                        log(`üìè „Çπ„Ç±„Éº„É´Â§âÊõ¥: X${data.scaleX}, Y${data.scaleY}`, 'info');
                        if (spineRenderer && spineRenderer.skeleton) {
                            // üö® Ê®™Ê≠™„Åø‰øÆÊ≠£: „Çπ„Ç±„Éº„É´„ÇíÁµ±‰∏Ä„Åó„Å¶Ê≠™„Åø„ÇíÈò≤Ê≠¢
                            const unifiedScale = Math.min(data.scaleX, data.scaleY);
                            spineRenderer.skeleton.scaleX = unifiedScale;
                            spineRenderer.skeleton.scaleY = unifiedScale;
                            log(`‚úÖ „Çπ„Ç±„Éº„É´Â§âÊõ¥ÂÆå‰∫ÜÔºàÁµ±‰∏ÄÂÄ§: ${unifiedScale}Ôºâ`, 'success');
                            
                            // üéØ SpineSettingsPersistenceËá™Âãï‰øùÂ≠òÔºàÁµ±‰∏ÄÂÄ§„Åß‰øùÂ≠òÔºâ
                            saveSpineSettingsIntegrated(currentCharacterName, { 
                                scaleX: unifiedScale, 
                                scaleY: unifiedScale 
                            });
                        }
                        break;
                        
                    case 'positionChanged':
                        log(`üìç ‰ΩçÁΩÆÂ§âÊõ¥: X${data.x}, Y${data.y}`, 'info');
                        if (spineRenderer && spineRenderer.skeleton) {
                            spineRenderer.skeleton.x = data.x;
                            spineRenderer.skeleton.y = data.y;
                            log('‚úÖ ‰ΩçÁΩÆÂ§âÊõ¥ÂÆå‰∫Ü', 'success');
                            
                            // üéØ CanvasÂÜÖSpine‰ΩçÁΩÆ„ÇíSpineSettingsPersistence„Åß‰øùÂ≠ò
                            // ÈáçË¶Å: CanvasÂÜÖSpine‰ΩçÁΩÆ„Å®BB‰ΩçÁΩÆ„ÅØÂà•Áâ©„Å®„Åó„Å¶Êâ±„ÅÜ
                            saveSpineSettingsIntegrated(currentCharacterName, {
                                positionX: data.x,
                                positionY: data.y
                            });
                        }
                        break;
                        
                    case 'uiReady':
                        log('üéõÔ∏è CanvasResizeController UIÂàùÊúüÂåñÂÆå‰∫Ü', 'success');
                        // ÁèæÂú®„ÅÆÁä∂ÊÖã„Çíiframe„Å´ÈÄÅ‰ø°
                        sendToCanvasResizeUI('updateUIState', {
                            canvasSize: spineRenderer ? Math.max(spineRenderer.canvas.width, spineRenderer.canvas.height) : 400,
                            scaleX: spineRenderer ? spineRenderer.skeleton.scaleX : 1.0,
                            scaleY: spineRenderer ? spineRenderer.skeleton.scaleY : 1.0
                            // üö® ‰ΩçÁΩÆÊÉÖÂ†±„ÅØPureBoundingBoxAutoPin„Å´ÂßîË≠≤ÔºàÈáçË§áÊéíÈô§Ôºâ
                        });
                        break;
                        
                    case 'uiLog':
                        log(`[CanvasResizeUI] ${data.message}`, 'info');
                        break;
                        
                    default:
                        // Êú™ÂØæÂøú„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏„Çø„Ç§„Éó
                        break;
                }
            });
            
            log('üì° CanvasResizeController postMessageÈÄö‰ø°Ë®≠ÂÆöÂÆå‰∫Ü', 'success');
        }
        
        // CanvasResizeController UI„Å´„É°„ÉÉ„Çª„Éº„Ç∏ÈÄÅ‰ø°
        function sendToCanvasResizeUI(type, data) {
            const iframe = document.getElementById('canvas-resize-iframe');
            if (iframe && iframe.contentWindow) {
                iframe.contentWindow.postMessage({ type, data }, window.location.origin);
            }
        }

        // „Ç≠„É£„É©„ÇØ„Çø„Éº„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆöÔºàÂÖ±ÈÄöÈñ¢Êï∞Ôºâ
        function setupCharacterClickListener(element) {
            if (!element) {
                log('‚ùå Ë¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì - „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆö„Çπ„Ç≠„ÉÉ„Éó', 'error');
                return;
            }
            
            log(`üîß „ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆö: ${element.id || element.tagName}`, 'info');
            
            // Êó¢Â≠ò„ÅÆ„É™„Çπ„Éä„Éº„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØÂâäÈô§„Åó„Å¶„Åã„ÇâËøΩÂä†ÔºàÈáçË§áÈò≤Ê≠¢Ôºâ
            element.removeEventListener('click', characterClickHandler);
            element.addEventListener('click', characterClickHandler);
        }
        
        // „Ç≠„É£„É©„ÇØ„Çø„Éº„ÇØ„É™„ÉÉ„ÇØ„Éè„É≥„Éâ„É©„ÉºÔºàÂÖ±ÈÄöÈñ¢Êï∞Ôºâ
        function characterClickHandler(e) {
            log(`üñ±Ô∏è „Ç≠„É£„É©„ÇØ„Çø„Éº„ÇØ„É™„ÉÉ„ÇØÊ§úÂá∫: ${e.target.tagName} (${e.target.id || 'IDÁÑ°„Åó'})`, 'info');
            e.stopPropagation();
            testBasicBoundingBox();
        }

        // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆöÔºà„Éû„Éã„É•„Ç¢„É´Ê∫ñÊã†ÁâàÔºâ
        function setupEventListeners() {
            // Spine„Ç≠„É£„É©„ÇØ„Çø„ÉºË™≠„ÅøËæº„ÅøÂæå„Å´testCharacter„ÅåË®≠ÂÆö„Åï„Çå„Çã„Åü„ÇÅ„ÄÅ
            // ÂàùÊúüÂåñÊôÇ„ÅØÂü∫Êú¨ÁöÑ„Å™„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÅÆ„ÅøË®≠ÂÆö
            log('‚ö†Ô∏è testCharacter„ÅØSpineË™≠„ÅøËæº„ÅøÂæå„Å´Ë®≠ÂÆö„Åï„Çå„Åæ„Åô', 'info');
            log('üí° „Äåüì• SpineË™≠„ÅøËæº„Åø„Äç„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶Spine„Ç≠„É£„É©„ÇØ„Çø„Éº„ÇíË™≠„ÅøËæº„Çì„Åß„Åè„Å†„Åï„ÅÑ', 'info');
            
            // ‰øùÂ≠òÂÆå‰∫Ü„Ç§„Éô„É≥„Éà„ÅÆÁõ£Ë¶ñ
            document.addEventListener('boundingBoxSaveCompleted', (event) => {
                const data = event.detail;
                log('üíæ „Éê„Ç¶„É≥„Éá„Ç£„É≥„Ç∞„Éú„ÉÉ„ÇØ„Çπ‰øùÂ≠òÂÆå‰∫Ü„Ç§„Éô„É≥„ÉàÂèó‰ø°', 'success');
                
                if (data.autoPinResult && data.autoPinResult.success) {
                    log(`üìç Ëá™Âãï„Éî„É≥ÈÅ©Áî®ÊàêÂäü: „Ç¢„É≥„Ç´„Éº${data.autoPinResult.pinConfig.anchor}`, 'success');
                } else {
                    log('üìù Âü∫Êú¨‰øùÂ≠ò„ÅÆ„ÅøÔºàËá™Âãï„Éî„É≥„Å™„ÅóÔºâ', 'info');
                }
            });
            
            // „Ç¶„Ç£„É≥„Éâ„Ç¶„É™„Çµ„Ç§„Ç∫„ÉÜ„Çπ„ÉàÁî® + BBÊØîÁéá‰øùÊåÅÊ©üËÉΩ
            let resizeTimeout;
            
            // 1. „Ç¶„Ç£„É≥„Éâ„Ç¶„É™„Çµ„Ç§„Ç∫Áõ£Ë¶ñ
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    log('üìê „Ç¶„Ç£„É≥„Éâ„Ç¶„É™„Çµ„Ç§„Ç∫Ê§úÂá∫ - Ëá™ÂãïËøΩÂæì„ÉÜ„Çπ„Éà', 'info');
                    // üéØ BB‰ΩçÁΩÆÁÆ°ÁêÜ„ÅØPureBoundingBoxAutoPin„Å´ÂßîË≠≤ - Áã¨Ëá™„Ç∑„Çπ„ÉÜ„É†ÂâäÈô§
                }, 100);
            });
            
            // 2. heroSection„Çµ„Ç§„Ç∫Â§âÊõ¥Áõ£Ë¶ñÔºàResizeObserverÔºâ
            const heroSection = document.getElementById('test-hero');
            if (heroSection) {
                log('üîç ResizeObserver ÂàùÊúüÂåñÈñãÂßã', 'info');
                const resizeObserver = new ResizeObserver(entries => {
                    log(`üîç ResizeObserver „Éà„É™„Ç¨„Éº: ${entries.length} „Ç®„É≥„Éà„É™„Éº`, 'info');
                    for (const entry of entries) {
                        const { width, height } = entry.contentRect;
                        log(`üìê „Éí„Éº„É≠„Éº„Çª„ÇØ„Ç∑„Éß„É≥„Çµ„Ç§„Ç∫Â§âÊõ¥Ê§úÂá∫: ${width.toFixed(0)}x${height.toFixed(0)}`, 'info');
                        
                        clearTimeout(resizeTimeout);
                        resizeTimeout = setTimeout(() => {
                            log('üìê „Éí„Éº„É≠„Éº„Çª„ÇØ„Ç∑„Éß„É≥„É™„Çµ„Ç§„Ç∫Ê§úÂá∫ - BBÊØîÁéá‰øùÊåÅÂÆüË°å', 'info');
                            // üéØ BB‰ΩçÁΩÆÁÆ°ÁêÜ„ÅØPureBoundingBoxAutoPin„Å´ÂßîË≠≤ - Áã¨Ëá™„Ç∑„Çπ„ÉÜ„É†ÂâäÈô§
                        }, 100);
                    }
                });
                
                resizeObserver.observe(heroSection);
                log('‚úÖ ResizeObserverÁõ£Ë¶ñÈñãÂßã', 'success');
            } else {
                log('‚ùå „Éí„Éº„É≠„Éº„Çª„ÇØ„Ç∑„Éß„É≥Ë¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì', 'error');
            }
        }
        
        // üö® Áã¨Ëá™BB„Ç∑„Çπ„ÉÜ„É†ÂâäÈô§: PureBoundingBoxAutoPin„Å´‰∏ÄÊú¨Âåñ
        // maintainBBRatioAfterResize()Èñ¢Êï∞„ÅØÂâäÈô§ - PureBoundingBoxAutoPin„Å´ÂßîË≠≤
        
        // üö® Áã¨Ëá™‰ΩçÁΩÆÂæ©ÂÖÉ„Ç∑„Çπ„ÉÜ„É†ÂâäÈô§: PureBoundingBoxAutoPin„Å´‰∏ÄÊú¨Âåñ
        // restoreSavedPosition()Èñ¢Êï∞„ÅØÂâäÈô§ - PureBoundingBoxAutoPin„Å´ÂßîË≠≤
        
        // Âü∫Êú¨„Éê„Ç¶„É≥„Éá„Ç£„É≥„Ç∞„Éú„ÉÉ„ÇØ„Çπ„ÉÜ„Çπ„Éà
        async function testBasicBoundingBox() {
            try {
                log('üì¶ Âü∫Êú¨„Éê„Ç¶„É≥„Éá„Ç£„É≥„Ç∞„Éú„ÉÉ„ÇØ„Çπ„ÉÜ„Çπ„ÉàÈñãÂßã', 'info');
                
                // üîç Ë©≥Á¥∞„Å™„É¢„Ç∏„É•„Éº„É´Áä∂ÊÖãÁ¢∫Ë™çÔºà„Éá„Éê„ÉÉ„Ç∞Ôºâ
                const moduleStatus = {
                    PureBoundingBoxCore: typeof window.PureBoundingBoxCore !== 'undefined',
                    PureBoundingBoxBounds: typeof window.PureBoundingBoxBounds !== 'undefined',
                    PureBoundingBoxUI: typeof window.PureBoundingBoxUI !== 'undefined',
                    PureBoundingBoxEvents: typeof window.PureBoundingBoxEvents !== 'undefined',
                    PureBoundingBox: typeof window.PureBoundingBox !== 'undefined'
                };
                
                // console.log('üîç „É¢„Ç∏„É•„Éº„É´Ë™≠„ÅøËæº„ÅøÁä∂Ê≥Å:', moduleStatus); // „Éá„Éê„ÉÉ„Ç∞„É≠„Ç∞ÁÑ°ÂäπÂåñ
                log(`üîç „É¢„Ç∏„É•„Éº„É´Áä∂Ê≥Å: Core=${moduleStatus.PureBoundingBoxCore}, Bounds=${moduleStatus.PureBoundingBoxBounds}, UI=${moduleStatus.PureBoundingBoxUI}, Events=${moduleStatus.PureBoundingBoxEvents}`, 'info');
                
                const missingModules = Object.keys(moduleStatus).filter(key => !moduleStatus[key]);
                if (missingModules.length > 0) {
                    log(`‚ùå ‰∏çË∂≥„É¢„Ç∏„É•„Éº„É´: ${missingModules.join(', ')}`, 'error');
                    console.error('‰∏çË∂≥„É¢„Ç∏„É•„Éº„É´Ë©≥Á¥∞:', missingModules);
                    return;
                }
                
                // „Éá„Éê„ÉÉ„Ç∞: PureBoundingBox„ÇØ„É©„ÇπÂ≠òÂú®Á¢∫Ë™ç
                if (typeof PureBoundingBox === 'undefined') {
                    log('‚ùå PureBoundingBox„ÇØ„É©„Çπ„ÅåË™≠„ÅøËæº„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì', 'error');
                    return;
                }
                
                // „Éá„Éê„ÉÉ„Ç∞: testCharacterÂ≠òÂú®Á¢∫Ë™ç
                if (!testCharacter) {
                    log('‚ùå testCharacterË¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì', 'error');
                    return;
                }
                
                log(`üéØ ÂØæË±°Ë¶ÅÁ¥†: ${testCharacter.id} (${testCharacter.tagName})`, 'info');
                
                // Êó¢Â≠ò„ÅÆ„Éê„Ç¶„É≥„Éá„Ç£„É≥„Ç∞„Éú„ÉÉ„ÇØ„Çπ„Çí„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
                if (currentBoundingBox) {
                    log('üßπ Êó¢Â≠òBB„Çí„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó‰∏≠...', 'info');
                    currentBoundingBox.cleanup();
                    currentBoundingBox = null;
                }
                
                // üéØ ‰ΩçÁΩÆÂæ©ÂÖÉ„ÅØPureBoundingBoxAutoPin„Å´ÂßîË≠≤ - Áã¨Ëá™„Ç∑„Çπ„ÉÜ„É†ÂâäÈô§
                
                // Êñ∞„Åó„ÅÑ„Éê„Ç¶„É≥„Éá„Ç£„É≥„Ç∞„Éú„ÉÉ„ÇØ„Çπ‰ΩúÊàê
                log('üîß Êñ∞„Åó„ÅÑBB„Çí‰ΩúÊàê‰∏≠...', 'info');
                currentBoundingBox = new PureBoundingBox({
                    targetElement: testCharacter,
                    nodeId: 'test-character'
                });
                
                log('‚úÖ PureBoundingBox „Ç§„É≥„Çπ„Çø„É≥„Çπ‰ΩúÊàêÂÆå‰∫Ü', 'success');
                
                // ÂÆüË°å
                const result = await currentBoundingBox.execute();
                
                if (result.success) {
                    log('‚úÖ „Éê„Ç¶„É≥„Éá„Ç£„É≥„Ç∞„Éú„ÉÉ„ÇØ„Çπ‰ΩúÊàêÊàêÂäü', 'success');
                    log(`üìä ÂàùÊúübounds: ${JSON.stringify(result.bounds)}`, 'info');
                } else {
                    log(`‚ùå „Éê„Ç¶„É≥„Éá„Ç£„É≥„Ç∞„Éú„ÉÉ„ÇØ„Çπ‰ΩúÊàêÂ§±Êïó: ${result.error}`, 'error');
                }
                
            } catch (error) {
                log(`‚ùå „ÉÜ„Çπ„ÉàÂÆüË°å„Ç®„É©„Éº: ${error.message}`, 'error');
                console.error('„ÉÜ„Çπ„Éà„Ç®„É©„Éº:', error);
            }
        }
        
        // Âè≥„ÇØ„É™„ÉÉ„ÇØ„É°„Éã„É•„Éº„ÉÜ„Çπ„Éà
        async function testRightClickMenu() {
            try {
                log('üñ±Ô∏è Âè≥„ÇØ„É™„ÉÉ„ÇØ„É°„Éã„É•„Éº„ÉÜ„Çπ„ÉàÈñãÂßã', 'info');
                
                if (!currentBoundingBox) {
                    log('‚ö†Ô∏è ÂÖà„Å´„Éê„Ç¶„É≥„Éá„Ç£„É≥„Ç∞„Éú„ÉÉ„ÇØ„Çπ„ÉÜ„Çπ„Éà„ÇíÂÆüË°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'warning');
                    return;
                }
                
                // BB„ÅÆ‰ΩçÁΩÆ„Å®„Çµ„Ç§„Ç∫„ÇíÁ¢∫Ë™ç
                const bbElement = currentBoundingBox.element;
                if (bbElement) {
                    const rect = bbElement.getBoundingClientRect();
                    log(`üìç BB‰ΩçÁΩÆ: (${rect.left.toFixed(1)}, ${rect.top.toFixed(1)})`, 'info');
                    log(`üìè BB„Çµ„Ç§„Ç∫: ${rect.width.toFixed(1)} √ó ${rect.height.toFixed(1)}`, 'info');
                }
                
                log('üìã Âè≥„ÇØ„É™„ÉÉ„ÇØ„É°„Éã„É•„Éº„ÅÆ‰ΩøÁî®ÊñπÊ≥ï:', 'info');
                log('1. Èùí„ÅÑÊû†„ÅÆ„Éê„Ç¶„É≥„Éá„Ç£„É≥„Ç∞„Éú„ÉÉ„ÇØ„Çπ‰∏ä„ÅßÂè≥„ÇØ„É™„ÉÉ„ÇØ', 'info');
                log('2. Ë°®Á§∫„Åï„Çå„Åü„É°„Éã„É•„Éº„Åã„Çâ„Äå‰øùÂ≠ò„Äç„ÇíÈÅ∏Êäû', 'info');
                log('3. Ëá™ÂãïÁöÑ„Å´AutoPinÊ©üËÉΩ„ÅßÊúÄÈÅ©„Å™„Éî„É≥‰ΩçÁΩÆ„ÅåË®≠ÂÆö„Åï„Çå„Åæ„Åô', 'info');
                log('4. „Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà„Ç≠„Éº:', 'info');
                log('   - Enter: ‰øùÂ≠òÔºàËá™Âãï„Éî„É≥ÈÅ©Áî®Ôºâ', 'info');
                log('   - Escape: „Ç≠„É£„É≥„Çª„É´', 'info');
                log('   - Ctrl+S: ‰øùÂ≠ò', 'info');
                
                // VIÂ∫ßÊ®ôÁ≥ªÁä∂ÊÖãÁ¢∫Ë™ç
                if (currentBoundingBox.ui && currentBoundingBox.ui.autoPin) {
                    const state = currentBoundingBox.ui.autoPin.getState();
                    log(`üìä AutoPinÁä∂ÊÖã: „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Éî„É≥${state.activePinsCount}ÂÄã`, 'info');
                    
                    // VIÂ∫ßÊ®ôÁ≥ª„ÅÆË©≥Á¥∞ÊÉÖÂ†±
                    const viSystem = currentBoundingBox.ui.autoPin;
                    if (viSystem.currentVIRatio) {
                        log(`üéØ VIÂ∫ßÊ®ôÁ≥ª: ÊØîÁéá ${viSystem.currentVIRatio.toFixed(4)}`, 'info');
                    }
                    
                    // Âè≥„ÇØ„É™„ÉÉ„ÇØ„É°„Éã„É•„Éº„Çí„Éó„É≠„Ç∞„É©„É†ÁöÑ„Å´Ë°®Á§∫„Åó„Å¶„ÉÜ„Çπ„Éà
                    log('üí° ÂÆüÈöõ„Å´BB‰∏ä„ÅßÂè≥„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„É°„Éã„É•„Éº„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'info');
                    log('üìå ‰øùÂ≠òÊôÇ„Å´AutoPin„Åå‰ª•‰∏ã„ÅÆ9„Éù„Ç§„É≥„Éà„Åã„ÇâÊúÄÈÅ©‰ΩçÁΩÆ„ÇíÈÅ∏Êäû:', 'info');
                    log('   TL(Â∑¶‰∏ä) TC(‰∏ä‰∏≠) TR(Âè≥‰∏ä)', 'info');
                    log('   ML(Â∑¶‰∏≠) MC(‰∏≠Â§Æ) MR(Âè≥‰∏≠)', 'info');
                    log('   BL(Â∑¶‰∏ã) BC(‰∏ã‰∏≠) BR(Âè≥‰∏ã)', 'info');
                    
                } else {
                    log('‚ùå AutoPin„Ç∑„Çπ„ÉÜ„É†„ÅåÂà©Áî®„Åß„Åç„Åæ„Åõ„Çì', 'error');
                }
                
                // UIÁä∂ÊÖã„ÅÆË©≥Á¥∞Á¢∫Ë™ç
                if (currentBoundingBox.ui) {
                    log('‚úÖ Âè≥„ÇØ„É™„ÉÉ„ÇØ„É°„Éã„É•„Éº„Ç∑„Çπ„ÉÜ„É†Âà©Áî®ÂèØËÉΩ', 'success');
                    log('üéÆ BB„Çí„Éâ„É©„ÉÉ„Ç∞„Åó„Å¶‰ΩçÁΩÆ„ÇíË™øÊï¥Âæå„ÄÅÂè≥„ÇØ„É™„ÉÉ„ÇØ‚Üí‰øùÂ≠ò„Åß„Éî„É≥ÈÖçÁΩÆ', 'info');
                    
                    // Âè≥„ÇØ„É™„ÉÉ„ÇØ„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥Ê©üËÉΩ„ÅÆÊèê‰æõ
                    log('', 'info');
                    log('üí° „ÉÜ„Çπ„ÉàÁî®Âè≥„ÇØ„É™„ÉÉ„ÇØ„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥Ê©üËÉΩ:', 'info');
                    log('‰ª•‰∏ã„ÅÆ„Ç≥„Éû„É≥„Éâ„ÅßBB„ÅÆÂè≥„ÇØ„É™„ÉÉ„ÇØ„Çí„ÉÜ„Çπ„Éà„Åß„Åç„Åæ„Åô:', 'info');
                    log('simulateRightClickOnBB() // BB‰∏≠Â§Æ„ÅßÂè≥„ÇØ„É™„ÉÉ„ÇØ„Çí„Ç∑„Éü„É•„É¨„Éº„Éà', 'info');
                    
                    // „Ç∞„É≠„Éº„Éê„É´Èñ¢Êï∞„Å®„Åó„Å¶ÁôªÈå≤
                    window.simulateRightClickOnBB = () => {
                        if (bbElement) {
                            const rect = bbElement.getBoundingClientRect();
                            const centerX = rect.left + rect.width / 2;
                            const centerY = rect.top + rect.height / 2;
                            
                            // Âè≥„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà„Çí‰ΩúÊàê
                            const rightClickEvent = new MouseEvent('contextmenu', {
                                bubbles: true,
                                cancelable: true,
                                clientX: centerX,
                                clientY: centerY,
                                button: 2,
                                buttons: 2
                            });
                            
                            log(`üñ±Ô∏è BB‰∏≠Â§Æ(${centerX.toFixed(1)}, ${centerY.toFixed(1)})„ÅßÂè≥„ÇØ„É™„ÉÉ„ÇØ„Ç∑„Éü„É•„É¨„Éº„Éà`, 'info');
                            bbElement.dispatchEvent(rightClickEvent);
                        } else {
                            log('‚ùå BB„Ç®„É¨„É°„É≥„Éà„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì', 'error');
                        }
                    };
                    
                } else {
                    log('‚ùå UI„Ç∑„Çπ„ÉÜ„É†„ÅåÂà©Áî®„Åß„Åç„Åæ„Åõ„Çì', 'error');
                }
                
            } catch (error) {
                log(`‚ùå Âè≥„ÇØ„É™„ÉÉ„ÇØ„É°„Éã„É•„Éº„ÉÜ„Çπ„Éà„Ç®„É©„Éº: ${error.message}`, 'error');
                console.error('Âè≥„ÇØ„É™„ÉÉ„ÇØ„É°„Éã„É•„Éº„ÉÜ„Çπ„Éà„Ç®„É©„Éº:', error);
            }
        }
        
        // „É™„Çµ„Ç§„Ç∫„ÉÜ„Çπ„Éà
        // üéØ ‰øÆÈ£æ„Ç≠„Éº„ÉÜ„Çπ„ÉàÊ©üËÉΩ
        function testModifierKeys() {
            log('üéÆ ‰øÆÈ£æ„Ç≠„Éº„ÉÜ„Çπ„ÉàÈñãÂßã', 'info');
            
            const testCharacter = document.getElementById('test-character');
            if (!testCharacter) {
                log('‚ùå „ÉÜ„Çπ„Éà„Ç≠„É£„É©„ÇØ„Çø„Éº„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì', 'error');
                return;
            }
            
            log('üìã ‰øÆÈ£æ„Ç≠„Éº„ÉÜ„Çπ„ÉàË™¨Êòé:', 'info');
            log('1. „Ç≠„É£„É©„ÇØ„Çø„Éº„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶BBË°®Á§∫', 'info');
            log('2. ÂêÑ‰øÆÈ£æ„Ç≠„Éº„ÇíË©¶„Åó„Å¶„Åè„Å†„Åï„ÅÑ:', 'info');
            log('   - Shift: Á∏¶Ê®™ÊØî‰øùÊåÅ', 'info');
            log('   - Alt: ‰∏≠ÂøÉÂõ∫ÂÆö„É™„Çµ„Ç§„Ç∫', 'info');
            log('   - Ctrl: „Ç∞„É™„ÉÉ„Éâ„Çπ„Éä„ÉÉ„Éó(10px)', 'info');
            log('   - ‰ΩµÁî®: Shift+Alt, Shift+Ctrl, Alt+Ctrl, Shift+Alt+Ctrl', 'info');
            log('3. „Éè„É≥„Éâ„É´„Çí„Éâ„É©„ÉÉ„Ç∞„Åó„Å¶Âãï‰ΩúÁ¢∫Ë™ç', 'success');
        }

        // BB„Ç∑„Çπ„ÉÜ„É†Ë®∫Êñ≠Èñ¢Êï∞ÔºàÂº∑ÂåñÁâàÔºâ
        function debugBBSystem() {
            log('üîç BB„Ç∑„Çπ„ÉÜ„É†Ë©≥Á¥∞Ë®∫Êñ≠ÈñãÂßã', 'info');
            
            // 1. ÂøÖÈ†à„ÇØ„É©„ÇπÁ¢∫Ë™ç
            const classes = ['PureBoundingBox', 'ElementObserver'];
            classes.forEach(className => {
                if (typeof window[className] !== 'undefined') {
                    log(`‚úÖ ${className}: Ë™≠„ÅøËæº„ÅøÊ∏à„Åø`, 'success');
                } else {
                    log(`‚ùå ${className}: Ë™≠„ÅøËæº„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì`, 'error');
                }
            });
            
            // 2. „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞Áä∂ÊÖãÁ¢∫Ë™ç
            log('üîç „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞Áä∂ÊÖã:', 'info');
            log(`testCharacter: ${testCharacter ? (testCharacter.id || testCharacter.tagName) : 'null'}`, 'info');
            log(`currentBoundingBox: ${currentBoundingBox ? 'Â≠òÂú®' : 'null'}`, 'info');
            log(`spineRenderer: ${spineRenderer ? 'Â≠òÂú®' : 'null'}`, 'info');
            
            // 3. DOMË¶ÅÁ¥†„ÅÆË©≥Á¥∞Á¢∫Ë™ç
            const testChar = document.getElementById('test-character');
            const allCanvases = document.querySelectorAll('canvas');
            const spineCanvas = document.querySelector('canvas[id*="spine"]');
            
            log('üîç DOMË¶ÅÁ¥†Áä∂Ê≥Å:', 'info');
            log(`ÂÖ®CanvasË¶ÅÁ¥†Êï∞: ${allCanvases.length}`, 'info');
            allCanvases.forEach((canvas, index) => {
                const isVisible = canvas.style.display !== 'none' && canvas.offsetWidth > 0;
                log(`  Canvas ${index + 1}: ${canvas.id || 'IDÁÑ°„Åó'} - ${isVisible ? 'Ë°®Á§∫' : 'ÈùûË°®Á§∫'}`, 'info');
                log(`    „Çµ„Ç§„Ç∫: ${canvas.width}√ó${canvas.height}px (CSS: ${canvas.style.width || 'auto'}√ó${canvas.style.height || 'auto'})`, 'info');
            });
            
            if (testChar) {
                const isVisible = testChar.style.display !== 'none' && testChar.offsetWidth > 0;
                log(`test-character: ${isVisible ? '‚úÖ Ë°®Á§∫‰∏≠' : '‚ö†Ô∏è ÈùûË°®Á§∫'}`, isVisible ? 'success' : 'warning');
                log(`  ‰ΩçÁΩÆ: ${testChar.style.left || 'auto'}, ${testChar.style.top || 'auto'}`, 'info');
                log(`  „Çµ„Ç§„Ç∫: ${testChar.style.width || 'auto'} √ó ${testChar.style.height || 'auto'}`, 'info');
                
                // testCharacter„Å®„Ç∞„É≠„Éº„Éê„É´Â§âÊï∞„ÅÆ‰∏ÄËá¥Á¢∫Ë™ç
                if (testCharacter === testChar) {
                    log('‚úÖ „Ç∞„É≠„Éº„Éê„É´testCharacter: DOMË¶ÅÁ¥†„Å®‰∏ÄËá¥', 'success');
                } else {
                    log('‚ö†Ô∏è „Ç∞„É≠„Éº„Éê„É´testCharacter: DOMË¶ÅÁ¥†„Å®‰∏ç‰∏ÄËá¥', 'warning');
                }
            } else {
                log('‚ùå test-characterË¶ÅÁ¥†: Ë¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì', 'error');
            }
            
            // 4. „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË©≥Á¥∞Á¢∫Ë™ç
            log('üîç „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºÁ¢∫Ë™ç:', 'info');
            if (testCharacter) {
                // „ÉÜ„Çπ„Éà„ÇØ„É™„ÉÉ„ÇØÂÆüË°å
                log('üß™ „ÉÜ„Çπ„Éà„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„ÉàÁô∫ÁÅ´...', 'info');
                try {
                    const clickEvent = new Event('click', { bubbles: true });
                    testCharacter.dispatchEvent(clickEvent);
                    log('‚úÖ „ÉÜ„Çπ„Éà„ÇØ„É™„ÉÉ„ÇØÊàêÂäü', 'success');
                } catch (error) {
                    log(`‚ùå „ÉÜ„Çπ„Éà„ÇØ„É™„ÉÉ„ÇØ„Ç®„É©„Éº: ${error.message}`, 'error');
                }
            } else {
                log('‚ö†Ô∏è testCharacter„ÅåÊú™Ë®≠ÂÆö„ÅÆ„Åü„ÇÅ„ÉÜ„Çπ„Éà„ÇØ„É™„ÉÉ„ÇØ‰∏çÂèØ', 'warning');
            }
            
            // 5. ÊâãÂãï„ÅßBB‰ΩúÊàê„ÉÜ„Çπ„Éà
            log('üß™ ÊâãÂãïBB„ÉÜ„Çπ„ÉàÂÆüË°å...', 'info');
            try {
                testBasicBoundingBox();
                log('‚úÖ ÊâãÂãïBB„ÉÜ„Çπ„ÉàÂÆüË°åÂÆå‰∫Ü', 'success');
            } catch (error) {
                log(`‚ùå ÊâãÂãïBB„ÉÜ„Çπ„Éà„Ç®„É©„Éº: ${error.message}`, 'error');
            }
        }
        
        // üéØ AutoPin„Ç∑„Çπ„ÉÜ„É†Á∑èÂêà„ÉÜ„Çπ„Éà
        async function testAutoPinSystem() {
            try {
                log('üéØ AutoPin „Ç∑„Çπ„ÉÜ„É†Á∑èÂêà„ÉÜ„Çπ„ÉàÈñãÂßã', 'info');
                
                // 1. ÂâçÊèêÊù°‰ª∂Á¢∫Ë™ç
                if (!testCharacter) {
                    log('‚ùå testCharacterÊú™Ë®≠ÂÆö - ÂÖà„Å´Spine„Ç≠„É£„É©„ÇØ„Çø„Éº„ÇíË™≠„ÅøËæº„Çì„Åß„Åè„Å†„Åï„ÅÑ', 'error');
                    return;
                }
                
                if (!currentBoundingBox) {
                    log('üì¶ „Éê„Ç¶„É≥„Éá„Ç£„É≥„Ç∞„Éú„ÉÉ„ÇØ„Çπ„Çí‰ΩúÊàê‰∏≠...', 'info');
                    await testBasicBoundingBox();
                }
                
                if (!currentBoundingBox || !currentBoundingBox.autoPin) {
                    log('‚ùå AutoPinÊ©üËÉΩ„ÅåÂà©Áî®„Åß„Åç„Åæ„Åõ„Çì', 'error');
                    return;
                }
                
                // 2. AutoPin„Ç∑„Çπ„ÉÜ„É†Áä∂ÊÖãÁ¢∫Ë™ç
                log('üîç AutoPin „Ç∑„Çπ„ÉÜ„É†Áä∂ÊÖãÁ¢∫Ë™ç:', 'info');
                const autoPinState = currentBoundingBox.autoPin.getState();
                log(`„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Éî„É≥Êï∞: ${autoPinState.activePinsCount}`, 'info');
                log(`„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÁµ±Ë®à: ÊàêÂäü${autoPinState.performanceMetrics.successCount}‰ª∂, Â§±Êïó${autoPinState.performanceMetrics.failureCount}‰ª∂`, 'info');
                
                // üîç ElementObserverÁµ±ÂêàÁä∂ÊÖã„ÅÆË©≥Á¥∞Ë®∫Êñ≠
                log('üîç ElementObserverÁµ±ÂêàË®∫Êñ≠:', 'info');
                const observer = currentBoundingBox.autoPin.observer;
                if (observer) {
                    log(`‚úÖ ElementObserver „Ç§„É≥„Çπ„Çø„É≥„Çπ: Â≠òÂú®`, 'success');
                    log(`üìã observe „É°„ÇΩ„ÉÉ„Éâ: ${typeof observer.observe}`, 'info');
                    log(`üìã ElementObserver „ÇØ„É©„Çπ: ${observer.constructor.name}`, 'info');
                    
                    // observe„É°„ÇΩ„ÉÉ„Éâ„ÅåÈñ¢Êï∞„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                    if (typeof observer.observe === 'function') {
                        log('‚úÖ observe „É°„ÇΩ„ÉÉ„Éâ: Âà©Áî®ÂèØËÉΩ', 'success');
                    } else {
                        log('‚ùå observe „É°„ÇΩ„ÉÉ„Éâ: Âà©Áî®‰∏çÂèØ', 'error');
                    }
                } else {
                    log('‚ùå ElementObserver „Ç§„É≥„Çπ„Çø„É≥„Çπ: null', 'error');
                }
                
                // „Ç∞„É≠„Éº„Éê„É´ElementObserver„ÇØ„É©„Çπ„ÅÆÁ¢∫Ë™ç
                log('üîç „Ç∞„É≠„Éº„Éê„É´ElementObserverÁ¢∫Ë™ç:', 'info');
                if (typeof window.ElementObserver !== 'undefined') {
                    log('‚úÖ window.ElementObserver: Â≠òÂú®', 'success');
                    try {
                        const testInstance = new window.ElementObserver();
                        log(`‚úÖ „ÉÜ„Çπ„Éà„Ç§„É≥„Çπ„Çø„É≥„Çπ‰ΩúÊàê: ÊàêÂäü (${testInstance.constructor.name})`, 'success');
                        log(`üìã „ÉÜ„Çπ„Éà„Ç§„É≥„Çπ„Çø„É≥„Çπ observe: ${typeof testInstance.observe}`, 'info');
                    } catch (error) {
                        log(`‚ùå „ÉÜ„Çπ„Éà„Ç§„É≥„Çπ„Çø„É≥„Çπ‰ΩúÊàê: Â§±Êïó - ${error.message}`, 'error');
                    }
                } else {
                    log('‚ùå window.ElementObserver: Êú™ÂÆöÁæ©', 'error');
                }
                
                // 3. ËÉåÊôØË¶ÅÁ¥†Ê§úÂá∫„ÉÜ„Çπ„Éà
                log('üîç ËÉåÊôØË¶ÅÁ¥†Ê§úÂá∫„ÉÜ„Çπ„Éà:', 'info');
                const backgroundElement = currentBoundingBox.autoPin.detectBackgroundElement(testCharacter);
                if (backgroundElement) {
                    log(`‚úÖ ËÉåÊôØË¶ÅÁ¥†Ê§úÂá∫ÊàêÂäü: ${backgroundElement.id || backgroundElement.tagName}`, 'success');
                    log(`ËÉåÊôØË¶ÅÁ¥†„Çµ„Ç§„Ç∫: ${backgroundElement.offsetWidth}√ó${backgroundElement.offsetHeight}px`, 'info');
                } else {
                    log('‚ùå ËÉåÊôØË¶ÅÁ¥†Ê§úÂá∫Â§±Êïó', 'error');
                }
                
                // 4. ÊúÄÈÅ©„Ç¢„É≥„Ç´„ÉºË®àÁÆó„ÉÜ„Çπ„Éà
                if (backgroundElement) {
                    log('üéØ ÊúÄÈÅ©„Ç¢„É≥„Ç´„Éº„Éù„Ç§„É≥„ÉàË®àÁÆó„ÉÜ„Çπ„Éà:', 'info');
                    const bounds = currentBoundingBox.getBounds();
                    const optimalAnchor = currentBoundingBox.autoPin.calculateOptimalAnchor(bounds, backgroundElement);
                    log(`‚úÖ ÊúÄÈÅ©„Ç¢„É≥„Ç´„Éº: ${optimalAnchor} (${getAnchorName(optimalAnchor)})`, 'success');
                }
                
                // 5. ÂÆüÈöõ„ÅÆ‰øùÂ≠ò„ÉªÂæ©ÂÖÉÂãï‰Ωú„ÉÜ„Çπ„Éà
                log('üéØ ÂÆüÈöõ„ÅÆAutoPin‰øùÂ≠ò„ÉªÂæ©ÂÖÉ„ÉÜ„Çπ„Éà:', 'info');
                
                // ÁèæÂú®„ÅÆ‰ΩçÁΩÆ„ÇíË®òÈå≤
                const beforeBounds = currentBoundingBox.getBounds();
                if (beforeBounds) {
                    // getBounds()„ÅØx,yÂΩ¢Âºè„Å®left,topÂΩ¢Âºè„ÅÆ‰∏°Êñπ„Å´ÂØæÂøú
                    const x = beforeBounds.left !== undefined ? beforeBounds.left : beforeBounds.x || 0;
                    const y = beforeBounds.top !== undefined ? beforeBounds.top : beforeBounds.y || 0;
                    log(`ÁèæÂú®‰ΩçÁΩÆ: ${x.toFixed(1)}, ${y.toFixed(1)}`, 'info');
                } else {
                    log(`ÁèæÂú®‰ΩçÁΩÆ: ÂèñÂæó„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü (bounds: ${JSON.stringify(beforeBounds)})`, 'warning');
                }
                
                // AutoPin„ÉÜ„Çπ„ÉàÁî®„Å´BB„ÇíÂ∞ë„ÅóÁßªÂãï
                const moveDistance = 50;
                const element = currentBoundingBox.element;
                
                if (element && element.style) {
                    const currentLeft = parseFloat(element.style.left || '0px');
                    const currentTop = parseFloat(element.style.top || '0px');
                    
                    element.style.left = `${currentLeft + moveDistance}px`;
                    element.style.top = `${currentTop + moveDistance}px`;
                    
                    const afterMoveBounds = currentBoundingBox.getBounds();
                    if (afterMoveBounds) {
                        const x = afterMoveBounds.left !== undefined ? afterMoveBounds.left : afterMoveBounds.x || 0;
                        const y = afterMoveBounds.top !== undefined ? afterMoveBounds.top : afterMoveBounds.y || 0;
                        log(`ÁßªÂãïÂæå‰ΩçÁΩÆ: ${x.toFixed(1)}, ${y.toFixed(1)}`, 'info');
                    } else {
                        log(`ÁßªÂãïÂæå‰ΩçÁΩÆ: ÂèñÂæó„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü`, 'warning');
                    }
                } else {
                    log('‚ùå BB„Ç®„É¨„É°„É≥„Éà„ÅåÂà©Áî®„Åß„Åç„Åæ„Åõ„Çì - ‰ΩçÁΩÆÁßªÂãï„ÉÜ„Çπ„Éà„Çí„Çπ„Ç≠„ÉÉ„Éó', 'warning');
                }
                
                // „Éó„É≠„Ç∞„É©„É†ÁöÑ„Å´‰øùÂ≠ò„ÇíÂÆüË°å
                log('üíæ AutoPin‰øùÂ≠ò„ÇíÂÆüË°å‰∏≠...', 'info');
                try {
                    const saveResult = await currentBoundingBox.ui.handleSave();
                    if (saveResult) {
                        log('‚úÖ AutoPin‰øùÂ≠òÂÆå‰∫Ü', 'success');
                        
                        // „Éî„É≥ÈÖçÁΩÆÁµêÊûú„ÅÆÁ¢∫Ë™ç
                        const pinState = currentBoundingBox.autoPin.getState();
                        log(`üìç ÁèæÂú®„ÅÆ„Éî„É≥Êï∞: ${pinState.activePinsCount}`, 'info');
                        
                        // VIÂ∫ßÊ®ôÁ≥ª„Åß„ÅÆÂæ©ÂÖÉ„ÉÜ„Çπ„ÉàÊ°àÂÜÖ
                        log('', 'info');
                        log('üí° VIÂ∫ßÊ®ôÁ≥ªÂæ©ÂÖÉ„ÉÜ„Çπ„ÉàÊâãÈ†Ü:', 'info');
                        log('1. „Éñ„É©„Ç¶„Ç∂„Ç¶„Ç£„É≥„Éâ„Ç¶„Çí„É™„Çµ„Ç§„Ç∫„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'info');
                        log('2. „Ç¢„Çπ„Éö„ÇØ„ÉàÊØî„ÅÆÂ§âÂåñ„ÇíÁ¢∫Ë™ç', 'info');
                        log('3. ÂÜçÂ∫¶BB„ÇíË°®Á§∫„Åó„Å¶„Éî„É≥‰ΩçÁΩÆ„ÅåÊ≠£„Åó„ÅèÂæ©ÂÖÉ„Åï„Çå„Çã„ÅãÁ¢∫Ë™ç', 'info');
                        
                        // „ÉÜ„Çπ„ÉàÁî®Èñ¢Êï∞„ÇíÊèê‰æõ
                        window.testVIRestoration = () => {
                            if (currentBoundingBox && currentBoundingBox.autoPin) {
                                log('üéØ VIÂ∫ßÊ®ôÁ≥ªÂæ©ÂÖÉ„ÉÜ„Çπ„ÉàÂÆüË°å', 'info');
                                const viRatio = currentBoundingBox.autoPin.currentVIRatio;
                                if (viRatio) {
                                    log(`ÁèæÂú®„ÅÆVIÊØîÁéá: ${viRatio.toFixed(4)}`, 'info');
                                    log('„Ç¶„Ç£„É≥„Éâ„Ç¶„É™„Çµ„Ç§„Ç∫Âæå„Å´„Åì„ÅÆÂÄ§„ÅÆÂ§âÂåñ„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'info');
                                }
                            }
                        };
                        log('üíª „Ç≥„Éû„É≥„Éâ: testVIRestoration() „ÅßVIÂæ©ÂÖÉ„ÉÜ„Çπ„ÉàÂÆüË°å', 'info');
                        
                    } else {
                        log('‚ùå AutoPin‰øùÂ≠òÂ§±Êïó', 'error');
                    }
                } catch (saveError) {
                    log(`‚ùå ‰øùÂ≠ò„Ç®„É©„Éº: ${saveError.message}`, 'error');
                }
                
                log('‚úÖ AutoPin „Ç∑„Çπ„ÉÜ„É†Áµ±Âêà„ÉÜ„Çπ„ÉàÂÆå‰∫Ü', 'success');
                
            } catch (error) {
                log(`‚ùå AutoPin „Ç∑„Çπ„ÉÜ„É†„ÉÜ„Çπ„Éà„Ç®„É©„Éº: ${error.message}`, 'error');
                console.error('AutoPin „Ç∑„Çπ„ÉÜ„É†„ÉÜ„Çπ„Éà„Ç®„É©„Éº:', error);
            }
        }
        
        // „Ç¢„É≥„Ç´„ÉºÂêçÁß∞„ÇíÂèñÂæó
        function getAnchorName(anchor) {
            const names = {
                'TL': 'Â∑¶‰∏ä', 'TC': '‰∏ä‰∏≠Â§Æ', 'TR': 'Âè≥‰∏ä',
                'ML': 'Â∑¶‰∏≠Â§Æ', 'MC': '‰∏≠Â§Æ', 'MR': 'Âè≥‰∏≠Â§Æ',
                'BL': 'Â∑¶‰∏ã', 'BC': '‰∏ã‰∏≠Â§Æ', 'BR': 'Âè≥‰∏ã'
            };
            return names[anchor] || anchor;
        }
        
        function testResize() {
            log('üìê „É™„Çµ„Ç§„Ç∫„ÉÜ„Çπ„ÉàÈñãÂßã', 'info');
            
            const container = document.querySelector('.test-container');
            const heroSection = document.getElementById('test-hero');
            
            if (!heroSection) {
                log('‚ùå „Éí„Éº„É≠„Éº„Çª„ÇØ„Ç∑„Éß„É≥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì', 'error');
                return;
            }
            
            log('üìä ÁèæÂú®„ÅÆ„Çµ„Ç§„Ç∫ÊÉÖÂ†±:', 'info');
            log(`„Ç¶„Ç£„É≥„Éâ„Ç¶: ${window.innerWidth} √ó ${window.innerHeight}`, 'info');
            
            const heroRect = heroSection.getBoundingClientRect();
            log(`„Éí„Éº„É≠„Éº„Çª„ÇØ„Ç∑„Éß„É≥: ${heroRect.width.toFixed(0)} √ó ${heroRect.height.toFixed(0)}`, 'info');
            
            // ÊÆµÈöéÁöÑ„É™„Çµ„Ç§„Ç∫„ÉÜ„Çπ„Éà
            const sizes = [
                { width: 800, height: 600, name: 'Â∞è„Åï„ÇÅ' },
                { width: 1200, height: 800, name: '‰∏≠„Çµ„Ç§„Ç∫' },
                { width: 1600, height: 900, name: 'Â§ß„Åç„ÇÅ' }
            ];
            
            let currentStep = 0;
            
            function nextResize() {
                if (currentStep >= sizes.length) {
                    log('‚úÖ „É™„Çµ„Ç§„Ç∫„ÉÜ„Çπ„ÉàÂÆå‰∫Ü', 'success');
                    return;
                }
                
                const size = sizes[currentStep];
                log(`üìê ${size.name}„Çµ„Ç§„Ç∫„Å´Â§âÊõ¥‰∏≠: ${size.width} √ó ${size.height}`, 'info');
                
                // „Éñ„É©„Ç¶„Ç∂„Ç¶„Ç£„É≥„Éâ„Ç¶„Çµ„Ç§„Ç∫Â§âÊõ¥„ÅØ„Çª„Ç≠„É•„É™„ÉÜ„Ç£Âà∂Èôê„Åß‰∏çÂèØ„ÅÆ„Åü„ÇÅ„ÄÅ
                // „Éí„Éº„É≠„Éº„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆ„Çµ„Ç§„Ç∫„ÇíÁõ¥Êé•Â§âÊõ¥
                heroSection.style.width = `${size.width}px`;
                heroSection.style.height = `${size.height}px`;
                
                setTimeout(() => {
                    const newRect = heroSection.getBoundingClientRect();
                    log(`‚Üí Êñ∞„Çµ„Ç§„Ç∫: ${newRect.width.toFixed(0)} √ó ${newRect.height.toFixed(0)}`, 'success');
                    
                    currentStep++;
                    setTimeout(nextResize, 2000);
                }, 1000);
            }
            
            // „ÉÜ„Çπ„ÉàÂÆüË°å
            nextResize();
            
            // 5ÁßíÂæå„Å´ÂÖÉ„ÅÆ„Çµ„Ç§„Ç∫„Å´Êàª„Åô
            setTimeout(() => {
                heroSection.style.width = '';
                heroSection.style.height = '';
                log('üîÑ ÂÖÉ„ÅÆ„Çµ„Ç§„Ç∫„Å´Âæ©ÂÖÉ', 'info');
            }, 10000);
        }
        
        // „É¢„Ç∏„É•„Éº„É´Áä∂ÊÖãË°®Á§∫
        function showModuleStatus() {
            log('üìä „É¢„Ç∏„É•„Éº„É´Áä∂ÊÖãË°®Á§∫', 'info');
            
            // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞Á¢∫Ë™ç
            const globals = [
                'ElementObserverCore', 'ElementObserver',
                'PureBoundingBoxCore', 'PureBoundingBoxUI', 
                'PureBoundingBoxAutoPin', 'PureBoundingBox',
                'StableSpineRenderer'
            ];
            
            globals.forEach(name => {
                const exists = typeof window[name] === 'function';
                log(`${exists ? '‚úÖ' : '‚ùå'} ${name}: ${exists ? 'OK' : 'NG'}`, exists ? 'success' : 'error');
            });
            
            // ÁèæÂú®„ÅÆ„Éê„Ç¶„É≥„Éá„Ç£„É≥„Ç∞„Éú„ÉÉ„ÇØ„ÇπÁä∂ÊÖã
            if (currentBoundingBox) {
                const state = currentBoundingBox.getState();
                log(`üìä ÁèæÂú®„ÅÆBBÁä∂ÊÖã: ${JSON.stringify(state)}`, 'info');
                
                if (currentBoundingBox.ui && currentBoundingBox.ui.autoPin) {
                    const autoPinState = currentBoundingBox.ui.autoPin.getState();
                    log(`üìç AutoPinÁä∂ÊÖã: ${JSON.stringify(autoPinState)}`, 'info');
                }
            } else {
                log('‚ö†Ô∏è „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™„Éê„Ç¶„É≥„Éá„Ç£„É≥„Ç∞„Éú„ÉÉ„ÇØ„Çπ„Å™„Åó', 'warning');
            }
        }
        
        // „É≠„Ç∞„ÇØ„É™„Ç¢
        function clearLog() {
            if (logDisplay) {
                logDisplay.textContent = 'üéØ „É≠„Ç∞„ÇØ„É™„Ç¢„Åï„Çå„Åæ„Åó„Åü\n';
            }
            log('üóëÔ∏è „É≠„Ç∞„ÇØ„É™„Ç¢ÂÆüË°å', 'info');
        }
        
        // ÂàùÊúüboundsÂâäÈô§Ôºà„Çπ„Ç±„Éº„É´Ë®àÁÆó„É™„Çª„ÉÉ„ÉàÁî®Ôºâ
        function clearOriginalBounds() {
            try {
                const keys = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith('original-bounds-')) {
                        keys.push(key);
                    }
                }
                
                keys.forEach(key => localStorage.removeItem(key));
                
                log(`üìè ÂàùÊúüboundsÂâäÈô§ÂÆå‰∫Ü: ${keys.length}ÂÄã`, 'success');
                log('Ê¨°Âõû„ÅÆ„Éê„Ç¶„É≥„Éá„Ç£„É≥„Ç∞„Éú„ÉÉ„ÇØ„Çπ‰ΩúÊàêÊôÇ„Å´Ê≠£„Åó„ÅÑÂàùÊúüÂÄ§„Åå‰øùÂ≠ò„Åï„Çå„Åæ„Åô', 'info');
                
                if (keys.length === 0) {
                    log('‚ö†Ô∏è ÂâäÈô§ÂØæË±°„ÅÆÂàùÊúübounds„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü', 'warning');
                }
                
            } catch (error) {
                log(`‚ùå ÂàùÊúüboundsÂâäÈô§„Ç®„É©„Éº: ${error.message}`, 'error');
                console.error('ÂàùÊúüboundsÂâäÈô§„Ç®„É©„Éº:', error);
            }
        }
        
        // „Éû„Éã„É•„Ç¢„É´Ê∫ñÊã†: StableSpineRenderer„ÅßSpine„Ç≠„É£„É©„ÇØ„Çø„ÉºÂÆüË£Ö
        async function loadSpineCharacter() {
            try {
                log('üéÆ Spine„Ç≠„É£„É©„ÇØ„Çø„ÉºË™≠„ÅøËæº„ÅøÈñãÂßãÔºà„Éû„Éã„É•„Ç¢„É´Ê∫ñÊã†Ôºâ', 'info');
                log(`„Ç≠„É£„É©„ÇØ„Çø„Éº: ${currentCharacterName}`, 'info');
                
                // Êó¢Â≠ò„ÅÆ„É¨„É≥„ÉÄ„É©„Éº„Çí„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
                if (spineRenderer) {
                    if (typeof spineRenderer.cleanup === 'function') {
                        spineRenderer.cleanup();
                    }
                    spineRenderer = null;
                }
                
                // CanvasË¶ÅÁ¥†„ÇíÂèñÂæóÔºàHTMLÂÜÖ„ÅßÂÆöÁæ©Ê∏à„ÅøÔºâ
                const canvas = document.getElementById('spine-canvas');
                if (!canvas) {
                    log('‚ùå spine-canvasË¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì', 'error');
                    return;
                }
                
                log('‚úÖ CanvasË¶ÅÁ¥†„ÇíÁ¢∫Ë™ç', 'info');
                log(`Canvas „Çµ„Ç§„Ç∫: ${canvas.width}√ó${canvas.height}px`, 'info');
                
                // Spine WebGL „ÅÆË™≠„ÅøËæº„ÅøÁ¢∫Ë™ç
                if (typeof spine === 'undefined') {
                    log('‚ùå Spine WebGL „ÅåË™≠„ÅøËæº„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì', 'error');
                    return;
                }
                
                // StableSpineRenderer „ÅÆË™≠„ÅøËæº„ÅøÁ¢∫Ë™ç
                if (typeof StableSpineRenderer === 'undefined') {
                    log('‚ùå StableSpineRenderer „ÅåË™≠„ÅøËæº„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì', 'error');
                    return;
                }
                
                // „Éû„Éã„É•„Ç¢„É´Ê∫ñÊã†: StableSpineRenderer.createForCharacter()„Çí‰ΩøÁî®
                log('üéØ StableSpineRendererÂàùÊúüÂåñ‰∏≠...Ôºà„Éû„Éã„É•„Ç¢„É´Ê∫ñÊã†Ôºâ', 'info');
                
                // 1Ë°å„Åß‰ΩúÊàê„ÉªÂàùÊúüÂåñÔºà„Ç≠„É£„É©„ÇØ„Çø„ÉºÂêç„ÇíÊåáÂÆöÔºâ
                spineRenderer = StableSpineRenderer.createForCharacter(currentCharacterName);
                await spineRenderer.initialize();
                
                // üîç CanvasÊ∫ñÂÇôÂÆå‰∫ÜÁ¢∫Ë™ç: spineRenderer.canvas„ÄÅspineRenderer.skeleton„ÅÆÁ¢∫Ë™ç
                log('üîç CanvasÊ∫ñÂÇôÂÆå‰∫ÜÁ¢∫Ë™çÈñãÂßã...', 'info');
                let retryCount = 0;
                const maxRetries = 20; // ÊúÄÂ§ß2ÁßíÂæÖÊ©üÔºà100ms √ó 20ÂõûÔºâ
                
                while (retryCount < maxRetries) {
                    if (spineRenderer && 
                        spineRenderer.canvas && 
                        spineRenderer.skeleton &&
                        spineRenderer.canvas.width > 0 &&
                        spineRenderer.canvas.height > 0) {
                        log('‚úÖ CanvasÊ∫ñÂÇôÂÆå‰∫ÜÁ¢∫Ë™ç: „Åô„Åπ„Å¶„ÅÆË¶ÅÁ¥†„ÅåÊ∫ñÂÇôÂÆå‰∫Ü', 'success');
                        break;
                    }
                    
                    log(`‚è≥ CanvasÊ∫ñÂÇôÂæÖÊ©ü‰∏≠... (${retryCount + 1}/${maxRetries})`, 'info');
                    await new Promise(resolve => setTimeout(resolve, 100));
                    retryCount++;
                }
                
                if (retryCount >= maxRetries) {
                    log('‚ö†Ô∏è CanvasÊ∫ñÂÇôÂÆå‰∫Ü„ÅÆÁ¢∫Ë™ç„Åå„Çø„Ç§„É†„Ç¢„Ç¶„ÉàÔºàË®≠ÂÆöÂæ©ÂÖÉ„ÇíÁ∂öË°åÔºâ', 'warning');
                }
                
                // ‚è≥ ËøΩÂä†ÈÅÖÂª∂: ÂàùÊúüÂåñÂÆå‰∫ÜÂæå100msÈÅÖÂª∂„ÅßÂæ©ÂÖÉÂÆüË°å
                log('‚è≥ Ë®≠ÂÆöÂæ©ÂÖÉ„ÅÆ„Åü„ÇÅ„ÅÆËøΩÂä†ÈÅÖÂª∂ÂÆüË°å‰∏≠...', 'info');
                await new Promise(resolve => setTimeout(resolve, 100));
                
                // üéØ SpineSettingsPersistenceÁµ±Âêà: Ë®≠ÂÆöÂæ©ÂÖÉÔºàÁ¢∫ÂÆü„Å™„Çø„Ç§„Éü„É≥„Ç∞„ÅßÂÆüË°åÔºâ
                log('üîÑ Ë®≠ÂÆöÂæ©ÂÖÉÂÆüË°åÈñãÂßãÔºàÁ¢∫ÂÆü„Å™„Çø„Ç§„Éü„É≥„Ç∞Ôºâ...', 'info');
                await restoreSpineSettingsIntegrated(currentCharacterName);
                
                // üéõÔ∏è UIÂêåÊúüÂº∑Âåñ: CanvasResizeController UIÂêåÊúü„ÇíÂº∑Âà∂ÂÆüË°å
                if (window.canvasResizeController) {
                    log('üéõÔ∏è CanvasResizeController UIÂêåÊúü„ÇíÂº∑Âà∂ÂÆüË°å...', 'info');
                    try {
                        // UIÊõ¥Êñ∞„ÇíÂº∑Âà∂ÂÆüË°åÔºàÂÜÖÈÉ®Áä∂ÊÖã„Å®UIË°®Á§∫„ÅÆÂêåÊúüÔºâ
                        if (typeof window.canvasResizeController.updateUI === 'function') {
                            window.canvasResizeController.updateUI();
                        }
                        // „Åæ„Åü„ÅØÁä∂ÊÖãÂÜçË®≠ÂÆö„Å´„Çà„ÇãÂêåÊúü
                        if (typeof window.canvasResizeController.refreshState === 'function') {
                            window.canvasResizeController.refreshState();
                        }
                        log('‚úÖ CanvasResizeController UIÂêåÊúüÂÆå‰∫Ü', 'success');
                    } catch (error) {
                        log(`‚ö†Ô∏è CanvasResizeController UIÂêåÊúü„Ç®„É©„Éº: ${error.message}`, 'warning');
                    }
                }
                
                log('üìè ÂàùÊúüÂåñÂÆå‰∫Ü: „Ç≠„É£„É©„ÇØ„Çø„ÉºÊ∫ñÂÇôÂÆå‰∫ÜÔºàË®≠ÂÆöÂæ©ÂÖÉ„ÉªUIÂêåÊúüÊ∏à„ÅøÔºâ', 'info');
                
                log(`‚úÖ ${currentCharacterName} „É¨„É≥„ÉÄ„É™„É≥„Ç∞ÊàêÂäü`, 'success');
                
                // „Ç≠„É£„É©„ÇØ„Çø„ÉºÂà•„Éá„Éï„Ç©„É´„Éà„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÂÜçÁîüÔºà„Éû„Éã„É•„Ç¢„É´Ê∫ñÊã†Ôºâ
                if (currentCharacterName === 'purattokun') {
                    spineRenderer.playAnimation('taiki');
                    log('‚ñ∂Ô∏è „Éá„Éï„Ç©„É´„Éà„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥: taikiÔºàpurattokunÁî®Ôºâ', 'success');
                } else if (currentCharacterName === 'nezumi') {
                    spineRenderer.playAnimation('search');
                    log('‚ñ∂Ô∏è „Éá„Éï„Ç©„É´„Éà„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥: searchÔºànezumiÁî®Ôºâ', 'success');
                } else {
                    log(`‚ö†Ô∏è Êú™Áü•„ÅÆ„Ç≠„É£„É©„ÇØ„Çø„Éº: ${currentCharacterName}`, 'warning');
                }
                
                // CanvasË¶ÅÁ¥†„ÇíBBÁî®„ÅÆ„Çø„Éº„Ç≤„ÉÉ„ÉàË¶ÅÁ¥†„Å®„Åó„Å¶Ë®≠ÂÆö
                testCharacter = canvas;
                
                // üîß CanvasË¶ÅÁ¥†„Å´„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíË®≠ÂÆö
                log(`üîß Spine canvas (${canvas.id}) „ÇíBB„Çø„Éº„Ç≤„ÉÉ„Éà„Å®„Åó„Å¶Ë®≠ÂÆö`, 'info');
                setupCharacterClickListener(testCharacter);
                
                // üîç Ë®≠ÂÆöÁ¢∫Ë™ç
                log(`‚úÖ testCharacterË®≠ÂÆöÂÆå‰∫Ü: ${testCharacter.id || testCharacter.tagName}`, 'success');
                
            } catch (error) {
                log(`‚ùå Spine„Ç≠„É£„É©„ÇØ„Çø„ÉºË™≠„ÅøËæº„Åø„Ç®„É©„Éº: ${error.message}`, 'error');
                console.error('Spine„Ç≠„É£„É©„ÇØ„Çø„ÉºË™≠„ÅøËæº„Åø„Ç®„É©„ÉºË©≥Á¥∞:', error);
            }
        }
        
        // „Ç≠„É£„É©„ÇØ„Çø„ÉºÂàá„ÇäÊõø„Åà
        async function switchCharacter() {
            try {
                // „Ç≠„É£„É©„ÇØ„Çø„Éº„ÇíÂàá„ÇäÊõø„Åà
                currentCharacterName = currentCharacterName === 'purattokun' ? 'nezumi' : 'purattokun';
                log(`üîÑ „Ç≠„É£„É©„ÇØ„Çø„ÉºÂàá„ÇäÊõø„Åà: ${currentCharacterName}`, 'info');
                
                // ÂÜçË™≠„ÅøËæº„Åø
                await loadSpineCharacter();
                
            } catch (error) {
                log(`‚ùå „Ç≠„É£„É©„ÇØ„Çø„ÉºÂàá„ÇäÊõø„Åà„Ç®„É©„Éº: ${error.message}`, 'error');
                console.error('„Ç≠„É£„É©„ÇØ„Çø„ÉºÂàá„ÇäÊõø„Åà„Ç®„É©„Éº:', error);
            }
        }
        
        // üéØ SpineSettingsPersistenceÁµ±Âêà: Ë®≠ÂÆöÂæ©ÂÖÉÊ©üËÉΩ
        async function restoreSpineSettingsIntegrated(characterId) {
            try {
                if (!spinePersistence) {
                    log('‚ö†Ô∏è SpineSettingsPersistenceÊú™ÂàùÊúüÂåñ - Âæ©ÂÖÉ„Çπ„Ç≠„ÉÉ„Éó', 'warning');
                    return false;
                }
                
                log(`üîÑ ${characterId} Ë®≠ÂÆöÂæ©ÂÖÉÈñãÂßã`, 'info');
                
                // SpineSettingsPersistence„Åã„ÇâË®≠ÂÆö„ÇíÂæ©ÂÖÉ
                const settings = spinePersistence.restore(characterId);
                
                if (settings) {
                    log(`üìÇ ${characterId} ‰øùÂ≠òÊ∏à„ÅøË®≠ÂÆö„ÇíÁô∫Ë¶ã:`, 'success');
                    log(`  - „Çπ„Ç±„Éº„É´: X=${settings.scaleX}, Y=${settings.scaleY}`, 'info');
                    // üö® ‰ΩçÁΩÆÊÉÖÂ†±Ë°®Á§∫„ÅØÂâäÈô§ÔºàPureBoundingBoxAutoPin„Å´ÂßîË≠≤Ôºâ
                    if (settings.canvasSize) {
                        log(`  - Canvas: ${settings.canvasSize}px`, 'info');
                    }
                    
                    // spineRenderer„ÅåÊ∫ñÂÇôÂÆå‰∫Ü„Åó„Å¶„ÅÑ„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç
                    if (spineRenderer && spineRenderer.skeleton && spineRenderer.canvas) {
                        
                        // ‚úÖ CanvasËß£ÂÉèÂ∫¶Âæ©ÂÖÉÔºàÁ¢∫ÂÆü„Å´ÂÆüË°å„ÉªÊ®™Ê≠™„Åø‰øÆÊ≠£ÂØæÂøúÔºâ
                        if (settings.canvasSize) {
                            log(`üìê CanvasËß£ÂÉèÂ∫¶Âæ©ÂÖÉÂÆüË°åÂâç: ${spineRenderer.canvas.width}x${spineRenderer.canvas.height}`, 'info');
                            
                            // üö® Ê®™Ê≠™„Åø‰øÆÊ≠£: CanvasËß£ÂÉèÂ∫¶„ÇíÊ≠£ÊñπÂΩ¢„Å´Âº∑Âà∂Áµ±‰∏ÄÔºàDPRÂØæÂøúÔºâ
                            const cssSquareSize = settings.canvasSize;
                            const dpr = window.devicePixelRatio || 1;
                            const bufferSquareSize = Math.round(cssSquareSize * dpr);
                            
                            spineRenderer.canvas.width = bufferSquareSize;
                            spineRenderer.canvas.height = bufferSquareSize;
                            
                            // CSSË°®Á§∫„Çµ„Ç§„Ç∫„ÇÇÊ≠£ÊñπÂΩ¢„Å´Áµ±‰∏ÄÔºàÊ≠™„ÅøÈò≤Ê≠¢Ôºâ
                            spineRenderer.canvas.style.width = `${cssSquareSize}px`;
                            spineRenderer.canvas.style.height = `${cssSquareSize}px`;
                            spineRenderer.canvas.style.aspectRatio = '1 / 1';
                            
                            // Renderer„ÅÆ„É™„Çµ„Ç§„Ç∫ÔºàÈáçË¶Å: WebGL context„ÇíÊõ¥Êñ∞Ôºâ
                            if (typeof spineRenderer.resize === 'function') {
                                spineRenderer.resize(cssSquareSize, cssSquareSize);
                            } else if (spineRenderer.gl) {
                                // ÊâãÂãï„Åßviewport„ÇíÊõ¥Êñ∞ÔºàDPRÂØæÂøúÔºâ
                                spineRenderer.gl.viewport(0, 0, bufferSquareSize, bufferSquareSize);
                            }
                            
                            log(`üìê CanvasËß£ÂÉèÂ∫¶Âæ©ÂÖÉÂÆå‰∫ÜÔºàÊ≠£ÊñπÂΩ¢Áµ±‰∏Ä„ÉªDPRÂØæÂøúÔºâ: CSS ${cssSquareSize}px, „Éê„ÉÉ„Éï„Ç° ${bufferSquareSize}px`, 'success');
                            log(`üìê CanvasËß£ÂÉèÂ∫¶Âæ©ÂÖÉÂÆüË°åÂæå: ${spineRenderer.canvas.width}x${spineRenderer.canvas.height}`, 'info');
                        }
                        
                        // ‚úÖ „Çπ„Ç±„Éº„É´Âæ©ÂÖÉÔºàÁ¢∫ÂÆü„Å´ÂÆüË°å„ÉªÊ®™Ê≠™„Åø‰øÆÊ≠£ÂØæÂøúÔºâ
                        if (settings.scaleX !== undefined && settings.scaleY !== undefined) {
                            log(`üìè „Çπ„Ç±„Éº„É´Âæ©ÂÖÉÂÆüË°åÂâç: X=${spineRenderer.skeleton.scaleX}, Y=${spineRenderer.skeleton.scaleY}`, 'info');
                            
                            // üö® Ê®™Ê≠™„Åø‰øÆÊ≠£: „Çπ„Ç±„Éº„É´„ÇíÁµ±‰∏Ä„Åó„Å¶Ê≠™„Åø„ÇíÈò≤Ê≠¢
                            const unifiedScale = Math.min(settings.scaleX, settings.scaleY);
                            spineRenderer.skeleton.scaleX = unifiedScale;
                            spineRenderer.skeleton.scaleY = unifiedScale;
                            
                            log(`üìè „Çπ„Ç±„Éº„É´Âæ©ÂÖÉÂÆå‰∫ÜÔºàÁµ±‰∏ÄÂÄ§: ${unifiedScale}Ôºâ`, 'success');
                            log(`üìè „Çπ„Ç±„Éº„É´Âæ©ÂÖÉÂÆüË°åÂæå: X=${spineRenderer.skeleton.scaleX}, Y=${spineRenderer.skeleton.scaleY}`, 'info');
                        }
                        
                        // üö® ‰ΩçÁΩÆË®≠ÂÆöÈÅ©Áî®„ÅØÂâäÈô§ÔºàPureBoundingBoxAutoPin„Å´ÂßîË≠≤Ôºâ
                        // ‰ΩçÁΩÆÊÉÖÂ†±„ÅÆÁÆ°ÁêÜ„ÅØÂÆåÂÖ®„Å´PureBoundingBoxAutoPin„Å´Âßî„Å≠„Çã
                        
                        // ‚úÖ UIÂêåÊúüÔºàCanvasResizeControllerÈÄ£Êê∫Ôºâ
                        const uiUpdateData = {
                            canvasSize: settings.canvasSize || (spineRenderer.canvas ? Math.max(spineRenderer.canvas.width, spineRenderer.canvas.height) : 400),
                            scaleX: settings.scaleX || spineRenderer.skeleton.scaleX || 1.0,
                            scaleY: settings.scaleY || spineRenderer.skeleton.scaleY || 1.0
                            // üö® ‰ΩçÁΩÆÊÉÖÂ†±„ÅØPureBoundingBoxAutoPin„Å´ÂßîË≠≤ÔºàÈáçË§áÊéíÈô§Ôºâ
                        };
                        
                        log(`üéõÔ∏è UIÂêåÊúü„Éá„Éº„ÇøÈÄÅ‰ø°:`, 'info');
                        log(`  - canvasSize: ${uiUpdateData.canvasSize}`, 'info');
                        log(`  - scaleX: ${uiUpdateData.scaleX}`, 'info');
                        log(`  - scaleY: ${uiUpdateData.scaleY}`, 'info');
                        
                        sendToCanvasResizeUI('updateUIState', uiUpdateData);
                        
                        log(`‚úÖ ${characterId} Ë®≠ÂÆöÂæ©ÂÖÉÂÆå‰∫Ü`, 'success');
                        return true;
                        
                    } else {
                        log(`‚ö†Ô∏è ${characterId} RendererÊ∫ñÂÇôÊú™ÂÆå‰∫Ü - Âæ©ÂÖÉ„ÇíÈÅÖÂª∂ÂÆüË°å`, 'warning');
                        log(`  - spineRenderer: ${!!spineRenderer}`, 'info');
                        log(`  - skeleton: ${!!(spineRenderer && spineRenderer.skeleton)}`, 'info');
                        log(`  - canvas: ${!!(spineRenderer && spineRenderer.canvas)}`, 'info');
                        
                        // 1ÁßíÂæå„Å´ÂÜçË©¶Ë°å
                        setTimeout(async () => {
                            await restoreSpineSettingsIntegrated(characterId);
                        }, 1000);
                        
                        return false;
                    }
                } else {
                    log(`üìù ${characterId} ‰øùÂ≠ò„Åï„Çå„ÅüË®≠ÂÆö„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„ÇìÔºàÂàùÂõûËµ∑ÂãïÔºâ`, 'info');
                    
                    // üéØ „Éá„Éï„Ç©„É´„Éà„Çπ„Ç±„Éº„É´Ë®≠ÂÆö (1:1)
                    if (spineRenderer && spineRenderer.skeleton) {
                        spineRenderer.setTransform(null, null, 1.0, 1.0);
                        log('üìè „Éá„Éï„Ç©„É´„Éà„Çπ„Ç±„Éº„É´ÈÅ©Áî®: X=1.0, Y=1.0', 'info');
                        
                        // „Éá„Éï„Ç©„É´„ÉàÁä∂ÊÖã„Åß„ÇÇUIÂêåÊúü
                        sendToCanvasResizeUI('updateUIState', {
                            canvasSize: spineRenderer.canvas ? Math.max(spineRenderer.canvas.width, spineRenderer.canvas.height) : 400,
                            scaleX: 1.0,
                            scaleY: 1.0
                        });
                    }
                    
                    return false;
                }
            } catch (error) {
                log(`‚ùå ${characterId} Ë®≠ÂÆöÂæ©ÂÖÉ„Ç®„É©„Éº: ${error.message}`, 'error');
                console.error('Ë®≠ÂÆöÂæ©ÂÖÉ„Ç®„É©„Éº:', error);
                return false;
            }
        }
        
        // üéØ SpineSettingsPersistenceÁµ±Âêà: Ë®≠ÂÆö‰øùÂ≠òÊ©üËÉΩ
        function saveSpineSettingsIntegrated(characterId, changes) {
            try {
                if (!spinePersistence) {
                    log('‚ö†Ô∏è SpineSettingsPersistenceÊú™ÂàùÊúüÂåñ - ‰øùÂ≠ò„Çπ„Ç≠„ÉÉ„Éó', 'warning');
                    return false;
                }
                
                if (!spineRenderer || !spineRenderer.skeleton) {
                    log('‚ö†Ô∏è SpineRendererÊú™Ê∫ñÂÇô - ‰øùÂ≠ò„Çπ„Ç≠„ÉÉ„Éó', 'warning');
                    return false;
                }
                
                // ÁèæÂú®„ÅÆË®≠ÂÆö„ÇíÂèñÂæó
                const currentSettings = {
                    scaleX: spineRenderer.skeleton.scaleX || 1.0,
                    scaleY: spineRenderer.skeleton.scaleY || 1.0,
                    // üö® ‰ΩçÁΩÆÊÉÖÂ†±„ÅØPureBoundingBoxAutoPin„Å´ÂßîË≠≤ÔºàÈáçË§áÊéíÈô§Ôºâ
                    canvasSize: spineRenderer.canvas ? Math.max(spineRenderer.canvas.width, spineRenderer.canvas.height) : 400
                };
                
                // Â§âÊõ¥„Åå„ÅÇ„Çå„Å∞‰∏äÊõ∏„Åç
                if (changes) {
                    Object.assign(currentSettings, changes);
                }
                
                // ‰øùÂ≠òÂÆüË°å
                const success = spinePersistence.save(characterId, currentSettings);
                
                if (success) {
                    log(`üíæ ${characterId} Ë®≠ÂÆö‰øùÂ≠òÂÆå‰∫Ü`, 'success');
                    const changedKeys = changes ? Object.keys(changes) : ['all'];
                    log(`  Â§âÊõ¥È†ÖÁõÆ: ${changedKeys.join(', ')}`, 'info');
                    return true;
                } else {
                    log(`‚ùå ${characterId} Ë®≠ÂÆö‰øùÂ≠òÂ§±Êïó`, 'error');
                    return false;
                }
            } catch (error) {
                log(`‚ùå ${characterId} Ë®≠ÂÆö‰øùÂ≠ò„Ç®„É©„Éº: ${error.message}`, 'error');
                console.error('Ë®≠ÂÆö‰øùÂ≠ò„Ç®„É©„Éº:', error);
                return false;
            }
        }
        
        // iframe„ÉÜ„Çπ„ÉàÔºàCanvasResizeController UIÁ¢∫Ë™çÔºâ
        async function testCanvasResize() {
            try {
                log('üìê Canvas Resize UI „ÉÜ„Çπ„ÉàÈñãÂßã', 'info');
                
                const iframe = document.getElementById('canvas-resize-iframe');
                if (!iframe) {
                    log('‚ùå CanvasResizeController iframe „ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì', 'error');
                    return;
                }
                
                // iframe„ÅÆÂ≠òÂú®Á¢∫Ë™ç„Å®Âº∑Ë™øË°®Á§∫
                iframe.style.border = '3px solid #00ff00';
                iframe.style.boxShadow = '0 0 20px rgba(0, 255, 0, 0.5)';
                
                log('‚úÖ CanvasResizeController UI iframe „ÇíÁ¢∫Ë™ç„Åó„Åæ„Åó„Åü', 'success');
                log('üìã iframeÂÜÖ„ÅÆUI„ÅßCanvasÂà∂Âæ°„ÅåÂèØËÉΩ„Åß„Åô', 'info');
                
                // 3ÁßíÂæå„Å´Âº∑Ë™øË°®Á§∫„ÇíËß£Èô§
                setTimeout(() => {
                    iframe.style.border = '1px solid #ddd';
                    iframe.style.boxShadow = '';
                    log('üìê iframeÂº∑Ë™øË°®Á§∫„ÇíËß£Èô§„Åó„Åæ„Åó„Åü', 'info');
                }, 3000);
                
            } catch (error) {
                log(`‚ùå iframe„ÉÜ„Çπ„Éà„Ç®„É©„Éº: ${error.message}`, 'error');
                console.error('iframe„ÉÜ„Çπ„Éà„Ç®„É©„Éº:', error);
            }
        }
        
        // üéØ „Ç¢„É≥„Ç´„Éº„Éù„Ç§„É≥„ÉàË°®Á§∫„ÉªÈùûË°®Á§∫Ê©üËÉΩ
        function showAnchorPoint() {
            try {
                const canvas = document.getElementById('spine-canvas');
                if (!canvas) {
                    log('‚ùå spine-canvasË¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì', 'error');
                    return;
                }
                
                // nodeId„ÇíÁîüÊàêÔºàCanvas„Éô„Éº„ÇπÔºâ
                const nodeId = 'spine-canvas';
                
                // PureBoundingBoxAutoPin„Ç§„É≥„Çπ„Çø„É≥„Çπ„ÇíÂèñÂæó
                if (!window.currentAutoPin) {
                    log('‚ö†Ô∏è AutoPin„Ç§„É≥„Çπ„Çø„É≥„Çπ„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì - ‰ΩúÊàê‰∏≠...', 'warning');
                    // Á∞°Êòì„Ç§„É≥„Çπ„Çø„É≥„Çπ‰ΩúÊàê
                    const elementObserver = window.ElementObserver ? new window.ElementObserver() : null;
                    window.currentAutoPin = new window.PureBoundingBoxAutoPin({
                        targetElement: canvas
                    }, elementObserver);
                }
                
                window.currentAutoPin.showAnchorPoint(nodeId);
                log('üìç „Ç¢„É≥„Ç´„Éº„Éù„Ç§„É≥„ÉàË°®Á§∫„ÇíÂÆüË°å„Åó„Åæ„Åó„Åü', 'success');
                
            } catch (error) {
                log(`‚ùå „Ç¢„É≥„Ç´„Éº„Éù„Ç§„É≥„ÉàË°®Á§∫„Ç®„É©„Éº: ${error.message}`, 'error');
                console.error('„Ç¢„É≥„Ç´„Éº„Éù„Ç§„É≥„ÉàË°®Á§∫„Ç®„É©„Éº:', error);
            }
        }
        
        function hideAnchorPoint() {
            try {
                const nodeId = 'spine-canvas';
                
                if (window.currentAutoPin) {
                    window.currentAutoPin.hideAnchorPoint(nodeId);
                } else {
                    // Áõ¥Êé•DOMÂâäÈô§
                    const marker = document.getElementById(`anchor-marker-${nodeId}`);
                    if (marker) {
                        marker.remove();
                    }
                }
                
                log('üö´ „Ç¢„É≥„Ç´„Éº„Éù„Ç§„É≥„Éà„ÇíÈùûË°®Á§∫„Å´„Åó„Åæ„Åó„Åü', 'info');
                
            } catch (error) {
                log(`‚ùå „Ç¢„É≥„Ç´„Éº„Éù„Ç§„É≥„ÉàÈùûË°®Á§∫„Ç®„É©„Éº: ${error.message}`, 'error');
                console.error('„Ç¢„É≥„Ç´„Éº„Éù„Ç§„É≥„ÉàÈùûË°®Á§∫„Ç®„É©„Éº:', error);
            }
        }
        
        function showUserPin() {
            try {
                const canvas = document.getElementById('spine-canvas');
                if (!canvas) {
                    log('‚ùå spine-canvasË¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì', 'error');
                    return;
                }
                
                const nodeId = 'spine-canvas';
                
                if (!window.currentAutoPin) {
                    log('‚ö†Ô∏è AutoPin„Ç§„É≥„Çπ„Çø„É≥„Çπ„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì - ‰ΩúÊàê‰∏≠...', 'warning');
                    const elementObserver = window.ElementObserver ? new window.ElementObserver() : null;
                    window.currentAutoPin = new window.PureBoundingBoxAutoPin({
                        targetElement: canvas
                    }, elementObserver);
                }
                
                window.currentAutoPin.showUserPin(nodeId);
                log('üìå „É¶„Éº„Ç∂„Éº„Éî„É≥Ë°®Á§∫„ÇíÂÆüË°å„Åó„Åæ„Åó„Åü', 'success');
                
            } catch (error) {
                log(`‚ùå „É¶„Éº„Ç∂„Éº„Éî„É≥Ë°®Á§∫„Ç®„É©„Éº: ${error.message}`, 'error');
                console.error('„É¶„Éº„Ç∂„Éº„Éî„É≥Ë°®Á§∫„Ç®„É©„Éº:', error);
            }
        }
        
        function hideUserPin() {
            try {
                const nodeId = 'spine-canvas';
                
                if (window.currentAutoPin) {
                    window.currentAutoPin.hideUserPin(nodeId);
                } else {
                    // Áõ¥Êé•DOMÂâäÈô§
                    const marker = document.getElementById(`user-pin-marker-${nodeId}`);
                    if (marker) {
                        marker.remove();
                    }
                }
                
                log('üö´ „É¶„Éº„Ç∂„Éº„Éî„É≥„ÇíÈùûË°®Á§∫„Å´„Åó„Åæ„Åó„Åü', 'info');
                
            } catch (error) {
                log(`‚ùå „É¶„Éº„Ç∂„Éº„Éî„É≥ÈùûË°®Á§∫„Ç®„É©„Éº: ${error.message}`, 'error');
                console.error('„É¶„Éº„Ç∂„Éº„Éî„É≥ÈùûË°®Á§∫„Ç®„É©„Éº:', error);
            }
        }
        
        function showDragHandle() {
            try {
                const canvas = document.getElementById('spine-canvas');
                if (!canvas) {
                    log('‚ùå spine-canvasË¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì', 'error');
                    return;
                }
                
                const nodeId = 'spine-canvas';
                
                if (!window.currentAutoPin) {
                    log('‚ö†Ô∏è AutoPin„Ç§„É≥„Çπ„Çø„É≥„Çπ„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì - ‰ΩúÊàê‰∏≠...', 'warning');
                    const elementObserver = window.ElementObserver ? new window.ElementObserver() : null;
                    window.currentAutoPin = new window.PureBoundingBoxAutoPin({
                        targetElement: canvas
                    }, elementObserver);
                }
                
                window.currentAutoPin.showDragHandle(nodeId);
                log('üñ±Ô∏è „Éâ„É©„ÉÉ„Ç∞„Éè„É≥„Éâ„É´Ë°®Á§∫„ÇíÂÆüË°å„Åó„Åæ„Åó„Åü', 'success');
                
            } catch (error) {
                log(`‚ùå „Éâ„É©„ÉÉ„Ç∞„Éè„É≥„Éâ„É´Ë°®Á§∫„Ç®„É©„Éº: ${error.message}`, 'error');
                console.error('„Éâ„É©„ÉÉ„Ç∞„Éè„É≥„Éâ„É´Ë°®Á§∫„Ç®„É©„Éº:', error);
            }
        }
        
        function hideDragHandle() {
            try {
                const nodeId = 'spine-canvas';
                
                if (window.currentAutoPin) {
                    window.currentAutoPin.hideDragHandle(nodeId);
                } else {
                    // Áõ¥Êé•DOMÂâäÈô§
                    const handle = document.getElementById(`persistent-drag-handle-${nodeId}`);
                    if (handle) {
                        handle.remove();
                    }
                }
                
                log('üö´ „Éâ„É©„ÉÉ„Ç∞„Éè„É≥„Éâ„É´„ÇíÈùûË°®Á§∫„Å´„Åó„Åæ„Åó„Åü', 'info');
                
            } catch (error) {
                log(`‚ùå „Éâ„É©„ÉÉ„Ç∞„Éè„É≥„Éâ„É´ÈùûË°®Á§∫„Ç®„É©„Éº: ${error.message}`, 'error');
                console.error('„Éâ„É©„ÉÉ„Ç∞„Éè„É≥„Éâ„É´ÈùûË°®Á§∫„Ç®„É©„Éº:', error);
            }
        }
        
        // üîç „Éî„É≥ÈáçË§áË®∫Êñ≠Ê©üËÉΩ
        function diagnosePinDuplication() {
            try {
                log('üîç „Éî„É≥ÈáçË§áË®∫Êñ≠ÈñãÂßã', 'info');
                
                // ÂÖ®„Å¶„ÅÆË¶ñË¶öÁöÑ„Éî„É≥„Éû„Éº„Ç´„Éº„ÇíÊ§úÁ¥¢
                const allPinMarkers = document.querySelectorAll('[id*="marker"], [class*="pin"], [class*="anchor"], [id*="pin"], [id*="anchor"]');
                
                log(`üìä Áô∫Ë¶ã„Åï„Çå„ÅüË¶ñË¶ö„Éî„É≥Á∑èÊï∞: ${allPinMarkers.length}`, 'info');
                
                const pinInfo = [];
                allPinMarkers.forEach((marker, index) => {
                    const rect = marker.getBoundingClientRect();
                    const info = {
                        index: index + 1,
                        id: marker.id || 'no-id',
                        className: marker.className || 'no-class',
                        position: `${rect.left.toFixed(1)}, ${rect.top.toFixed(1)}`,
                        size: `${rect.width.toFixed(1)}x${rect.height.toFixed(1)}`,
                        visible: rect.width > 0 && rect.height > 0,
                        innerHTML: marker.innerHTML ? marker.innerHTML.substring(0, 50) + '...' : 'empty'
                    };
                    pinInfo.push(info);
                    
                    log(`üìç „Éî„É≥ ${index + 1}: ID=${info.id}, Class=${info.className}, Position=${info.position}`, 'info');
                    
                    // Âêå„Åò‰ΩçÁΩÆ„ÅÆ„Éî„É≥„ÇíÂº∑Ë™øË°®Á§∫
                    marker.style.border = '3px solid red';
                    marker.style.boxShadow = '0 0 20px rgba(255, 0, 0, 0.7)';
                    
                    setTimeout(() => {
                        marker.style.border = '';
                        marker.style.boxShadow = '';
                    }, 5000);
                });
                
                // localStorageÂÜÖ„ÅÆ„Éî„É≥„Éá„Éº„Çø„ÇíÁ¢∫Ë™ç
                log('üìã LocalStorage „Éî„É≥„Éá„Éº„ÇøÊ§úÊüª:', 'info');
                const storageKeys = Object.keys(localStorage);
                const pinKeys = storageKeys.filter(key => key.includes('pin') || key.includes('autopin'));
                
                pinKeys.forEach(key => {
                    try {
                        const data = JSON.parse(localStorage.getItem(key));
                        log(`üîë ${key}: ${JSON.stringify(data, null, 2).substring(0, 200)}...`, 'info');
                    } catch (e) {
                        log(`‚ùå ${key}: Ëß£ÊûêÂ§±Êïó`, 'error');
                    }
                });
                
                log('‚úÖ „Éî„É≥ÈáçË§áË®∫Êñ≠ÂÆå‰∫Ü - Ëµ§Êû†„Åß5ÁßíÈñìÂº∑Ë™øË°®Á§∫‰∏≠', 'success');
                
            } catch (error) {
                log(`‚ùå „Éî„É≥ÈáçË§áË®∫Êñ≠„Ç®„É©„Éº: ${error.message}`, 'error');
                console.error('„Éî„É≥ÈáçË§áË®∫Êñ≠„Ç®„É©„Éº:', error);
            }
        }
        
        // üßπ ÂÖ®„Éî„É≥„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„ÉóÊ©üËÉΩ
        function cleanupAllPins() {
            try {
                log('üßπ ÂÖ®„Éî„É≥„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„ÉóÈñãÂßã', 'warning');
                
                // Ë¶ñË¶öÁöÑ„Éî„É≥„Éû„Éº„Ç´„Éº„ÇíÂÖ®ÂâäÈô§
                const allPinMarkers = document.querySelectorAll('[id*="marker"], [class*="pin"], [class*="anchor"], [id*="pin"], [id*="anchor"]');
                let removedCount = 0;
                
                allPinMarkers.forEach(marker => {
                    if (marker.parentNode) {
                        marker.parentNode.removeChild(marker);
                        removedCount++;
                    }
                });
                
                log(`üóëÔ∏è Ë¶ñË¶ö„Éî„É≥„Éû„Éº„Ç´„ÉºÂâäÈô§: ${removedCount}ÂÄã`, 'info');
                
                // LocalStorage„ÅÆ„Éî„É≥„Éá„Éº„Çø„Çí„ÇØ„É™„Ç¢
                const storageKeys = Object.keys(localStorage);
                const pinKeys = storageKeys.filter(key => key.includes('pin') || key.includes('autopin'));
                let storageCleared = 0;
                
                pinKeys.forEach(key => {
                    localStorage.removeItem(key);
                    storageCleared++;
                    log(`üóëÔ∏è LocalStorageÂâäÈô§: ${key}`, 'info');
                });
                
                log(`‚úÖ ÂÖ®„Éî„É≥„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„ÉóÂÆå‰∫Ü: Ë¶ñË¶ö${removedCount}ÂÄã, „Çπ„Éà„É¨„Éº„Ç∏${storageCleared}ÂÄã`, 'success');
                
            } catch (error) {
                log(`‚ùå ÂÖ®„Éî„É≥„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó„Ç®„É©„Éº: ${error.message}`, 'error');
                console.error('ÂÖ®„Éî„É≥„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó„Ç®„É©„Éº:', error);
            }
        }
        
        // „ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
        window.addEventListener('beforeunload', () => {
            if (currentBoundingBox) {
                currentBoundingBox.cleanup();
            }
            if (spineRenderer) {
                spineRenderer.cleanup();
            }
        });
        
        // üÜï IMGË¶ÅÁ¥†„ÉÜ„Çπ„ÉàÊ©üËÉΩ
        function testIMGElementContentRect() {
            log('üñºÔ∏è IMGË¶ÅÁ¥†„Ç≥„É≥„ÉÜ„É≥„ÉÑÁü©ÂΩ¢„ÉÜ„Çπ„ÉàÈñãÂßã', 'info');
            
            // „Ç¶„Ç£„É≥„Éâ„Ç¶„Çµ„Ç§„Ç∫„ÇÇË®òÈå≤
            log(`üìê ÁèæÂú®„ÅÆ„Ç¶„Ç£„É≥„Éâ„Ç¶„Çµ„Ç§„Ç∫: ${window.innerWidth}√ó${window.innerHeight}`, 'info');
            
            const testImg = document.getElementById('test-img');
            if (!testImg) {
                log('‚ùå „ÉÜ„Çπ„ÉàIMGË¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì', 'error');
                return;
            }
            
            // Ëá™ÁÑ∂„Çµ„Ç§„Ç∫Ë°®Á§∫
            if (testImg.complete && testImg.naturalWidth > 0) {
                const naturalSizeSpan = document.getElementById('natural-size');
                if (naturalSizeSpan) {
                    naturalSizeSpan.textContent = `${testImg.naturalWidth}√ó${testImg.naturalHeight}`;
                }
                
                log(`‚úÖ IMGËá™ÁÑ∂„Çµ„Ç§„Ç∫: ${testImg.naturalWidth}√ó${testImg.naturalHeight}`, 'success');
                
                // PureBoundingBoxAutoPin„ÅÆ„Ç≥„É≥„ÉÜ„É≥„ÉÑÁü©ÂΩ¢Ë®àÁÆó„ÉÜ„Çπ„Éà
                if (window.PureBoundingBoxAutoPin) {
                    const autoPin = new window.PureBoundingBoxAutoPin();
                    const contentRect = autoPin.calculateContentRect(testImg);
                    
                    if (contentRect) {
                        log('üéØ IMGË¶ÅÁ¥†„ÅÆ„Ç≥„É≥„ÉÜ„É≥„ÉÑÁü©ÂΩ¢Ë®àÁÆóÁµêÊûú:', 'info');
                        // console.log('üìä Content Rect Details:', contentRect); // ResizeObserverË©≥Á¥∞„É≠„Ç∞ÁÑ°ÂäπÂåñ
                        
                        log(`  ‚Ä¢ ‰ΩçÁΩÆ: (${contentRect.x.toFixed(1)}, ${contentRect.y.toFixed(1)})`, 'info');
                        log(`  ‚Ä¢ „Çµ„Ç§„Ç∫: ${contentRect.width.toFixed(1)}√ó${contentRect.height.toFixed(1)}`, 'info');
                        log(`  ‚Ä¢ „Çπ„Ç±„Éº„É´: ${contentRect.scaleX?.toFixed(3)}√ó${contentRect.scaleY?.toFixed(3)}`, 'info');
                        log(`  ‚Ä¢ „Çø„Ç§„Éó: ${contentRect.type}`, 'info');
                        
                        // ËÉåÊôØÁîªÂÉèÁâà„Å®„ÅÆÊØîËºÉ
                        const backgroundElement = document.getElementById('background-element');
                        if (backgroundElement) {
                            const bgContentRect = autoPin.calculateContentRect(backgroundElement);
                            if (bgContentRect) {
                                log('üîç ËÉåÊôØÁîªÂÉèÁâà„Å®„ÅÆÊØîËºÉ:', 'info');
                                log(`  ‚Ä¢ IMGÁâà„Çø„Ç§„Éó: ${contentRect.type}`, 'info');
                                log(`  ‚Ä¢ ËÉåÊôØÁâà„Çø„Ç§„Éó: ${bgContentRect.type}`, 'info');
                                log(`  ‚Ä¢ „Çπ„Ç±„Éº„É´Á≤æÂ∫¶: IMGÁâà„ÅÆÊñπ„Åå${contentRect.type.includes('natural') ? 'È´òÁ≤æÂ∫¶' : 'Êé®ÂÆöÂÄ§'}`, 'info');
                            }
                        }
                    } else {
                        log('‚ùå „Ç≥„É≥„ÉÜ„É≥„ÉÑÁü©ÂΩ¢Ë®àÁÆóÂ§±Êïó', 'error');
                    }
                } else {
                    log('‚ö†Ô∏è PureBoundingBoxAutoPin„ÅåË™≠„ÅøËæº„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì', 'warning');
                }
            } else {
                log('‚è≥ ÁîªÂÉèË™≠„ÅøËæº„Åø‰∏≠...ÂÜçË©¶Ë°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'warning');
            }
        }
        
        /**
         * üéØ ÂäπÁéáÁöÑ„Éî„É≥„Ç∑„Çπ„ÉÜ„É† v2.0 Áµ±Âêà„ÉÜ„Çπ„Éà
         */
        async function testEfficientPinSystem() {
            log('üéØ ÂäπÁéáÁöÑ„Éî„É≥„Ç∑„Çπ„ÉÜ„É† v2.0 Áµ±Âêà„ÉÜ„Çπ„ÉàÈñãÂßã', 'info');
            
            try {
                // „É¢„Ç∏„É•„Éº„É´Â≠òÂú®Á¢∫Ë™ç
                if (!window.ElementCalculator || !window.PinRenderer || !window.EfficientObserver) {
                    log('‚ùå ÂøÖË¶Å„Å™„É¢„Ç∏„É•„Éº„É´„ÅåË™≠„ÅøËæº„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì', 'error');
                    log('  ‚Ä¢ ElementCalculator: ' + (!!window.ElementCalculator), 'error');
                    log('  ‚Ä¢ PinRenderer: ' + (!!window.PinRenderer), 'error');
                    log('  ‚Ä¢ EfficientObserver: ' + (!!window.EfficientObserver), 'error');
                    return;
                }
                
                log('‚úÖ ÂÖ®„É¢„Ç∏„É•„Éº„É´Ë™≠„ÅøËæº„ÅøÁ¢∫Ë™çÂÆå‰∫Ü', 'success');
                
                // 1. „Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñ
                const calculator = new ElementCalculator();
                const renderer = new PinRenderer();
                const observer = new EfficientObserver(calculator, renderer);
                
                log('üèóÔ∏è 3Â±§„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£ÂàùÊúüÂåñÂÆå‰∫Ü', 'success');
                
                // 2. „ÉÜ„Çπ„ÉàÂØæË±°Ë¶ÅÁ¥†ÈÅ∏Êäû
                const backgroundElement = document.getElementById('background-element');
                if (!backgroundElement) {
                    log('‚ùå ËÉåÊôØË¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì', 'error');
                    return;
                }
                
                // 3. Ë®àÁÆó„É™„ÇØ„Ç®„Çπ„Éà‰ΩúÊàêÔºà‰ªïÊßòÊõ∏‰æã„Å®Âêå„ÅòÔºâ
                const request = {
                    element: backgroundElement,
                    anchorPoints: [
                        { id: 'TC', ratioX: 0.5, ratioY: 0.0 }  // ‰∏ä‰∏≠Â§Æ„ÅÆ„Åø
                    ],
                    elementType: 'background'
                };
                
                log('üìã Ë®àÁÆó„É™„ÇØ„Ç®„Çπ„Éà‰ΩúÊàê: TC (‰∏ä‰∏≠Â§Æ) „ÅÆ„Åø', 'info');
                
                // 4. Áõ¥Êé•Ë®àÁÆó„ÉÜ„Çπ„Éà
                log('üßÆ ElementCalculatorÁõ¥Êé•Ë®àÁÆó„ÉÜ„Çπ„Éà...', 'info');
                const result = await calculator.calculate(request);
                
                log('‚úÖ Ë®àÁÆóÂÆå‰∫Ü:', 'success');
                log(`  ‚Ä¢ Ë¶ÅÁ¥†ID: ${result.elementId}`, 'info');
                log(`  ‚Ä¢ Ë¶ÅÁ¥†„Çø„Ç§„Éó: ${result.metadata.elementType}`, 'info');
                log(`  ‚Ä¢ Ë®àÁÆóÊñπÊ≥ï: ${result.metadata.calculationMethod}`, 'info');
                log(`  ‚Ä¢ ÂÆüË°åÊôÇÈñì: ${result.metadata.executionTime}ms`, 'info');
                log(`  ‚Ä¢ „Éî„É≥Êï∞: ${result.pins.length}`, 'info');
                
                result.pins.forEach(pin => {
                    log(`    TC ‚Üí (${pin.x}, ${pin.y}) ${pin.isValid ? '‚úÖ' : '‚ùåÁîªÈù¢Â§ñ'}`, 'info');
                });
                
                // 5. PinRendererÊèèÁîª„ÉÜ„Çπ„Éà
                log('üé® PinRendererÊèèÁîª„ÉÜ„Çπ„Éà...', 'info');
                renderer.render({
                    pins: result.pins,
                    options: {
                        defaultColor: '#2ed573',
                        showLabels: true,
                        enableAnimation: true
                    }
                });
                
                log('‚úÖ „Éî„É≥ÊèèÁîªÂÆå‰∫Ü - ÁîªÈù¢‰∏ä„Å´Á∑ëËâ≤„Éî„É≥„ÅåË°®Á§∫„Åï„Çå„Å¶„ÅÑ„Çã„ÅØ„Åö„Åß„Åô', 'success');
                
                // 6. EfficientObserverÁõ£Ë¶ñ„ÉÜ„Çπ„Éà
                log('üëÄ EfficientObserverÁõ£Ë¶ñÈñãÂßã...', 'info');
                observer.observe(backgroundElement, request);
                
                log('‚úÖ Áõ£Ë¶ñÈñãÂßãÂÆå‰∫Ü - „Ç¶„Ç£„É≥„Éâ„Ç¶„Çµ„Ç§„Ç∫Â§âÊõ¥„Åß„Éî„É≥„ÅåËøΩÂæì„Åô„Çã„ÅØ„Åö„Åß„Åô', 'success');
                
                // 7. Áµ±Ë®àÊÉÖÂ†±Ë°®Á§∫
                const observationState = observer.getObservationState();
                const rendererState = renderer.getState();
                
                log('üìä „Ç∑„Çπ„ÉÜ„É†Áµ±Ë®à:', 'info');
                log(`  ‚Ä¢ Áõ£Ë¶ñË¶ÅÁ¥†Êï∞: ${observationState.observedElementCount}`, 'info');
                log(`  ‚Ä¢ „Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Éî„É≥Êï∞: ${rendererState.activePinCount}`, 'info');
                log(`  ‚Ä¢ Ë®àÁÆó„Ç≠„É£„ÉÉ„Ç∑„É•„Çµ„Ç§„Ç∫: ${calculator.getStats().cacheSize}`, 'info');
                
                // 8. „Ç∞„É≠„Éº„Éê„É´ÂèÇÁÖßË®≠ÂÆöÔºà‰ªñ„ÅÆÊ©üËÉΩ„Åã„Çâ„Ç¢„ÇØ„Çª„ÇπÂèØËÉΩ„Å´„Åô„ÇãÔºâ
                window.efficientPinSystem = {
                    calculator: calculator,
                    renderer: renderer,
                    observer: observer
                };
                
                // 9. 3ÁßíÂæå„Å´„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó„ÉÜ„Çπ„Éà
                setTimeout(() => {
                    log('üßπ 3ÁßíÂæå„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó„ÉÜ„Çπ„Éà...', 'info');
                    observer.unobserve(backgroundElement);
                    renderer.clearPins();
                    log('‚úÖ „ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„ÉóÂÆå‰∫Ü - „Éî„É≥„ÅåÊ∂à„Åà„Å¶„ÅÑ„Çã„ÅØ„Åö„Åß„Åô', 'success');
                }, 3000);
                
                log('üéØ ÂäπÁéáÁöÑ„Éî„É≥„Ç∑„Çπ„ÉÜ„É† v2.0 Áµ±Âêà„ÉÜ„Çπ„ÉàÂÆå‰∫ÜÔºÅ', 'success');
                
            } catch (error) {
                log(`‚ùå Áµ±Âêà„ÉÜ„Çπ„Éà„Ç®„É©„Éº: ${error.message}`, 'error');
                console.error('Áµ±Âêà„ÉÜ„Çπ„ÉàË©≥Á¥∞„Ç®„É©„Éº:', error);
            }
        }
        
        /**
         * üîÑ Phase 2: ‰∏¶Ë°åÁ®ºÂÉçÁµ±Âêà„ÉÜ„Çπ„Éà
         */
        async function testParallelSystemIntegration() {
            log('üîÑ Phase 2: ‰∏¶Ë°åÁ®ºÂÉçÁµ±Âêà„ÉÜ„Çπ„ÉàÈñãÂßã', 'info');
            
            try {
                // „Ç¢„ÉÄ„Éó„Çø„ÉºÂàùÊúüÂåñ
                if (!window.ElementObserverAdapter) {
                    log('‚ùå ElementObserverAdapter„ÅåË™≠„ÅøËæº„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì', 'error');
                    return;
                }
                
                const adapter = new ElementObserverAdapter();
                
                // „Ç∑„Çπ„ÉÜ„É†Áä∂ÊÖãÁ¢∫Ë™ç
                const debugInfo = adapter.getDebugInfo();
                log('üîç „Ç∑„Çπ„ÉÜ„É†Áä∂ÊÖã:', 'info');
                log(`  ‚Ä¢ „É¨„Ç¨„Ç∑„Éº„Ç∑„Çπ„ÉÜ„É†: ${debugInfo.systemStatus.legacy.available ? '‚úÖÂà©Áî®ÂèØËÉΩ' : '‚ùåÂà©Áî®‰∏çÂèØ'}`, 'info');
                log(`  ‚Ä¢ ÂäπÁéáÁöÑ„Éî„É≥„Ç∑„Çπ„ÉÜ„É†: ${debugInfo.systemStatus.efficient.available ? '‚úÖÂà©Áî®ÂèØËÉΩ' : '‚ùåÂà©Áî®‰∏çÂèØ'}`, 'info');
                log(`  ‚Ä¢ Âãï‰Ωú„É¢„Éº„Éâ: ${debugInfo.migrationConfig.mode}`, 'info');
                
                // ‰∏¶Ë°åÁ®ºÂÉç„ÉÜ„Çπ„Éà
                if (debugInfo.migrationConfig.mode === 'parallel') {
                    log('‚öñÔ∏è ‰∏¶Ë°åÁ®ºÂÉç„É¢„Éº„Éâ - ‰∏°„Ç∑„Çπ„ÉÜ„É†„ÉÜ„Çπ„Éà', 'info');
                    
                    const testElement = document.getElementById('background-element');
                    
                    let changeCount = 0;
                    const unobserve = adapter.observe(testElement, (rect, changeType) => {
                        changeCount++;
                        log(`üì° Â§âÊõ¥Ê§úÂá∫ ${changeCount}ÂõûÁõÆ: ${changeType} - „Çµ„Ç§„Ç∫ ${Math.round(rect.width)}√ó${Math.round(rect.height)}`, 'info');
                    });
                    
                    // 5ÁßíÂæå„Å´„ÉÜ„Çπ„ÉàÁµÇ‰∫Ü
                    setTimeout(() => {
                        unobserve();
                        const metrics = adapter.getPerformanceMetrics();
                        log('üìä ‰∏¶Ë°åÁ®ºÂÉç„ÉÜ„Çπ„ÉàÁµêÊûú:', 'success');
                        log(`  ‚Ä¢ „É¨„Ç¨„Ç∑„ÉºÂëº„Å≥Âá∫„Åó: ${metrics.legacyCallCount}Âõû`, 'info');
                        log(`  ‚Ä¢ ÂäπÁéáÁöÑ„Ç∑„Çπ„ÉÜ„É†Âëº„Å≥Âá∫„Åó: ${metrics.efficientCallCount}Âõû`, 'info');
                        log(`  ‚Ä¢ „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÁô∫Áîü: ${metrics.fallbackCount}Âõû`, 'info');
                        log(`  ‚Ä¢ Â§âÊõ¥Ê§úÂá∫ÂõûÊï∞: ${changeCount}Âõû`, 'info');
                        
                        adapter.destroy();
                    }, 5000);
                    
                    log('‚úÖ ‰∏¶Ë°åÁ®ºÂÉç„ÉÜ„Çπ„ÉàÂÆüË°å‰∏≠... 5ÁßíÈñìÁõ£Ë¶ñ„Åó„Åæ„Åô', 'success');
                    
                } else {
                    log(`üîÑ ${debugInfo.migrationConfig.mode}„É¢„Éº„Éâ - Âçò‰∏Ä„Ç∑„Çπ„ÉÜ„É†„ÉÜ„Çπ„Éà`, 'info');
                    
                    // Âçò‰∏Ä„Ç∑„Çπ„ÉÜ„É†„ÉÜ„Çπ„Éà
                    const testElement = document.getElementById('test-hero');
                    const unobserve = adapter.observe(testElement, (rect, changeType) => {
                        log(`üì° ${debugInfo.migrationConfig.mode}„Ç∑„Çπ„ÉÜ„É†Â§âÊõ¥Ê§úÂá∫: ${changeType}`, 'info');
                    });
                    
                    setTimeout(() => {
                        unobserve();
                        const metrics = adapter.getPerformanceMetrics();
                        log('üìä Âçò‰∏Ä„Ç∑„Çπ„ÉÜ„É†„ÉÜ„Çπ„ÉàÂÆå‰∫Ü', 'success');
                        log(`  ‚Ä¢ Âá¶ÁêÜÂõûÊï∞: ${metrics.legacyCallCount + metrics.efficientCallCount}Âõû`, 'info');
                        
                        adapter.destroy();
                    }, 3000);
                }
                
            } catch (error) {
                log(`‚ùå ‰∏¶Ë°åÁ®ºÂÉç„ÉÜ„Çπ„Éà„Ç®„É©„Éº: ${error.message}`, 'error');
                console.error('‰∏¶Ë°åÁ®ºÂÉç„ÉÜ„Çπ„ÉàË©≥Á¥∞„Ç®„É©„Éº:', error);
            }
        }
        
        /**
         * üöÄ Phase 3: „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„Éô„É≥„ÉÅ„Éû„Éº„ÇØ & ÁßªË°åÂà§ÂÆö„Ç∑„Çπ„ÉÜ„É†
         */
        window.performanceBenchmark = function() {
            // console.log('üöÄ Phase 3„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„Éô„É≥„ÉÅ„Éû„Éº„ÇØÈñãÂßã'); // „Éô„É≥„ÉÅ„Éû„Éº„ÇØ„É≠„Ç∞ÁÑ°ÂäπÂåñ
            
            const results = {
                legacy: null,
                efficient: null,
                comparison: null,
                migrationDecision: null
            };
            
            const adapter = new ElementObserverAdapter();
            const heroSection = document.querySelector('.hero-section');
            
            if (!heroSection) {
                console.error('‚ùå heroSection„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                return;
            }
            
            // „É¨„Ç¨„Ç∑„Éº„Ç∑„Çπ„ÉÜ„É†„ÅÆ„Éô„É≥„ÉÅ„Éû„Éº„ÇØ
            // console.log('üìä „É¨„Ç¨„Ç∑„Éº„Ç∑„Çπ„ÉÜ„É†„ÅÆ„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÊ∏¨ÂÆöÈñãÂßã'); // „Éô„É≥„ÉÅ„Éû„Éº„ÇØ„É≠„Ç∞ÁÑ°ÂäπÂåñ
            adapter.updateMigrationConfig({ mode: 'legacy-first' });
            
            const legacyStartTime = performance.now();
            const legacyUnobserve = adapter.observe(heroSection, () => {});
            
            setTimeout(() => {
                const legacyEndTime = performance.now();
                results.legacy = {
                    initTime: legacyEndTime - legacyStartTime,
                    metrics: adapter.getPerformanceMetrics()
                };
                
                legacyUnobserve();
                // console.log('‚úÖ „É¨„Ç¨„Ç∑„Éº„Ç∑„Çπ„ÉÜ„É†Ê∏¨ÂÆöÂÆå‰∫Ü:', results.legacy); // „Éô„É≥„ÉÅ„Éû„Éº„ÇØ„É≠„Ç∞ÁÑ°ÂäπÂåñ
                
                // ÂäπÁéáÁöÑ„Ç∑„Çπ„ÉÜ„É†„ÅÆ„Éô„É≥„ÉÅ„Éû„Éº„ÇØ
                // console.log('üöÄ ÂäπÁéáÁöÑ„Éî„É≥„Ç∑„Çπ„ÉÜ„É†„ÅÆ„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÊ∏¨ÂÆöÈñãÂßã'); // „Éô„É≥„ÉÅ„Éû„Éº„ÇØ„É≠„Ç∞ÁÑ°ÂäπÂåñ
                adapter.updateMigrationConfig({ mode: 'efficient-first' });
                
                const efficientStartTime = performance.now();
                const efficientUnobserve = adapter.observe(heroSection, () => {});
                
                setTimeout(() => {
                    const efficientEndTime = performance.now();
                    results.efficient = {
                        initTime: efficientEndTime - efficientStartTime,
                        metrics: adapter.getPerformanceMetrics()
                    };
                    
                    efficientUnobserve();
                    // console.log('‚úÖ ÂäπÁéáÁöÑ„Ç∑„Çπ„ÉÜ„É†Ê∏¨ÂÆöÂÆå‰∫Ü:', results.efficient); // „Éô„É≥„ÉÅ„Éû„Éº„ÇØ„É≠„Ç∞ÁÑ°ÂäπÂåñ
                    
                    // ÊØîËºÉÂàÜÊûê„Å®ÁßªË°åÂà§ÂÆö
                    performMigrationAnalysis(results);
                    
                }, 2000);
            }, 2000);
        };
        
        // üìä ÁßªË°åÂà§ÂÆöÂàÜÊûê„Ç∑„Çπ„ÉÜ„É†
        function performMigrationAnalysis(results) {
            // console.log('üìä ÁßªË°åÂà§ÂÆöÂàÜÊûêÈñãÂßã'); // „Éô„É≥„ÉÅ„Éû„Éº„ÇØ„É≠„Ç∞ÁÑ°ÂäπÂåñ
            
            const comparison = {
                initTimeRatio: results.efficient.initTime / results.legacy.initTime,
                performanceImprovement: ((results.legacy.initTime - results.efficient.initTime) / results.legacy.initTime * 100),
                reliabilityScore: calculateReliabilityScore(results),
                compatibilityScore: 100 // „Ç¢„ÉÄ„Éó„Çø„Éº„Å´„Çà„ÇäÂÆåÂÖ®‰∫íÊèõÊÄßÁ¢∫‰øù
            };
            
            results.comparison = comparison;
            
            // GO/STOPÂà§ÂÆöÂü∫Ê∫ñ„Å´Âü∫„Å•„ÅèËá™ÂãïÂà§ÂÆö
            const migrationDecision = makeMigrationDecision(comparison);
            results.migrationDecision = migrationDecision;
            
            // console.log('üìä „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÊØîËºÉÁµêÊûú:', comparison); // „Éô„É≥„ÉÅ„Éû„Éº„ÇØ„É≠„Ç∞ÁÑ°ÂäπÂåñ
            // console.log('üéØ ÁßªË°åÂà§ÂÆöÁµêÊûú:', migrationDecision); // „Éô„É≥„ÉÅ„Éû„Éº„ÇØ„É≠„Ç∞ÁÑ°ÂäπÂåñ
            
            // Âà§ÂÆöÁµêÊûú„ÅÆÂèØË¶ñÂåñ
            displayMigrationResults(results);
        }
        
        function calculateReliabilityScore(results) {
            // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÁô∫ÁîüÁéá„Å™„Å©„Åã„Çâ‰ø°È†ºÊÄß„Çπ„Ç≥„Ç¢„ÇíË®àÁÆó
            const efficientFallbacks = results.efficient.metrics.fallbackCount || 0;
            const totalOperations = results.efficient.metrics.efficientCallCount + efficientFallbacks;
            const reliabilityScore = totalOperations > 0 ? 
                (1 - (efficientFallbacks / totalOperations)) * 100 : 100;
            
            return reliabilityScore;
        }
        
        function makeMigrationDecision(comparison) {
            const criteria = {
                performanceThreshold: -20, // „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÂä£Âåñ20%‰ª•‰∏ä„ÅßSTOP
                reliabilityThreshold: 95,  // ‰ø°È†ºÊÄß95%‰ª•‰∏ä„ÅßGO
                compatibilityThreshold: 95 // ‰∫íÊèõÊÄß95%‰ª•‰∏ä„ÅßGO
            };
            
            let decision = 'GO';
            let reasons = [];
            
            if (comparison.performanceImprovement < criteria.performanceThreshold) {
                decision = 'STOP';
                reasons.push(`„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÂä£Âåñ: ${comparison.performanceImprovement.toFixed(1)}% (Âü∫Ê∫ñ: ${criteria.performanceThreshold}%‰ª•‰∏ä)`);
            }
            
            if (comparison.reliabilityScore < criteria.reliabilityThreshold) {
                decision = 'STOP';
                reasons.push(`‰ø°È†ºÊÄß‰∏çË∂≥: ${comparison.reliabilityScore.toFixed(1)}% (Âü∫Ê∫ñ: ${criteria.reliabilityThreshold}%‰ª•‰∏ä)`);
            }
            
            if (comparison.compatibilityScore < criteria.compatibilityThreshold) {
                decision = 'STOP';
                reasons.push(`‰∫íÊèõÊÄß‰∏çË∂≥: ${comparison.compatibilityScore.toFixed(1)}% (Âü∫Ê∫ñ: ${criteria.compatibilityThreshold}%‰ª•‰∏ä)`);
            }
            
            if (decision === 'GO') {
                reasons.push('ÂÖ®Âü∫Ê∫ñ„Çí„ÇØ„É™„Ç¢ - Phase 3ÁßªË°å„ÇíÊé®Â•®');
            }
            
            return { decision, reasons, criteria };
        }
        
        function displayMigrationResults(results) {
            console.group('üéØ Phase 3ÁßªË°åÂà§ÂÆö„É¨„Éù„Éº„Éà');
            
            console.log('üìä „Ç∑„Çπ„ÉÜ„É†ÊØîËºÉ:'); // ÈáçË¶Å„Å™ÁµêÊûúË°®Á§∫„ÅØ‰øùÊåÅ
            console.table({
                '„É¨„Ç¨„Ç∑„Éº„Ç∑„Çπ„ÉÜ„É†': {
                    'ÂàùÊúüÂåñÊôÇÈñì': `${results.legacy.initTime.toFixed(2)}ms`,
                    'Âëº„Å≥Âá∫„ÅóÂõûÊï∞': results.legacy.metrics.legacyCallCount,
                    '„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ': results.legacy.metrics.fallbackCount
                },
                'ÂäπÁéáÁöÑ„Ç∑„Çπ„ÉÜ„É†': {
                    'ÂàùÊúüÂåñÊôÇÈñì': `${results.efficient.initTime.toFixed(2)}ms`,
                    'Âëº„Å≥Âá∫„ÅóÂõûÊï∞': results.efficient.metrics.efficientCallCount,
                    '„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ': results.efficient.metrics.fallbackCount
                }
            });
            
            console.log('üéØ ÁßªË°åÂà§ÂÆö:', results.migrationDecision.decision);
            console.log('üìã Âà§ÂÆöÁêÜÁî±:');
            results.migrationDecision.reasons.forEach(reason => console.log(`  ‚Ä¢ ${reason}`));
            
            if (results.migrationDecision.decision === 'GO') {
                console.log('‚úÖ ÁßªË°åÊé®Â•®: efficient-first„É¢„Éº„Éâ„Åß„ÅÆ„ÉÜ„Çπ„ÉàÂÆüË°å„ÇíÊé®Â•®„Åó„Åæ„Åô');
                console.log('üéØ Ê¨°„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó: testEfficientFirstMode() „ÇíÂÆüË°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
            } else {
                console.log('‚ùå ÁßªË°åÈùûÊé®Â•®: ÂïèÈ°å„ÅÆËß£Ê±∫Âæå„Å´ÂÜçË©ï‰æ°„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
            }
            
            console.groupEnd();
            
            // ÁµêÊûú„Çí„Ç∞„É≠„Éº„Éê„É´Â§âÊï∞„Å®„Åó„Å¶‰øùÂ≠òÔºà„Éá„Éê„ÉÉ„Ç∞Áî®Ôºâ
            window.migrationBenchmarkResults = results;
        }
        
        /**
         * üöÄ efficient-first„É¢„Éº„Éâ„ÉÜ„Çπ„Éà
         */
        window.testEfficientFirstMode = function() {
            console.log('üöÄ efficient-first„É¢„Éº„ÉâÁßªË°å„ÉÜ„Çπ„ÉàÈñãÂßã');
            
            const adapter = new ElementObserverAdapter();
            adapter.updateMigrationConfig({ 
                mode: 'efficient-first',
                enableAutoMigration: true,
                fallbackToLegacy: true
            });
            
            const heroSection = document.querySelector('.hero-section');
            if (!heroSection) {
                console.error('‚ùå heroSection„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                return;
            }
            
            // console.log('üéØ ÂäπÁéáÁöÑ„Éî„É≥„Ç∑„Çπ„ÉÜ„É† v2.0 ÂÑ™ÂÖà„É¢„Éº„Éâ„ÅßÁ®ºÂÉçÈñãÂßã'); // „Éô„É≥„ÉÅ„Éû„Éº„ÇØ„É≠„Ç∞ÁÑ°ÂäπÂåñ
            
            const unobserve = adapter.observe(heroSection, (rect, changeType) => {
                // console.log('üìä efficient-firstÂãï‰Ωú:', { // „Éô„É≥„ÉÅ„Éû„Éº„ÇØ„É≠„Ç∞ÁÑ°ÂäπÂåñ
                //     changeType, 
                //     size: `${rect.width}x${rect.height}`,
                //     timestamp: Date.now() 
                // });
            });
            
            // 10ÁßíÈñì„ÅÆÁ®ºÂÉç„ÉÜ„Çπ„Éà
            setTimeout(() => {
                const metrics = adapter.getPerformanceMetrics();
                // console.log('üìä efficient-firstÁ®ºÂÉçÁµêÊûú:', metrics); // „Éô„É≥„ÉÅ„Éû„Éº„ÇØ„É≠„Ç∞ÁÑ°ÂäπÂåñ
                
                console.log('üéØ ÁßªË°åÊàêÂäüÂ∫¶Ë©ï‰æ°:');
                if (metrics.efficientCallCount > 0 && metrics.fallbackCount === 0) {
                    console.log('‚úÖ ÂÆåÂÖ®ÁßªË°åÊàêÂäü - ÂäπÁéáÁöÑ„Ç∑„Çπ„ÉÜ„É†„ÅÆ„Åø„ÅßÁ®ºÂÉç');
                } else if (metrics.efficientCallCount > 0 && metrics.fallbackCount > 0) {
                    console.log('‚ö†Ô∏è ÈÉ®ÂàÜÁßªË°å - „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÁô∫Áîü„ÅÇ„Çä');
                    console.log(`üìä „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÁéá: ${(metrics.fallbackCount / (metrics.efficientCallCount + metrics.fallbackCount) * 100).toFixed(1)}%`);
                } else {
                    console.log('‚ùå ÁßªË°åÂ§±Êïó - „É¨„Ç¨„Ç∑„Éº„Ç∑„Çπ„ÉÜ„É†„ÅÆ„Åø„ÅßÁ®ºÂÉç');
                }
                
                unobserve();
                console.log('‚úÖ efficient-first„É¢„Éº„Éâ„ÉÜ„Çπ„ÉàÂÆå‰∫Ü');
                
                // Ê¨°„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„ÅÆÊ°àÂÜÖ
                if (metrics.efficientCallCount > 0 && metrics.fallbackCount === 0) {
                    console.log('üéØ Ê¨°„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó: ÂÆåÂÖ®ÁßªË°å„ÉÜ„Çπ„Éà (testFullMigration) „ÇíÂÆüË°åÂèØËÉΩ„Åß„Åô');
                }
                
            }, 10000);
        };
        
        /**
         * üéØ Phase 3: ÂÆåÂÖ®ÁßªË°å„ÉÜ„Çπ„ÉàÔºàÊóß„Ç∑„Çπ„ÉÜ„É†ÂâäÈô§Ê∫ñÂÇôÔºâ
         */
        window.testFullMigration = function() {
            console.log('üéØ Phase 3ÂÆåÂÖ®ÁßªË°å„ÉÜ„Çπ„ÉàÈñãÂßã');
            
            const results = {
                migrationPhases: [],
                overallSuccess: false,
                cleanupResults: null,
                finalValidation: null
            };
            
            // Phase 1: efficient-only„É¢„Éº„Éâ„ÉÜ„Çπ„Éà
            console.log('üìä Phase 1: efficient-only„É¢„Éº„ÉâÊ§úË®ºÈñãÂßã');
            
            const adapter = new ElementObserverAdapter();
            adapter.updateMigrationConfig({ 
                mode: 'efficient-first',
                enableAutoMigration: false,  // Ëá™ÂãïÁßªË°åÁÑ°Âäπ
                fallbackToLegacy: false      // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÁÑ°Âäπ
            });
            
            const heroSection = document.querySelector('.hero-section');
            if (!heroSection) {
                console.error('‚ùå heroSection„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                return;
            }
            
            console.log('üéØ ÂäπÁéáÁöÑ„Éî„É≥„Ç∑„Çπ„ÉÜ„É†ÂçòÁã¨„É¢„Éº„Éâ - „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÁÑ°Âäπ„ÅßÁ®ºÂÉç„ÉÜ„Çπ„Éà');
            
            let changeDetectionCount = 0;
            const unobserve = adapter.observe(heroSection, (rect, changeType) => {
                changeDetectionCount++;
                console.log('üìä efficient-onlyÂãï‰Ωú:', { 
                    changeType, 
                    size: `${rect.width}x${rect.height}`,
                    detectionCount: changeDetectionCount
                });
            });
            
            // 5ÁßíÈñì„ÅÆÂçòÁã¨Á®ºÂÉç„ÉÜ„Çπ„Éà
            setTimeout(() => {
                const phase1Metrics = adapter.getPerformanceMetrics();
                results.migrationPhases.push({
                    phase: 'efficient-only',
                    success: phase1Metrics.efficientCallCount > 0 && phase1Metrics.fallbackCount === 0,
                    metrics: phase1Metrics,
                    changeDetections: changeDetectionCount
                });
                
                unobserve();
                
                console.log('üìä Phase 1ÁµêÊûú:', results.migrationPhases[0]);
                
                if (results.migrationPhases[0].success) {
                    console.log('‚úÖ Phase 1ÊàêÂäü - ÂäπÁéáÁöÑ„Ç∑„Çπ„ÉÜ„É†ÂçòÁã¨Á®ºÂÉçÁ¢∫Ë™ç');
                    // Phase 2: „É¨„Ç¨„Ç∑„Éº„Ç∑„Çπ„ÉÜ„É†‰æùÂ≠òÈñ¢‰øÇ„ÉÅ„Çß„ÉÉ„ÇØ
                    testLegacyDependencyCheck(results);
                } else {
                    console.log('‚ùå Phase 1Â§±Êïó - ÂÆåÂÖ®ÁßªË°å‰∏çÂèØ');
                    displayFullMigrationResults(results);
                }
                
            }, 5000);
        };
        
        function testLegacyDependencyCheck(results) {
            console.log('üìä Phase 2: „É¨„Ç¨„Ç∑„Éº„Ç∑„Çπ„ÉÜ„É†‰æùÂ≠òÈñ¢‰øÇ„ÉÅ„Çß„ÉÉ„ÇØÈñãÂßã');
            
            // „É¨„Ç¨„Ç∑„Éº„Ç∑„Çπ„ÉÜ„É†„ÅÆ‰ΩøÁî®Áä∂Ê≥ÅÁ¢∫Ë™ç
            const legacyUsage = {
                globalReferences: checkGlobalLegacyReferences(),
                activeObservations: checkActiveLegacyObservations(),
                codeReferences: checkCodeLegacyReferences()
            };
            
            results.migrationPhases.push({
                phase: 'legacy-dependency-check',
                success: legacyUsage.globalReferences.safe && legacyUsage.activeObservations.safe,
                details: legacyUsage
            });
            
            console.log('üìã „É¨„Ç¨„Ç∑„Éº‰æùÂ≠òÈñ¢‰øÇ„ÉÅ„Çß„ÉÉ„ÇØÁµêÊûú:', legacyUsage);
            
            if (results.migrationPhases[1].success) {
                console.log('‚úÖ Phase 2ÊàêÂäü - „É¨„Ç¨„Ç∑„Éº‰æùÂ≠òÈñ¢‰øÇ„ÇØ„É™„Ç¢');
                // Phase 3: ÊÆµÈöéÁöÑ„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó„ÉÜ„Çπ„Éà
                testCleanupPhase(results);
            } else {
                console.log('‚ö†Ô∏è Phase 2Ë≠¶Âëä - „É¨„Ç¨„Ç∑„Éº‰æùÂ≠òÈñ¢‰øÇ„ÅÇ„ÇäÔºàÁßªË°åÁ∂ôÁ∂öÂèØËÉΩÔºâ');
                // ‰æùÂ≠òÈñ¢‰øÇ„Åå„ÅÇ„Å£„Å¶„ÇÇÁßªË°åÁ∂ôÁ∂öÔºàÊÆµÈöéÁöÑÂâäÈô§Ôºâ
                testCleanupPhase(results);
            }
        }
        
        function checkGlobalLegacyReferences() {
            const legacyGlobals = [
                'ElementObserver', 'ElementObserverCore', 
                'PureBoundingBoxAutoPin', 'PureBoundingBox'
            ];
            
            const activeReferences = [];
            const safeToRemove = [];
            
            legacyGlobals.forEach(globalName => {
                if (typeof window[globalName] !== 'undefined') {
                    // ÂÆüÈöõ„ÅÆ‰ΩøÁî®Áä∂Ê≥Å„Çí„ÉÅ„Çß„ÉÉ„ÇØÔºàÁ∞°ÊòìÁâàÔºâ
                    const hasActiveInstances = window[globalName].prototype && 
                        Object.getOwnPropertyNames(window).some(prop => 
                            window[prop] instanceof window[globalName]
                        );
                    
                    if (hasActiveInstances) {
                        activeReferences.push(globalName);
                    } else {
                        safeToRemove.push(globalName);
                    }
                }
            });
            
            return {
                safe: activeReferences.length === 0,
                activeReferences: activeReferences,
                safeToRemove: safeToRemove,
                total: legacyGlobals.length
            };
        }
        
        function checkActiveLegacyObservations() {
            // ÁèæÂú®„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™„É¨„Ç¨„Ç∑„ÉºÁõ£Ë¶ñ„ÅÆÁ¢∫Ë™ç
            const activeObservations = [];
            
            // ElementObserverAdapterÁµåÁî±„ÅÆÁõ£Ë¶ñÁä∂Ê≥Å
            if (window.ElementObserverAdapter) {
                try {
                    const adapter = new ElementObserverAdapter();
                    const metrics = adapter.getPerformanceMetrics();
                    
                    return {
                        safe: metrics.legacyCallCount === 0,
                        legacyCallCount: metrics.legacyCallCount,
                        efficientCallCount: metrics.efficientCallCount,
                        activeObservationCount: metrics.activeObservationCount
                    };
                } catch (error) {
                    return {
                        safe: true, // „Ç®„É©„Éº„ÅÆÂ†¥Âêà„ÅØÂÆâÂÖ®„Å®Ë¶ã„Å™„Åô
                        error: error.message
                    };
                }
            }
            
            return { safe: true, reason: 'ElementObserverAdapter not available' };
        }
        
        function checkCodeLegacyReferences() {
            // ÈùôÁöÑ„Ç≥„Éº„ÉâÂèÇÁÖß„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØÔºàÂÆüË£ÖÊôÇ„Å´ÂøÖË¶Å„Å´Âøú„Åò„Å¶Êã°ÂºµÔºâ
            return {
                filesWithLegacyReferences: [],
                estimatedCleanupComplexity: 'low'
            };
        }
        
        function testCleanupPhase(results) {
            console.log('üìä Phase 3: ÊÆµÈöéÁöÑ„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó„ÉÜ„Çπ„ÉàÈñãÂßã');
            
            const cleanupPlan = {
                step1: '„É¨„Ç¨„Ç∑„ÉºÂèÇÁÖß„ÅÆÊÆµÈöéÁöÑÂâäÈô§',
                step2: '„Ç∞„É≠„Éº„Éê„É´Â§âÊï∞„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó',
                step3: 'Êú™‰ΩøÁî®„Ç≥„Éº„ÉâÂâäÈô§',
                step4: 'ÊúÄÁµÇÊ§úË®º'
            };
            
            console.log('üóëÔ∏è „ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„ÉóË®àÁîª:', cleanupPlan);
            
            // ÂÆüÈöõ„ÅÆ„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó„ÅØÊâãÂãïÂÆüË°å„ÅÆ„Åü„ÇÅ„ÄÅ„Åì„Åì„Åß„ÅØ„Éó„É©„É≥„ÅÆ„Åø
            results.cleanupResults = {
                plan: cleanupPlan,
                readyForExecution: true,
                estimatedRisk: 'low',
                backupRecommended: true
            };
            
            // ÊúÄÁµÇÊ§úË®º
            performFinalValidation(results);
        }
        
        function performFinalValidation(results) {
            console.log('üìä Phase 4: ÊúÄÁµÇÊ§úË®ºÈñãÂßã');
            
            // „Ç∑„Çπ„ÉÜ„É†ÂÖ®‰Ωì„ÅÆÂÅ•ÂÖ®ÊÄß„ÉÅ„Çß„ÉÉ„ÇØ
            const validation = {
                efficientSystemStable: true,
                performanceAcceptable: true,
                noRegressions: true,
                readyForProduction: true
            };
            
            // ÂäπÁéáÁöÑ„Éî„É≥„Ç∑„Çπ„ÉÜ„É†„ÅÆÊúÄÁµÇÂãï‰ΩúÁ¢∫Ë™ç
            const finalAdapter = new ElementObserverAdapter();
            finalAdapter.updateMigrationConfig({ mode: 'efficient-first' });
            
            const heroSection = document.querySelector('.hero-section');
            const finalUnobserve = finalAdapter.observe(heroSection, () => {});
            
            setTimeout(() => {
                const finalMetrics = finalAdapter.getPerformanceMetrics();
                finalUnobserve();
                
                validation.finalMetrics = finalMetrics;
                validation.migrationSuccess = finalMetrics.efficientCallCount > 0 && finalMetrics.fallbackCount === 0;
                
                results.finalValidation = validation;
                results.overallSuccess = validation.migrationSuccess && 
                    results.migrationPhases.every(phase => phase.success);
                
                console.log('üìä ÊúÄÁµÇÊ§úË®ºÁµêÊûú:', validation);
                displayFullMigrationResults(results);
                
            }, 2000);
        }
        
        function displayFullMigrationResults(results) {
            console.group('üéØ Phase 3ÂÆåÂÖ®ÁßªË°å„ÉÜ„Çπ„ÉàÁµêÊûú');
            
            console.log('üìä ÁßªË°å„Éï„Çß„Éº„Ç∫ÁµêÊûú:');
            results.migrationPhases.forEach((phase, index) => {
                console.log(`  Phase ${index + 1} (${phase.phase}): ${phase.success ? '‚úÖ ÊàêÂäü' : '‚ùå Â§±Êïó'}`);
                if (phase.details) {
                    console.log('    Ë©≥Á¥∞:', phase.details);
                }
            });
            
            if (results.cleanupResults) {
                console.log('üóëÔ∏è „ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„ÉóÊ∫ñÂÇô:', results.cleanupResults.readyForExecution ? '‚úÖ Ê∫ñÂÇôÂÆå‰∫Ü' : '‚ùå Ê∫ñÂÇô‰∏çË∂≥');
            }
            
            if (results.finalValidation) {
                console.log('üîç ÊúÄÁµÇÊ§úË®º:', results.finalValidation.migrationSuccess ? '‚úÖ ÊàêÂäü' : '‚ùå Â§±Êïó');
            }
            
            console.log('üéØ Á∑èÂêàÂà§ÂÆö:', results.overallSuccess ? '‚úÖ ÂÆåÂÖ®ÁßªË°åÂèØËÉΩ' : '‚ùå ÁßªË°å„Å´ÂïèÈ°å„ÅÇ„Çä');
            
            if (results.overallSuccess) {
                console.log('üöÄ Ê¨°„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó:');
                console.log('  1. ÊÆµÈöéÁöÑ„É¨„Ç¨„Ç∑„Éº„Ç≥„Éº„ÉâÂâäÈô§„ÅÆÂÆüË°å');
                console.log('  2. „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÊúÄÈÅ©Âåñ„ÅÆÂÆüÊñΩ');
                console.log('  3. Êú¨Áï™Áí∞Â¢É„Åß„ÅÆÊ§úË®º„ÉÜ„Çπ„Éà');
                console.log('  4. „Éâ„Ç≠„É•„É°„É≥„ÉàÊõ¥Êñ∞„ÉªÈÅãÁî®ÊâãÈ†ÜÁ¢∫Á´ã');
            } else {
                console.log('‚ö†Ô∏è ÂïèÈ°åËß£Ê±∫Âæå„Å´ÂÜç„ÉÜ„Çπ„Éà„ÇíÊé®Â•®„Åó„Åæ„Åô');
            }
            
            console.groupEnd();
            
            // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞„Å®„Åó„Å¶‰øùÂ≠ò
            window.fullMigrationResults = results;
        }
        
        /**
         * üéØ „Ç∑„Çπ„ÉÜ„É†Âàá„ÇäÊõø„Åà„ÉÜ„Çπ„Éà
         */
        function testSystemSwitching() {
            log('üéØ „Ç∑„Çπ„ÉÜ„É†Âàá„ÇäÊõø„Åà„ÉÜ„Çπ„ÉàÈñãÂßã', 'info');
            
            const adapter = new ElementObserverAdapter();
            const testElement = document.getElementById('background-element');
            
            // ÂàùÊúü„É¢„Éº„ÉâÁ¢∫Ë™ç
            let debugInfo = adapter.getDebugInfo();
            log(`ÂàùÊúü„É¢„Éº„Éâ: ${debugInfo.migrationConfig.mode}`, 'info');
            
            // „É¨„Ç¨„Ç∑„ÉºÂÑ™ÂÖà„É¢„Éº„Éâ„Å´Âàá„ÇäÊõø„Åà
            adapter.updateMigrationConfig({ mode: 'legacy-first' });
            const legacyUnobserve = adapter.observe(testElement, (rect) => {
                log(`üîÑ „É¨„Ç¨„Ç∑„Éº„É¢„Éº„ÉâÊ§úÂá∫: ${Math.round(rect.width)}√ó${Math.round(rect.height)}`, 'info');
            });
            
            setTimeout(() => {
                legacyUnobserve();
                
                // ÂäπÁéáÁöÑ„Ç∑„Çπ„ÉÜ„É†ÂÑ™ÂÖà„É¢„Éº„Éâ„Å´Âàá„ÇäÊõø„Åà
                adapter.updateMigrationConfig({ mode: 'efficient-first' });
                const efficientUnobserve = adapter.observe(testElement, (rect) => {
                    log(`üöÄ ÂäπÁéáÁöÑ„É¢„Éº„ÉâÊ§úÂá∫: ${Math.round(rect.width)}√ó${Math.round(rect.height)}`, 'info');
                });
                
                setTimeout(() => {
                    efficientUnobserve();
                    
                    const finalMetrics = adapter.getPerformanceMetrics();
                    log('üìä „Ç∑„Çπ„ÉÜ„É†Âàá„ÇäÊõø„Åà„ÉÜ„Çπ„ÉàÂÆå‰∫Ü', 'success');
                    log(`  ‚Ä¢ „É¨„Ç¨„Ç∑„Éº: ${finalMetrics.legacyCallCount}Âõû`, 'info');
                    log(`  ‚Ä¢ ÂäπÁéáÁöÑ: ${finalMetrics.efficientCallCount}Âõû`, 'info');
                    
                    adapter.destroy();
                }, 2000);
            }, 2000);
        }
        
        // IMGË¶ÅÁ¥†„ÅÆË™≠„ÅøËæº„ÅøÁõ£Ë¶ñ
        document.addEventListener('DOMContentLoaded', () => {
            const testImg = document.getElementById('test-img');
            if (testImg) {
                testImg.addEventListener('load', () => {
                    log('‚úÖ „ÉÜ„Çπ„ÉàÁî®IMGË¶ÅÁ¥†Ë™≠„ÅøËæº„ÅøÂÆå‰∫Ü', 'success');
                    const naturalSizeSpan = document.getElementById('natural-size');
                    if (naturalSizeSpan) {
                        naturalSizeSpan.textContent = `${testImg.naturalWidth}√ó${testImg.naturalHeight}`;
                    }
                });
                
                testImg.addEventListener('error', () => {
                    log('‚ùå „ÉÜ„Çπ„ÉàÁî®IMGË¶ÅÁ¥†Ë™≠„ÅøËæº„ÅøÂ§±Êïó', 'error');
                    const naturalSizeSpan = document.getElementById('natural-size');
                    if (naturalSizeSpan) {
                        naturalSizeSpan.textContent = 'Error';
                    }
                });
            }
        });

        // üîç „Ç¶„Ç£„É≥„Éâ„Ç¶„É™„Çµ„Ç§„Ç∫ÂΩ±ÈüøË®∫Êñ≠
        function debugWindowResizeImpact() {
            log('üîç „Ç¶„Ç£„É≥„Éâ„Ç¶„É™„Çµ„Ç§„Ç∫ÂΩ±ÈüøË®∫Êñ≠ÈñãÂßã', 'info');
            
            const windowInfo = {
                innerWidth: window.innerWidth,
                innerHeight: window.innerHeight,
                devicePixelRatio: window.devicePixelRatio,
                screenWidth: window.screen.width,
                screenHeight: window.screen.height
            };
            
            log('üìê „Ç¶„Ç£„É≥„Éâ„Ç¶„ÉªÁîªÈù¢ÊÉÖÂ†±:', 'info');
            for (const [key, value] of Object.entries(windowInfo)) {
                log(`  ‚Ä¢ ${key}: ${value}`, 'info');
            }
            
            // Ë¶ÅÁ¥†„Çµ„Ç§„Ç∫„ÅÆË©≥Á¥∞Á¢∫Ë™ç
            const elementsToCheck = [
                { id: 'background-element', name: 'ËÉåÊôØË¶ÅÁ¥†' },
                { id: 'test-img', name: 'IMGË¶ÅÁ¥†' },
                { id: 'test-hero', name: '„Éí„Éº„É≠„Éº„Çª„ÇØ„Ç∑„Éß„É≥' }
            ];
            
            elementsToCheck.forEach(({ id, name }) => {
                const element = document.getElementById(id);
                if (element) {
                    const rect = element.getBoundingClientRect();
                    const computedStyle = window.getComputedStyle(element);
                    
                    log(`üéØ ${name} (${id}) „ÅÆ„Çµ„Ç§„Ç∫ÊÉÖÂ†±:`, 'info');
                    log(`  ‚Ä¢ BoundingRect: ${rect.width.toFixed(1)}√ó${rect.height.toFixed(1)} at (${rect.left.toFixed(1)}, ${rect.top.toFixed(1)})`, 'info');
                    log(`  ‚Ä¢ CSS width/height: ${computedStyle.width} / ${computedStyle.height}`, 'info');
                    log(`  ‚Ä¢ CSS backgroundSize: ${computedStyle.backgroundSize}`, 'info');
                    
                    if (element.tagName.toLowerCase() === 'img') {
                        log(`  ‚Ä¢ Ëá™ÁÑ∂„Çµ„Ç§„Ç∫: ${element.naturalWidth}√ó${element.naturalHeight}`, 'info');
                    }
                    
                    // „Ç≥„É≥„ÉÜ„É≥„ÉÑÁü©ÂΩ¢Ë®àÁÆó
                    if (window.PureBoundingBoxAutoPin) {
                        const autoPin = new window.PureBoundingBoxAutoPin();
                        const contentRect = autoPin.calculateContentRect(element);
                        if (contentRect) {
                            log(`  ‚Ä¢ „Ç≥„É≥„ÉÜ„É≥„ÉÑÁü©ÂΩ¢: ${contentRect.width.toFixed(1)}√ó${contentRect.height.toFixed(1)} at (${contentRect.x.toFixed(1)}, ${contentRect.y.toFixed(1)})`, 'info');
                            log(`  ‚Ä¢ „Çø„Ç§„Éó: ${contentRect.type}`, 'info');
                            if (contentRect.scaleX && contentRect.scaleY) {
                                log(`  ‚Ä¢ „Çπ„Ç±„Éº„É´: ${contentRect.scaleX.toFixed(3)}√ó${contentRect.scaleY.toFixed(3)}`, 'info');
                            }
                        }
                    }
                    
                    log('', 'info'); // Á©∫Ë°å
                }
            });
            
            // „Ç¶„Ç£„É≥„Éâ„Ç¶„É™„Çµ„Ç§„Ç∫„É™„Çπ„Éä„Éº„ÅÆÁä∂ÊÖãÁ¢∫Ë™ç
            if (window.PureBoundingBoxAutoPin) {
                log('üîç AutoPin„Ç∑„Çπ„ÉÜ„É†Áä∂ÊÖãÁ¢∫Ë™ç:', 'info');
                const autoPin = new window.PureBoundingBoxAutoPin();
                
                // „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÁµ±Ë®à
                if (autoPin.performanceMetrics) {
                    log('üìä „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÁµ±Ë®à:', 'info');
                    log(`  ‚Ä¢ ÊàêÂäü: ${autoPin.performanceMetrics.successCount || 0}`, 'info');
                    log(`  ‚Ä¢ Â§±Êïó: ${autoPin.performanceMetrics.failureCount || 0}`, 'info');
                    log(`  ‚Ä¢ ÊúÄÁµÇÊõ¥Êñ∞: ${autoPin.performanceMetrics.lastUpdated || 'N/A'}`, 'info');
                }
            }
            
            log('‚úÖ „Ç¶„Ç£„É≥„Éâ„Ç¶„É™„Çµ„Ç§„Ç∫ÂΩ±ÈüøË®∫Êñ≠ÂÆå‰∫Ü', 'success');
            log('üí° ÊâãÈ†Ü: „Ç¶„Ç£„É≥„Éâ„Ç¶„Çµ„Ç§„Ç∫„ÇíÂ§âÊõ¥„Åó„Å¶„Åã„ÇâÂÜçÂ∫¶„Åì„ÅÆ„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶ÊØîËºÉ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'info');
        }

        // üîç ÊúÄÂ∞èË®∫Êñ≠„Ç∑„Çπ„ÉÜ„É†
        function runMinimalDiagnosis() {
            log('üîç ÊúÄÂ∞èË®∫Êñ≠ÂÆüË°åÈñãÂßã - Ê≠™„ÅøÂïèÈ°åÊ†πÊú¨ÂéüÂõ†ÁâπÂÆö', 'info');
            
            // Ë®∫Êñ≠ÊôÇ„ÅÆ„Åø„É≠„Ç∞„ÇíÊúâÂäπÂåñÔºà‰øùÂ≠òÊ∏à„Åø„ÅÆoriginalLog„ÇíÂæ©ÂÖÉÔºâ
            console.log = window.originalConsoleLog || console.log;
            
            try {
                // Canvas„ÇíÂãïÁöÑ„Å´Ê§úÁ¥¢ÔºàË§áÊï∞„ÅÆIDÂÄôË£ú„ÇíË©¶Ë°åÔºâ
                let canvas = document.getElementById('purattokun-canvas') || 
                            document.getElementById('spine-canvas') ||
                            document.getElementById('spine-test-canvas') ||
                            document.querySelector('canvas');
                
                console.log('üîç CanvasÊ§úÁ¥¢ÁµêÊûú:', {
                    purattokun: !!document.getElementById('purattokun-canvas'),
                    spine: !!document.getElementById('spine-canvas'),
                    spineTest: !!document.getElementById('spine-test-canvas'),
                    anyCanvas: !!document.querySelector('canvas'),
                    foundCanvas: canvas ? canvas.id : 'none'
                });
                
                if (!canvas) {
                    log('‚ùå Canvas„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì - Âà©Áî®ÂèØËÉΩ„Å™Ë¶ÅÁ¥†„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                    console.log('Âà©Áî®ÂèØËÉΩ„Å™canvasË¶ÅÁ¥†:', Array.from(document.querySelectorAll('canvas')).map(c => c.id || 'no-id'));
                    return;
                }

                // 5„Å§„ÅÆË®∫Êñ≠„ÇíÈ†ÜÊ¨°ÂÆüË°å
                logCanvasTriple(canvas);
                checkMatrixIsometric(canvas);
                if (window.skeleton) {
                    normalizeSpineScaling(window.skeleton);
                } else {
                    log('‚ö†Ô∏è Skeleton„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì', 'warning');
                }
                freezeCanvasSize(canvas);
                checkTransformLayering(canvas);
                
                log('‚úÖ ÊúÄÂ∞èË®∫Êñ≠ÂÆå‰∫Ü - „Ç≥„É≥„ÇΩ„Éº„É´„ÅßË©≥Á¥∞ÊÉÖÂ†±„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'success');
                
            } catch (error) {
                log(`‚ùå ÊúÄÂ∞èË®∫Êñ≠„Ç®„É©„Éº: ${error.message}`, 'error');
                window.originalConsoleError('ÊúÄÂ∞èË®∫Êñ≠„Ç®„É©„Éº:', error);
            }
            
            // Ë®∫Êñ≠Âæå„ÅØ„É≠„Ç∞ÁÑ°ÂäπÂåñ„Å´Êàª„Åô
            setTimeout(() => {
                console.log = function() {};
                console.warn = function() {};
                console.info = function() {};
                console.debug = function() {};
                console.error = function() {};
            }, 2000); // 2ÁßíÂæå„Å´ÁÑ°ÂäπÂåñ
        }

        // 1. Canvas‰∏âÂÖÑÂºü„ÅÆ„É≠„Ç∞ÔºàÁ∑®ÈõÜ‰∏≠Áä∂ÊÖã„ÅßÂÆüÊñΩÔºâ
        function logCanvasTriple(canvas) {
            const rect = canvas.getBoundingClientRect();
            const dpr = window.devicePixelRatio || 1;
            
            console.log('=== Canvas‰∏âÂÖÑÂºüË®∫Êñ≠ ===');
            console.log('Ë°®Á§∫„Çµ„Ç§„Ç∫ÔºàCSSÔºâ:', rect.width, '√ó', rect.height);
            console.log('ÂÜÖÈÉ®„Éê„ÉÉ„Éï„Ç°:', canvas.width, '√ó', canvas.height);
            console.log('DPR:', dpr);
            console.log('ÊúüÂæÖÈñ¢‰øÇ„ÉÅ„Çß„ÉÉ„ÇØ:');
            console.log('  XËª∏:', canvas.width, '‚âà', rect.width * dpr, '?', Math.abs(canvas.width - rect.width * dpr) < 1);
            console.log('  YËª∏:', canvas.height, '‚âà', rect.height * dpr, '?', Math.abs(canvas.height - rect.height * dpr) < 1);
            
            // „É≠„Ç∞„Ç∑„Çπ„ÉÜ„É†„Å´„ÇÇÂá∫Âäõ
            log(`üìê Ë°®Á§∫„Çµ„Ç§„Ç∫: ${rect.width.toFixed(1)}√ó${rect.height.toFixed(1)}`, 'info');
            log(`üñ•Ô∏è ÂÜÖÈÉ®„Éê„ÉÉ„Éï„Ç°: ${canvas.width}√ó${canvas.height}`, 'info');
            log(`üì± DPR: ${dpr}`, 'info');
            log(`‚úÖ XËª∏ÈÅ©Ê≠£: ${Math.abs(canvas.width - rect.width * dpr) < 1 ? 'OK' : 'NG'}`, 
                Math.abs(canvas.width - rect.width * dpr) < 1 ? 'success' : 'error');
            log(`‚úÖ YËª∏ÈÅ©Ê≠£: ${Math.abs(canvas.height - rect.height * dpr) < 1 ? 'OK' : 'NG'}`, 
                Math.abs(canvas.height - rect.height * dpr) < 1 ? 'success' : 'error');
        }

        // 2. Matrix„ÅÆ"Á≠âÊñπ"„ÉÅ„Çß„ÉÉ„ÇØ
        function checkMatrixIsometric(element) {
            const style = getComputedStyle(element);
            const matrix = new DOMMatrix(style.transform);
            
            console.log('=== MatrixÁ≠âÊñπÊÄßË®∫Êñ≠ ===');
            console.log('transform:', style.transform);
            console.log('scaleX (a):', matrix.a);
            console.log('scaleY (d):', matrix.d);
            console.log('skewX (b):', matrix.b);
            console.log('skewY (c):', matrix.c);
            console.log('Á≠âÊñπÊÄß„ÉÅ„Çß„ÉÉ„ÇØ: |a| ‚âà |d|?', Math.abs(Math.abs(matrix.a) - Math.abs(matrix.d)) < 0.01);
            console.log('„Çπ„Ç≠„É•„Éº„Å™„Åó: b‚âà0, c‚âà0?', Math.abs(matrix.b) < 0.01 && Math.abs(matrix.c) < 0.01);
            
            // „É≠„Ç∞„Ç∑„Çπ„ÉÜ„É†„Å´„ÇÇÂá∫Âäõ
            log(`üîÑ Transform: ${style.transform}`, 'info');
            log(`üìè ScaleX: ${matrix.a.toFixed(3)}, ScaleY: ${matrix.d.toFixed(3)}`, 'info');
            log(`üîÄ SkewX: ${matrix.b.toFixed(3)}, SkewY: ${matrix.c.toFixed(3)}`, 'info');
            const isIsometric = Math.abs(Math.abs(matrix.a) - Math.abs(matrix.d)) < 0.01;
            const noSkew = Math.abs(matrix.b) < 0.01 && Math.abs(matrix.c) < 0.01;
            log(`‚úÖ Á≠âÊñπÊÄß: ${isIsometric ? 'OK' : 'NG'}`, isIsometric ? 'success' : 'warning');
            log(`‚úÖ „Çπ„Ç≠„É•„Éº„Å™„Åó: ${noSkew ? 'OK' : 'NG'}`, noSkew ? 'success' : 'warning');
        }

        // 3. SpineÂÅ¥„ÅÆ„Çπ„Ç±„Éº„É´ÁµåË∑Ø„Çí1Êú¨Âåñ
        function normalizeSpineScaling(skeleton) {
            console.log('=== Spine„Çπ„Ç±„Éº„É´1Êú¨Âåñ ===');
            console.log('Â§âÊõ¥Ââç scaleX:', skeleton.scaleX, 'scaleY:', skeleton.scaleY);
            
            // ÁèæÂú®„ÅÆÂÄ§„ÇíË®òÈå≤
            const originalScaleX = skeleton.scaleX;
            const originalScaleY = skeleton.scaleY;
            
            // ‰∏ÄÊôÇÁöÑ„Å´Á≠âÊñπ„Çπ„Ç±„Éº„É´„Å´Áµ±‰∏Ä
            skeleton.scaleX = skeleton.scaleY = 1;
            
            console.log('Â§âÊõ¥Âæå scaleX:', skeleton.scaleX, 'scaleY:', skeleton.scaleY);
            console.log('‚Üí CanvasÂÅ¥„Åß„ÅÆ„Åø„Çπ„Ç±„Éº„É´Âà∂Âæ°„Å´Â§âÊõ¥');
            
            // „É≠„Ç∞„Ç∑„Çπ„ÉÜ„É†„Å´„ÇÇÂá∫Âäõ
            log(`üîÑ ÂÖÉ„ÅÆSpine„Çπ„Ç±„Éº„É´: X=${originalScaleX.toFixed(3)}, Y=${originalScaleY.toFixed(3)}`, 'info');
            log(`üéØ Ê≠£Ë¶èÂåñÂæå: X=1.000, Y=1.000 (CanvasÂÅ¥Âà∂Âæ°„Å´Áµ±‰∏Ä)`, 'success');
        }

        // 4. Á∑®ÈõÜ‰∏≠„ÅØCanvas„Çµ„Ç§„Ç∫„ÇíPXÂõ∫ÂÆöÔºàDPRÂØæÂøú‰øÆÊ≠£Ôºâ
        function freezeCanvasSize(canvas) {
            const rect = canvas.getBoundingClientRect();
            const dpr = window.devicePixelRatio || 1;
            
            console.log('=== Canvas PXÂõ∫ÂÆö (DPRÂØæÂøú) ===');
            console.log('Âõ∫ÂÆöÂâç CSS:', canvas.style.width, canvas.style.height);
            console.log('DPR:', dpr);
            
            const originalWidth = canvas.style.width;
            const originalHeight = canvas.style.height;
            
            // Ê≠£ÊñπÂΩ¢„Çµ„Ç§„Ç∫Áµ±‰∏ÄÔºàÊ≠™„ÅøÈò≤Ê≠¢Ôºâ
            const cssSquareSize = Math.max(rect.width, rect.height);
            const bufferSquareSize = Math.round(cssSquareSize * dpr);
            
            // CSSË°®Á§∫„Çµ„Ç§„Ç∫Ë®≠ÂÆöÔºàÊ≠£ÊñπÂΩ¢Áµ±‰∏ÄÔºâ
            canvas.style.width = cssSquareSize + 'px';
            canvas.style.height = cssSquareSize + 'px';
            canvas.style.aspectRatio = '1 / 1';
            
            // ÂÜÖÈÉ®„Éê„ÉÉ„Éï„Ç°„Çµ„Ç§„Ç∫Ë®≠ÂÆöÔºàDPRÂØæÂøúÔºâ
            canvas.width = bufferSquareSize;
            canvas.height = bufferSquareSize;
            
            console.log('Âõ∫ÂÆöÂæå CSS:', canvas.style.width, canvas.style.height);
            console.log('Âõ∫ÂÆöÂæåÂÜÖÈÉ®:', canvas.width, canvas.height);
            console.log('DPRÊï¥ÂêàÊÄßÁ¢∫Ë™ç:', bufferSquareSize, '=', cssSquareSize, 'x', dpr.toFixed(3));
            
            // „É≠„Ç∞„Ç∑„Çπ„ÉÜ„É†„Å´„ÇÇÂá∫Âäõ
            log(`üîí ÂÖÉ„ÅÆCSS: width=${originalWidth || 'auto'}, height=${originalHeight || 'auto'}`, 'info');
            log(`üîí CSSÂõ∫ÂÆöÂæå: ${canvas.style.width} √ó ${canvas.style.height} (Ê≠£ÊñπÂΩ¢Áµ±‰∏Ä)`, 'success');
            log(`üñ•Ô∏è ÂÜÖÈÉ®„Éê„ÉÉ„Éï„Ç°: ${canvas.width} √ó ${canvas.height} (DPR: ${dpr.toFixed(3)})`, 'success');
            log(`‚úÖ DPRÊï¥ÂêàÊÄß: ${bufferSquareSize} ‚âà ${cssSquareSize} √ó ${dpr.toFixed(3)} = ${(cssSquareSize * dpr).toFixed(1)}`, 
                Math.abs(bufferSquareSize - cssSquareSize * dpr) < 1 ? 'success' : 'warning');
        }

        // 5. „É¨„Ç§„É§„ÉºÂàÜÈõ¢„Åæ„Åü„ÅØCSSÂ§âÊï∞ÂêàÊàê„ÅÆÁ¢∫Ë™ç
        function checkTransformLayering(element) {
            const style = getComputedStyle(element);
            
            console.log('=== Transform „É¨„Ç§„É§„ÉºÁ¢∫Ë™ç ===');
            console.log('ÁèæÂú®„ÅÆtransform:', style.transform);
            console.log('--base-transform:', style.getPropertyValue('--base-transform'));
            console.log('--autopin-transform:', style.getPropertyValue('--autopin-transform'));
            console.log('translate(-50%, -50%)‰øùÊåÅÁ¢∫Ë™ç');
            
            // „É≠„Ç∞„Ç∑„Çπ„ÉÜ„É†„Å´„ÇÇÂá∫Âäõ
            log(`üîÑ ÂêàÊàêTransform: ${style.transform}`, 'info');
            const baseTransform = style.getPropertyValue('--base-transform');
            const autopinTransform = style.getPropertyValue('--autopin-transform');
            log(`üéØ Base Transform: ${baseTransform || '„Å™„Åó'}`, baseTransform ? 'info' : 'warning');
            log(`üìç AutoPin Transform: ${autopinTransform || '„Å™„Åó'}`, autopinTransform ? 'info' : 'warning');
            
            // ‰∏≠ÂøÉÂåñtransformÊ§úÊüª
            const hasCenterTransform = style.transform.includes('translate(-50%, -50%)') || 
                                     style.transform.includes('translate3d(-50%, -50%, 0)');
            log(`‚úÖ ‰∏≠ÂøÉÂåñ‰øùÊåÅ: ${hasCenterTransform ? 'OK' : 'NG'}`, hasCenterTransform ? 'success' : 'error');
        }

        // üìç „Éî„É≥Ë°®Á§∫Âàá„ÇäÊõø„ÅàÊ©üËÉΩ
        let pinsVisible = false;
        let currentPinMarkers = [];
        
        function togglePinVisibility() {
            pinsVisible = !pinsVisible;
            const button = document.querySelector('[onclick="togglePinVisibility()"]');
            
            if (pinsVisible) {
                button.textContent = 'üî¥ „Éî„É≥ÈùûË°®Á§∫';
                button.style.background = '#dc3545';
                showCurrentPins();
                log('üìç „Éî„É≥Ë°®Á§∫„É¢„Éº„Éâ ON', 'info');
            } else {
                button.textContent = 'üìç „Éî„É≥Ë°®Á§∫Âàá„ÇäÊõø„Åà';
                button.style.background = '#6c757d';
                hideCurrentPins();
                log('üìç „Éî„É≥Ë°®Á§∫„É¢„Éº„Éâ OFF', 'info');
            }
        }
        
        function showCurrentPins() {
            // Êó¢Â≠ò„ÅÆ„Éî„É≥„ÇíÂâäÈô§
            hideCurrentPins();
            
            if (window.PureBoundingBoxAutoPin) {
                const autoPin = new window.PureBoundingBoxAutoPin();
                
                // ÂêÑË¶ÅÁ¥†„ÅÆ„Ç¢„É≥„Ç´„Éº„Éù„Ç§„É≥„Éà„ÇíË°®Á§∫
                const elementsToCheck = [
                    { id: 'background-element', name: 'ËÉåÊôØË¶ÅÁ¥†' },
                    { id: 'test-img', name: 'IMGË¶ÅÁ¥†' },
                    { id: 'test-hero', name: '„Éí„Éº„É≠„Éº' }
                ];
                
                elementsToCheck.forEach(({ id, name }) => {
                    const element = document.getElementById(id);
                    if (element) {
                        const contentRect = autoPin.calculateContentRect(element);
                        if (contentRect) {
                            // 9„Å§„ÅÆ„Ç¢„É≥„Ç´„Éº„Éù„Ç§„É≥„Éà„ÇíË°®Á§∫
                            const anchors = [
                                { id: 'TL', x: 0, y: 0, name: 'Top Left' },
                                { id: 'TC', x: 0.5, y: 0, name: 'Top Center' },
                                { id: 'TR', x: 1, y: 0, name: 'Top Right' },
                                { id: 'ML', x: 0, y: 0.5, name: 'Middle Left' },
                                { id: 'MC', x: 0.5, y: 0.5, name: 'Middle Center' },
                                { id: 'MR', x: 1, y: 0.5, name: 'Middle Right' },
                                { id: 'BL', x: 0, y: 1, name: 'Bottom Left' },
                                { id: 'BC', x: 0.5, y: 1, name: 'Bottom Center' },
                                { id: 'BR', x: 1, y: 1, name: 'Bottom Right' }
                            ];
                            
                            const elementRect = element.getBoundingClientRect();
                            
                            anchors.forEach(anchor => {
                                // üî• ‰øÆÊ≠£: containerRect„Çí‰ΩøÁî®„Åó„ÅüÊ≠£Á¢∫„Å™Ë®àÁÆó
                                let pinX, pinY;
                                
                                if (contentRect.containerRect) {
                                    // containerRect„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØ„Åù„Çå„ÇíÂü∫Ê∫ñ„Å´
                                    pinX = contentRect.containerRect.left + contentRect.x + (contentRect.width * anchor.x);
                                    pinY = contentRect.containerRect.top + contentRect.y + (contentRect.height * anchor.y);
                                } else {
                                    // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ: elementRect„ÇíÂü∫Ê∫ñ„Å´
                                    pinX = elementRect.left + contentRect.x + (contentRect.width * anchor.x);
                                    pinY = elementRect.top + contentRect.y + (contentRect.height * anchor.y);
                                }
                                
                                // console.log(`üîç ${name} ${anchor.id} „Éî„É≥Ë®àÁÆó:`, { // „Éî„É≥Ë®àÁÆó„É≠„Ç∞ÁÑ°ÂäπÂåñ
                                //     elementRect: `${elementRect.left.toFixed(1)}, ${elementRect.top.toFixed(1)}, ${elementRect.width.toFixed(1)}√ó${elementRect.height.toFixed(1)}`,
                                //     contentRect: `${contentRect.x}, ${contentRect.y}, ${contentRect.width.toFixed(1)}√ó${contentRect.height.toFixed(1)}`,
                                //     anchorOffset: `${anchor.x}√ó${anchor.y}`,
                                //     calculatedPin: `(${pinX.toFixed(1)}, ${pinY.toFixed(1)})`,
                                //     windowSize: `${window.innerWidth}√ó${window.innerHeight}`
                                // });
                                
                                const pin = document.createElement('div');
                                pin.className = `autopin-marker anchor-${anchor.id}`;
                                pin.style.left = pinX + 'px';
                                pin.style.top = pinY + 'px';
                                pin.title = `${name}: ${anchor.name} (${anchor.id})\n‰ΩçÁΩÆ: (${pinX.toFixed(1)}, ${pinY.toFixed(1)})`;
                                
                                // „Ç¶„Ç£„É≥„Éâ„Ç¶Â§ñ„Å´Âá∫„ÇãÂ†¥Âêà„ÅÆË≠¶Âëä
                                if (pinX < 0 || pinY < 0 || pinX > window.innerWidth || pinY > window.innerHeight) {
                                    // console.warn(`‚ö†Ô∏è ${name} ${anchor.id} „Éî„É≥„Åå„Ç¶„Ç£„É≥„Éâ„Ç¶Â§ñ: (${pinX.toFixed(1)}, ${pinY.toFixed(1)})`); // „Éî„É≥Ë≠¶Âëä„É≠„Ç∞ÁÑ°ÂäπÂåñ
                                    pin.style.border = '3px solid orange'; // Ë≠¶ÂëäËâ≤
                                }
                                
                                document.body.appendChild(pin);
                                currentPinMarkers.push(pin);
                            });
                            
                            log(`üìç ${name}: 9ÂÄã„ÅÆ„Ç¢„É≥„Ç´„Éº„Éî„É≥Ë°®Á§∫`, 'info');
                        }
                    }
                });
                
                // „Ç¶„Ç£„É≥„Éâ„Ç¶„É™„Çµ„Ç§„Ç∫ÊôÇ„Å´„Éî„É≥‰ΩçÁΩÆ„ÇíÊõ¥Êñ∞
                if (currentPinMarkers.length > 0) {
                    const updatePins = () => {
                        if (pinsVisible) {
                            showCurrentPins();
                        }
                    };
                    
                    window.addEventListener('resize', updatePins);
                    // 5ÁßíÂæå„Å´„É™„Çπ„Éä„Éº„ÇíÂâäÈô§Ôºà„É°„É¢„É™„É™„Éº„ÇØÈò≤Ê≠¢Ôºâ
                    setTimeout(() => {
                        window.removeEventListener('resize', updatePins);
                    }, 5000);
                }
            } else {
                log('‚ö†Ô∏è PureBoundingBoxAutoPin„ÅåË™≠„ÅøËæº„Åæ„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì', 'warning');
            }
        }
        
        function hideCurrentPins() {
            currentPinMarkers.forEach(pin => pin.remove());
            currentPinMarkers = [];
        }

        // „Éá„Éê„ÉÉ„Ç∞Áî®„Ç∞„É≠„Éº„Éê„É´Èñ¢Êï∞
        window.testBoundingBox = testBasicBoundingBox;
        window.testRightClickMenu = testRightClickMenu;
        window.testResize = testResize;
        window.testModifierKeys = testModifierKeys;
        window.debugBBSystem = debugBBSystem;
        window.testCanvasResize = testCanvasResize;
        window.testAutoPinSystem = testAutoPinSystem;
        window.loadSpineCharacter = loadSpineCharacter;
        window.switchCharacter = switchCharacter;
        window.testIMGElementContentRect = testIMGElementContentRect; // üÜï
        window.debugWindowResizeImpact = debugWindowResizeImpact; // üÜï
        window.togglePinVisibility = togglePinVisibility; // üÜï
        window.showCurrentPins = showCurrentPins; // üÜï
        window.hideCurrentPins = hideCurrentPins; // üÜï
        window.getCurrentBB = () => currentBoundingBox;
        window.getSpineRenderer = () => spineRenderer;
        window.logTest = (message, type) => log(message, type);
        
        /**
         * üéØ 2ÊÆµÈöéUIÁµ±Âêà„ÉÜ„Çπ„Éà
         */
        window.testTwoStageUI = function() {
            console.log('üéØ 2ÊÆµÈöéUIÁµ±Âêà„ÉÜ„Çπ„ÉàÈñãÂßã');
            
            // „É¢„Ç∏„É•„Éº„É´Âà©Áî®ÂèØËÉΩÊÄß„ÉÅ„Çß„ÉÉ„ÇØ
            const availableModules = {
                ElementHighlighter: typeof window.ElementHighlighter !== 'undefined',
                ElementSelector: typeof window.ElementSelector !== 'undefined',
                TwoStageSelector: typeof window.TwoStageSelector !== 'undefined'
            };
            
            console.log('üìä 2ÊÆµÈöéUI„É¢„Ç∏„É•„Éº„É´Âà©Áî®ÂèØËÉΩÊÄß:', availableModules);
            
            if (!availableModules.ElementHighlighter || !availableModules.ElementSelector || !availableModules.TwoStageSelector) {
                log('‚ùå ÂøÖÈ†à„É¢„Ç∏„É•„Éº„É´„Åå‰∏çË∂≥„Åó„Å¶„ÅÑ„Åæ„Åô', 'error');
                console.error('‰∏çË∂≥„É¢„Ç∏„É•„Éº„É´:', availableModules);
                return;
            }
            
            log('‚úÖ ÂÖ®„É¢„Ç∏„É•„Éº„É´Ë™≠„ÅøËæº„ÅøÁ¢∫Ë™çÂÆå‰∫Ü', 'success');
            
            // TwoStageSelectorÂàùÊúüÂåñ
            let twoStageSelector;
            try {
                twoStageSelector = new TwoStageSelector();
                log('‚úÖ TwoStageSelectorÂàùÊúüÂåñÂÆå‰∫Ü', 'success');
            } catch (error) {
                log(`‚ùå TwoStageSelectorÂàùÊúüÂåñÂ§±Êïó: ${error.message}`, 'error');
                console.error('TwoStageSelectorÂàùÊúüÂåñ„Ç®„É©„Éº:', error);
                return;
            }
            
            // „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±Ë°®Á§∫
            if (twoStageSelector.config.debugMode) {
                const debugInfo = twoStageSelector.showDebugInfo();
                console.log('üîß „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±:', debugInfo);
            }
            
            log('üéØ 2ÊÆµÈöé„Éî„É≥Ë®≠ÂÆö„Éó„É≠„Çª„ÇπÈñãÂßãÊ∫ñÂÇôÂÆå‰∫Ü', 'info');
            console.log('üëÜ F12È¢®Ë¶ÅÁ¥†ÈÅ∏Êäû„ÇíÈñãÂßã„Åó„Åæ„Åô„ÄÇ‰ªªÊÑè„ÅÆË¶ÅÁ¥†„Å´„Éû„Ç¶„Çπ„Ç´„Éº„ÇΩ„É´„ÇíÁßªÂãï„Åó„Å¶„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
            
            // 2ÊÆµÈöé„Éó„É≠„Çª„ÇπÈñãÂßã
            twoStageSelector.startTwoStageProcess(
                // ÂÆå‰∫Ü„Ç≥„Éº„É´„Éê„ÉÉ„ÇØ
                (pinRequest, selectedElement) => {
                    log('‚úÖ 2ÊÆµÈöé„Éî„É≥Ë®≠ÂÆöÂÆå‰∫Ü!', 'success');
                    console.log('üéØ „Éî„É≥Ë®≠ÂÆöÁµêÊûú:', pinRequest);
                    console.log('üìç ÂØæË±°Ë¶ÅÁ¥†:', selectedElement ? {
                        tagName: selectedElement.tagName,
                        id: selectedElement.id,
                        className: selectedElement.className
                    } : 'null (Ë¶ÅÁ¥†ÊÉÖÂ†±ÂèñÂæóÂ§±Êïó)');
                    
                    // ÁµêÊûú„Çí„É¶„Éº„Ç∂„Éº„Å´Ë°®Á§∫
                    const anchorPoint = pinRequest.anchorPoints[0];
                    log(`üìç „Éî„É≥ÈÖçÁΩÆ: ${anchorPoint.id} + „Ç™„Éï„Çª„ÉÉ„Éà(${anchorPoint.offsetX}, ${anchorPoint.offsetY})`, 'success');
                    
                    // ÂäπÁéáÁöÑ„Éî„É≥„Ç∑„Çπ„ÉÜ„É†„Å®„ÅÆÁµ±ÂêàÁ¢∫Ë™ç
                    if (window.ElementCalculator && window.PinRenderer) {
                        log('üöÄ ÂäπÁéáÁöÑ„Éî„É≥„Ç∑„Çπ„ÉÜ„É†v2.0„ÅßÊèèÁîªÊ∏à„Åø', 'success');
                    } else {
                        log('‚ö†Ô∏è ÂäπÁéáÁöÑ„Éî„É≥„Ç∑„Çπ„ÉÜ„É†v2.0„ÅØÂà©Áî®„Åß„Åç„Åæ„Åõ„Çì„Åå„ÄÅ„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØË°®Á§∫ÊàêÂäü', 'warning');
                    }
                },
                
                // „Ç≠„É£„É≥„Çª„É´„Ç≥„Éº„É´„Éê„ÉÉ„ÇØ
                () => {
                    log('‚ùå 2ÊÆµÈöé„Éî„É≥Ë®≠ÂÆö„Åå„Ç≠„É£„É≥„Çª„É´„Åï„Çå„Åæ„Åó„Åü', 'warning');
                    console.log('üîÑ „Éó„É≠„Çª„Çπ‰∏≠Êñ≠ - ÂÜçÂ∫¶„ÉÜ„Çπ„Éà„Éú„Çø„É≥„ÇíÊäº„Åô„Åì„Å®„ÅßÂÜçÈñãÂèØËÉΩ„Åß„Åô');
                }
            );
            
            // „ÉÜ„Çπ„ÉàÂÆå‰∫Ü„É°„ÉÉ„Çª„Éº„Ç∏ÔºàÈùûÂêåÊúüÂá¶ÁêÜ„ÅÆ„Åü„ÇÅÂç≥Â∫ß„Å´Ë°®Á§∫Ôºâ
            setTimeout(() => {
                console.log('üìã 2ÊÆµÈöéUIÁµ±Âêà„ÉÜ„Çπ„ÉàÊ¶ÇË¶Å:');
                console.log('  Stage 1: F12È¢®Ë¶ÅÁ¥†ÈÅ∏Êäû„Ç∑„Çπ„ÉÜ„É† - „Éû„Ç¶„ÇπÁßªÂãï„Åß„Éè„Ç§„É©„Ç§„Éà„ÄÅ„ÇØ„É™„ÉÉ„ÇØ„ÅßÈÅ∏Êäû');
                console.log('  Stage 2: ‰ΩçÁΩÆË™øÊï¥„Ç§„É≥„Çø„Éº„Éï„Çß„Éº„Çπ - „Ç¢„É≥„Ç´„Éº„Éù„Ç§„É≥„ÉàÈÅ∏Êäû„ÄÅ„Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„ÉóË™øÊï¥');
                console.log('  Áµ±Âêà: ÂäπÁéáÁöÑ„Éî„É≥„Ç∑„Çπ„ÉÜ„É†v2.0„Å®„ÅÆÂÆåÂÖ®Áµ±Âêà');
                console.log('  Êìç‰Ωú: ESC„Ç≠„Éº„Åß„Ç≠„É£„É≥„Çª„É´„ÄÅEnter„Ç≠„Éº„ÅßÁ¢∫ÂÆö');
                console.log('üéØ Ë¶ÅÁ¥†„ÇíÈÅ∏Êäû„Åó„Å¶‰ΩçÁΩÆË™øÊï¥„Çí‰ΩìÈ®ì„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºÅ');
            }, 500);
        };
        
        /**
         * üéÆ Spine„Ç≠„É£„É©„ÇØ„Çø„ÉºÂÆüÊà¶„ÉÜ„Çπ„ÉàÂàùÊúüÂåñ
         */
        window.initializeSpineCharacterTest = function() {
            console.log('üéÆ Spine„Ç≠„É£„É©„ÇØ„Çø„ÉºÂÆüÊà¶„ÉÜ„Çπ„ÉàÂàùÊúüÂåñÈñãÂßã');
            
            // Spine„Ç®„É™„Ç¢Ë°®Á§∫
            const spineArea = document.getElementById('spine-character-area');
            spineArea.style.display = 'block';
            
            // „Çπ„ÇØ„É≠„Éº„É´„Åó„Å¶Spine„Ç®„É™„Ç¢„ÇíË°®Á§∫
            spineArea.scrollIntoView({ behavior: 'smooth', block: 'center' });
            
            log('üéÆ Spine„Ç≠„É£„É©„ÇØ„Çø„ÉºÂÆüÊà¶„ÉÜ„Çπ„Éà „É¢„Éº„ÉâÊúâÂäπÂåñ', 'info');
            
            // StableSpineRenderer‰ΩøÁî®„Åó„Å¶„Ç≠„É£„É©„ÇØ„Çø„ÉºÂàùÊúüÂåñ
            if (typeof StableSpineRenderer !== 'undefined') {
                initializeSpineCharacterDisplay();
            } else {
                log('‚ö†Ô∏è StableSpineRenderer „ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì - Âü∫Êú¨„ÉÜ„Çπ„Éà„É¢„Éº„Éâ„ÅßÈñãÂßã', 'warning');
                // Âü∫Êú¨ÁöÑ„Å™„ÉÜ„Çπ„ÉàË¶ÅÁ¥†„Çí‰ΩúÊàê
                createMockSpineCharacter();
            }
        };
        
        /**
         * üéÆ Spine„Ç≠„É£„É©„ÇØ„Çø„ÉºË°®Á§∫ÂàùÊúüÂåñ
         */
        async function initializeSpineCharacterDisplay() {
            try {
                const canvas = document.getElementById('spine-test-canvas');
                const characterInfo = document.getElementById('spine-character-info');
                
                log('üéÆ StableSpineRenderer„Åß„Ç≠„É£„É©„ÇØ„Çø„ÉºÂàùÊúüÂåñ‰∏≠...', 'info');
                
                // StableSpineRenderer„ÅßpurattokunË™≠„ÅøËæº„Åø
                window.spineTestRenderer = StableSpineRenderer.createForCharacter('purattokun', {
                    canvasId: 'spine-test-canvas',
                    width: 300,
                    height: 300,
                    quality: 'medium'
                });
                
                // ÂàùÊúüÂåñÂÆå‰∫Ü„ÇíÂæÖ„Å§
                setTimeout(() => {
                    const spineCanvas = document.getElementById('spine-test-canvas');
                    if (spineCanvas && spineCanvas.width > 0) {
                        characterInfo.textContent = '„Ç≠„É£„É©„ÇØ„Çø„Éº: purattokun (StableSpineRenderer)';
                        log('‚úÖ Spine„Ç≠„É£„É©„ÇØ„Çø„ÉºË™≠„ÅøËæº„ÅøÂÆå‰∫Ü', 'success');
                        
                        // „Ç≠„É£„É©„ÇØ„Çø„Éº„Å´„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„ÉàËøΩÂä†
                        spineCanvas.style.cursor = 'pointer';
                        spineCanvas.title = '2ÊÆµÈöéUI„ÉÜ„Çπ„Éà„Åß„ÇØ„É™„ÉÉ„ÇØÈÅ∏ÊäûÂèØËÉΩ';
                        
                        // „ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆö
                        setupCharacterClickListener(spineCanvas);
                    } else {
                        throw new Error('SpineÂàùÊúüÂåñÊ§úË®ºÂ§±Êïó');
                    }
                }, 2000);
                
            } catch (error) {
                log('‚ùå Spine„Ç≠„É£„É©„ÇØ„Çø„ÉºÂàùÊúüÂåñÂ§±Êïó: ' + error.message, 'error');
                console.error('SpineÂàùÊúüÂåñ„Ç®„É©„Éº:', error);
                
                // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ: „É¢„ÉÉ„ÇØ„Ç≠„É£„É©„ÇØ„Çø„Éº‰ΩúÊàê
                createMockSpineCharacter();
            }
        }
        
        /**
         * üé≠ „É¢„ÉÉ„ÇØSpine„Ç≠„É£„É©„ÇØ„Çø„Éº‰ΩúÊàê
         */
        function createMockSpineCharacter() {
            const canvas = document.getElementById('spine-test-canvas');
            const characterInfo = document.getElementById('spine-character-info');
            
            // „Ç≠„É£„É≥„Éê„ÇπË®≠ÂÆöÔºàDPRÂØæÂøúÔºâ
            const cssMockSize = 300;
            const dpr = window.devicePixelRatio || 1;
            const bufferMockSize = Math.round(cssMockSize * dpr);
            
            canvas.width = bufferMockSize;
            canvas.height = bufferMockSize;
            canvas.style.width = `${cssMockSize}px`;
            canvas.style.height = `${cssMockSize}px`;
            canvas.style.border = '2px solid #ff6b35';
            canvas.style.borderRadius = '8px';
            canvas.style.background = 'radial-gradient(circle, #fff3e0 0%, #ffcc80 100%)';
            
            // Á∞°Âçò„Å™„Ç≠„É£„É©„ÇØ„Çø„ÉºÊèèÁîª
            const ctx = canvas.getContext('2d');
            
            // „Ç≠„É£„É©„ÇØ„Çø„ÉºÊú¨‰ΩìÔºàÂÜÜÂΩ¢Ôºâ
            ctx.fillStyle = '#ff6b35';
            ctx.beginPath();
            ctx.arc(150, 150, 50, 0, Math.PI * 2);
            ctx.fill();
            
            // ÁõÆ
            ctx.fillStyle = '#333';
            ctx.beginPath();
            ctx.arc(135, 135, 8, 0, Math.PI * 2);
            ctx.arc(165, 135, 8, 0, Math.PI * 2);
            ctx.fill();
            
            // Âè£
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.arc(150, 160, 15, 0, Math.PI);
            ctx.stroke();
            
            // ÊñáÂ≠ó
            ctx.fillStyle = '#333';
            ctx.font = '16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('„É¢„ÉÉ„ÇØ', 150, 250);
            ctx.fillText('„Ç≠„É£„É©„ÇØ„Çø„Éº', 150, 270);
            
            characterInfo.textContent = '„Ç≠„É£„É©„ÇØ„Çø„Éº: „É¢„ÉÉ„ÇØ „Ç≠„É£„É©„ÇØ„Çø„Éº („Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ)';
            canvas.style.cursor = 'pointer';
            canvas.title = '2ÊÆµÈöéUI„ÉÜ„Çπ„Éà„Åß„ÇØ„É™„ÉÉ„ÇØÈÅ∏ÊäûÂèØËÉΩ';
            
            // „ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆö
            setupCharacterClickListener(canvas);
            
            log('‚úÖ „É¢„ÉÉ„ÇØ„Ç≠„É£„É©„ÇØ„Çø„Éº‰ΩúÊàêÂÆå‰∫Ü', 'success');
        }
        
        /**
         * üìç Spine„Ç≠„É£„É©„ÇØ„Çø„ÉºÁî®„Éî„É≥„ÉÜ„Çπ„ÉàÈñãÂßã
         */
        window.startSpinePinTest = function() {
            console.log('üìç Spine„Ç≠„É£„É©„ÇØ„Çø„ÉºÁî®„Éî„É≥„ÉÜ„Çπ„ÉàÈñãÂßã');
            
            // TwoStageSelector„ÅåÂà©Áî®ÂèØËÉΩ„Åã„ÉÅ„Çß„ÉÉ„ÇØ
            if (typeof TwoStageSelector === 'undefined') {
                log('‚ùå TwoStageSelector„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì', 'error');
                return;
            }
            
            // 2ÊÆµÈöéUIÈñãÂßã
            let twoStageSelector;
            try {
                twoStageSelector = new TwoStageSelector();
                log('üìç Spine„Ç≠„É£„É©„ÇØ„Çø„ÉºÁî® 2ÊÆµÈöé„Éî„É≥Ë®≠ÂÆöÈñãÂßã', 'info');
                
                // Spine„Ç≠„É£„É©„ÇØ„Çø„ÉºÂ∞ÇÁî®„É°„ÉÉ„Çª„Éº„Ç∏
                setTimeout(() => {
                    log('üéÆ Spine„Ç≠„É£„É©„ÇØ„Çø„ÉºÂÆüÊà¶„ÉÜ„Çπ„Éà‰∏≠...', 'info');
                    console.log('üéÆ „Ç≤„Éº„É†„Ç≠„É£„É©„ÇØ„Çø„ÉºË¶ÅÁ¥†„ÅÆÈÅ∏Êäû‚Üí‰ΩçÁΩÆË™øÊï¥„Çí‰ΩìÈ®ì‰∏≠');
                    console.log('üí° Spine„Ç≠„É£„É≥„Éê„Çπ„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                }, 500);
                
                twoStageSelector.startTwoStageProcess(
                    // ÂÆå‰∫Ü„Ç≥„Éº„É´„Éê„ÉÉ„ÇØ
                    (pinRequest, selectedElement) => {
                        log('üéÆ Spine„Ç≠„É£„É©„ÇØ„Çø„Éº„Éî„É≥Ë®≠ÂÆöÂÆå‰∫Ü!', 'success');
                        console.log('üéØ Spine„Éî„É≥Ë®≠ÂÆöÁµêÊûú:', pinRequest);
                        console.log('üéÆ ÂØæË±°SpineË¶ÅÁ¥†:', selectedElement ? {
                            tagName: selectedElement.tagName,
                            id: selectedElement.id,
                            canvas: selectedElement.tagName === 'CANVAS'
                        } : null);
                        
                        // Spine„Ç≠„É£„É©„ÇØ„Çø„ÉºÂ∞ÇÁî®„ÅÆÁµêÊûúË°®Á§∫
                        const anchorPoint = pinRequest.anchorPoints[0];
                        log(`üéÆ Spine„Éî„É≥ÈÖçÁΩÆ: ${anchorPoint.id} + „Ç™„Éï„Çª„ÉÉ„Éà(${anchorPoint.offsetX}, ${anchorPoint.offsetY})`, 'success');
                        
                        // „Ç≤„Éº„É†Âà∂‰ΩúÁî®ÈÄî„Åß„ÅÆ„É°„ÉÉ„Çª„Éº„Ç∏
                        log('üéØ ÂÆüÈöõ„ÅÆ„Ç≤„Éº„É†Âà∂‰Ωú„Åß„ÅØ„ÄÅ„Åì„ÅÆË®≠ÂÆö„Åß UIË¶ÅÁ¥†„ÅåSpine„Ç≠„É£„É©„ÇØ„Çø„Éº„Å´ËøΩÂæì„Åó„Åæ„Åô', 'info');
                    },
                    
                    // „Ç≠„É£„É≥„Çª„É´„Ç≥„Éº„É´„Éê„ÉÉ„ÇØ
                    () => {
                        log('‚ùå Spine„Ç≠„É£„É©„ÇØ„Çø„Éº„Éî„É≥Ë®≠ÂÆö„Åå„Ç≠„É£„É≥„Çª„É´„Åï„Çå„Åæ„Åó„Åü', 'warning');
                        console.log('üîÑ Spine„ÉÜ„Çπ„Éà‰∏≠Êñ≠ - ÂÜçÂ∫¶„Äåüìç „Ç≠„É£„É©„ÇØ„Çø„Éº„Éî„É≥„ÉÜ„Çπ„Éà„Äç„ÅßÂÜçÈñãÂèØËÉΩ');
                    }
                );
                
            } catch (error) {
                log('‚ùå Spine„Éî„É≥„ÉÜ„Çπ„ÉàÈñãÂßãÂ§±Êïó: ' + error.message, 'error');
                console.error('Spine„Éî„É≥„ÉÜ„Çπ„Éà „Ç®„É©„Éº:', error);
            }
        };
        
        // üéØ SpineSettingsPersistenceÁµ±Âêà„Ç∑„Çπ„ÉÜ„É†„ÉÜ„Çπ„Éà
        window.testSpineSettingsPersistenceIntegration = function() {
            log('üß™ SpineSettingsPersistenceÁµ±Âêà„ÉÜ„Çπ„ÉàÈñãÂßã', 'info');
            
            try {
                // 1. ÂàùÊúüÂåñÁä∂ÊÖãÁ¢∫Ë™ç
                if (!spinePersistence) {
                    log('‚ùå SpineSettingsPersistenceÊú™ÂàùÊúüÂåñ', 'error');
                    return;
                }
                
                log('‚úÖ SpineSettingsPersistenceÂàùÊúüÂåñÊ∏à„Åø', 'success');
                
                // 2. „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±Ë°®Á§∫
                log('üìä „Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±Ë°®Á§∫:', 'info');
                spinePersistence.debug();
                
                // 3. „ÉÜ„Çπ„ÉàË®≠ÂÆö„ÅÆ‰øùÂ≠ò
                const testCharacterId = currentCharacterName;
                const testSettings = {
                    scaleX: 1.5,
                    scaleY: 1.5,
                    // üö® ‰ΩçÁΩÆÊÉÖÂ†±„ÉÜ„Çπ„Éà„ÅØÂâäÈô§ÔºàPureBoundingBoxAutoPin„Å´ÂßîË≠≤Ôºâ
                    canvasSize: 512
                };
                
                log(`üß™ „ÉÜ„Çπ„ÉàË®≠ÂÆö‰øùÂ≠ò: ${testCharacterId}`, 'info');
                const saveResult = spinePersistence.save(testCharacterId, testSettings);
                
                if (saveResult) {
                    log('‚úÖ „ÉÜ„Çπ„ÉàË®≠ÂÆö‰øùÂ≠òÊàêÂäü', 'success');
                } else {
                    log('‚ùå „ÉÜ„Çπ„ÉàË®≠ÂÆö‰øùÂ≠òÂ§±Êïó', 'error');
                    return;
                }
                
                // 4. Ë®≠ÂÆö„ÅÆÂæ©ÂÖÉ„ÉÜ„Çπ„Éà
                log(`üîÑ „ÉÜ„Çπ„ÉàË®≠ÂÆöÂæ©ÂÖÉ: ${testCharacterId}`, 'info');
                const restoredSettings = spinePersistence.restore(testCharacterId);
                
                if (restoredSettings) {
                    log('‚úÖ „ÉÜ„Çπ„ÉàË®≠ÂÆöÂæ©ÂÖÉÊàêÂäü:', 'success');
                    log(`  - „Çπ„Ç±„Éº„É´: X=${restoredSettings.scaleX}, Y=${restoredSettings.scaleY}`, 'info');
                    // üö® ‰ΩçÁΩÆÊÉÖÂ†±„É≠„Ç∞„ÅØÂâäÈô§ÔºàPureBoundingBoxAutoPin„Å´ÂßîË≠≤Ôºâ
                    log(`  - Canvas: ${restoredSettings.canvasSize}px`, 'info');
                    
                    // Ë®≠ÂÆöÂÄ§„ÅÆÊ§úË®ºÔºà‰ΩçÁΩÆÊÉÖÂ†±Èô§Â§ñÔºâ
                    const isValid = (
                        restoredSettings.scaleX === testSettings.scaleX &&
                        restoredSettings.scaleY === testSettings.scaleY &&
                        restoredSettings.canvasSize === testSettings.canvasSize
                    );
                    
                    if (isValid) {
                        log('‚úÖ Ë®≠ÂÆöÂÄ§„ÅÆÊï¥ÂêàÊÄßÁ¢∫Ë™çÂÆå‰∫Ü', 'success');
                    } else {
                        log('‚ùå Ë®≠ÂÆöÂÄ§„Å´‰∏çÊï¥Âêà„Åå„ÅÇ„Çä„Åæ„Åô', 'error');
                    }
                } else {
                    log('‚ùå „ÉÜ„Çπ„ÉàË®≠ÂÆöÂæ©ÂÖÉÂ§±Êïó', 'error');
                    return;
                }
                
                // 5. ÂÖ®„Éö„Éº„Ç∏Ë®≠ÂÆöÂèñÂæó„ÉÜ„Çπ„Éà
                log('üìã ÂÖ®„Éö„Éº„Ç∏Ë®≠ÂÆöÂèñÂæó„ÉÜ„Çπ„Éà', 'info');
                const allSettings = spinePersistence.getAllForCurrentPage();
                const settingsCount = Object.keys(allSettings).length;
                log(`üìä ÁèæÂú®„Éö„Éº„Ç∏„ÅÆË®≠ÂÆöÊï∞: ${settingsCount}`, 'info');
                
                // 6. Ë®≠ÂÆöÂâäÈô§„ÉÜ„Çπ„Éà
                log(`üóëÔ∏è „ÉÜ„Çπ„ÉàË®≠ÂÆöÂâäÈô§: ${testCharacterId}`, 'info');
                const deleteResult = spinePersistence.clear(testCharacterId);
                
                if (deleteResult) {
                    log('‚úÖ „ÉÜ„Çπ„ÉàË®≠ÂÆöÂâäÈô§ÊàêÂäü', 'success');
                } else {
                    log('‚ùå „ÉÜ„Çπ„ÉàË®≠ÂÆöÂâäÈô§Â§±Êïó', 'error');
                }
                
                // 7. ÂâäÈô§Á¢∫Ë™ç
                const deletedSettings = spinePersistence.restore(testCharacterId);
                if (!deletedSettings) {
                    log('‚úÖ Ë®≠ÂÆöÂâäÈô§Á¢∫Ë™çÂÆå‰∫Ü', 'success');
                } else {
                    log('‚ö†Ô∏è Ë®≠ÂÆö„ÅåÂâäÈô§„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì', 'warning');
                }
                
                // 8. Áµ±ÂêàÊ©üËÉΩ„ÉÜ„Çπ„Éà
                if (spineRenderer && spineRenderer.skeleton) {
                    log('üîß Áµ±ÂêàÊ©üËÉΩ„ÉÜ„Çπ„Éà: Ëá™Âãï‰øùÂ≠ò„ÉªÂæ©ÂÖÉ', 'info');
                    
                    // ÁèæÂú®„ÅÆË®≠ÂÆö„Çí‰øùÂ≠ò
                    const integrationResult = saveSpineSettingsIntegrated(testCharacterId);
                    if (integrationResult) {
                        log('‚úÖ Áµ±Âêà‰øùÂ≠òÊ©üËÉΩ„ÉÜ„Çπ„ÉàÊàêÂäü', 'success');
                    } else {
                        log('‚ùå Áµ±Âêà‰øùÂ≠òÊ©üËÉΩ„ÉÜ„Çπ„ÉàÂ§±Êïó', 'error');
                    }
                    
                    // Âæ©ÂÖÉÊ©üËÉΩ„ÉÜ„Çπ„Éà
                    setTimeout(async () => {
                        const restoreResult = await restoreSpineSettingsIntegrated(testCharacterId);
                        if (restoreResult) {
                            log('‚úÖ Áµ±ÂêàÂæ©ÂÖÉÊ©üËÉΩ„ÉÜ„Çπ„ÉàÊàêÂäü', 'success');
                        } else {
                            log('üìù Áµ±ÂêàÂæ©ÂÖÉÊ©üËÉΩ„ÉÜ„Çπ„Éà: Ë®≠ÂÆö„Å™„ÅóÔºàÊ≠£Â∏∏Ôºâ', 'info');
                        }
                        
                        log('üéâ SpineSettingsPersistenceÁµ±Âêà„ÉÜ„Çπ„ÉàÂÆå‰∫Ü', 'success');
                    }, 1000);
                } else {
                    log('‚ö†Ô∏è SpineRendererÊú™Ê∫ñÂÇô - Áµ±ÂêàÊ©üËÉΩ„ÉÜ„Çπ„Éà„Çπ„Ç≠„ÉÉ„Éó', 'warning');
                    log('üéâ SpineSettingsPersistenceÂü∫Êú¨„ÉÜ„Çπ„ÉàÂÆå‰∫Ü', 'success');
                }
            } catch (error) {
                log(`‚ùå SpineSettingsPersistenceÁµ±Âêà„ÉÜ„Çπ„Éà„Ç®„É©„Éº: ${error.message}`, 'error');
                console.error('Áµ±Âêà„ÉÜ„Çπ„Éà„Ç®„É©„Éº:', error);
            }
        };
        
        // üîç „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏Ë®∫Êñ≠Ê©üËÉΩ
        window.debugLocalStorageForCanvasResize = function() {
            log("üîç „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏Ë®∫Êñ≠ÈñãÂßã", "info");
            
            // SpineSettingsPersistenceÈñ¢ÈÄ£„ÅÆ„Ç≠„Éº„ÇíÊ§úÁ¥¢
            const spineKeys = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && key.startsWith("spineSettings-")) {
                    spineKeys.push(key);
                }
            }
            
            log(`üìä SpineSettingsÈñ¢ÈÄ£„Ç≠„ÉºÊï∞: ${spineKeys.length}`, "info");
            
            spineKeys.forEach(key => {
                try {
                    const data = JSON.parse(localStorage.getItem(key));
                    log(`üîë ${key}:`, "info");
                    log(`  - canvasSize: ${data.settings?.canvasSize}`, "info");
                    log(`  - scaleX: ${data.settings?.scaleX}`, "info");
                    log(`  - scaleY: ${data.settings?.scaleY}`, "info");
                    log(`  - timestamp: ${data.timestamp}`, "info");
                } catch (error) {
                    log(`‚ùå ${key} Ëß£Êûê„Ç®„É©„Éº: ${error.message}`, "error");
                }
            });
        };
        
        // üîç Canvas ResizeË®≠ÂÆö‰øùÂ≠ò„ÉÜ„Çπ„Éà
        window.testCanvasResizeSaveRestore = async function() {
            log("üß™ Canvas ResizeË®≠ÂÆö‰øùÂ≠ò„ÉªÂæ©ÂÖÉ„ÉÜ„Çπ„ÉàÈñãÂßã", "info");
            
            if (!spineRenderer || !spineRenderer.skeleton) {
                log("‚ö†Ô∏è SpineRendererÊú™Ê∫ñÂÇô - „ÉÜ„Çπ„Éà‰∏≠Ê≠¢", "warning");
                return;
            }
            
            const testCharacterId = currentCharacterName || "test-character";
            
            // 1. ÁèæÂú®„ÅÆË®≠ÂÆö„ÇíË®òÈå≤
            const originalCanvasSize = spineRenderer.canvas ? Math.max(spineRenderer.canvas.width, spineRenderer.canvas.height) : 400;
            const originalScaleX = spineRenderer.skeleton.scaleX;
            const originalScaleY = spineRenderer.skeleton.scaleY;
            
            log(`üìä ÁèæÂú®„ÅÆË®≠ÂÆö: Canvas=${originalCanvasSize}, Scale=${originalScaleX.toFixed(2)}, ${originalScaleY.toFixed(2)}`, "info");
            
            // 2. „ÉÜ„Çπ„ÉàÁî®Ë®≠ÂÆö„Åß‰øùÂ≠ò
            const testSettings = {
                canvasSize: 512,
                scaleX: 1.5,
                scaleY: 1.5
            };
            
            log("üíæ „ÉÜ„Çπ„ÉàË®≠ÂÆö‰øùÂ≠òÂÆüË°å", "info");
            const saveResult = saveSpineSettingsIntegrated(testCharacterId, testSettings);
            
            if (saveResult) {
                log("‚úÖ „ÉÜ„Çπ„ÉàË®≠ÂÆö‰øùÂ≠òÊàêÂäü", "success");
            } else {
                log("‚ùå „ÉÜ„Çπ„ÉàË®≠ÂÆö‰øùÂ≠òÂ§±Êïó", "error");
                return;
            }
            
            // 3. „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏Á¢∫Ë™ç
            debugLocalStorageForCanvasResize();
            
            // 4. Âæ©ÂÖÉ„ÉÜ„Çπ„Éà
            log("üîÑ „ÉÜ„Çπ„ÉàË®≠ÂÆöÂæ©ÂÖÉÂÆüË°å", "info");
            const restoreResult = await restoreSpineSettingsIntegrated(testCharacterId);
            
            if (restoreResult) {
                log("‚úÖ „ÉÜ„Çπ„ÉàË®≠ÂÆöÂæ©ÂÖÉÊàêÂäü", "success");
                
                // 5. Âæ©ÂÖÉÂæå„ÅÆÂÄ§Á¢∫Ë™ç
                const restoredCanvasSize = spineRenderer.canvas ? Math.max(spineRenderer.canvas.width, spineRenderer.canvas.height) : 400;
                const restoredScaleX = spineRenderer.skeleton.scaleX;
                const restoredScaleY = spineRenderer.skeleton.scaleY;
                
                log(`üìä Âæ©ÂÖÉÂæå„ÅÆË®≠ÂÆö: Canvas=${restoredCanvasSize}, Scale=${restoredScaleX.toFixed(2)}, ${restoredScaleY.toFixed(2)}`, "info");
                
                // ÊúüÂæÖÂÄ§„Å®ÊØîËºÉ
                const canvasMatch = restoredCanvasSize === testSettings.canvasSize;
                const scaleXMatch = Math.abs(restoredScaleX - testSettings.scaleX) < 0.001;
                const scaleYMatch = Math.abs(restoredScaleY - testSettings.scaleY) < 0.001;
                
                log(`üîç Ê§úË®ºÁµêÊûú: Canvas=${canvasMatch ? "‚úÖ" : "‚ùå"}, ScaleX=${scaleXMatch ? "‚úÖ" : "‚ùå"}, ScaleY=${scaleYMatch ? "‚úÖ" : "‚ùå"}`, canvasMatch && scaleXMatch && scaleYMatch ? "success" : "error");
                
                if (!canvasMatch) {
                    log(`‚ùå CanvasÂæ©ÂÖÉÂ§±Êïó: ÊúüÂæÖÂÄ§=${testSettings.canvasSize}, ÂÆüÈöõÂÄ§=${restoredCanvasSize}`, "error");
                }
                if (!scaleXMatch) {
                    log(`‚ùå ScaleXÂæ©ÂÖÉÂ§±Êïó: ÊúüÂæÖÂÄ§=${testSettings.scaleX}, ÂÆüÈöõÂÄ§=${restoredScaleX}`, "error");
                }
                if (!scaleYMatch) {
                    log(`‚ùå ScaleYÂæ©ÂÖÉÂ§±Êïó: ÊúüÂæÖÂÄ§=${testSettings.scaleY}, ÂÆüÈöõÂÄ§=${restoredScaleY}`, "error");
                }
                
            } else {
                log("‚ùå „ÉÜ„Çπ„ÉàË®≠ÂÆöÂæ©ÂÖÉÂ§±Êïó", "error");
            }
            
            log("üéâ Canvas ResizeË®≠ÂÆö‰øùÂ≠ò„ÉªÂæ©ÂÖÉ„ÉÜ„Çπ„ÉàÂÆå‰∫Ü", "success");
        };
    </script>
</body>
</html>