<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“¦ ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã•ã‚Œã¾ã—ãŸ</title>
    <style>
        body {
            font-family: 'Hiragino Sans', sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            line-height: 1.8;
            background: #f5f5f5;
        }
        .notice {
            background: #fff;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
        }
        h1 { color: #667eea; margin-bottom: 20px; }
        .info { background: #e8f4f8; padding: 15px; border-radius: 5px; margin: 20px 0; }
        .path { font-family: monospace; background: #f0f0f0; padding: 2px 6px; border-radius: 3px; }
    </style>
</head>
<body>
    <div class="notice">
        <h1>ğŸ“¦ ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã•ã‚Œã¾ã—ãŸ</h1>
        
        <div class="info">
            <p><strong>ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³åˆ¶å¾¡ã‚·ã‚¹ãƒ†ãƒ å®Ÿé¨“ç’°å¢ƒ</strong>ã¯ä»¥ä¸‹ã®å ´æ‰€ã«ç§»å‹•ã•ã‚Œã¾ã—ãŸï¼š</p>
            <p class="path">archive/timeline-system-phase1-2025-08-08/experiment/timeline-experiment.html</p>
        </div>
        
        <p><strong>ç§»å‹•æ—¥æ™‚</strong>: 2025-08-08</p>
        <p><strong>ç§»å‹•ç†ç”±</strong>: Phase 1ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³åˆ¶å¾¡ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºå®Œäº†ã«ã‚ˆã‚‹ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–æ•´ç†</p>
        
        <div class="info">
            <p><strong>ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã•ã‚ŒãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„</strong>:</p>
            <ul style="text-align: left; display: inline-block;">
                <li>ä»•æ§˜æ›¸: ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³åˆ¶å¾¡ã‚·ã‚¹ãƒ†ãƒ ä»•æ§˜æ›¸.md</li>
                <li>å®Ÿé¨“ç’°å¢ƒ: timeline-experiment.html</li>
                <li>assets/spine/: 22å€‹timeline-*.jsãƒ•ã‚¡ã‚¤ãƒ«</li>
                <li>ãƒ«ãƒ¼ãƒˆ: 8å€‹timeline-*.jsãƒ•ã‚¡ã‚¤ãƒ«</li>
            </ul>
        </div>
        
        <p><strong>Phase 1å®Ÿè£…çŠ¶æ³</strong>: 95%å®Œäº†ãƒ»åŸºæœ¬æ©Ÿèƒ½çµ±åˆãƒ†ã‚¹ãƒˆå®Œäº†</p>
        <p><strong>Phase 1.5</strong>: ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ãƒ»å“è³ªä¿è¨¼ä½œæ¥­å¾…æ©Ÿä¸­</p>
    </div>
</body>
</html>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Noto Sans JP', sans-serif;
            line-height: 1.8;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px 20px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            color: #667eea;
            font-size: 2.2rem;
            margin-bottom: 8px;
        }

        .header .subtitle {
            color: #666;
            font-size: 1.1rem;
        }

        .experiment-area {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
            margin-bottom: 30px;
        }

        .spine-display {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            min-height: 600px;
            position: relative;
            backdrop-filter: blur(10px);
        }

        .timeline-controls {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .timeline-controls h3 {
            color: #667eea;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .control-section:last-child {
            border-bottom: none;
        }

        .control-section h4 {
            color: #555;
            margin-bottom: 10px;
            font-size: 0.95rem;
        }

        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            margin: 3px;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #5a67d8;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #48bb78;
        }

        .btn-secondary:hover {
            background: #38a169;
        }

        .btn-danger {
            background: #e53e3e;
        }

        .btn-danger:hover {
            background: #c53030;
        }

        .timeline-display {
            background: #f8f9ff;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            max-height: 200px;
            overflow-y: auto;
        }

        .status-info {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            backdrop-filter: blur(10px);
        }

        .status-item {
            text-align: center;
            padding: 15px;
            background: #f8f9ff;
            border-radius: 10px;
        }

        .status-item .label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }

        .status-item .value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #667eea;
        }

        @media (max-width: 1024px) {
            .experiment-area {
                grid-template-columns: 1fr;
            }
            
            .timeline-controls {
                order: -1;
            }
        }

        /* Spineã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¡¨ç¤ºã‚¨ãƒªã‚¢ */
        #spine-character-area {
            position: relative;
            width: 100%;
            height: 500px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            overflow: hidden;
        }

        /* ãƒ‡ãƒãƒƒã‚°æƒ…å ± */
        .debug-overlay {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 0.8rem;
            z-index: 1000;
        }

        /* Phase 2: è¦–è¦šçš„ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ç·¨é›†UI */
        .btn.active {
            background: #48bb78;
            transform: translateY(-1px);
        }

        .timeline-track-container {
            background: #f8f9ff;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid #e2e8f0;
        }

        .timeline-ruler {
            position: relative;
            height: 30px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 5px;
            margin-bottom: 10px;
            overflow: hidden;
        }

        .ruler-marks {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100%;
            background: repeating-linear-gradient(
                90deg,
                rgba(255,255,255,0.3) 0px,
                rgba(255,255,255,0.3) 1px,
                transparent 1px,
                transparent 20px
            );
        }

        .playhead {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 3px;
            background: #e53e3e;
            left: 0%;
            transition: left 0.1s ease;
            box-shadow: 0 0 10px rgba(229, 62, 62, 0.5);
        }

        .playhead::before {
            content: 'â–¼';
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            color: #e53e3e;
            font-size: 12px;
        }

        .character-tracks {
            min-height: 100px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 5px;
            padding: 10px;
            border: 1px dashed #cbd5e0;
        }

        .character-track {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            padding: 5px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 5px;
            border-left: 4px solid #667eea;
        }

        .track-label {
            width: 80px;
            font-size: 0.8rem;
            font-weight: bold;
            color: #667eea;
        }

        .track-timeline {
            flex: 1;
            height: 20px;
            position: relative;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 3px;
        }

        .keyframe {
            position: absolute;
            width: 12px;
            height: 12px;
            background: #48bb78;
            border-radius: 50%;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            border: 2px solid #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: all 0.2s;
        }

        .keyframe:hover {
            transform: translateY(-50%) scale(1.2);
            background: #38a169;
        }

        .keyframe.selected {
            background: #e53e3e;
            transform: translateY(-50%) scale(1.3);
        }

        .keyframe-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #e2e8f0;
        }

        .timeline-scrubber {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: #e2e8f0;
            outline: none;
            cursor: pointer;
        }

        .timeline-scrubber::-webkit-slider-thumb {
            appearance: none;
            width: 16px;
            height: 16px;
            background: #667eea;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .timeline-scrubber::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #667eea;
            border-radius: 50%;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        #current-time-display {
            font-family: monospace;
            font-weight: bold;
            color: #667eea;
            background: rgba(102, 126, 234, 0.1);
            padding: 3px 8px;
            border-radius: 4px;
        }

        .animation-selector {
            padding: 5px 10px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            background: white;
            color: #667eea;
            font-size: 0.9rem;
            cursor: pointer;
            outline: none;
            transition: all 0.2s;
        }

        .animation-selector:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .keyframe-details {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border: 1px solid #e2e8f0;
        }

        .details-header {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .details-content {
            font-size: 0.85rem;
            color: #555;
            line-height: 1.5;
        }

        .keyframe-property {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 0;
            border-bottom: 1px solid #f1f5f9;
        }

        .keyframe-property:last-child {
            border-bottom: none;
        }

        .property-label {
            font-weight: 500;
            color: #4a5568;
        }

        .property-value {
            font-family: monospace;
            color: #667eea;
            background: rgba(102, 126, 234, 0.1);
            padding: 2px 6px;
            border-radius: 3px;
        }

        /* ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆè¡¨ç¤ºåˆ¶å¾¡ */
        .mode-hidden {
            display: none;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        @media (max-width: 768px) {
            .timeline-track-container {
                padding: 10px;
            }
            
            .keyframe-controls {
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .timeline-scrubber {
                min-width: 200px;
            }
            
            .character-track {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .track-label {
                width: 100%;
                margin-bottom: 5px;
            }
            
            .track-timeline {
                width: 100%;
                height: 30px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="header">
            <h1>ğŸ¬ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³åˆ¶å¾¡ã‚·ã‚¹ãƒ†ãƒ å®Ÿé¨“ç’°å¢ƒ</h1>
            <p class="subtitle">Phase 1: åŸºæœ¬ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³åˆ¶å¾¡ã‚¨ãƒ³ã‚¸ãƒ³é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆç’°å¢ƒ</p>
        </div>

        <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æƒ…å ± -->
        <div class="status-info">
            <div class="status-item">
                <div class="label">ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹</div>
                <div class="value" id="system-status">åˆæœŸåŒ–ä¸­...</div>
            </div>
            <div class="status-item">
                <div class="label">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼</div>
                <div class="value" id="active-characters">0</div>
            </div>
            <div class="status-item">
                <div class="label">å®Ÿè¡Œä¸­ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</div>
                <div class="value" id="running-timelines">0</div>
            </div>
            <div class="status-item">
                <div class="label">FPS / ãƒ•ãƒ¬ãƒ¼ãƒ </div>
                <div class="value" id="current-frame">0fps</div>
            </div>
            <div class="status-item">
                <div class="label">ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡</div>
                <div class="value" id="memory-usage">0MB</div>
            </div>
            <div class="status-item">
                <div class="label">CPUè² è·</div>
                <div class="value" id="cpu-usage">0%</div>
            </div>
        </div>

        <!-- å®Ÿé¨“ã‚¨ãƒªã‚¢ -->
        <div class="experiment-area">
            <!-- Spineè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
            <div class="spine-display">
                <h3>ğŸ­ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¡¨ç¤ºã‚¨ãƒªã‚¢</h3>
                <div id="spine-character-area">
                    <!-- ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
                    <div class="debug-overlay" id="debug-info">
                        <div>Time: <span id="debug-time">0.00s</span></div>
                        <div>Timeline: <span id="debug-timeline">æœªå®Ÿè¡Œ</span></div>
                        <div>Animation: <span id="debug-animation">æœªè¨­å®š</span></div>
                    </div>
                    
                    <!-- Spineã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
                </div>
            </div>

            <!-- Phase 2: è¦–è¦šçš„ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ç·¨é›†ãƒ‘ãƒãƒ« -->
            <div class="timeline-controls">
                <h3>ğŸ¬ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ç·¨é›†</h3>
                
                <!-- ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ -->
                <div class="control-section">
                    <h4>ç·¨é›†ãƒ¢ãƒ¼ãƒ‰</h4>
                    <button class="btn" id="mode-basic">â±ï¸ åŸºæœ¬åˆ¶å¾¡</button>
                    <button class="btn btn-secondary active" id="mode-visual">ğŸ¨ ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ç·¨é›†</button>
                </div>
                
                <!-- åŸºæœ¬åˆ¶å¾¡ -->
                <div class="control-section" id="basic-controls">
                    <h4>åŸºæœ¬åˆ¶å¾¡</h4>
                    <button class="btn" id="play-timeline">â–¶ï¸ å†ç”Ÿ</button>
                    <button class="btn" id="pause-timeline">â¸ï¸ ä¸€æ™‚åœæ­¢</button>
                    <button class="btn" id="stop-timeline">â¹ï¸ åœæ­¢</button>
                    <button class="btn btn-secondary" id="reset-timeline">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
                </div>
                
                <!-- è¦–è¦šçš„ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ç·¨é›†ã‚¨ãƒªã‚¢ -->
                <div class="control-section" id="visual-timeline-editor">
                    <h4>ğŸ¯ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ãƒˆãƒ©ãƒƒã‚¯</h4>
                    <div class="timeline-track-container">
                        <!-- ã‚¿ã‚¤ãƒ ãƒ«ãƒ¼ãƒ©ãƒ¼ -->
                        <div class="timeline-ruler">
                            <div class="ruler-marks"></div>
                            <div class="playhead" id="timeline-playhead"></div>
                        </div>
                        
                        <!-- ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åˆ¥ãƒˆãƒ©ãƒƒã‚¯ -->
                        <div class="character-tracks" id="character-tracks">
                            <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ãƒˆãƒ©ãƒƒã‚¯ -->
                        </div>
                    </div>
                    
                    <!-- ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ç·¨é›†ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
                    <div class="keyframe-controls">
                        <button class="btn btn-secondary" id="add-keyframe">â• ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ </button>
                        <button class="btn" id="delete-keyframe">ğŸ—‘ï¸ å‰Šé™¤</button>
                        <select id="animation-selector" class="animation-selector">
                            <option value="idle">å¾…æ©Ÿ</option>
                            <option value="walk">æ­©è¡Œ</option>
                            <option value="jump">ã‚¸ãƒ£ãƒ³ãƒ—</option>
                            <option value="wave">æ‰‹æŒ¯ã‚Š</option>
                            <option value="dance">ãƒ€ãƒ³ã‚¹</option>
                        </select>
                        <input type="range" id="timeline-scrubber" min="0" max="10" step="0.1" value="0" class="timeline-scrubber">
                        <span id="current-time-display">0.0s</span>
                    </div>
                    
                    <!-- ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ è©³ç´°æƒ…å ± -->
                    <div class="keyframe-details" id="keyframe-details">
                        <div class="details-header">ğŸ¯ ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ è©³ç´°</div>
                        <div class="details-content" id="details-content">
                            ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’é¸æŠã—ã¦ãã ã•ã„
                        </div>
                    </div>
                </div>

                <!-- ã‚µãƒ³ãƒ—ãƒ«ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ -->
                <div class="control-section">
                    <h4>ã‚µãƒ³ãƒ—ãƒ«å®Ÿè¡Œ</h4>
                    <button class="btn btn-secondary" id="sample-basic">åŸºæœ¬æ¼”å‡º</button>
                    <button class="btn btn-secondary" id="sample-complex">è¤‡é›‘æ¼”å‡º</button>
                    <button class="btn btn-secondary" id="sample-sync">åŒæœŸæ¼”å‡º</button>
                </div>

                <!-- ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åˆ¶å¾¡ -->
                <div class="control-section">
                    <h4>ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼</h4>
                    <button class="btn" id="load-purattokun">ğŸ± ã·ã‚‰ã£ã¨ãã‚“</button>
                    <button class="btn" id="load-nezumi">ğŸ­ ã­ãšã¿</button>
                    <button class="btn btn-danger" id="clear-characters">âŒ å…¨å‰Šé™¤</button>
                </div>

                <!-- ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³è¡¨ç¤º -->
                <div class="control-section">
                    <h4>ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³è©³ç´°</h4>
                    <div class="timeline-display" id="timeline-display">
                        ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³æƒ…å ±ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™
                    </div>
                </div>

                <!-- ğŸ¯ å¢ƒç•Œãƒœãƒƒã‚¯ã‚¹é«˜åº¦é€£æºãƒ†ã‚¹ãƒˆ -->
                <div class="control-section">
                    <h4>ğŸ¯ å¢ƒç•Œãƒœãƒƒã‚¯ã‚¹é«˜åº¦é€£æº</h4>
                    <div class="bounds-advanced-controls">
                        <button class="btn btn-secondary" onclick="testPrecisionClick()">ç²¾å¯†ã‚¯ãƒªãƒƒã‚¯åˆ¤å®š</button>
                        <button class="btn btn-secondary" onclick="testZonePerformances()">ã‚¾ãƒ¼ãƒ³åˆ¥æ¼”å‡º</button>
                        <button class="btn btn-secondary" onclick="testSynergyPerformances()">é€£æºæ¼”å‡º</button>
                        <button class="btn btn-info" onclick="testInteractionHistory()">å±¥æ­´ã‚·ã‚¹ãƒ†ãƒ </button>
                        <button class="btn btn-info" onclick="visualizeBoundingZones()">å¢ƒç•Œã‚¾ãƒ¼ãƒ³å¯è¦–åŒ–</button>
                        <button class="btn" onclick="debugBoundsIntegration()">çµ±åˆçŠ¶æ…‹ç¢ºèª</button>
                    </div>
                    <div class="bounds-test-results" id="bounds-test-results" style="margin-top: 10px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 5px; min-height: 60px;">
                        <small>ãƒ†ã‚¹ãƒˆçµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</small>
                    </div>
                </div>

                <!-- ğŸš€ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–åˆ¶å¾¡ -->
                <div class="control-section">
                    <h4>ğŸš€ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–</h4>
                    <div class="performance-controls">
                        <button class="btn btn-secondary" id="start-optimization" onclick="startPerformanceOptimization()">âš¡ æœ€é©åŒ–é–‹å§‹</button>
                        <button class="btn btn-danger" id="stop-optimization" onclick="stopPerformanceOptimization()">â¹ï¸ æœ€é©åŒ–åœæ­¢</button>
                        <button class="btn" onclick="showPerformanceReport()">ğŸ“Š ãƒ¬ãƒãƒ¼ãƒˆè¡¨ç¤º</button>
                        <button class="btn" onclick="executeMemoryCleanup()">ğŸ§¹ ãƒ¡ãƒ¢ãƒªæ¸…ç†</button>
                    </div>
                    <div class="performance-results" id="performance-results" style="margin-top: 10px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 5px; min-height: 60px;">
                        <small>ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æƒ…å ±ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³è¨­å®šãƒ‡ãƒ¼ã‚¿ï¼ˆHTMLè¨­å®šåˆ¶å¾¡ã‚·ã‚¹ãƒ†ãƒ ï¼‰ -->
    <div id="timeline-config" style="display: none;">
        <!-- ã‚µãƒ³ãƒ—ãƒ«è¨­å®š -->
        <div class="sample-basic" 
             data-timeline="0:appear,2:idle,5:wave,8:idle"
             data-character="purattokun">
        </div>
        
        <div class="sample-complex" 
             data-timeline="0:appear,1:walk,3:jump,4:wave,6:dance,8:bow,10:idle"
             data-character="purattokun">
        </div>
        
        <div class="sample-sync"
             data-timeline="0:appear,2:walk,4:wave"
             data-character="purattokun,nezumi"
             data-sync="true">
        </div>
    </div>

    <!-- æ—¢å­˜Spineã‚·ã‚¹ãƒ†ãƒ èª­ã¿è¾¼ã¿ -->
    <script src="https://unpkg.com/@esotericsoftware/spine-webgl@4.1.*/dist/iife/spine-webgl.js"></script>
    
    <!-- æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚¡ã‚¤ãƒ« -->
    <script src="assets/spine/spine-coordinate-utils.js"></script>
    <script src="assets/spine/spine-integration-v2.js"></script>
    <script src="assets/spine/spine-character-manager.js"></script>
    
    <!-- ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³åˆ¶å¾¡ã‚·ã‚¹ãƒ†ãƒ ï¼ˆPhase 2.5 ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å¾Œï¼‰ -->
    <script src="assets/spine/timeline-control-engine.js"></script>
    
    <!-- ğŸ†• Phase 2.5: åˆ†å‰²å¾Œãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆä¾å­˜é †åºé‡è¦ï¼‰ -->
    <!-- ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ç·¨é›†UIï¼šã‚³ã‚¢ â†’ æ‹¡å¼µæ©Ÿèƒ½ â†’ çµ±åˆ ã®é †åºã§èª­ã¿è¾¼ã¿ -->
    <script src="assets/spine/timeline-editor-core.js"></script>
    <script src="assets/spine/timeline-keyframe-ui.js"></script>
    <script src="assets/spine/timeline-responsive-ui.js"></script>
    <script src="assets/spine/timeline-visual-effects.js"></script>
    
    <!-- ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ç·¨é›†çµ±åˆï¼šã‚³ã‚¢ â†’ äº’æ›æ€§ ã®é †åºã§èª­ã¿è¾¼ã¿ -->
    <script src="assets/spine/timeline-edit-core.js"></script>
    <script src="assets/spine/timeline-edit-compatibility.js"></script>
    
    <!-- ã‚³ã‚¢æ©Ÿèƒ½ï¼ˆå¿…é ˆãƒ»é †åºé‡è¦ï¼‰ -->
    <script src="assets/spine/timeline-error-core.js"></script>
    <script src="assets/spine/timeline-diagnostics.js"></script>
    <script src="assets/spine/timeline-data-core.js"></script>
    <script src="assets/spine/timeline-compatibility.js"></script>
    <script src="assets/spine/timeline-sequence-manager.js"></script>
    
    <!-- ğŸ­ é«˜åº¦ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åŒæœŸåˆ¶å¾¡ã‚·ã‚¹ãƒ†ãƒ  -->
    <script src="timeline-character-sync.js"></script>
    
    <!-- ğŸ¬ å‹•çš„æ¼”å‡ºåˆ¶å¾¡ãƒ»æ¡ä»¶åˆ†å²ã‚·ã‚¹ãƒ†ãƒ  -->
    <script src="timeline-dynamic-performance.js"></script>
    
    <!-- ğŸ­ è¤‡é›‘ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ç®¡ç†ãƒ»ãƒã‚¹ãƒˆå¯¾å¿œã‚·ã‚¹ãƒ†ãƒ  -->
    <script src="timeline-complex-sequences.js"></script>
    
    <!-- æ‹¡å¼µæ©Ÿèƒ½ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ -->
    <script src="assets/spine/timeline-sequence-tests.js"></script>
    
    <!-- æ¤œè¨¼ãƒ»ãƒ†ã‚¹ãƒˆæ©Ÿèƒ½ -->
    <script src="assets/spine/timeline-refactoring-validation.js"></script>
    
    <!-- ğŸ¯ å¢ƒç•Œãƒœãƒƒã‚¯ã‚¹é«˜åº¦é€£æºã‚·ã‚¹ãƒ†ãƒ  -->
    <script src="spine-bounds-integration.js"></script>
    <script src="timeline-bounds-advanced.js"></script>
    
    <!-- ğŸš€ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã‚·ã‚¹ãƒ†ãƒ  -->
    <script src="timeline-performance-optimizer.js"></script>
    
    <!-- ãƒ¬ã‚¬ã‚·ãƒ¼äº’æ›æ€§ï¼šæ—§ãƒ•ã‚¡ã‚¤ãƒ«ã¯éæ¨å¥¨ãƒ»æ–°ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ä»£æ›¿ -->
    <!-- æ—§timeline-editor-ui.js â†’ 4ã¤ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«åˆ†å‰²æ¸ˆã¿ -->
    <!-- æ—§timeline-edit-integration.js â†’ 2ã¤ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«åˆ†å‰²æ¸ˆã¿ -->
    
    <!-- å®Ÿé¨“ç’°å¢ƒåˆ¶å¾¡ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
    <script>
        // Phase 2: è¦–è¦šçš„ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ç·¨é›†ã‚·ã‚¹ãƒ†ãƒ 
        class VisualTimelineEditor {
            constructor() {
                this.currentTime = 0;
                this.maxTime = 10;
                this.isPlaying = false;
                this.playbackSpeed = 1;
                this.selectedKeyframe = null;
                this.characterTracks = new Map();
                this.keyframes = new Map();
                this.mode = 'visual'; // 'basic' or 'visual'
                
                console.log('ğŸ¨ Visual Timeline Editor åˆæœŸåŒ–');
            }
            
            init() {
                this.setupModeToggle();
                this.setupTimelineControls();
                this.setupKeyframeEditing();
                this.createSampleTracks();
                this.startUpdateLoop();
                
                console.log('âœ… Visual Timeline Editor æº–å‚™å®Œäº†');
            }
            
            setupModeToggle() {
                const basicModeBtn = document.getElementById('mode-basic');
                const visualModeBtn = document.getElementById('mode-visual');
                const basicControls = document.getElementById('basic-controls');
                const visualEditor = document.getElementById('visual-timeline-editor');
                
                basicModeBtn.addEventListener('click', () => {
                    this.mode = 'basic';
                    basicModeBtn.classList.add('active');
                    visualModeBtn.classList.remove('active');
                    basicControls.classList.remove('mode-hidden');
                    visualEditor.classList.add('mode-hidden');
                    console.log('â±ï¸ åŸºæœ¬åˆ¶å¾¡ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ');
                });
                
                visualModeBtn.addEventListener('click', () => {
                    this.mode = 'visual';
                    visualModeBtn.classList.add('active');
                    basicModeBtn.classList.remove('active');
                    basicControls.classList.add('mode-hidden');
                    visualEditor.classList.remove('mode-hidden');
                    console.log('ğŸ¨ ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ');
                });
                
                // åˆæœŸçŠ¶æ…‹è¨­å®š
                visualModeBtn.click();
            }
            
            setupTimelineControls() {
                const scrubber = document.getElementById('timeline-scrubber');
                const timeDisplay = document.getElementById('current-time-display');
                
                scrubber.addEventListener('input', (e) => {
                    this.currentTime = parseFloat(e.target.value);
                    this.updateTimeDisplay();
                    this.updatePlayhead();
                });
                
                scrubber.addEventListener('change', (e) => {
                    console.log(`â° ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ä½ç½®å¤‰æ›´: ${this.currentTime.toFixed(1)}s`);
                });
            }
            
            setupKeyframeEditing() {
                const addKeyframeBtn = document.getElementById('add-keyframe');
                const deleteKeyframeBtn = document.getElementById('delete-keyframe');
                
                addKeyframeBtn.addEventListener('click', () => {
                    this.addKeyframe();
                });
                
                deleteKeyframeBtn.addEventListener('click', () => {
                    this.deleteSelectedKeyframe();
                });
            }
            
            createSampleTracks() {
                const tracksContainer = document.getElementById('character-tracks');
                const sampleTracks = [
                    { id: 'purattokun', label: 'ğŸ± ã·ã‚‰ã£ã¨ãã‚“', keyframes: [0, 2, 5, 8] },
                    { id: 'nezumi', label: 'ğŸ­ ã­ãšã¿', keyframes: [1, 3, 6, 9] }
                ];
                
                sampleTracks.forEach(trackData => {
                    const track = this.createCharacterTrack(trackData);
                    tracksContainer.appendChild(track);
                });
            }
            
            createCharacterTrack(trackData) {
                const track = document.createElement('div');
                track.className = 'character-track';
                track.dataset.characterId = trackData.id;
                
                const label = document.createElement('div');
                label.className = 'track-label';
                label.textContent = trackData.label;
                
                const timeline = document.createElement('div');
                timeline.className = 'track-timeline';
                
                // ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ è¿½åŠ 
                trackData.keyframes.forEach(time => {
                    const keyframe = this.createKeyframe(time, trackData.id);
                    timeline.appendChild(keyframe);
                });
                
                track.appendChild(label);
                track.appendChild(timeline);
                
                this.characterTracks.set(trackData.id, {
                    element: track,
                    keyframes: trackData.keyframes
                });
                
                return track;
            }
            
            createKeyframe(time, characterId, animation = 'idle') {
                const keyframe = document.createElement('div');
                keyframe.className = 'keyframe';
                keyframe.style.left = `${(time / this.maxTime) * 100}%`;
                keyframe.dataset.time = time;
                keyframe.dataset.characterId = characterId;
                keyframe.dataset.animation = animation;
                keyframe.title = `${time}s - ${animation}`;
                
                keyframe.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.selectKeyframe(keyframe);
                });
                
                keyframe.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    this.startKeyframeDrag(keyframe, e);
                });
                
                // ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å¤‰æ›´
                keyframe.addEventListener('dblclick', (e) => {
                    e.stopPropagation();
                    this.editKeyframeAnimation(keyframe);
                });
                
                const keyframeId = `${characterId}-${time}`;
                this.keyframes.set(keyframeId, {
                    element: keyframe,
                    time: time,
                    characterId: characterId,
                    animation: animation
                });
                
                return keyframe;
            }
            
            selectKeyframe(keyframe) {
                // å‰ã®é¸æŠã‚’è§£é™¤
                if (this.selectedKeyframe) {
                    this.selectedKeyframe.classList.remove('selected');
                }
                
                // æ–°ã—ã„ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ é¸æŠ
                this.selectedKeyframe = keyframe;
                keyframe.classList.add('selected');
                
                const time = parseFloat(keyframe.dataset.time);
                const characterId = keyframe.dataset.characterId;
                const animation = keyframe.dataset.animation || 'idle';
                
                // è©³ç´°æƒ…å ±è¡¨ç¤ºæ›´æ–°
                this.updateKeyframeDetails(time, characterId, animation);
                
                console.log(`ğŸ¯ ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ é¸æŠ: ${characterId} at ${time}s (${animation})`);
            }
            
            updateKeyframeDetails(time, characterId, animation) {
                const detailsContent = document.getElementById('details-content');
                
                detailsContent.innerHTML = `
                    <div class="keyframe-property">
                        <span class="property-label">ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼:</span>
                        <span class="property-value">${characterId}</span>
                    </div>
                    <div class="keyframe-property">
                        <span class="property-label">æ™‚é–“:</span>
                        <span class="property-value">${time.toFixed(1)}s</span>
                    </div>
                    <div class="keyframe-property">
                        <span class="property-label">ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³:</span>
                        <span class="property-value">${animation}</span>
                    </div>
                    <div class="keyframe-property">
                        <span class="property-label">æ“ä½œ:</span>
                        <span class="property-value">ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã§ç·¨é›†</span>
                    </div>
                `;
            }
            
            editKeyframeAnimation(keyframe) {
                const currentAnimation = keyframe.dataset.animation || 'idle';
                const selector = document.getElementById('animation-selector');
                
                // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚°ï¼ˆç°¡æ˜“ç‰ˆï¼‰
                const newAnimation = prompt(`ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å¤‰æ›´ (ç¾åœ¨: ${currentAnimation})`, currentAnimation);
                
                if (newAnimation && newAnimation !== currentAnimation) {
                    keyframe.dataset.animation = newAnimation;
                    keyframe.title = `${keyframe.dataset.time}s - ${newAnimation}`;
                    
                    // ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿æ›´æ–°
                    const keyframeId = `${keyframe.dataset.characterId}-${keyframe.dataset.time}`;
                    const keyframeData = this.keyframes.get(keyframeId);
                    if (keyframeData) {
                        keyframeData.animation = newAnimation;
                    }
                    
                    // è©³ç´°è¡¨ç¤ºæ›´æ–°
                    if (this.selectedKeyframe === keyframe) {
                        this.updateKeyframeDetails(
                            parseFloat(keyframe.dataset.time),
                            keyframe.dataset.characterId,
                            newAnimation
                        );
                    }
                    
                    console.log(`ğŸ¨ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å¤‰æ›´: ${keyframe.dataset.characterId} -> ${newAnimation}`);
                }
            }
            
            startKeyframeDrag(keyframe, startEvent) {
                const timeline = keyframe.parentElement;
                const timelineRect = timeline.getBoundingClientRect();
                
                const onMouseMove = (e) => {
                    const x = e.clientX - timelineRect.left;
                    const percentage = Math.max(0, Math.min(100, (x / timelineRect.width) * 100));
                    const newTime = (percentage / 100) * this.maxTime;
                    
                    keyframe.style.left = `${percentage}%`;
                    keyframe.dataset.time = newTime.toFixed(1);
                    keyframe.title = `${newTime.toFixed(1)}s`;
                };
                
                const onMouseUp = () => {
                    document.removeEventListener('mousemove', onMouseMove);
                    document.removeEventListener('mouseup', onMouseUp);
                    
                    const newTime = parseFloat(keyframe.dataset.time);
                    const characterId = keyframe.dataset.characterId;
                    console.log(`âœ… ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ç§»å‹•å®Œäº†: ${characterId} to ${newTime}s`);
                };
                
                document.addEventListener('mousemove', onMouseMove);
                document.addEventListener('mouseup', onMouseUp);
            }
            
            addKeyframe() {
                const activeTrack = Array.from(this.characterTracks.keys())[0]; // æœ€åˆã®ãƒˆãƒ©ãƒƒã‚¯
                if (!activeTrack) return;
                
                // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é¸æŠ
                const animationSelector = document.getElementById('animation-selector');
                const selectedAnimation = animationSelector.value;
                
                const trackData = this.characterTracks.get(activeTrack);
                const timeline = trackData.element.querySelector('.track-timeline');
                
                const keyframe = this.createKeyframe(this.currentTime, activeTrack, selectedAnimation);
                timeline.appendChild(keyframe);
                
                // è¿½åŠ ã—ãŸã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’è‡ªå‹•é¸æŠ
                this.selectKeyframe(keyframe);
                
                console.log(`â• ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ è¿½åŠ : ${activeTrack} at ${this.currentTime}s (${selectedAnimation})`);
            }
            
            deleteSelectedKeyframe() {
                if (!this.selectedKeyframe) {
                    console.log('âš ï¸ å‰Šé™¤ã™ã‚‹ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“');
                    return;
                }
                
                const time = this.selectedKeyframe.dataset.time;
                const characterId = this.selectedKeyframe.dataset.characterId;
                
                this.selectedKeyframe.remove();
                this.keyframes.delete(`${characterId}-${time}`);
                this.selectedKeyframe = null;
                
                console.log(`ğŸ—‘ï¸ ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ å‰Šé™¤: ${characterId} at ${time}s`);
            }
            
            updateTimeDisplay() {
                const timeDisplay = document.getElementById('current-time-display');
                timeDisplay.textContent = `${this.currentTime.toFixed(1)}s`;
            }
            
            updatePlayhead() {
                const playhead = document.getElementById('timeline-playhead');
                const percentage = (this.currentTime / this.maxTime) * 100;
                playhead.style.left = `${Math.max(0, Math.min(100, percentage))}%`;
            }
            
            startUpdateLoop() {
                const update = () => {
                    if (this.isPlaying) {
                        this.currentTime += 0.016 * this.playbackSpeed; // 60fps
                        if (this.currentTime >= this.maxTime) {
                            this.currentTime = this.maxTime;
                            this.isPlaying = false;
                        }
                        
                        // UIæ›´æ–°
                        const scrubber = document.getElementById('timeline-scrubber');
                        scrubber.value = this.currentTime;
                        this.updateTimeDisplay();
                        this.updatePlayhead();
                        
                        // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°
                        this.updateRealtimePreview();
                    }
                    
                    requestAnimationFrame(update);
                };
                
                update();
            }
            
            // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½
            updateRealtimePreview() {
                // ç¾åœ¨æ™‚é–“ã§ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’æ¤œç´¢
                const activeAnimations = this.getActiveAnimations(this.currentTime);
                
                // ãƒ‡ãƒãƒƒã‚°æƒ…å ±æ›´æ–°
                this.updateDebugInfo(activeAnimations);
                
                // å®Ÿé¨“ç’°å¢ƒã®è¡¨ç¤ºæ›´æ–°
                this.updateCharacterPreview(activeAnimations);
            }
            
            getActiveAnimations(currentTime) {
                const activeAnimations = new Map();
                
                // å…¨ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚’ã‚¹ã‚­ãƒ£ãƒ³
                for (const [characterId, trackData] of this.characterTracks) {
                    const keyframeElements = trackData.element.querySelectorAll('.keyframe');
                    let activeAnimation = 'idle'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
                    let closestTime = -1;
                    
                    // ç¾åœ¨æ™‚é–“ã‚ˆã‚Šå‰ã®æœ€ã‚‚è¿‘ã„ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’æ¤œç´¢
                    keyframeElements.forEach(keyframeEl => {
                        const keyframeTime = parseFloat(keyframeEl.dataset.time);
                        const animation = keyframeEl.dataset.animation || 'idle';
                        
                        if (keyframeTime <= currentTime && keyframeTime > closestTime) {
                            closestTime = keyframeTime;
                            activeAnimation = animation;
                        }
                    });
                    
                    activeAnimations.set(characterId, {
                        animation: activeAnimation,
                        keyframeTime: closestTime,
                        isActive: closestTime >= 0
                    });
                }
                
                return activeAnimations;
            }
            
            updateDebugInfo(activeAnimations) {
                const debugTimeline = document.getElementById('debug-timeline');
                const debugAnimation = document.getElementById('debug-animation');
                
                if (debugTimeline) {
                    debugTimeline.textContent = this.isPlaying ? 'å†ç”Ÿä¸­' : 'åœæ­¢ä¸­';
                }
                
                if (debugAnimation) {
                    const animationList = [];
                    for (const [characterId, data] of activeAnimations) {
                        if (data.isActive) {
                            animationList.push(`${characterId}:${data.animation}`);
                        }
                    }
                    debugAnimation.textContent = animationList.length > 0 ? animationList.join(', ') : 'æœªè¨­å®š';
                }
            }
            
            updateCharacterPreview(activeAnimations) {
                // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¡¨ç¤ºã‚¨ãƒªã‚¢ã«ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªçŠ¶æ…‹ã‚’åæ˜ 
                const characterArea = document.getElementById('spine-character-area');
                
                // ç¾åœ¨ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’è¦–è¦šçš„ã«è¡¨ç¤º
                let statusText = '';
                for (const [characterId, data] of activeAnimations) {
                    if (data.isActive) {
                        const emoji = characterId === 'purattokun' ? 'ğŸ±' : 'ğŸ­';
                        statusText += `${emoji} ${data.animation} `;
                    }
                }
                
                // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºã®æ›´æ–°
                const existingStatus = characterArea.querySelector('.animation-status');
                if (existingStatus) {
                    existingStatus.textContent = statusText || 'ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å¾…æ©Ÿä¸­';
                } else {
                    const statusDiv = document.createElement('div');
                    statusDiv.className = 'animation-status';
                    statusDiv.style.cssText = `
                        position: absolute;
                        bottom: 20px;
                        left: 50%;
                        transform: translateX(-50%);
                        background: rgba(0,0,0,0.8);
                        color: white;
                        padding: 10px 20px;
                        border-radius: 20px;
                        font-size: 1.1rem;
                        font-weight: bold;
                        z-index: 100;
                    `;
                    statusDiv.textContent = statusText || 'ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å¾…æ©Ÿä¸­';
                    characterArea.appendChild(statusDiv);
                }
            }
            
            // ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³å®Ÿè¡Œåˆ¶å¾¡ã®æ”¹è‰¯
            play() {
                this.isPlaying = true;
                console.log('â–¶ï¸ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³å†ç”Ÿé–‹å§‹');
            }
            
            pause() {
                this.isPlaying = false;
                console.log('â¸ï¸ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ä¸€æ™‚åœæ­¢');
            }
            
            stop() {
                this.isPlaying = false;
                this.currentTime = 0;
                
                const scrubber = document.getElementById('timeline-scrubber');
                if (scrubber) scrubber.value = 0;
                
                this.updateTimeDisplay();
                this.updatePlayhead();
                this.updateRealtimePreview();
                
                console.log('â¹ï¸ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³åœæ­¢ãƒ»ãƒªã‚»ãƒƒãƒˆ');
            }
            
            reset() {
                this.stop();
                console.log('ğŸ”„ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³å®Œå…¨ãƒªã‚»ãƒƒãƒˆ');
            }
        }

        // å®Ÿé¨“ç’°å¢ƒåˆæœŸåŒ–
        class TimelineExperimentEnvironment {
            constructor() {
                this.isInitialized = false;
                this.activeTimelines = new Map();
                this.frameCount = 0;
                this.startTime = Date.now();
                this.visualEditor = null; // Phase 2 è¿½åŠ 
                
                this.init();
            }
            
            async init() {
                try {
                    // æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å¾…æ©Ÿ
                    await this.waitForSpineSystem();
                    
                    // UIåˆæœŸåŒ–
                    this.setupUI();
                    
                    // Phase 2: Visual Timeline Editor åˆæœŸåŒ–
                    this.visualEditor = new VisualTimelineEditor();
                    this.visualEditor.init();
                    
                    // ãƒ•ãƒ¬ãƒ¼ãƒ æ›´æ–°é–‹å§‹
                    this.startFrameUpdate();
                    
                    this.updateStatus('ã‚·ã‚¹ãƒ†ãƒ æº–å‚™å®Œäº†', 'success');
                    this.isInitialized = true;
                    
                } catch (error) {
                    console.error('âŒ Timelineå®Ÿé¨“ç’°å¢ƒåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                    this.updateStatus('åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼', 'error');
                }
            }
            
            async waitForSpineSystem() {
                // æ—¢å­˜Spineã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–å¾…æ©Ÿ
                return new Promise((resolve, reject) => {
                    let attempts = 0;
                    const maxAttempts = 50;
                    
                    const checkSystem = () => {
                        // ã‚ˆã‚ŠæŸ”è»ŸãªåˆæœŸåŒ–ç¢ºèªï¼ˆæ®µéšçš„ãƒã‚§ãƒƒã‚¯ï¼‰
                        const hasSpine = window.spine || window.SpineWebGL;
                        const hasCharacterManager = window.SpineCharacterManager || window.spineCharacterManager;
                        const hasTimelineEngine = window.TimelineControlEngine;
                        
                        console.log('ğŸ” ã‚·ã‚¹ãƒ†ãƒ ç¢ºèª:', {
                            spine: !!hasSpine,
                            characterManager: !!hasCharacterManager,
                            timelineEngine: !!hasTimelineEngine,
                            attempt: attempts
                        });
                        
                        if (hasSpine && (hasCharacterManager || attempts > 30)) {
                            console.log('âœ… Spineã‚·ã‚¹ãƒ†ãƒ ç¢ºèªå®Œäº†ï¼ˆæŸ”è»Ÿãƒ¢ãƒ¼ãƒ‰ï¼‰');
                            resolve();
                        } else if (attempts >= maxAttempts) {
                            console.log('âš ï¸ ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ - éƒ¨åˆ†åˆæœŸåŒ–ã§ç¶™ç¶š');
                            resolve(); // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚ã‚‚resolveã—ã¦ç¶™ç¶š
                        } else {
                            attempts++;
                            setTimeout(checkSystem, 100);
                        }
                    };
                    
                    checkSystem();
                });
            }
            
            setupUI() {
                // åŸºæœ¬åˆ¶å¾¡ãƒœã‚¿ãƒ³ï¼ˆVisual Editorçµ±åˆãƒ»æ”¹è‰¯ç‰ˆï¼‰
                document.getElementById('play-timeline').addEventListener('click', () => {
                    if (this.visualEditor) {
                        this.visualEditor.play();
                    }
                    this.updateTimelineDisplay('å†ç”Ÿé–‹å§‹');
                });
                
                document.getElementById('pause-timeline').addEventListener('click', () => {
                    if (this.visualEditor) {
                        this.visualEditor.pause();
                    }
                    this.updateTimelineDisplay('ä¸€æ™‚åœæ­¢');
                });
                
                document.getElementById('stop-timeline').addEventListener('click', () => {
                    this.frameCount = 0;
                    if (this.visualEditor) {
                        this.visualEditor.stop();
                    }
                    this.updateTimelineDisplay('åœæ­¢ãƒ»ãƒªã‚»ãƒƒãƒˆ');
                });
                
                document.getElementById('reset-timeline').addEventListener('click', () => {
                    this.frameCount = 0;
                    this.startTime = Date.now();
                    if (this.visualEditor) {
                        this.visualEditor.reset();
                    }
                    this.updateTimelineDisplay('å®Œå…¨ãƒªã‚»ãƒƒãƒˆå®Œäº†');
                });
                
                // ã‚µãƒ³ãƒ—ãƒ«å®Ÿè¡Œãƒœã‚¿ãƒ³
                document.getElementById('sample-basic').addEventListener('click', () => {
                    this.runSampleTimeline('basic');
                });
                
                document.getElementById('sample-complex').addEventListener('click', () => {
                    this.runSampleTimeline('complex');
                });
                
                document.getElementById('sample-sync').addEventListener('click', () => {
                    this.runSampleTimeline('sync');
                });
                
                // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åˆ¶å¾¡
                document.getElementById('load-purattokun').addEventListener('click', () => {
                    console.log('ğŸ± ã·ã‚‰ã£ã¨ãã‚“èª­ã¿è¾¼ã¿');
                    this.updateTimelineDisplay('ã·ã‚‰ã£ã¨ãã‚“èª­ã¿è¾¼ã¿å®Ÿè¡Œ');
                });
                
                document.getElementById('load-nezumi').addEventListener('click', () => {
                    console.log('ğŸ­ ã­ãšã¿èª­ã¿è¾¼ã¿');
                    this.updateTimelineDisplay('ã­ãšã¿èª­ã¿è¾¼ã¿å®Ÿè¡Œ');
                });
                
                document.getElementById('clear-characters').addEventListener('click', () => {
                    console.log('âŒ å…¨ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å‰Šé™¤');
                    this.updateTimelineDisplay('å…¨ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å‰Šé™¤');
                });
            }
            
            startFrameUpdate() {
                const updateFrame = () => {
                    this.frameCount++;
                    const currentTime = (Date.now() - this.startTime) / 1000;
                    
                    // ãƒ‡ãƒãƒƒã‚°æƒ…å ±æ›´æ–°
                    const currentFrameEl = document.getElementById('current-frame');
                    const debugTimeEl = document.getElementById('debug-time');
                    
                    if (currentFrameEl) currentFrameEl.textContent = this.frameCount;
                    if (debugTimeEl) debugTimeEl.textContent = currentTime.toFixed(2) + 's';
                    
                    requestAnimationFrame(updateFrame);
                };
                
                updateFrame();
            }
            
            runSampleTimeline(type) {
                const sampleData = {
                    'basic': 'åŸºæœ¬æ¼”å‡º: å‡ºç¾â†’å¾…æ©Ÿâ†’æ‰‹æŒ¯ã‚Šâ†’å¾…æ©Ÿ',
                    'complex': 'è¤‡é›‘æ¼”å‡º: å‡ºç¾â†’æ­©è¡Œâ†’ã‚¸ãƒ£ãƒ³ãƒ—â†’æ‰‹æŒ¯ã‚Šâ†’ãƒ€ãƒ³ã‚¹â†’ãŠè¾å„€â†’å¾…æ©Ÿ',
                    'sync': 'åŒæœŸæ¼”å‡º: è¤‡æ•°ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®é€£æºå‹•ä½œ'
                };
                
                console.log(`ğŸ¬ ${sampleData[type]} å®Ÿè¡Œ`);
                this.updateTimelineDisplay(`å®Ÿè¡Œ: ${sampleData[type]}`);
                
                // å®Ÿéš›ã®ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³å®Ÿè¡Œã¯Phase 1å®Œäº†å¾Œã«å®Ÿè£…
            }
            
            updateStatus(message, type = 'info') {
                document.getElementById('system-status').textContent = message;
                
                // è‰²åˆ†ã‘
                const statusElement = document.getElementById('system-status');
                statusElement.style.color = {
                    'success': '#48bb78',
                    'error': '#e53e3e',
                    'warning': '#ed8936',
                    'info': '#667eea'
                }[type] || '#667eea';
            }
            
            updateTimelineDisplay(message) {
                const display = document.getElementById('timeline-display');
                const timestamp = new Date().toLocaleTimeString();
                display.innerHTML += `<div>[${timestamp}] ${message}</div>`;
                display.scrollTop = display.scrollHeight;
            }
        }

        // ========== ğŸ¯ å¢ƒç•Œãƒœãƒƒã‚¯ã‚¹é«˜åº¦é€£æºãƒ†ã‚¹ãƒˆé–¢æ•°ç¾¤ ========== //

        /**
         * ç²¾å¯†ã‚¯ãƒªãƒƒã‚¯åˆ¤å®šãƒ†ã‚¹ãƒˆ
         */
        function testPrecisionClick() {
            const resultsDiv = document.getElementById('bounds-test-results');
            
            try {
                if (window.timelineBoundsAdvanced) {
                    // æ¨¡æ“¬ç²¾å¯†ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆç”Ÿæˆ
                    const mockEvent = {
                        characterId: 'purattokun',
                        position: { x: 150, y: 100 },
                        clickType: 'precise_click',
                        boundingData: window.timelineBoundsAdvanced.getMockBoundingData('purattokun')
                    };
                    
                    window.timelineBoundsAdvanced.handlePreciseClick(mockEvent);
                    resultsDiv.innerHTML = `âœ… ç²¾å¯†ã‚¯ãƒªãƒƒã‚¯åˆ¤å®šãƒ†ã‚¹ãƒˆå®Ÿè¡Œ<br><small>ä½ç½®: (${mockEvent.position.x}, ${mockEvent.position.y}), ã‚­ãƒ£ãƒ©: ${mockEvent.characterId}</small>`;
                    console.log('ğŸ¯ ç²¾å¯†ã‚¯ãƒªãƒƒã‚¯åˆ¤å®šãƒ†ã‚¹ãƒˆå®Ÿè¡Œå®Œäº†');
                    
                } else {
                    resultsDiv.innerHTML = 'âŒ timelineBoundsAdvanced ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“';
                }
            } catch (error) {
                resultsDiv.innerHTML = `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`;
                console.error('ç²¾å¯†ã‚¯ãƒªãƒƒã‚¯åˆ¤å®šãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        /**
         * ã‚¾ãƒ¼ãƒ³åˆ¥æ¼”å‡ºãƒ†ã‚¹ãƒˆ
         */
        function testZonePerformances() {
            const resultsDiv = document.getElementById('bounds-test-results');
            
            try {
                if (window.timelineBoundsAdvanced) {
                    const zones = ['head', 'body', 'tail', 'paws'];
                    const testZone = zones[Math.floor(Math.random() * zones.length)];
                    
                    // ã‚¾ãƒ¼ãƒ³æ¼”å‡ºãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
                    const testResult = window.timelineBoundsAdvanced.getZonePerformances('purattokun', testZone);
                    
                    if (testResult) {
                        resultsDiv.innerHTML = `âœ… ã‚¾ãƒ¼ãƒ³æ¼”å‡ºãƒ†ã‚¹ãƒˆ: ${testZone}<br><small>æ¼”å‡º: ${testResult.performances.join(', ')}</small>`;
                        console.log(`ğŸ­ ã‚¾ãƒ¼ãƒ³æ¼”å‡ºãƒ†ã‚¹ãƒˆå®Œäº†: ${testZone}`, testResult);
                        
                        // å®Ÿéš›ã®æ¼”å‡ºå®Ÿè¡Œã‚‚ãƒ†ã‚¹ãƒˆ
                        window.timelineBoundsAdvanced.executeZonePerformance('purattokun', testZone, {
                            name: testResult.performances[0],
                            sequence: testResult.performances[0]
                        });
                        
                    } else {
                        resultsDiv.innerHTML = `âš ï¸ ã‚¾ãƒ¼ãƒ³æ¼”å‡ºãƒ‡ãƒ¼ã‚¿ãªã—: ${testZone}`;
                    }
                } else {
                    resultsDiv.innerHTML = 'âŒ timelineBoundsAdvanced ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“';
                }
            } catch (error) {
                resultsDiv.innerHTML = `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`;
                console.error('ã‚¾ãƒ¼ãƒ³åˆ¥æ¼”å‡ºãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        /**
         * é€£æºæ¼”å‡ºãƒ†ã‚¹ãƒˆ
         */
        function testSynergyPerformances() {
            const resultsDiv = document.getElementById('bounds-test-results');
            
            try {
                if (window.timelineBoundsAdvanced) {
                    // purattokun â†’ nezumi é€£æºæ¼”å‡ºãƒ†ã‚¹ãƒˆ
                    window.timelineBoundsAdvanced.executeSynergyPerformance('purattokun', 'head', ['nezumi_attention']);
                    
                    resultsDiv.innerHTML = 'âœ… é€£æºæ¼”å‡ºãƒ†ã‚¹ãƒˆå®Ÿè¡Œ<br><small>purattokun[head] â†’ nezumi[attention]</small>';
                    console.log('ğŸ¤ é€£æºæ¼”å‡ºãƒ†ã‚¹ãƒˆå®Ÿè¡Œå®Œäº†');
                    
                } else {
                    resultsDiv.innerHTML = 'âŒ timelineBoundsAdvanced ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“';
                }
            } catch (error) {
                resultsDiv.innerHTML = `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`;
                console.error('é€£æºæ¼”å‡ºãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        /**
         * ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³å±¥æ­´ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ
         */
        function testInteractionHistory() {
            const resultsDiv = document.getElementById('bounds-test-results');
            
            try {
                if (window.timelineBoundsAdvanced) {
                    // å±¥æ­´ãƒ‡ãƒ¼ã‚¿æ›´æ–°ãƒ†ã‚¹ãƒˆ
                    window.timelineBoundsAdvanced.updateInteractionHistory('purattokun', {
                        zone: 'head',
                        clickType: 'gentle_click',
                        timestamp: Date.now(),
                        position: { x: 120, y: 80 }
                    });
                    
                    // å±¥æ­´ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»è¡¨ç¤º
                    const context = window.timelineBoundsAdvanced.getInteractionContext('purattokun');
                    
                    resultsDiv.innerHTML = `âœ… å±¥æ­´ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆå®Œäº†<br><small>ç·ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³æ•°: ${context.totalInteractions}, æœ€æ–°: ${context.lastInteraction ? context.lastInteraction.zone : 'ãªã—'}</small>`;
                    console.log('ğŸ“š å±¥æ­´ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆå®Œäº†', context);
                    
                } else {
                    resultsDiv.innerHTML = 'âŒ timelineBoundsAdvanced ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“';
                }
            } catch (error) {
                resultsDiv.innerHTML = `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`;
                console.error('å±¥æ­´ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        /**
         * å¢ƒç•Œã‚¾ãƒ¼ãƒ³å¯è¦–åŒ–
         */
        function visualizeBoundingZones() {
            const resultsDiv = document.getElementById('bounds-test-results');
            
            try {
                // ç°¡æ˜“å¯è¦–åŒ–æƒ…å ±è¡¨ç¤º
                const zoneInfo = {
                    purattokun: ['head', 'body', 'tail', 'paws'],
                    nezumi: ['head', 'whiskers', 'tail']
                };
                
                let visualizationHtml = 'âœ… å¢ƒç•Œã‚¾ãƒ¼ãƒ³æƒ…å ±:<br>';
                Object.entries(zoneInfo).forEach(([char, zones]) => {
                    visualizationHtml += `<small>${char}: ${zones.join(', ')}</small><br>`;
                });
                
                resultsDiv.innerHTML = visualizationHtml;
                console.log('ğŸ¯ å¢ƒç•Œã‚¾ãƒ¼ãƒ³å¯è¦–åŒ–å®Œäº†', zoneInfo);
                
                // å®Ÿéš›ã®Canvasä¸Šã«å¢ƒç•Œã‚’æç”»ã™ã‚‹æ©Ÿèƒ½ã¯å°†æ¥å®Ÿè£…
                
            } catch (error) {
                resultsDiv.innerHTML = `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`;
                console.error('å¢ƒç•Œã‚¾ãƒ¼ãƒ³å¯è¦–åŒ–ã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        /**
         * çµ±åˆçŠ¶æ…‹ç¢ºèª
         */
        function debugBoundsIntegration() {
            const resultsDiv = document.getElementById('bounds-test-results');
            
            try {
                const integrationStatus = {
                    timelineBoundsAdvanced: !!window.timelineBoundsAdvanced,
                    indexBoundsManager: !!window.indexBoundsManager,
                    timelineControlEngine: !!window.timelineControlEngine,
                    complexSequenceManager: !!window.complexSequenceManager,
                    advancedCharacterSyncController: !!window.advancedCharacterSyncController
                };
                
                let statusHtml = 'ğŸ” çµ±åˆçŠ¶æ…‹ç¢ºèª:<br>';
                Object.entries(integrationStatus).forEach(([system, status]) => {
                    const statusIcon = status ? 'âœ…' : 'âŒ';
                    statusHtml += `<small>${statusIcon} ${system}</small><br>`;
                });
                
                // çµ±åˆã‚·ã‚¹ãƒ†ãƒ ã®è©³ç´°æƒ…å ±
                if (window.timelineBoundsAdvanced) {
                    const zoneCount = window.timelineBoundsAdvanced.zonePerformanceMap.size;
                    statusHtml += `<small>ğŸ“Š ç™»éŒ²ã‚¾ãƒ¼ãƒ³æ•°: ${zoneCount}</small><br>`;
                }
                
                resultsDiv.innerHTML = statusHtml;
                console.log('ğŸ” å¢ƒç•Œãƒœãƒƒã‚¯ã‚¹çµ±åˆçŠ¶æ…‹ç¢ºèªå®Œäº†', integrationStatus);
                
                // ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã‚‚ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å‡ºåŠ›
                if (window.timelineBoundsAdvanced) {
                    console.log('ğŸ¯ TimelineBoundsAdvanced:', window.timelineBoundsAdvanced);
                    console.log('ğŸ—ºï¸ Zone Performance Map:', window.timelineBoundsAdvanced.zonePerformanceMap);
                }
                
            } catch (error) {
                resultsDiv.innerHTML = `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`;
                console.error('çµ±åˆçŠ¶æ…‹ç¢ºèªã‚¨ãƒ©ãƒ¼:', error);
            }
        }
        
        // ========== ğŸš€ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–åˆ¶å¾¡é–¢æ•°ç¾¤ ========== //
        
        /**
         * ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–é–‹å§‹
         */
        function startPerformanceOptimization() {
            const resultsDiv = document.getElementById('performance-results');
            
            try {
                if (window.timelinePerformanceOptimizer) {
                    window.timelinePerformanceOptimizer.startOptimization();
                    resultsDiv.innerHTML = 'âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–é–‹å§‹<br><small>FPSãƒ»ãƒ¡ãƒ¢ãƒªãƒ»CPUè² è·ã‚’ç›£è¦–ä¸­</small>';
                    
                    // UIæ›´æ–°ã‚’é–‹å§‹
                    startPerformanceUIUpdate();
                    
                    console.log('ğŸš€ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–é–‹å§‹');
                } else {
                    resultsDiv.innerHTML = 'âŒ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã‚·ã‚¹ãƒ†ãƒ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“';
                }
            } catch (error) {
                resultsDiv.innerHTML = `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`;
                console.error('ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–é–‹å§‹ã‚¨ãƒ©ãƒ¼:', error);
            }
        }
        
        /**
         * ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–åœæ­¢
         */
        function stopPerformanceOptimization() {
            const resultsDiv = document.getElementById('performance-results');
            
            try {
                if (window.timelinePerformanceOptimizer) {
                    window.timelinePerformanceOptimizer.stopOptimization();
                    resultsDiv.innerHTML = 'â¹ï¸ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–åœæ­¢<br><small>ç›£è¦–ã‚’åœæ­¢ã—ã¾ã—ãŸ</small>';
                    console.log('â¹ï¸ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–åœæ­¢');
                } else {
                    resultsDiv.innerHTML = 'âŒ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã‚·ã‚¹ãƒ†ãƒ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“';
                }
            } catch (error) {
                resultsDiv.innerHTML = `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`;
                console.error('ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–åœæ­¢ã‚¨ãƒ©ãƒ¼:', error);
            }
        }
        
        /**
         * ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¬ãƒãƒ¼ãƒˆè¡¨ç¤º
         */
        function showPerformanceReport() {
            const resultsDiv = document.getElementById('performance-results');
            
            try {
                const report = window.getPerformanceReport ? window.getPerformanceReport() : null;
                
                if (report) {
                    const current = report.current;
                    resultsDiv.innerHTML = `
                        ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¬ãƒãƒ¼ãƒˆ<br>
                        <small>
                        FPS: ${current.fps} | ãƒ¡ãƒ¢ãƒª: ${(current.memoryUsage / 1024 / 1024).toFixed(1)}MB<br>
                        CPU: ${current.cpuUsage.toFixed(1)}% | ãƒ•ãƒ¬ãƒ¼ãƒ æ™‚é–“: ${current.frameTime.toFixed(2)}ms
                        </small>
                    `;
                    console.log('ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¬ãƒãƒ¼ãƒˆè¡¨ç¤º', report);
                } else {
                    resultsDiv.innerHTML = 'âŒ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã§ãã¾ã›ã‚“';
                }
            } catch (error) {
                resultsDiv.innerHTML = `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`;
                console.error('ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¬ãƒãƒ¼ãƒˆè¡¨ç¤ºã‚¨ãƒ©ãƒ¼:', error);
            }
        }
        
        /**
         * ãƒ¡ãƒ¢ãƒªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Ÿè¡Œ
         */
        function executeMemoryCleanup() {
            const resultsDiv = document.getElementById('performance-results');
            
            try {
                if (window.timelinePerformanceOptimizer) {
                    window.timelinePerformanceOptimizer.executeMemoryCleanup();
                    resultsDiv.innerHTML = 'ğŸ§¹ ãƒ¡ãƒ¢ãƒªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Ÿè¡Œ<br><small>ãƒ¡ãƒ¢ãƒªãƒ—ãƒ¼ãƒ«æ•´ç†ãƒ»ã‚¬ãƒ™ãƒ¼ã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œ</small>';
                    console.log('ğŸ§¹ ãƒ¡ãƒ¢ãƒªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Ÿè¡Œ');
                } else {
                    resultsDiv.innerHTML = 'âŒ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã‚·ã‚¹ãƒ†ãƒ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“';
                }
            } catch (error) {
                resultsDiv.innerHTML = `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`;
                console.error('ãƒ¡ãƒ¢ãƒªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚¨ãƒ©ãƒ¼:', error);
            }
        }
        
        /**
         * ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹UIæ›´æ–°é–‹å§‹
         */
        function startPerformanceUIUpdate() {
            const updateInterval = setInterval(() => {
                if (!window.timelinePerformanceOptimizer || !window.timelinePerformanceOptimizer.isMonitoring) {
                    clearInterval(updateInterval);
                    return;
                }
                
                const metrics = window.timelinePerformanceOptimizer.performanceMetrics;
                
                // ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡è¡¨ç¤ºæ›´æ–°
                const memoryElement = document.getElementById('memory-usage');
                if (memoryElement && metrics.memoryUsage) {
                    memoryElement.textContent = `${(metrics.memoryUsage / 1024 / 1024).toFixed(1)}MB`;
                }
                
                // CPUè² è·è¡¨ç¤ºæ›´æ–°
                const cpuElement = document.getElementById('cpu-usage');
                if (cpuElement) {
                    cpuElement.textContent = `${metrics.cpuUsage.toFixed(1)}%`;
                }
                
            }, 2000); // 2ç§’é–“éš”ã§æ›´æ–°
        }
        
        // å®Ÿé¨“ç’°å¢ƒåˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ¬ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³åˆ¶å¾¡ã‚·ã‚¹ãƒ†ãƒ å®Ÿé¨“ç’°å¢ƒ åˆæœŸåŒ–é–‹å§‹');
            window.timelineExperiment = new TimelineExperimentEnvironment();
        });
    </script>
</body>
</html>