<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canvas/WebGL è¨ºæ–­ãƒ—ãƒ­ãƒ¼ãƒ–</title>
    <style>
        body { font-family: 'Courier New', monospace; padding: 20px; background: #1a1a1a; color: #00ff00; }
        pre { background: #000; padding: 15px; border-radius: 5px; overflow-x: auto; }
        .success { color: #00ff00; }
        .error { color: #ff4444; }
        .warning { color: #ffaa00; }
        canvas { border: 2px solid #444; margin: 10px 0; }
        h1 { color: #ffffff; }
        h2 { color: #88ccff; }
    </style>
</head>
<body>
    <h1>ğŸ” Canvas/WebGL è¨ºæ–­ãƒ—ãƒ­ãƒ¼ãƒ–</h1>
    <pre id="log"></pre>
    
    <h2>ãƒ†ã‚¹ãƒˆç”¨Canvas:</h2>
    <canvas id="test-canvas" width="300" height="200"></canvas>
    
    <script>
        const log = (...args) => {
            const timestamp = new Date().toLocaleTimeString();
            const message = `[${timestamp}] ${args.join(' ')}`;
            document.getElementById('log').textContent += message + '\n';
            console.log(...args);
        };

        const logSuccess = (...args) => {
            const span = document.createElement('span');
            span.className = 'success';
            span.textContent = `[${new Date().toLocaleTimeString()}] âœ… ${args.join(' ')}\n`;
            document.getElementById('log').appendChild(span);
            console.log('âœ…', ...args);
        };

        const logError = (...args) => {
            const span = document.createElement('span');
            span.className = 'error';
            span.textContent = `[${new Date().toLocaleTimeString()}] âŒ ${args.join(' ')}\n`;
            document.getElementById('log').appendChild(span);
            console.error('âŒ', ...args);
        };

        const logWarning = (...args) => {
            const span = document.createElement('span');
            span.className = 'warning';
            span.textContent = `[${new Date().toLocaleTimeString()}] âš ï¸ ${args.join(' ')}\n`;
            document.getElementById('log').appendChild(span);
            console.warn('âš ï¸', ...args);
        };

        // ğŸ” åŸºæœ¬ç’°å¢ƒæƒ…å ±
        log('=== åŸºæœ¬ç’°å¢ƒæƒ…å ± ===');
        log('User Agent:', navigator.userAgent);
        log('Platform:', navigator.platform);
        log('æ˜¯å¦Electron:', navigator.userAgent.includes('Electron') ? 'Yes' : 'No');
        
        // ãƒ—ãƒ­ãƒˆã‚³ãƒ«ç¢ºèª
        log('Protocol:', window.location.protocol);
        log('Host:', window.location.host || 'local file');
        
        log('\n=== CanvasåŸºæœ¬ãƒ†ã‚¹ãƒˆ ===');

        // Canvasè¦ç´ ä½œæˆãƒ†ã‚¹ãƒˆ
        let testCanvas;
        try {
            testCanvas = document.createElement('canvas');
            testCanvas.width = 256;
            testCanvas.height = 256;
            document.body.appendChild(testCanvas);
            logSuccess('Canvasè¦ç´ ä½œæˆæˆåŠŸ');
        } catch (error) {
            logError('Canvasè¦ç´ ä½œæˆå¤±æ•—:', error.message);
        }

        // Canvas 2D ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ†ã‚¹ãƒˆ
        let ctx2d = null;
        if (testCanvas) {
            try {
                ctx2d = testCanvas.getContext('2d');
                if (ctx2d) {
                    logSuccess('Canvas 2D ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå–å¾—æˆåŠŸ');
                    
                    // 2Dæç”»ãƒ†ã‚¹ãƒˆ
                    try {
                        ctx2d.fillStyle = '#ff0000';
                        ctx2d.fillRect(10, 10, 50, 50);
                        ctx2d.fillStyle = '#00ff00';
                        ctx2d.fillText('2D OK', 70, 30);
                        logSuccess('Canvas 2D æç”»ãƒ†ã‚¹ãƒˆæˆåŠŸ');
                    } catch (drawError) {
                        logError('Canvas 2D æç”»ãƒ†ã‚¹ãƒˆå¤±æ•—:', drawError.message);
                    }
                } else {
                    logError('Canvas 2D ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå–å¾—å¤±æ•—: null');
                }
            } catch (error) {
                logError('Canvas 2D ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå–å¾—ã‚¨ãƒ©ãƒ¼:', error.message);
            }
        }

        log('\n=== WebGL ãƒ†ã‚¹ãƒˆ ===');

        // WebGL ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ†ã‚¹ãƒˆ
        let gl = null;
        let gl2 = null;
        
        if (testCanvas) {
            // WebGL 2.0 ãƒ†ã‚¹ãƒˆ
            try {
                gl2 = testCanvas.getContext('webgl2');
                if (gl2) {
                    logSuccess('WebGL 2.0 ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå–å¾—æˆåŠŸ');
                    log('WebGL 2.0 Version:', gl2.getParameter(gl2.VERSION));
                    log('WebGL 2.0 Renderer:', gl2.getParameter(gl2.RENDERER));
                    log('WebGL 2.0 Vendor:', gl2.getParameter(gl2.VENDOR));
                } else {
                    logWarning('WebGL 2.0 ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå–å¾—å¤±æ•—: null');
                }
            } catch (error) {
                logError('WebGL 2.0 ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå–å¾—ã‚¨ãƒ©ãƒ¼:', error.message);
            }

            // WebGL 1.0 ãƒ†ã‚¹ãƒˆ
            try {
                gl = testCanvas.getContext('webgl') || testCanvas.getContext('experimental-webgl');
                if (gl) {
                    logSuccess('WebGL 1.0 ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå–å¾—æˆåŠŸ');
                    log('WebGL 1.0 Version:', gl.getParameter(gl.VERSION));
                    log('WebGL 1.0 Renderer:', gl.getParameter(gl.RENDERER));
                    log('WebGL 1.0 Vendor:', gl.getParameter(gl.VENDOR));
                    log('WebGL 1.0 GLSL Version:', gl.getParameter(gl.SHADING_LANGUAGE_VERSION));
                    
                    // WebGLæç”»ãƒ†ã‚¹ãƒˆ
                    try {
                        gl.clearColor(0.0, 0.5, 1.0, 1.0);
                        gl.clear(gl.COLOR_BUFFER_BIT);
                        logSuccess('WebGL åŸºæœ¬æç”»ãƒ†ã‚¹ãƒˆæˆåŠŸ');
                    } catch (drawError) {
                        logError('WebGL æç”»ãƒ†ã‚¹ãƒˆå¤±æ•—:', drawError.message);
                    }
                } else {
                    logError('WebGL 1.0 ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå–å¾—å¤±æ•—: null');
                }
            } catch (error) {
                logError('WebGL 1.0 ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå–å¾—ã‚¨ãƒ©ãƒ¼:', error.message);
            }
        }

        log('\n=== Spine WebGL ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ†ã‚¹ãƒˆ ===');

        // Spine WebGL ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç¢ºèª
        if (typeof spine !== 'undefined') {
            logSuccess('Spine WebGL ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ¤œå‡º');
            log('Spine ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ:', Object.keys(spine));
            
            if (spine.AssetManager) {
                logSuccess('spine.AssetManager åˆ©ç”¨å¯èƒ½');
            } else {
                logError('spine.AssetManager æœªå®šç¾©');
            }
            
            if (spine.SceneRenderer) {
                logSuccess('spine.SceneRenderer åˆ©ç”¨å¯èƒ½');
            } else {
                logError('spine.SceneRenderer æœªå®šç¾©');
            }
            
            // AssetManager ãƒ†ã‚¹ãƒˆï¼ˆWebGLã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒå¿…è¦ï¼‰
            if (gl && spine.AssetManager) {
                try {
                    const assetManager = new spine.AssetManager(gl, './');
                    logSuccess('spine.AssetManager ä½œæˆæˆåŠŸ');
                } catch (spineError) {
                    logError('spine.AssetManager ä½œæˆå¤±æ•—:', spineError.message);
                }
            }
        } else {
            logWarning('Spine WebGL ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæœªæ¤œå‡º');
        }

        log('\n=== è¨ºæ–­çµæœã‚µãƒãƒªãƒ¼ ===');
        
        const results = {
            'Canvas 2D': !!ctx2d,
            'WebGL 1.0': !!gl,
            'WebGL 2.0': !!gl2,
            'Spine Library': typeof spine !== 'undefined',
            'Protocol': window.location.protocol,
            'Environment': navigator.userAgent.includes('Electron') ? 'Electron' : 'Browser'
        };
        
        Object.entries(results).forEach(([key, value]) => {
            if (typeof value === 'boolean') {
                if (value) {
                    logSuccess(`${key}: OK`);
                } else {
                    logError(`${key}: FAILED`);
                }
            } else {
                log(`${key}: ${value}`);
            }
        });

        // ç·åˆåˆ¤å®š
        const canvasOK = !!ctx2d;
        const webglOK = !!gl || !!gl2;
        
        log('\n=== ç·åˆåˆ¤å®š ===');
        if (canvasOK && webglOK) {
            logSuccess('Canvas/WebGLç’°å¢ƒ: æ­£å¸¸ - Spineè¡¨ç¤ºå¯èƒ½ã¨æ¨æ¸¬');
        } else if (canvasOK && !webglOK) {
            logWarning('Canvas 2D: OK, WebGL: NG - 2Dãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å¯èƒ½');
        } else if (!canvasOK && !webglOK) {
            logError('Canvas/WebGLç’°å¢ƒ: å®Œå…¨å¤±æ•— - æ ¹æœ¬çš„ãªç’°å¢ƒå•é¡Œ');
        } else {
            logWarning('äºˆæœŸã—ãªã„çŠ¶æ³ - è©³ç´°èª¿æŸ»ãŒå¿…è¦');
        }

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨ºæ–­é–¢æ•°
        window.runCanvasProbe = function() {
            window.location.reload();
        };
        
        log('\nğŸ”§ æ‰‹å‹•å†ãƒ†ã‚¹ãƒˆ: runCanvasProbe() ã‚’å®Ÿè¡Œ');
    </script>
</body>
</html>