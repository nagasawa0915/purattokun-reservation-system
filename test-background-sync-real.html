<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¢ ç¸¦æ¨ªæ¯”å•é¡Œè§£æ±ºãƒ»å®Ÿç”¨Spineãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ãƒ†ã‚¹ãƒˆ</title>
    <style>
        /* åŸºæœ¬ãƒªã‚»ãƒƒãƒˆ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #f0f0f0;
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        .test-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .test-header h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .test-header p {
            color: #666;
            font-size: 14px;
        }

        /* ğŸ”‘ é‡è¦ï¼šã‚·ãƒ¼ãƒ³ã‚³ãƒ³ãƒ†ãƒŠï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–åŸºæº–ï¼‰ */
        .scene-container {
            position: relative;           /* å­è¦ç´ ã®çµ¶å¯¾ä½ç½®åŸºæº– */
            width: 100%;                 /* ç”»é¢å¹…ã«åˆã‚ã›ã‚‹ */
            max-width: 1200px;           /* æœ€å¤§å¹…åˆ¶é™ */
            margin: 0 auto;              /* ä¸­å¤®å¯„ã› */
            background: white;           
            border-radius: 10px;         
            overflow: hidden;            /* ã¯ã¿å‡ºã—é˜²æ­¢ */
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        /* ğŸ¨ é‡è¦ï¼šèƒŒæ™¯ç”»åƒï¼ˆåŸºæº–ã¨ãªã‚‹è¦ç´ ï¼‰ */
        .background-image {
            width: 100%;                 /* ã‚³ãƒ³ãƒ†ãƒŠå¹…ã«åˆã‚ã›ã‚‹ */
            height: auto;                /* ç¸¦æ¨ªæ¯”ç¶­æŒ */
            display: block;              /* inlineè¦ç´ ã®éš™é–“é™¤å» */
            user-select: none;           /* ãƒ‰ãƒ©ãƒƒã‚°é˜²æ­¢ */
        }

        /* ğŸ® é‡è¦ï¼šSpineã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç”¨Canvasï¼ˆã·ã‚‰ã£ã¨ãã‚“ï¼‰ */
        #purattokun-canvas {
            position: absolute;          /* èƒŒæ™¯ç”»åƒä¸Šã«é‡ã­ã‚‹ */
            left: 35%;                   /* èƒŒæ™¯ç”»åƒåŸºæº–ã®ä½ç½®ï¼ˆèª¿æ•´å¯èƒ½ï¼‰ */
            top: 75%;                    /* èƒŒæ™¯ç”»åƒåŸºæº–ã®ä½ç½®ï¼ˆèª¿æ•´å¯èƒ½ï¼‰ */
            transform: translate(-50%, -50%); /* ä¸­å¤®å¯„ã› */
            width: 25%;                  /* ğŸ”‘ èƒŒæ™¯ç”»åƒã¨åŒã˜æ¯”ä¾‹æ‹¡ç¸® */
            aspect-ratio: 3/2;           /* ğŸ”‘ ç¸¦æ¨ªæ¯”å›ºå®šï¼ˆæ½°ã‚Œé˜²æ­¢ï¼‰ */
            z-index: 10;                 /* å‰é¢è¡¨ç¤º */
            display: none;               /* åˆæœŸã¯éè¡¨ç¤ºï¼ˆJSèª­ã¿è¾¼ã¿å¾Œã«è¡¨ç¤ºï¼‰ */
            cursor: pointer;             /* ã‚¯ãƒªãƒƒã‚¯å¯èƒ½è¡¨ç¤º */
            data-character-name: "purattokun"; /* ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è­˜åˆ¥ç”¨ */
        }

        /* ğŸ“± ãƒ¢ãƒã‚¤ãƒ«ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        @media (max-width: 768px) {
            #purattokun-canvas {
                width: 30%;              /* ãƒ¢ãƒã‚¤ãƒ«ã§å°‘ã—å¤§ãã */
                left: 50%;               /* ä¸­å¤®å¯„ã‚Š */
            }
        }

        /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« */
        .control-panel {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .control-button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .primary-button {
            background: #28a745;
            color: white;
        }
        
        .primary-button:hover {
            background: #218838;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .secondary-button {
            background: #6c757d;
            color: white;
        }
        
        .secondary-button:hover {
            background: #5a6268;
        }
        
        .danger-button {
            background: #dc3545;
            color: white;
        }
        
        .danger-button:hover {
            background: #c82333;
        }

        /* æƒ…å ±ãƒ‘ãƒãƒ« */
        .info-panel {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-success { background: #28a745; }
        .status-warning { background: #ffc107; }
        .status-danger { background: #dc3545; }

        /* ãƒ­ã‚°è¡¨ç¤º */
        .log-container {
            background: #000;
            color: #0f0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            padding: 15px;
            border-radius: 4px;
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
        }

        /* æ©Ÿèƒ½èª¬æ˜ */
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .feature-card {
            background: #fff;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .feature-card h3 {
            margin: 0 0 10px 0;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* ç¸¦æ¨ªæ¯”ãƒ†ã‚¹ãƒˆç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .aspect-test-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 20px 0;
            flex-wrap: wrap;
            justify-content: center;
        }

        .aspect-info {
            background: #e9ecef;
            padding: 10px 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ†ã‚¹ãƒˆç”¨ */
        .responsive-test-info {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 11px;
            z-index: 1000;
            display: none;
        }
    </style>
</head>
<body>
    <div class="test-header">
        <h1>ğŸ¢ ç¸¦æ¨ªæ¯”å•é¡Œè§£æ±ºãƒ»å®Ÿç”¨Spineãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ãƒ†ã‚¹ãƒˆ</h1>
        <p>å®Ÿéš›ã®èƒŒæ™¯ç”»åƒã¨Spineãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ãŸãƒªã‚¢ãƒ«ãªãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã™ã€‚</p>
        <p><strong>ã‚­ãƒ¼æ©Ÿèƒ½:</strong> ç¸¦æ¨ªæ¯”ç¶­æŒãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œãƒ»è‡ªå‹•ãƒ”ãƒ³ã‚·ã‚¹ãƒ†ãƒ </p>
    </div>
    
    <!-- ğŸ¢ ãƒªã‚¢ãƒ«ãªScene Container -->
    <div class="scene-container">
        <!-- å®Ÿéš›ã®èƒŒæ™¯ç”»åƒ -->
        <img src="assets/images/ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼TOP.png" alt="èƒŒæ™¯" class="background-image">
        
        <!-- å®Ÿéš›ã®Spineã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç”¨Canvas -->
        <canvas id="purattokun-canvas"></canvas>
    </div>

    <!-- ç¸¦æ¨ªæ¯”ãƒ†ã‚¹ãƒˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
    <div class="aspect-test-controls">
        <button class="control-button secondary-button" onclick="testAspectRatio()">
            ğŸ“ ç¸¦æ¨ªæ¯”æ¤œè¨¼é–‹å§‹
        </button>
        <button class="control-button secondary-button" onclick="toggleResponsiveInfo()">
            ğŸ“± ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–æƒ…å ±è¡¨ç¤º
        </button>
        <div class="aspect-info" id="aspect-info">
            ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”: æ¸¬å®šä¸­...
        </div>
    </div>

    <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« -->
    <div class="control-panel">
        <button class="control-button primary-button" onclick="initializeSpineAndBB()">
            ğŸ® SpineåˆæœŸåŒ– + ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹
        </button>
        <button class="control-button primary-button" onclick="testBBAutoPin()">
            ğŸ“ è‡ªå‹•ãƒ”ãƒ³ãƒ†ã‚¹ãƒˆ
        </button>
        <button class="control-button secondary-button" onclick="showSystemStatus()">
            âš™ï¸ ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹
        </button>
        <button class="control-button secondary-button" onclick="performResizeTest()">
            ğŸ“ ãƒªã‚µã‚¤ã‚ºãƒ†ã‚¹ãƒˆ
        </button>
        <button class="control-button danger-button" onclick="clearAllData()">
            ğŸ—‘ï¸ å…¨ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢
        </button>
    </div>

    <!-- æ©Ÿèƒ½èª¬æ˜ -->
    <div class="feature-grid">
        <div class="feature-card">
            <h3>ğŸ¢ å®Ÿç’°å¢ƒãƒ†ã‚¹ãƒˆ</h3>
            <p>å®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨åŒã˜æ§‹æˆã§ãƒ†ã‚¹ãƒˆã§ãã¾ã™ï¼š</p>
            <ul>
                <li>å®Ÿéš›ã®èƒŒæ™¯ç”»åƒ: ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼TOP.png</li>
                <li>å®Ÿéš›ã®Spineãƒ‡ãƒ¼ã‚¿: purattokun.json/.atlas/.png</li>
                <li>index.htmlã¨åŒä¸€ã®CSSæ§‹æˆãƒ»aspect-ratioå¯¾å¿œ</li>
                <li>ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³å®Œå…¨å†ç¾</li>
            </ul>
        </div>
        
        <div class="feature-card">
            <h3>ğŸ” ç¸¦æ¨ªæ¯”å•é¡Œè§£æ±º</h3>
            <p>ä»¥ä¸‹ã®æŠ€è¡“ã§ç¸¦æ¨ªæ¯”å•é¡Œã‚’æ ¹æœ¬è§£æ±ºï¼š</p>
            <ul>
                <li><code>aspect-ratio: 3/2</code> ã§Canvasç¸¦æ¨ªæ¯”å›ºå®š</li>
                <li><code>width: 25%</code> ã§èƒŒæ™¯ç”»åƒã¨æ¯”ä¾‹æ‹¡ç¸®</li>
                <li><code>height: auto</code> ã§èƒŒæ™¯ç”»åƒã®ç¸¦æ¨ªæ¯”ç¶­æŒ</li>
                <li>ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ–ãƒ¬ã‚¤ã‚¯ãƒã‚¤ãƒ³ãƒˆã§ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ</li>
            </ul>
        </div>
        
        <div class="feature-card">
            <h3>ğŸ”§ ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹è‡ªå‹•ãƒ”ãƒ³</h3>
            <p>Phase 2ã®é«˜åº¦ãªè‡ªå‹•ãƒ”ãƒ³ã‚·ã‚¹ãƒ†ãƒ ï¼š</p>
            <ul>
                <li>èƒŒæ™¯è¦ç´ ã®è‡ªå‹•æ¤œå‡º</li>
                <li>9ã‚¢ãƒ³ã‚«ãƒ¼ãƒã‚¤ãƒ³ãƒˆæœ€é©åŒ–</li>
                <li>ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºæ™‚ã®æ¯”ç‡ä¿æŒ</li>
                <li>å³ã‚¯ãƒªãƒƒã‚¯ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ“ä½œ</li>
            </ul>
        </div>
    </div>

    <!-- ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹è¡¨ç¤º -->
    <div class="info-panel">
        <h3>ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹</h3>
        <div id="system-status">
            <div class="status-line">
                <span class="status-indicator status-warning"></span>
                <span>ã‚·ã‚¹ãƒ†ãƒ ãƒã‚§ãƒƒã‚¯ä¸­...</span>
            </div>
        </div>
    </div>

    <!-- ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–æƒ…å ±è¡¨ç¤º -->
    <div class="responsive-test-info" id="responsive-info">
        <div>Window: <span id="window-size">-</span></div>
        <div>Scene: <span id="scene-size">-</span></div>
        <div>Background: <span id="bg-size">-</span></div>
        <div>Canvas: <span id="canvas-size">-</span></div>
        <div>Aspect Ratio: <span id="aspect-ratio">-</span></div>
    </div>

    <!-- ãƒ­ã‚°è¡¨ç¤º -->
    <div class="log-container" id="log-display">
        ğŸ¢ å®Ÿç”¨Spineãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ãƒ†ã‚¹ãƒˆãƒ­ã‚° - åˆæœŸåŒ–ä¸­...\n
    </div>

    <!-- Spine WebGLãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
    <script src="https://unpkg.com/@esotericsoftware/spine-webgl@4.1.24/dist/iife/spine-webgl.js"></script>
    
    <!-- æˆåŠŸäº‹ä¾‹ãƒ™ãƒ¼ã‚¹ã‚·ã‚¹ãƒ†ãƒ ã§ã¯PureSpineLoaderã¯ä¸è¦ -->
    
    <!-- å¿…è¦ãªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿ -->
    <script src="micromodules/element-observer/ElementObserverCore.js"></script>
    <script src="micromodules/element-observer/ElementObserverTransform.js"></script>
    <script src="micromodules/element-observer/ElementObserverWebGL.js"></script>
    <script src="micromodules/element-observer/ElementObserverResponsive.js"></script>
    <script src="micromodules/element-observer/ElementObserverAdvanced.js"></script>
    
    <script src="micromodules/bounding-box/PureBoundingBoxCore.js"></script>
    <script src="micromodules/bounding-box/PureBoundingBoxBounds.js"></script>
    <script src="micromodules/bounding-box/PureBoundingBoxEvents.js"></script>
    <script src="micromodules/bounding-box/PureBoundingBoxUI.js"></script>
    <script src="micromodules/bounding-box/PureBoundingBoxAutoPin.js"></script>
    <script src="micromodules/bounding-box/PureBoundingBox.js"></script>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        // spineLoaderã¯æˆåŠŸäº‹ä¾‹ãƒ™ãƒ¼ã‚¹ã§ã¯ä¸è¦
        // spineDataã¯æˆåŠŸäº‹ä¾‹ãƒ™ãƒ¼ã‚¹ã§ã¯ä¸è¦
        let skeleton = null;
        let animationState = null;
        let renderer = null;
        let currentBoundingBox = null;
        let canvas = null;
        let gl = null;
        let logDisplay = null;
        let responsiveInterval = null;
        let renderLoop = null;
        
        // ãƒ­ã‚°é–¢æ•°
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const icon = type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : type === 'warning' ? 'âš ï¸' : 'ğŸ“‹';
            const logMessage = `[${timestamp}] ${icon} ${message}\n`;
            
            if (logDisplay) {
                logDisplay.textContent += logMessage;
                logDisplay.scrollTop = logDisplay.scrollHeight;
            }
            
            console.log(`${icon} ${message}`);
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', async () => {
            canvas = document.getElementById('purattokun-canvas');
            logDisplay = document.getElementById('log-display');
            
            log('ğŸŠ€ å®Ÿç”¨Spineãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
            
            // ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç¢ºèª
            await checkSystemModules();
            
            // ç¸¦æ¨ªæ¯”æƒ…å ±åˆæœŸè¡¨ç¤º
            updateAspectInfo();
            
            // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
            setupEventListeners();
            
            log('âœ… åˆæœŸåŒ–å®Œäº† - ãƒ†ã‚¹ãƒˆæº–å‚™å®Œäº†', 'success');
        });

        // ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç¢ºèª
        async function checkSystemModules() {
            const modules = [
                { name: 'Spine WebGL', obj: window.spine },
                { name: 'Spine AssetManager', obj: window.spine?.AssetManager },
                { name: 'ElementObserverCore', obj: window.ElementObserverCore },
                { name: 'ElementObserverAdvanced', obj: window.ElementObserverAdvanced },
                { name: 'PureBoundingBoxCore', obj: window.PureBoundingBoxCore },
                { name: 'PureBoundingBoxUI', obj: window.PureBoundingBoxUI },
                { name: 'PureBoundingBoxAutoPin', obj: window.PureBoundingBoxAutoPin },
                { name: 'PureBoundingBox', obj: window.PureBoundingBox }
            ];
            
            let allLoaded = true;
            let statusHtml = '';
            
            for (const module of modules) {
                const loaded = (module.name === 'Spine WebGL') ? 
                    (typeof module.obj === 'object' && module.obj !== null) :
                    (typeof module.obj === 'function');
                const statusClass = loaded ? 'status-success' : 'status-danger';
                const statusText = loaded ? 'èª­ã¿è¾¼ã¿æ¸ˆã¿' : 'èª­ã¿è¾¼ã¿å¤±æ•—';
                
                statusHtml += `
                    <div class="status-line">
                        <span class="status-indicator ${statusClass}"></span>
                        <span>${module.name}: ${statusText}</span>
                    </div>
                `;
                
                if (!loaded) {
                    allLoaded = false;
                    log(`âŒ ${module.name} ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`, 'error');
                } else {
                    log(`âœ… ${module.name} ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿æˆåŠŸ`, 'success');
                }
            }
            
            document.getElementById('system-status').innerHTML = statusHtml;
            
            if (allLoaded) {
                log('ğŸ‰ å…¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿æˆåŠŸ', 'success');
            } else {
                log('âš ï¸ ä¸€éƒ¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'warning');
            }
        }

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
        function setupEventListeners() {
            // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚¯ãƒªãƒƒã‚¯ã§ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹è¡¨ç¤º
            canvas.addEventListener('click', (e) => {
                if (skeleton) {
                    e.stopPropagation();
                    testBBAutoPin();
                }
            });
            
            // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºç›£è¦–
            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    updateAspectInfo();
                    updateResponsiveInfo();
                    log('ğŸ“ ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºæ¤œå‡º - ç¸¦æ¨ªæ¯”æƒ…å ±æ›´æ–°', 'info');
                }, 100);
            });
        }

        // SpineåˆæœŸåŒ–ï¼ˆæˆåŠŸäº‹ä¾‹ãƒ™ãƒ¼ã‚¹ç‰ˆï¼‰
        async function initializeSpineAndBB() {
            try {
                // åˆæœŸåŒ–ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ä¸Šã§å®Ÿè¡Œæ¸ˆã¿
                
                log('ğŸ® æˆåŠŸäº‹ä¾‹ãƒ™ãƒ¼ã‚¹ SpineåˆæœŸåŒ–é–‹å§‹ (SceneRendererãƒ™ãƒ¼ã‚¹)', 'info');
                
                // CanvasåˆæœŸè¨­å®šï¼ˆæˆåŠŸäº‹ä¾‹æº–æ‹ ï¼‰
                canvas.width = canvas.clientWidth || 300;
                canvas.height = canvas.clientHeight || 200;
                
                log(`ğŸ“ CanvasåˆæœŸè¨­å®š: ${canvas.width}x${canvas.height} (CSS: ${canvas.clientWidth}x${canvas.clientHeight})`, 'info');
                
                // WebGLã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå–å¾—ï¼ˆæˆåŠŸäº‹ä¾‹æº–æ‹ ï¼‰
                gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                if (!gl) {
                    throw new Error('WebGLã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
                log('âœ… WebGLã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå–å¾—æˆåŠŸ', 'success');
                
                // ã‚¢ã‚»ãƒƒãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ä½œæˆï¼ˆæˆåŠŸäº‹ä¾‹æº–æ‹ ï¼‰
                const assetManager = new spine.AssetManager(gl);
                
                const spineFile = 'assets/spine/characters/purattokun/purattokun.json';
                const atlasFile = 'assets/spine/characters/purattokun/purattokun.atlas';
                
                assetManager.loadText(spineFile);
                assetManager.loadTextureAtlas(atlasFile);
                
                // ã‚¢ã‚»ãƒƒãƒˆèª­ã¿è¾¼ã¿å¾…ã¡ï¼ˆæˆåŠŸäº‹ä¾‹æº–æ‹ ï¼‰
                await new Promise((resolve, reject) => {
                    let checkCount = 0;
                    const checkAssets = () => {
                        if (assetManager.isLoadingComplete()) {
                            resolve();
                        } else if (checkCount++ < 100) {
                            setTimeout(checkAssets, 100);
                        } else {
                            reject(new Error('ã‚¢ã‚»ãƒƒãƒˆèª­ã¿è¾¼ã¿ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ'));
                        }
                    };
                    checkAssets();
                });
                log('âœ… Spineã‚¢ã‚»ãƒƒãƒˆèª­ã¿è¾¼ã¿å®Œäº†', 'success');
                
                // Skeletonä½œæˆï¼ˆæˆåŠŸäº‹ä¾‹æº–æ‹ ï¼‰
                const atlas = assetManager.require(atlasFile);
                const atlasLoader = new spine.AtlasAttachmentLoader(atlas);
                const skeletonJson = new spine.SkeletonJson(atlasLoader);
                const skeletonData = skeletonJson.readSkeletonData(assetManager.require(spineFile));
                
                skeleton = new spine.Skeleton(skeletonData);
                const stateData = new spine.AnimationStateData(skeletonData);
                animationState = new spine.AnimationState(stateData);
                
                // ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ä½œæˆï¼ˆæˆåŠŸäº‹ä¾‹æº–æ‹  - SceneRendererä½¿ç”¨ï¼‰
                renderer = new spine.SceneRenderer(canvas, gl);
                
                // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ä½ç½®ãƒ»ã‚¹ã‚±ãƒ¼ãƒ«è¨­å®šï¼ˆæˆåŠŸäº‹ä¾‹æº–æ‹ ï¼‰
                skeleton.scaleX = skeleton.scaleY = 0.6;
                skeleton.x = 0;  // æˆåŠŸäº‹ä¾‹æº–æ‹ ï¼ˆå¾Œã§Canvasã‚µã‚¤ã‚ºèª¿æ•´æ™‚ã«æ›´æ–°ï¼‰
                skeleton.y = 0;  // æˆåŠŸäº‹ä¾‹æº–æ‹ ï¼ˆå¾Œã§Canvasã‚µã‚¤ã‚ºèª¿æ•´æ™‚ã«æ›´æ–°ï¼‰
                skeleton.setToSetupPose();
                skeleton.updateWorldTransform();
                
                // åˆæœŸã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
                if (skeletonData.animations.length > 0) {
                    const firstAnim = skeletonData.animations[0].name;
                    animationState.setAnimation(0, firstAnim, true);
                    log(`ğŸ¨ åˆæœŸã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³: ${firstAnim}`, 'success');
                }
                
                // Canvasè¡¨ç¤º
                canvas.style.display = 'block';
                
                // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ«ãƒ¼ãƒ—é–‹å§‹
                startRenderLoop();
                
                log('âœ… æˆåŠŸäº‹ä¾‹ãƒ™ãƒ¼ã‚¹ SpineåˆæœŸåŒ–å®Œäº†', 'success');
                log('ğŸ”§ SceneRendererä½¿ç”¨ã«ã‚ˆã‚ŠdrawOrderã‚¨ãƒ©ãƒ¼ã‚’å›é¿', 'info');
                
            } catch (error) {
                log(`âŒ SpineåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                console.error('SpineåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
            }
        }
        
        // Spineãƒ†ã‚¹ãƒˆï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
        async function testSpineSystem() {
            try {
                log('ğŸ§ª Spineã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
                
                if (!window.spine) {
                    throw new Error('Spine WebGLãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
                }
                
                log(`ğŸ¯ Spine WebGLãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ†ã‚¹ãƒˆ:`, 'info');
                log(`  - spine: ${typeof window.spine}`, 'info');
                log(`  - AssetManager: ${typeof window.spine?.AssetManager}`, 'info');
                log(`  - SceneRenderer: ${typeof window.spine?.SceneRenderer}`, 'info');
                log(`  - Skeleton: ${typeof window.spine?.Skeleton}`, 'info');
                log('âœ… Spine WebGLãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ†ã‚¹ãƒˆå®Œäº†', 'success');
                
                return { success: true };
                
            } catch (error) {
                log(`âŒ Spine WebGLãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                return { success: false, error: error.message };
            }
        }
        
        // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ«ãƒ¼ãƒ—ï¼ˆæˆåŠŸäº‹ä¾‹ãƒ™ãƒ¼ã‚¹ - SceneRendererç‰ˆï¼‰
        function startRenderLoop() {
            let lastTime = Date.now();
            let debugFrameCount = 0; // ãƒ‡ãƒãƒƒã‚°ç”¨ãƒ•ãƒ¬ãƒ¼ãƒ ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼
            let isResized = false; // ãƒªã‚µã‚¤ã‚ºãƒ•ãƒ©ã‚°
            let lastResizeLog = 0; // æœ€å¾Œã®ãƒªã‚µã‚¤ã‚ºãƒ­ã‚°æ™‚åˆ»
            
            function render() {
                const now = Date.now();
                const delta = (now - lastTime) / 1000;
                lastTime = now;
                
                // Canvasæç”»ã‚µã‚¤ã‚ºæ›´æ–°ï¼ˆå¿…è¦æ™‚ã®ã¿ï¼‰
                const newWidth = canvas.clientWidth || 200;
                const newHeight = canvas.clientHeight || 200;
                
                if (canvas.width !== newWidth || canvas.height !== newHeight) {
                    canvas.width = newWidth;
                    canvas.height = newHeight;
                    // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ä½ç½®ã¯(0,0)ã‚’ç¶­æŒï¼ˆæ­£å¸¸è¡¨ç¤ºä½ç½®ï¼‰
                    skeleton.x = 0;
                    skeleton.y = 0;
                    isResized = true;
                    
                    if (now - lastResizeLog > 500) {
                        log(`ğŸ“ Canvas ãƒªã‚µã‚¤ã‚º: ${canvas.width}x${canvas.height}, skeletonä½ç½®ç¶­æŒ: x=${skeleton.x}, y=${skeleton.y} (0,0=æ­£å¸¸)`, 'info');
                        lastResizeLog = now;
                    }
                }
                
                // åˆæœŸ5ãƒ•ãƒ¬ãƒ¼ãƒ ã®ãƒ‡ãƒãƒƒã‚°æƒ…å ±å‡ºåŠ›ï¼ˆåˆæœŸåŒ–æ™‚ã®ã¿ï¼‰
                if (debugFrameCount < 5) {
                    log(`ğŸ¯ ãƒ•ãƒ¬ãƒ¼ãƒ ${debugFrameCount + 1}: skeleton.x=${skeleton.x}, skeleton.y=${skeleton.y}, canvas=${canvas.width}x${canvas.height}`, 'info');
                    debugFrameCount++;
                }
                
                gl.viewport(0, 0, canvas.width, canvas.height);
                
                // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ›´æ–°
                animationState.update(delta);
                animationState.apply(skeleton);
                skeleton.updateWorldTransform();
                
                // èƒŒæ™¯ã‚¯ãƒªã‚¢ï¼ˆåŠé€æ˜èƒŒæ™¯ï¼‰
                gl.clearColor(0.0, 0.0, 0.0, 0.1);
                gl.clear(gl.COLOR_BUFFER_BIT);
                
                // ã‚«ãƒ¡ãƒ©è¨­å®šï¼ˆã‚·ãƒ³ãƒ—ãƒ«è¨­å®šï¼‰
                const camera = renderer.camera;
                camera.position.x = canvas.width / 2;  // Canvasä¸­å¤®ã«ã‚«ãƒ¡ãƒ©é…ç½®
                camera.position.y = canvas.height / 2; // Canvasä¸­å¤®ã«ã‚«ãƒ¡ãƒ©é…ç½®
                camera.setViewport(canvas.width, canvas.height);
                
                // ãƒªã‚µã‚¤ã‚ºæ™‚ã®è¿½åŠ ãƒ‡ãƒãƒƒã‚°æƒ…å ±
                if (isResized && now - lastResizeLog <= 100) {
                    log(`ğŸ® ã‚«ãƒ¡ãƒ©è¨­å®š: position=(${camera.position.x}, ${camera.position.y}), viewport=${canvas.width}x${canvas.height}`, 'info');
                    isResized = false;
                }
                
                // æç”»å®Ÿè¡Œï¼ˆSceneRendererç‰ˆï¼‰
                renderer.begin();
                renderer.drawSkeleton(skeleton, true);
                renderer.end();
                
                requestAnimationFrame(render);
            }
            render();
            
            log('âœ… Spineæç”»ãƒ«ãƒ¼ãƒ—é–‹å§‹', 'success');
        }

        // ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹è‡ªå‹•ãƒ”ãƒ³ãƒ†ã‚¹ãƒˆ
        async function testBBAutoPin() {
            try {
                if (!skeleton) {
                    log('âš ï¸ å…ˆã«Spineã‚’åˆæœŸåŒ–ã—ã¦ãã ã•ã„', 'warning');
                    return;
                }
                
                log('ğŸ“‹ ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹è‡ªå‹•ãƒ”ãƒ³ãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
                
                // æ—¢å­˜ã®ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
                if (currentBoundingBox) {
                    currentBoundingBox.cleanup();
                    currentBoundingBox = null;
                }
                
                // æ–°ã—ã„ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ä½œæˆ
                currentBoundingBox = new PureBoundingBox({
                    targetElement: canvas,
                    nodeId: 'purattokun-canvas'
                });
                
                // å®Ÿè¡Œ
                const result = await currentBoundingBox.execute();
                
                if (result.success) {
                    log('âœ… ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ä½œæˆæˆåŠŸ', 'success');
                    log(`ğŸ“Š åˆæœŸbounds: ${JSON.stringify(result.bounds)}`, 'info');
                    
                    // è‡ªå‹•ãƒ”ãƒ³æƒ…å ±è¡¨ç¤º
                    if (currentBoundingBox.ui && currentBoundingBox.ui.autoPin) {
                        const autoPinState = currentBoundingBox.ui.autoPin.getState();
                        log(`ğŸ“ AutoPinçŠ¶æ…‹: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ”ãƒ³${autoPinState.activePinsCount}å€‹`, 'info');
                    }
                } else {
                    log(`âŒ ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ä½œæˆå¤±æ•—: ${result.error}`, 'error');
                }
                
            } catch (error) {
                log(`âŒ ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                console.error('ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼:', error);
            }
        }
        
        // ç¸¦æ¨ªæ¯”ãƒ†ã‚¹ãƒˆ
        function testAspectRatio() {
            log('ğŸ“ ç¸¦æ¨ªæ¯”æ¤œè¨¼é–‹å§‹', 'info');
            
            updateAspectInfo();
            
            const sceneContainer = document.querySelector('.scene-container');
            const backgroundImage = document.querySelector('.background-image');
            
            if (sceneContainer && backgroundImage) {
                const sceneRect = sceneContainer.getBoundingClientRect();
                const bgRect = backgroundImage.getBoundingClientRect();
                const canvasRect = canvas.getBoundingClientRect();
                
                log(`ğŸ“ ã‚·ãƒ¼ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ: ${sceneRect.width.toFixed(0)} Ã— ${sceneRect.height.toFixed(0)}`, 'info');
                log(`ğŸ¨ èƒŒæ™¯ç”»åƒ: ${bgRect.width.toFixed(0)} Ã— ${bgRect.height.toFixed(0)}`, 'info');
                log(`ğŸ­ Canvas: ${canvasRect.width.toFixed(0)} Ã— ${canvasRect.height.toFixed(0)}`, 'info');
                
                // ç¸¦æ¨ªæ¯”è¨ˆç®—
                const bgAspect = (bgRect.width / bgRect.height).toFixed(3);
                const canvasAspect = (canvasRect.width / canvasRect.height).toFixed(3);
                
                log(`ğŸ“ èƒŒæ™¯ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”: ${bgAspect}`, 'info');
                log(`ğŸ“ Canvasã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”: ${canvasAspect} (ç›®æ¨™: 1.500)`, 'info');
                
                // CSSè¨­å®šç¢ºèª
                const canvasStyles = window.getComputedStyle(canvas);
                log(`ğŸ“ CSS width: ${canvasStyles.width}`, 'info');
                log(`ğŸ“ CSS aspect-ratio: ${canvasStyles.aspectRatio || 'è¨­å®šãªã—'}`, 'info');
                
                // ç¸¦æ¨ªæ¯”ãƒã‚§ãƒƒã‚¯
                const targetAspect = 1.5; // 3:2
                const aspectDiff = Math.abs(parseFloat(canvasAspect) - targetAspect);
                
                if (aspectDiff < 0.01) {
                    log('âœ… ç¸¦æ¨ªæ¯”æ¤œè¨¼: æ­£å¸¸', 'success');
                } else {
                    log(`âš ï¸ ç¸¦æ¨ªæ¯”åå·®: ${aspectDiff.toFixed(3)} (è¨±å®¹å€¤: 0.01)`, 'warning');
                }
                
            } else {
                log('âŒ ç¸¦æ¨ªæ¯”ãƒ†ã‚¹ãƒˆ: è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
            }
        }
        
        // ç¸¦æ¨ªæ¯”æƒ…å ±æ›´æ–°
        function updateAspectInfo() {
            const aspectInfo = document.getElementById('aspect-info');
            if (!aspectInfo) return;
            
            const canvasRect = canvas.getBoundingClientRect();
            const aspect = (canvasRect.width / canvasRect.height).toFixed(3);
            
            aspectInfo.textContent = `ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”: ${aspect} (ç›®æ¨™: 1.500) | Canvas: ${canvasRect.width.toFixed(0)}Ã—${canvasRect.height.toFixed(0)}`;
        }
        
        // ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–æƒ…å ±è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
        function toggleResponsiveInfo() {
            const info = document.getElementById('responsive-info');
            if (info.style.display === 'none' || !info.style.display) {
                info.style.display = 'block';
                startResponsiveMonitoring();
                log('ğŸ“± ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–æƒ…å ±è¡¨ç¤ºé–‹å§‹', 'info');
            } else {
                info.style.display = 'none';
                stopResponsiveMonitoring();
                log('ğŸ“± ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–æƒ…å ±è¡¨ç¤ºåœæ­¢', 'info');
            }
        }
        
        // ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ç›£è¦–é–‹å§‹
        function startResponsiveMonitoring() {
            if (responsiveInterval) return;
            
            responsiveInterval = setInterval(updateResponsiveInfo, 100);
        }
        
        // ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ç›£è¦–åœæ­¢
        function stopResponsiveMonitoring() {
            if (responsiveInterval) {
                clearInterval(responsiveInterval);
                responsiveInterval = null;
            }
        }
        
        // ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–æƒ…å ±æ›´æ–°
        function updateResponsiveInfo() {
            const windowSize = document.getElementById('window-size');
            const sceneSize = document.getElementById('scene-size');
            const bgSize = document.getElementById('bg-size');
            const canvasSize = document.getElementById('canvas-size');
            const aspectRatio = document.getElementById('aspect-ratio');
            
            if (windowSize) windowSize.textContent = `${window.innerWidth} Ã— ${window.innerHeight}`;
            
            const sceneContainer = document.querySelector('.scene-container');
            if (sceneContainer && sceneSize) {
                const rect = sceneContainer.getBoundingClientRect();
                sceneSize.textContent = `${rect.width.toFixed(0)} Ã— ${rect.height.toFixed(0)}`;
            }
            
            const backgroundImage = document.querySelector('.background-image');
            if (backgroundImage && bgSize) {
                const rect = backgroundImage.getBoundingClientRect();
                bgSize.textContent = `${rect.width.toFixed(0)} Ã— ${rect.height.toFixed(0)}`;
            }
            
            if (canvas && canvasSize && aspectRatio) {
                const rect = canvas.getBoundingClientRect();
                canvasSize.textContent = `${rect.width.toFixed(0)} Ã— ${rect.height.toFixed(0)}`;
                
                const aspect = (rect.width / rect.height).toFixed(3);
                aspectRatio.textContent = aspect + ' (target: 1.500)';
            }
        }
        
        // ãƒªã‚µã‚¤ã‚ºãƒ†ã‚¹ãƒˆ
        function performResizeTest() {
            log('ğŸ“ ãƒªã‚µã‚¤ã‚ºãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
            
            const sceneContainer = document.querySelector('.scene-container');
            if (!sceneContainer) {
                log('âŒ ã‚·ãƒ¼ãƒ³ã‚³ãƒ³ãƒ†ãƒŠãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
                return;
            }
            
            // ãƒ†ã‚¹ãƒˆã‚µã‚¤ã‚º
            const testSizes = [
                { width: '800px', name: 'å°ã•ã‚' },
                { width: '1000px', name: 'ä¸­ã‚µã‚¤ã‚º' },
                { width: '1200px', name: 'å¤§ãã‚' }
            ];
            
            let currentStep = 0;
            
            function nextResize() {
                if (currentStep >= testSizes.length) {
                    // å…ƒã®ã‚µã‚¤ã‚ºã«æˆ»ã™
                    sceneContainer.style.width = '';
                    log('âœ… ãƒªã‚µã‚¤ã‚ºãƒ†ã‚¹ãƒˆå®Œäº†', 'success');
                    updateAspectInfo();
                    return;
                }
                
                const size = testSizes[currentStep];
                log(`ğŸ“ ${size.name}ã‚µã‚¤ã‚ºã«å¤‰æ›´: ${size.width}`, 'info');
                
                sceneContainer.style.width = size.width;
                
                setTimeout(() => {
                    updateAspectInfo();
                    currentStep++;
                    setTimeout(nextResize, 2000);
                }, 1000);
            }
            
            nextResize();
        }
        
        // ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹è¡¨ç¤º
        function showSystemStatus() {
            log('ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹è¡¨ç¤º', 'info');
            
            // æˆåŠŸäº‹ä¾‹ãƒ™ãƒ¼ã‚¹ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹
            if (skeleton && animationState && renderer) {
                log('âœ… Spineã‚·ã‚¹ãƒ†ãƒ : æ­£å¸¸å‹•ä½œä¸­', 'success');
                log(`  - Skeleton: x=${skeleton.x}, y=${skeleton.y}`, 'info');
                log(`  - Renderer: ${renderer.constructor.name}`, 'info');
                log(`ğŸ¨ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³: ${skeleton.data.animations.length}å€‹`, 'info');
            } else {
                log('âš ï¸ Spineã‚·ã‚¹ãƒ†ãƒ : æœªåˆæœŸåŒ–', 'warning');
            }
            
            // ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹çŠ¶æ…‹
            if (currentBoundingBox) {
                const state = currentBoundingBox.getState();
                log(`ğŸ“Š ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹çŠ¶æ…‹: ${JSON.stringify(state)}`, 'info');
                
                if (currentBoundingBox.ui && currentBoundingBox.ui.autoPin) {
                    const autoPinState = currentBoundingBox.ui.autoPin.getState();
                    log(`ğŸ“ AutoPinçŠ¶æ…‹: ${JSON.stringify(autoPinState)}`, 'info');
                }
            } else {
                log('âš ï¸ ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹: éã‚¢ã‚¯ãƒ†ã‚£ãƒ–', 'warning');
            }
            
            // ç¸¦æ¨ªæ¯”æƒ…å ±
            testAspectRatio();
        }
        
        // å…¨ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢
        function clearAllData() {
            log('ğŸ—‘ï¸ å…¨ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢é–‹å§‹', 'info');
            
            // ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
            if (currentBoundingBox) {
                currentBoundingBox.cleanup();
                currentBoundingBox = null;
                log('âœ… ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†', 'success');
            }
            
            // Spineã‚·ã‚¹ãƒ†ãƒ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
            // æˆåŠŸäº‹ä¾‹ãƒ™ãƒ¼ã‚¹ã§ã¯ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
            skeleton = null;
            animationState = null;
            renderer = null;
            gl = null;
            log('âœ… æˆåŠŸäº‹ä¾‹ãƒ™ãƒ¼ã‚¹ã‚·ã‚¹ãƒ†ãƒ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†', 'success');
            
            // Canvaséè¡¨ç¤º
            if (canvas) {
                canvas.style.display = 'none';
            }
            
            // localStorageã‚¯ãƒªã‚¢
            let clearedCount = 0;
            const keys = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && (key.startsWith('bb-') || key.startsWith('original-bounds-') || key.includes('purattokun'))) {
                    keys.push(key);
                }
            }
            
            keys.forEach(key => {
                localStorage.removeItem(key);
                clearedCount++;
            });
            
            log(`âœ… localStorageã‚¯ãƒªã‚¢å®Œäº†: ${clearedCount}å€‹ã®ã‚­ãƒ¼ã‚’å‰Šé™¤`, 'success');
            
            // ãƒ­ã‚°ã‚¯ãƒªã‚¢
            if (logDisplay) {
                logDisplay.textContent = 'ğŸ—‘ï¸ å…¨ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢å®Œäº†\n';
            }
            
            log('âœ… å…¨ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢å®Œäº†', 'success');
        }
        
        // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
        window.addEventListener('beforeunload', () => {
            if (currentBoundingBox) {
                currentBoundingBox.cleanup();
            }
            // æˆåŠŸäº‹ä¾‹ãƒ™ãƒ¼ã‚¹ã‚·ã‚¹ãƒ†ãƒ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
            if (responsiveInterval) {
                clearInterval(responsiveInterval);
            }
        });
        
        // ãƒ‡ãƒãƒƒã‚°ç”¨ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ï¼ˆæˆåŠŸäº‹ä¾‹ãƒ™ãƒ¼ã‚¹ç‰ˆï¼‰
        window.spineSystem = () => ({ skeleton, animationState, renderer });
        window.skeleton = () => skeleton;
        window.animationState = () => animationState;
        window.currentBoundingBox = () => currentBoundingBox;
        window.testSpineSystem = testSpineSystem;
        window.logTest = (message, type) => log(message, type);
    </script>
</body>
</html>