# 📋 CanvasResizeController.js 要件定義書

**作成日**: 2025-09-02  
**バージョン**: v1.0  
**ステータス**: 確定  

## 🎯 プロジェクト概要

### 目的
test-nezumi-stable-spine-bb.html から Canvas サイズ調整機能を抽出し、統合編集機能付きのマイクロモジュールとして独立化する。

### 背景
- 現在のtest-nezumi-stable-spine-bb.htmlに優秀なCanvas制御機能が実装済み
- `?edit=true` の編集システムのような統合BB操作機能が必要
- マイクロモジュール化により他プロジェクトでの再利用を可能にする

## 📋 機能要件

### 🎯 コア機能（必須実装）

#### 1. Canvas 解像度制御
- **入力方式**: 1つの数値入力のみ
- **動作**: 入力値で正方形Canvas作成（例：400 → 400x400px）
- **効果**: Canvas物理サイズ（解像度）の変更
- **用途**: 描画品質の調整

#### 2. CSS 表示サイズ制御
- **方式**: 1つの固定サイズのみ提供
- **サイズ**: 中サイズ程度の正方形（300px～400px想定）
- **理由**: 後でBB操作により微調整可能なため固定で十分

#### 3. キャラクタースケール調整
- **仕様**: test-nezumi-stable-spine-bb.html の現機能をそのまま移植
- **操作**: スライダーまたは数値入力によるスケール変更
- **対象**: Spineキャラクターのscale値

#### 4. キャラクター位置調整
- **仕様**: test-nezumi-stable-spine-bb.html の現機能をそのまま移植
- **操作**: 数値入力またはドラッグによる位置変更
- **対象**: Spineキャラクターのx, y座標

### 🔗 統合機能（重要実装）

#### 5. BB-Canvas統合操作システム
- **参考**: `http://localhost:8000/?edit=true` の編集システム動作
- **動作仕様**:
  - キャラクターを囲むバウンディングボックス（BB）表示
  - BBドラッグ → キャラクター + Canvas全体が一緒に移動
  - BBハンドルリサイズ → キャラクター + Canvas が一緒にスケール
  - 統合された一体型操作感の実現

#### 6. 完全透明背景
- **Canvas背景**: `background: transparent`
- **描画背景**: キャラクター以外の部分を完全透明に
- **目的**: キャラクターのみを際立たせる

## 🎨 UI/UX要件

### 操作パネル設計
```
┌─ Canvas解像度制御 ─┐
│ サイズ: [400] px   │ ← 1つの数値のみ（正方形）
│ [適用] [リセット]   │
└─────────────────┘

┌─ キャラクター制御 ─┐
│ スケール: [1.0]    │
│ X座標: [0]        │
│ Y座標: [0]        │  
│ [適用] [中央配置]   │
└─────────────────┘

┌─ 統合BB操作 ──────┐
│ [BB表示ON/OFF]    │
│ [ドラッグ移動]     │
│ [ハンドルリサイズ] │
└─────────────────┘
```

### 表示仕様
- **Canvas表示サイズ**: 固定（中サイズ正方形）
- **BB表示**: `?edit=true` と同様のビジュアル
- **背景**: 完全透明
- **操作フィードバック**: リアルタイム更新

## 🔧 技術要件

### マイクロモジュール設計原則
- **単一責任**: Canvas + キャラクター統合制御に特化
- **軽量性**: 500行以内の実装目標
- **独立性**: 他システムへの依存を最小限に
- **再利用性**: 任意のSpineプロジェクトで利用可能

### 対応環境
- **HTML5 Canvas**: 必須
- **WebGL**: 対応必須（ビューポート自動更新）
- **Spine WebGL**: 必須（キャラクター制御のため）
- **バウンディングボックスシステム**: 統合対応

### パフォーマンス要件
- **リアルタイム更新**: 60fps でスムーズな操作感
- **メモリ効率**: 最小限のメモリ使用
- **処理速度**: レスポンシブな操作感

## 🚨 制約・前提条件

### v3.0システム開発哲学準拠
- **シンプル設計**: 複雑な機能追加の禁止
- **軽量性維持**: ファイルサイズ・処理負荷を最小限に
- **必要最小限**: 要求された機能のみ実装

### 技術制約
- **Spine WebGL依存**: Spineライブラリが前提
- **Canvas API**: HTML5 Canvas の標準機能のみ使用
- **ブラウザ対応**: モダンブラウザ（ES6対応）

## 📊 成功基準

### 機能面
- ✅ Canvas解像度が1つの数値で正方形変更できる
- ✅ キャラクタースケール・位置が個別調整できる
- ✅ BBドラッグでCanvas+キャラクターが一体移動する
- ✅ BBリサイズでCanvas+キャラクターが一体スケールする
- ✅ 背景が完全透明で表示される

### 技術面
- ✅ `?edit=true` と同等の操作感を実現
- ✅ 他プロジェクトでのマイクロモジュールとして再利用可能
- ✅ 安定したWebGL対応・エラーハンドリング

### ユーザビリティ
- ✅ 直感的な操作感（学習コストの低減）
- ✅ リアルタイムなフィードバック
- ✅ 設定の永続化（localStorage対応）

## 🔄 開発フェーズ

### Phase 1: 基本機能実装
- Canvas解像度制御（正方形リサイズ）
- キャラクタースケール・位置調整
- 基本UI構築

### Phase 2: 統合機能実装
- BB表示システム
- BB-Canvas統合操作
- 完全透明背景

### Phase 3: 品質向上・テスト
- エラーハンドリング強化
- パフォーマンス最適化
- 包括的テスト実施

## 📚 参考資料

- **test-nezumi-stable-spine-bb.html** - 機能抽出元
- **http://localhost:8000/?edit=true** - BB操作の参考システム
- **CLAUDE.md v3.0システム開発哲学** - 設計方針
- **マイクロモジュール設計指針** - アーキテクチャ基準

## ✅ 承認

**要件確定**: 2025-09-02  
**承認者**: プロジェクト責任者  
**次工程**: 技術仕様書作成・実装開始  

---

**🎯 この要件定義書に基づき、統合編集機能付きCanvasResizeControllerの実装を開始します。**