<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ”¹å–„ã•ã‚ŒãŸç¸¦ç©ã¿ã‚·ã‚¹ãƒ†ãƒ  ãƒ†ã‚¹ãƒˆ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1e1e1e;
            color: white;
            height: 100vh;
            display: grid;
            grid-template-areas: 
                "header header header"
                "outliner preview properties"
                "timeline timeline timeline";
            grid-template-columns: var(--outliner-width, 300px) 1fr var(--properties-width, 300px);
            grid-template-rows: 60px 1fr var(--timeline-height, 200px);
            gap: 1px;
        }
        
        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .top-bar {
            grid-area: header;
            background: #2d2d2d;
            border-bottom: 1px solid #404040;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
        }
        
        .test-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .test-btn {
            background: #007acc;
            border: 1px solid #0099ff;
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }
        
        .test-btn:hover {
            background: #0099ff;
            transform: translateY(-1px);
        }
        
        .test-status {
            background: #00ff88;
            color: black;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        
        /* ãƒ‘ãƒãƒ«å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
        .panel {
            background: #2d2d2d;
            border: 1px solid #404040;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }
        
        .panel:hover {
            border-color: #555555;
        }
        
        .panel-header {
            height: 32px;
            background: #3a3a3a;
            border-bottom: 1px solid #404040;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 12px;
            cursor: move;
            user-select: none;
            transition: all 0.2s ease;
        }
        
        .panel-header:hover {
            background: #4a4a4a;
        }
        
        .panel-header.dragging {
            background: #007acc;
            transform: scale(1.05);
            box-shadow: 0 4px 20px rgba(0, 122, 204, 0.4);
        }
        
        .panel-title {
            font-size: 13px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .panel-content {
            flex: 1;
            padding: 15px;
            overflow: auto;
        }
        
        /* å„ãƒ‘ãƒãƒ«é…ç½® */
        .panel-outliner { grid-area: outliner; }
        .panel-preview { 
            grid-area: preview;
            background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
        }
        .panel-properties { grid-area: properties; }
        .panel-timeline { grid-area: timeline; }
        
        /* ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ */
        .preview-area {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            text-align: center;
        }
        
        /* ãƒ‡ãƒãƒƒã‚°ãƒ‘ãƒãƒ« */
        .debug-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 8px;
            font-size: 11px;
            max-width: 350px;
            opacity: 0.9;
            transition: opacity 0.3s ease;
            border: 1px solid #333;
            z-index: 2000;
        }
        
        .debug-panel:hover {
            opacity: 1;
        }
        
        .debug-panel h4 {
            color: #00ff88;
            margin-bottom: 10px;
            font-size: 13px;
        }
        
        .debug-info {
            margin: 4px 0;
            color: #cccccc;
            display: flex;
            justify-content: space-between;
        }
        
        .debug-info .label {
            color: #999;
        }
        
        .debug-info .value {
            color: #00ff88;
            font-weight: 500;
        }
        
        /* æ¯”è¼ƒè¡¨ç¤º */
        .comparison-info {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid #333;
        }
        
        .comparison-info h5 {
            color: #ffdd00;
            margin-bottom: 8px;
            font-size: 12px;
        }
        
        .comparison-item {
            margin: 3px 0;
            font-size: 10px;
        }
        
        .improvement {
            color: #00ff88;
        }
        
        .issue {
            color: #ff6b6b;
        }
        
        /* æ“ä½œã‚¬ã‚¤ãƒ‰ */
        .operation-guide {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.9);
            padding: 12px;
            border-radius: 8px;
            font-size: 11px;
            max-width: 300px;
            border: 1px solid #333;
        }
        
        .operation-guide h4 {
            color: #007acc;
            margin-bottom: 8px;
            font-size: 12px;
        }
        
        .operation-step {
            margin: 4px 0;
            color: #ccc;
        }
        
        .step-number {
            color: #00ff88;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="top-bar">
        <div>
            <span style="font-weight: bold; color: #00ff88;">ğŸ§ª æ”¹å–„ã•ã‚ŒãŸç¸¦ç©ã¿ã‚·ã‚¹ãƒ†ãƒ  ãƒ†ã‚¹ãƒˆ</span>
        </div>
        
        <div class="test-controls">
            <button class="test-btn" onclick="switchToOriginal()">ğŸ”„ å¾“æ¥ç‰ˆåˆ‡æ›¿</button>
            <button class="test-btn" onclick="switchToImproved()">ğŸš€ æ”¹å–„ç‰ˆåˆ‡æ›¿</button>
            <button class="test-btn" onclick="resetLayout()">ğŸ“ ãƒªã‚»ãƒƒãƒˆ</button>
            <div class="test-status" id="current-system">æ”¹å–„ç‰ˆã‚¢ã‚¯ãƒ†ã‚£ãƒ–</div>
        </div>
    </div>

    <!-- ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒŠãƒ¼ãƒ‘ãƒãƒ« -->
    <div class="panel panel-outliner" data-panel="outliner">
        <div class="panel-header">
            <span class="panel-title">ğŸ“ ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒŠãƒ¼</span>
            <div style="font-size: 10px; color: #666;">ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½</div>
        </div>
        <div class="panel-content">
            <div style="color: #999; font-size: 13px;">
                <p>ğŸ“‚ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ </p>
                <div style="margin: 15px 0; padding: 10px; background: rgba(0, 122, 204, 0.1); border-radius: 4px;">
                    <strong style="color: #007acc;">ğŸ¯ ãƒ†ã‚¹ãƒˆæ‰‹é †:</strong>
                    <div style="margin-top: 8px; font-size: 11px; line-height: 1.4;">
                        1. ã“ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ãƒ‰ãƒ©ãƒƒã‚°<br>
                        2. ç”»é¢å·¦ç«¯/å³ç«¯ã«ç§»å‹•<br>
                        3. ç¸¦ç©ã¿ã‚¾ãƒ¼ãƒ³ã®è¡¨ç¤ºç¢ºèª<br>
                        4. ä»–ã®ãƒ‘ãƒãƒ«ä¸Šã§ãƒ‰ãƒ­ãƒƒãƒ—ç¢ºèª
                    </div>
                </div>
                <ul style="list-style: none; margin-left: 10px;">
                    <li style="margin: 5px 0;"><span style="color: #00ff88;">ğŸŸ¢</span> SystemCoordinator.js</li>
                    <li style="margin: 5px 0;"><span style="color: #007acc;">ğŸ”µ</span> ImprovedDragDrop.js</li>
                    <li style="margin: 5px 0;"><span style="color: #ffdd00;">ğŸŸ¡</span> LayoutManager.js</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ‘ãƒãƒ« -->
    <div class="panel panel-preview" data-panel="preview">
        <div class="panel-header">
            <span class="panel-title">ğŸ¬ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</span>
            <div style="font-size: 10px; color: #666;">ä¸­å¤®ã‚¨ãƒªã‚¢</div>
        </div>
        <div class="panel-content">
            <div class="preview-area">
                <div>
                    <div style="font-size: 48px; margin-bottom: 15px;">ğŸ­</div>
                    <p style="margin-bottom: 8px;">æ”¹å–„ã•ã‚ŒãŸç¸¦ç©ã¿ã‚·ã‚¹ãƒ†ãƒ </p>
                    <p style="font-size: 10px; color: #555;">ãƒ‰ãƒ©ãƒƒã‚°æ„Ÿåº¦ãƒ»è¦–è¦šãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯å¼·åŒ–ç‰ˆ</p>
                    <div style="margin-top: 20px; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 8px;">
                        <strong style="color: #00ff88;">âœ¨ ä¸»è¦æ”¹å–„ç‚¹:</strong>
                        <ul style="text-align: left; margin-top: 10px; font-size: 11px;">
                            <li>ğŸ¯ ãƒ‰ãƒ©ãƒƒã‚°æ„Ÿåº¦å‘ä¸Š (250px â†’ 100px)</li>
                            <li>ğŸ¨ æ®µéšçš„ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³è¡¨ç¤º</li>
                            <li>âš¡ ã‚¹ãƒ ãƒ¼ã‚ºãªã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³</li>
                            <li>ğŸ”„ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ‘ãƒãƒ« -->
    <div class="panel panel-properties" data-panel="properties">
        <div class="panel-header">
            <span class="panel-title">âš™ï¸ ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£</span>
            <div style="font-size: 10px; color: #666;">è¨­å®šãƒ‘ãƒãƒ«</div>
        </div>
        <div class="panel-content">
            <div style="font-size: 12px;">
                <div style="margin-bottom: 15px; padding: 10px; background: rgba(255, 107, 107, 0.1); border-radius: 4px;">
                    <strong style="color: #ff6b6b;">ğŸ” å¾“æ¥ç‰ˆã®å•é¡Œ:</strong>
                    <ul style="margin-top: 8px; font-size: 11px; line-height: 1.4;">
                        <li>â€¢ ç”»é¢ç«¯250px = æ„Ÿåº¦ä½ã™ã</li>
                        <li>â€¢ ãƒ‰ãƒ­ãƒƒãƒ—ãƒ’ãƒ³ãƒˆä¸è¶³</li>
                        <li>â€¢ é‡ã„ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆåˆ‡æ›¿</li>
                        <li>â€¢ ç›´æ„Ÿæ€§ã«æ¬ ã‘ã‚‹</li>
                    </ul>
                </div>
                
                <div style="padding: 10px; background: rgba(0, 255, 136, 0.1); border-radius: 4px;">
                    <strong style="color: #00ff88;">âœ… æ”¹å–„ç‰ˆã®ç‰¹å¾´:</strong>
                    <ul style="margin-top: 8px; font-size: 11px; line-height: 1.4;">
                        <li>â€¢ ç”»é¢ç«¯100px = è‡ªç„¶ãªæ„Ÿåº¦</li>
                        <li>â€¢ æ®µéšçš„ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³</li>
                        <li>â€¢ ã‚¹ãƒ ãƒ¼ã‚ºã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³</li>
                        <li>â€¢ ç¾ä»£çš„UIè¨­è¨ˆæº–æ‹ </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ãƒ‘ãƒãƒ« -->
    <div class="panel panel-timeline" data-panel="timeline">
        <div class="panel-header">
            <span class="panel-title">â° ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</span>
            <div style="font-size: 10px; color: #666;">æ¨ªé•·ãƒ‘ãƒãƒ«</div>
        </div>
        <div class="panel-content">
            <div style="text-align: center; color: #666;">
                <div style="font-size: 32px; margin-bottom: 10px;">â¯ï¸</div>
                <p>ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åˆ¶å¾¡ã‚¨ãƒªã‚¢</p>
                <p style="font-size: 10px; margin-top: 5px;">ã“ã®ãƒ‘ãƒãƒ«ã‚‚ä»–ã®ãƒ‘ãƒãƒ«ã¨å…¥ã‚Œæ›¿ãˆå¯èƒ½ã§ã™</p>
            </div>
        </div>
    </div>

    <!-- ãƒ‡ãƒãƒƒã‚°ãƒ‘ãƒãƒ« -->
    <div class="debug-panel">
        <h4>ğŸ” æ”¹å–„ç‰ˆã‚·ã‚¹ãƒ†ãƒ ç›£è¦–</h4>
        <div class="debug-info">
            <span class="label">ç¾åœ¨ã®ã‚·ã‚¹ãƒ†ãƒ :</span>
            <span class="value" id="system-status">æ”¹å–„ç‰ˆ</span>
        </div>
        <div class="debug-info">
            <span class="label">ãƒ‰ãƒ©ãƒƒã‚°çŠ¶æ…‹:</span>
            <span class="value" id="drag-status">å¾…æ©Ÿä¸­</span>
        </div>
        <div class="debug-info">
            <span class="label">æ¤œå‡ºã‚¾ãƒ¼ãƒ³:</span>
            <span class="value" id="current-zone">ãªã—</span>
        </div>
        <div class="debug-info">
            <span class="label">ã‚¨ãƒƒã‚¸æ„Ÿåº¦:</span>
            <span class="value" id="edge-threshold">100px</span>
        </div>
        
        <div class="comparison-info">
            <h5>ğŸ“Š å¾“æ¥ç‰ˆã¨ã®æ¯”è¼ƒ</h5>
            <div class="comparison-item improvement">âœ… æ„Ÿåº¦: 250px â†’ 100px (60%å‘ä¸Š)</div>
            <div class="comparison-item improvement">âœ… ãƒ’ãƒ³ãƒˆ: å¾Œå‡ºã— â†’ æ®µéšè¡¨ç¤º</div>
            <div class="comparison-item improvement">âœ… æ“ä½œæ€§: é‡ã„ â†’ ã‚¹ãƒ ãƒ¼ã‚º</div>
            <div class="comparison-item improvement">âœ… ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯: æœ€å° â†’ ãƒªãƒƒãƒ</div>
        </div>
    </div>
    
    <!-- æ“ä½œã‚¬ã‚¤ãƒ‰ -->
    <div class="operation-guide">
        <h4>ğŸ“– æ“ä½œã‚¬ã‚¤ãƒ‰</h4>
        <div class="operation-step"><span class="step-number">1.</span> ãƒ‘ãƒãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹</div>
        <div class="operation-step"><span class="step-number">2.</span> ç”»é¢å·¦ç«¯ãƒ»å³ç«¯ (100pxä»¥å†…) ã§ç¸¦ç©ã¿</div>
        <div class="operation-step"><span class="step-number">3.</span> ä»–ã®ãƒ‘ãƒãƒ«ä¸Šã§ãƒ‘ãƒãƒ«å…¥ã‚Œæ›¿ãˆ</div>
        <div class="operation-step"><span class="step-number">4.</span> ESCã‚­ãƒ¼ã§ãƒ‰ãƒ©ãƒƒã‚°ã‚­ãƒ£ãƒ³ã‚»ãƒ«</div>
        <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #333; font-size: 10px; color: #777;">
            ğŸ’¡ æ”¹å–„ç‰ˆã§ã¯ç”»é¢ç«¯100px = ã‚ˆã‚Šè‡ªç„¶ãªæ“ä½œæ„Ÿ
        </div>
    </div>

    <!-- æ”¹å–„ã•ã‚ŒãŸã‚·ã‚¹ãƒ†ãƒ èª­ã¿è¾¼ã¿ -->
    <script type="module">
        import { ImprovedDragDropController } from './micromodules/ui/ImprovedDragDropController.js';
        import { LayoutManager } from './micromodules/ui/LayoutManager.js';
        
        // ç°¡æ˜“ãƒ‘ãƒãƒ«ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼
        class TestPanelManager {
            getAllPanels() {
                return ['outliner', 'preview', 'properties', 'timeline'];
            }
            
            findPanel(panelId) {
                const element = document.querySelector(`.panel[data-panel="${panelId}"]`);
                return element ? { element, id: panelId } : null;
            }
        }
        
        // ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
        let currentSystem = 'improved';
        let improvedController = null;
        let layoutManager = null;
        let panelManager = null;
        
        async function initializeImprovedSystem() {
            console.log('ğŸš€ æ”¹å–„ç‰ˆã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–é–‹å§‹');
            
            try {
                // ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
                panelManager = new TestPanelManager();
                layoutManager = new LayoutManager();
                improvedController = new ImprovedDragDropController(panelManager, layoutManager);
                
                // åˆæœŸåŒ–
                const result = await improvedController.initializeDragDrop();
                
                // ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®š
                window.improvedSystem = {
                    controller: improvedController,
                    layoutManager: layoutManager,
                    panelManager: panelManager
                };
                
                // ãƒ‡ãƒãƒƒã‚°æ›´æ–°é–‹å§‹
                startDebugMonitoring();
                
                console.log(`âœ… æ”¹å–„ç‰ˆã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†: ${result}å€‹ã®ãƒ‘ãƒãƒ«`);
                updateSystemStatus('æ”¹å–„ç‰ˆ', 'ready');
                
            } catch (error) {
                console.error('âŒ æ”¹å–„ç‰ˆã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                updateSystemStatus('æ”¹å–„ç‰ˆ', 'error');
            }
        }
        
        // ãƒ‡ãƒãƒƒã‚°ç›£è¦–é–‹å§‹
        function startDebugMonitoring() {
            setInterval(() => {
                if (improvedController) {
                    const debugInfo = improvedController.getImprovedDebugInfo();
                    updateDebugDisplay(debugInfo);
                }
            }, 100);
        }
        
        // ãƒ‡ãƒãƒƒã‚°è¡¨ç¤ºæ›´æ–°
        function updateDebugDisplay(debugInfo) {
            document.getElementById('drag-status').textContent = 
                debugInfo.isDragging ? `ãƒ‰ãƒ©ãƒƒã‚°ä¸­: ${debugInfo.draggedPanel}` : 'å¾…æ©Ÿä¸­';
                
            document.getElementById('current-zone').textContent = 
                debugInfo.currentZone || 'ãªã—';
                
            document.getElementById('edge-threshold').textContent = 
                `${debugInfo.config?.edgeThreshold || 100}px`;
        }
        
        // ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹æ›´æ–°
        function updateSystemStatus(system, status) {
            document.getElementById('system-status').textContent = system;
            document.getElementById('current-system').textContent = `${system}ã‚¢ã‚¯ãƒ†ã‚£ãƒ–`;
            
            const statusElement = document.getElementById('current-system');
            statusElement.className = 'test-status';
            
            if (status === 'ready') {
                statusElement.style.background = '#00ff88';
                statusElement.style.color = 'black';
            } else if (status === 'error') {
                statusElement.style.background = '#ff6b6b';
                statusElement.style.color = 'white';
            }
        }
        
        // ãƒ†ã‚¹ãƒˆæ©Ÿèƒ½
        window.switchToOriginal = function() {
            alert('å¾“æ¥ç‰ˆåˆ‡æ›¿æ©Ÿèƒ½\nï¼ˆãƒ‡ãƒ¢ç”¨ - å®Ÿéš›ã®åˆ‡æ›¿ã¯è¤‡é›‘ãªå®Ÿè£…ãŒå¿…è¦ï¼‰');
        };
        
        window.switchToImproved = function() {
            if (!improvedController) {
                initializeImprovedSystem();
            } else {
                updateSystemStatus('æ”¹å–„ç‰ˆ', 'ready');
            }
        };
        
        window.resetLayout = function() {
            if (layoutManager) {
                layoutManager.resetLayout();
                localStorage.removeItem('spine-editor-stacks');
                updateSystemStatus('æ”¹å–„ç‰ˆ', 'ready');
                console.log('ğŸ“ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒªã‚»ãƒƒãƒˆå®Œäº†');
            }
        };
        
        // ãƒ‡ãƒãƒƒã‚°ç”¨ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        window.getImprovedDebugInfo = function() {
            return improvedController?.getImprovedDebugInfo();
        };
        
        // åˆæœŸåŒ–å®Ÿè¡Œ
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ§ª æ”¹å–„ã•ã‚ŒãŸç¸¦ç©ã¿ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆé–‹å§‹');
            initializeImprovedSystem();
        });
    </script>
</body>
</html>