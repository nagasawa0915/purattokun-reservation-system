<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ModularPanelSystemçµ±åˆãƒ†ã‚¹ãƒˆ - spine-editor-webapp</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1e1e1e;
            color: white;
            height: 100vh;
            display: grid;
            grid-template-areas: 
                "header header header"
                "outliner preview properties"
                "timeline timeline timeline";
            grid-template-columns: var(--outliner-width, 300px) 1fr var(--properties-width, 300px);
            grid-template-rows: 60px 1fr var(--timeline-height, 200px);
            gap: 1px;
            transition: grid-template-areas 0.3s ease;
        }
        
        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .test-header {
            grid-area: header;
            background: #2d2d2d;
            border-bottom: 1px solid #404040;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            gap: 20px;
        }
        
        .test-header h1 {
            font-size: 16px;
            color: #00ff88;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .test-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .test-btn {
            background: #007acc;
            border: 1px solid #0099ff;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
            white-space: nowrap;
        }
        
        .test-btn:hover {
            background: #0099ff;
            transform: translateY(-1px);
        }
        
        .test-btn:active {
            transform: translateY(0);
        }
        
        .reset-btn {
            background: #ff6b35;
            border-color: #ff8555;
        }
        
        .reset-btn:hover {
            background: #ff8555;
        }
        
        .status-display {
            background: rgba(0, 0, 0, 0.5);
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 11px;
            font-family: monospace;
        }
        
        /* ãƒ‘ãƒãƒ«å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
        .panel {
            background: #2d2d2d;
            border: 1px solid #404040;
            display: flex;
            flex-direction: column;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .panel:hover {
            border-color: #555555;
        }
        
        /* ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã®ãƒ‘ãƒãƒ«ã‚¹ã‚¿ã‚¤ãƒ« */
        .panel[draggable="true"] {
            cursor: grab;
        }
        
        .panel[draggable="true"]:active {
            cursor: grabbing;
        }
        
        .panel.dragging {
            opacity: 0.7;
            transform: scale(1.02);
            box-shadow: 0 4px 20px rgba(0, 122, 204, 0.4);
            border-color: #007acc;
        }
        
        .panel-header {
            height: 32px;
            background: #3a3a3a;
            border-bottom: 1px solid #404040;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 12px;
            user-select: none;
            transition: all 0.2s ease;
        }
        
        .panel-header:hover {
            background: #4a4a4a;
        }
        
        .panel-title {
            font-size: 13px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .panel-content {
            flex: 1;
            padding: 15px;
            overflow: auto;
        }
        
        /* å„ãƒ‘ãƒãƒ«é…ç½® */
        .panel-outliner { grid-area: outliner; }
        .panel-preview { grid-area: preview; }
        .panel-properties { grid-area: properties; }
        .panel-timeline { grid-area: timeline; }
        
        /* ãƒ‰ãƒ©ãƒƒã‚°ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ */
        .drag-insert-indicator {
            position: fixed;
            width: 3px;
            background: #007acc;
            z-index: 9999;
            display: none;
            border-radius: 2px;
            box-shadow: 0 0 8px rgba(0, 122, 204, 0.8);
            animation: indicatorPulse 1s infinite;
        }
        
        @keyframes indicatorPulse {
            0%, 100% { opacity: 0.8; transform: scaleY(1); }
            50% { opacity: 1; transform: scaleY(1.1); }
        }
        
        /* ãƒ†ã‚¹ãƒˆçµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ */
        .test-results {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 8px;
            font-size: 12px;
            max-width: 400px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #333;
            transition: all 0.3s ease;
        }
        
        .test-results:hover {
            transform: scale(1.02);
        }
        
        .test-results h3 {
            color: #00ff88;
            margin-bottom: 10px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .test-log {
            margin: 5px 0;
            padding: 6px;
            border-radius: 3px;
            font-family: monospace;
            font-size: 11px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .test-log.success {
            background: rgba(0, 255, 136, 0.2);
            border-left: 3px solid #00ff88;
            color: #ccffdd;
        }
        
        .test-log.info {
            background: rgba(0, 122, 204, 0.2);
            border-left: 3px solid #007acc;
            color: #ccddff;
        }
        
        .test-log.warning {
            background: rgba(255, 221, 0, 0.2);
            border-left: 3px solid #ffdd00;
            color: #ffffcc;
        }
        
        .test-log.error {
            background: rgba(255, 107, 107, 0.2);
            border-left: 3px solid #ff6b6b;
            color: #ffcccc;
        }
        
        /* Grid Template Areas è¡¨ç¤ºã‚¨ãƒªã‚¢ */
        .grid-areas-display {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 8px;
            font-size: 11px;
            font-family: monospace;
            border: 1px solid #333;
            min-width: 280px;
        }
        
        .grid-areas-display h4 {
            color: #00ff88;
            margin-bottom: 8px;
            font-size: 12px;
        }
        
        .current-areas {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px;
            border-radius: 4px;
            white-space: pre-wrap;
            color: #cccccc;
            border: 1px solid #444;
        }
        
        /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŠ¹æœ */
        .panel-transition {
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        .success-flash {
            animation: successFlash 0.6s ease-out;
        }
        
        @keyframes successFlash {
            0% { background: rgba(0, 255, 136, 0.3); transform: scale(1); }
            50% { background: rgba(0, 255, 136, 0.6); transform: scale(1.02); }
            100% { background: transparent; transform: scale(1); }
        }
        
        /* ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢å¼·åŒ– */
        .preview-area {
            background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
            height: 100%;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            position: relative;
            overflow: hidden;
        }
        
        .preview-content {
            text-align: center;
            z-index: 2;
        }
        
        /* ãƒ‡ãƒãƒƒã‚°ãƒ˜ãƒ«ãƒ— */
        .debug-help {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px;
            border-radius: 4px;
            font-size: 10px;
            color: #ccc;
            opacity: 0;
            transition: opacity 0.3s ease;
            max-width: 200px;
        }
        
        .debug-help.show {
            opacity: 1;
        }
        
        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        @media (max-width: 1024px) {
            body {
                grid-template-columns: 250px 1fr 250px;
            }
        }
    </style>
</head>
<body>
    <!-- ãƒ†ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="test-header">
        <h1>
            ğŸ§ª ModularPanelSystemçµ±åˆãƒ†ã‚¹ãƒˆ
        </h1>
        
        <div class="test-controls">
            <button class="test-btn" onclick="runTest('test1')">
                ğŸ”„ ãƒ†ã‚¹ãƒˆ1: ãƒ‘ãƒãƒ«1â†’2ã®å‰
            </button>
            <button class="test-btn" onclick="runTest('test2')">
                ğŸ”„ ãƒ†ã‚¹ãƒˆ2: ãƒ‘ãƒãƒ«3â†’1ã®å¾Œ
            </button>
            <button class="test-btn" onclick="runTest('test3')">
                ğŸ”„ ãƒ†ã‚¹ãƒˆ3: ãƒ‘ãƒãƒ«2â†’3ã®å‰
            </button>
            <button class="test-btn reset-btn" onclick="resetPanels()">
                ğŸ  ãƒªã‚»ãƒƒãƒˆ
            </button>
            <div class="status-display" id="test-status">
                å¾…æ©Ÿä¸­
            </div>
        </div>
    </div>

    <!-- ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒŠãƒ¼ãƒ‘ãƒãƒ« -->
    <div class="panel panel-outliner" data-panel="outliner" draggable="true">
        <div class="panel-header">
            <span class="panel-title">ğŸ“ 1. ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒŠãƒ¼</span>
            <div style="font-size: 10px; color: #666;">Ctrl+1</div>
        </div>
        <div class="panel-content">
            <div style="color: #999; font-size: 13px;">
                <p style="margin-bottom: 15px;">ğŸ“‚ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆéšå±¤</p>
                <ul style="list-style: none; padding-left: 10px;">
                    <li style="margin: 8px 0;">
                        <span style="color: #00ff88;">ğŸ“</span> spine-editor-webapp
                        <ul style="margin-left: 20px; margin-top: 8px;">
                            <li style="margin: 5px 0;">
                                <span style="color: #007acc;">ğŸ“</span> micromodules
                                <ul style="margin-left: 20px; margin-top: 5px;">
                                    <li style="color: #ffdd00;">ğŸŸ¡ DragDetector.js</li>
                                    <li style="color: #ffdd00;">ğŸŸ¡ PanelInserter.js</li>
                                    <li style="color: #ffdd00;">ğŸŸ¡ ModularPanelSystem.js</li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                </ul>
                <div style="margin-top: 15px; padding: 8px; background: rgba(0, 122, 204, 0.1); border-radius: 4px;">
                    <div style="font-size: 10px; color: #007acc;">ğŸ’¡ ãƒ‰ãƒ©ãƒƒã‚°ã§ãƒ‘ãƒãƒ«ç§»å‹•å¯èƒ½</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ‘ãƒãƒ« -->
    <div class="panel panel-preview" data-panel="preview" draggable="true">
        <div class="panel-header">
            <span class="panel-title">ğŸ¬ 2. ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</span>
            <div style="font-size: 10px; color: #666;">Ctrl+2</div>
        </div>
        <div class="panel-content">
            <div class="preview-area">
                <div class="preview-content">
                    <div style="font-size: 48px; margin-bottom: 15px;">ğŸ­</div>
                    <p style="margin-bottom: 8px;">ModularPanelSystem</p>
                    <p style="font-size: 12px; color: #666;">çµ±åˆãƒ†ã‚¹ãƒˆç’°å¢ƒ</p>
                    <div style="margin-top: 20px; padding: 10px; background: rgba(0, 255, 136, 0.1); border-radius: 4px;">
                        <div style="font-size: 10px; color: #00ff88;">âœ… ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—å¯¾å¿œ</div>
                        <div style="font-size: 10px; color: #00ff88;">âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ä½ç½®æ¤œå‡º</div>
                        <div style="font-size: 10px; color: #00ff88;">âœ… Grid Template Areasæ›´æ–°</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ‘ãƒãƒ« -->
    <div class="panel panel-properties" data-panel="properties" draggable="true">
        <div class="panel-header">
            <span class="panel-title">âš™ï¸ 3. ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£</span>
            <div style="font-size: 10px; color: #666;">Ctrl+3</div>
        </div>
        <div class="panel-content">
            <div style="color: #999; font-size: 12px;">
                <div style="margin-bottom: 15px;">
                    <h4 style="color: #00ff88; margin-bottom: 8px;">ğŸ¯ ModularPanelSystemè¨­å®š</h4>
                    <div style="background: rgba(255, 255, 255, 0.05); padding: 8px; border-radius: 4px;">
                        <div style="margin: 5px 0;">DragDetector: <span style="color: #00ff88;">æœ‰åŠ¹</span></div>
                        <div style="margin: 5px 0;">PanelInserter: <span style="color: #00ff88;">æœ‰åŠ¹</span></div>
                        <div style="margin: 5px 0;">æŒ¿å…¥ä½ç½®æ¤œå‡º: <span style="color: #00ff88;">before/after</span></div>
                    </div>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <h4 style="color: #007acc; margin-bottom: 8px;">ğŸ“Š ãƒ†ã‚¹ãƒˆçŠ¶æ³</h4>
                    <div id="test-statistics" style="background: rgba(0, 122, 204, 0.1); padding: 8px; border-radius: 4px; font-size: 11px;">
                        <div>å®Ÿè¡Œå›æ•°: <span id="test-count">0</span></div>
                        <div>æˆåŠŸ: <span id="success-count">0</span></div>
                        <div>å¤±æ•—: <span id="error-count">0</span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ãƒ‘ãƒãƒ« -->
    <div class="panel panel-timeline" data-panel="timeline">
        <div class="panel-header">
            <span class="panel-title">â° 4. ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</span>
            <div style="font-size: 10px; color: #666;">å›ºå®šãƒ‘ãƒãƒ«</div>
        </div>
        <div class="panel-content">
            <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #666;">
                <div style="text-align: center;">
                    <div style="font-size: 32px; margin-bottom: 10px;">â¯ï¸</div>
                    <p style="margin-bottom: 5px;">ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ãƒ‘ãƒãƒ«</p>
                    <p style="font-size: 10px; color: #555;">(ãƒ‰ãƒ©ãƒƒã‚°å¯¾è±¡å¤–)</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ãƒ†ã‚¹ãƒˆçµæœè¡¨ç¤º -->
    <div class="test-results">
        <h3>ğŸ§ª ãƒ†ã‚¹ãƒˆå®Ÿè¡Œãƒ­ã‚°</h3>
        <div id="test-log-container">
            <div class="test-log info">
                <span>ğŸ’¡</span>
                <span>ModularPanelSystemçµ±åˆãƒ†ã‚¹ãƒˆç’°å¢ƒèµ·å‹•</span>
            </div>
        </div>
        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #333; font-size: 10px; color: #777;">
            <div>ğŸ’¡ ãƒ‘ãƒãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ä»–ã®ãƒ‘ãƒãƒ«ã®å·¦å³ã«ç§»å‹•</div>
            <div>ğŸ’¡ æŒ¿å…¥ä½ç½®ã¯é’ã„ãƒ©ã‚¤ãƒ³ã§è¡¨ç¤º</div>
            <div>ğŸ’¡ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ãƒ‘ãƒãƒ«ã¯ãƒ‰ãƒ©ãƒƒã‚°å¯¾è±¡å¤–</div>
        </div>
    </div>

    <!-- Grid Template Areas è¡¨ç¤º -->
    <div class="grid-areas-display">
        <h4>ğŸ“ Grid Template Areas</h4>
        <div class="current-areas" id="current-areas-display">
"header header header"
"outliner preview properties"
"timeline timeline timeline"
        </div>
        <div style="margin-top: 8px; font-size: 10px; color: #777;">
            ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°
        </div>
    </div>

    <!-- ãƒ‡ãƒãƒƒã‚°ãƒ˜ãƒ«ãƒ— -->
    <div class="debug-help" id="debug-help">
        <div>ğŸ”§ ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½</div>
        <div>F12ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«çŠ¶æ…‹ç¢ºèª</div>
        <div>window.modularPanelSystem</div>
        <div>window.testController</div>
    </div>

    <!-- DragDetectorèª­ã¿è¾¼ã¿ -->
    <script src="micromodules/ui/modular-panel-system/DragDetector.js"></script>
    
    <!-- ModularPanelSystemçµ±åˆãƒ†ã‚¹ãƒˆ -->
    <script type="module">
        import { ModularPanelSystem } from './micromodules/ui/modular-panel-system/ModularPanelSystem.js';
        
        // ãƒ†ã‚¹ãƒˆåˆ¶å¾¡ã‚¯ãƒ©ã‚¹
        class TestController {
            constructor() {
                this.testCount = 0;
                this.successCount = 0;
                this.errorCount = 0;
                this.modularPanelSystem = null;
                
                this.init();
            }
            
            init() {
                // ModularPanelSystemåˆæœŸåŒ–
                try {
                    this.modularPanelSystem = new ModularPanelSystem();
                    window.modularPanelSystem = this.modularPanelSystem;
                    
                    this.logTest('ModularPanelSystemåˆæœŸåŒ–å®Œäº†', 'success');
                    this.updateStatus('ã‚·ã‚¹ãƒ†ãƒ æº–å‚™å®Œäº†');
                    
                    // ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
                    this.setupEventListeners();
                    
                    // Grid Template Areasç›£è¦–é–‹å§‹
                    this.startGridAreasMonitoring();
                    
                } catch (error) {
                    this.logTest(`åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                    this.updateStatus('åˆæœŸåŒ–å¤±æ•—');
                }
            }
            
            setupEventListeners() {
                // ãƒ‘ãƒãƒ«æŒ¿å…¥æˆåŠŸã‚¤ãƒ™ãƒ³ãƒˆ
                document.addEventListener('panelInserted', (event) => {
                    this.successCount++;
                    this.updateStatistics();
                    this.logTest(`ãƒ‘ãƒãƒ«æŒ¿å…¥æˆåŠŸ: ${event.detail.operation}`, 'success');
                    this.updateStatus('æŒ¿å…¥å®Œäº†');
                    
                    // æˆåŠŸãƒ•ãƒ©ãƒƒã‚·ãƒ¥åŠ¹æœ
                    this.flashSuccess();
                });
                
                // ãƒ‘ãƒãƒ«æŒ¿å…¥å¤±æ•—ã‚¤ãƒ™ãƒ³ãƒˆ
                document.addEventListener('panelInsertFailed', (event) => {
                    this.errorCount++;
                    this.updateStatistics();
                    this.logTest(`ãƒ‘ãƒãƒ«æŒ¿å…¥å¤±æ•—: ${event.detail.error}`, 'error');
                    this.updateStatus('æŒ¿å…¥å¤±æ•—');
                });
                
                // ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹ãƒ»çµ‚äº†ã®è¦–è¦šãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
                document.querySelectorAll('[data-panel][draggable="true"]').forEach(panel => {
                    panel.addEventListener('dragstart', () => {
                        panel.classList.add('dragging');
                        this.updateStatus('ãƒ‰ãƒ©ãƒƒã‚°ä¸­...');
                    });
                    
                    panel.addEventListener('dragend', () => {
                        panel.classList.remove('dragging');
                        this.updateStatus('ãƒ‰ãƒ©ãƒƒã‚°çµ‚äº†');
                    });
                });
            }
            
            // ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ†ã‚£ãƒƒã‚¯ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
            async runTest(testId) {
                this.testCount++;
                this.updateStatistics();
                
                try {
                    this.updateStatus(`ãƒ†ã‚¹ãƒˆ${testId}å®Ÿè¡Œä¸­...`);
                    
                    let result;
                    switch (testId) {
                        case 'test1':
                            // ãƒ‘ãƒãƒ«1ã‚’ãƒ‘ãƒãƒ«2ã®å‰ã«æŒ¿å…¥ â†’ "properties preview outliner"
                            result = this.modularPanelSystem.panelInserter.insertHorizontally(
                                'properties', 'preview', 'before'
                            );
                            this.logTest('ãƒ†ã‚¹ãƒˆ1: properties â†’ preview ã®å‰', 'info');
                            break;
                            
                        case 'test2':
                            // ãƒ‘ãƒãƒ«3ã‚’ãƒ‘ãƒãƒ«1ã®å¾Œã«æŒ¿å…¥ â†’ "outliner properties preview"
                            result = this.modularPanelSystem.panelInserter.insertHorizontally(
                                'properties', 'outliner', 'after'
                            );
                            this.logTest('ãƒ†ã‚¹ãƒˆ2: properties â†’ outliner ã®å¾Œ', 'info');
                            break;
                            
                        case 'test3':
                            // ãƒ‘ãƒãƒ«2ã‚’ãƒ‘ãƒãƒ«3ã®å‰ã«æŒ¿å…¥ â†’ "outliner preview properties"
                            result = this.modularPanelSystem.panelInserter.insertHorizontally(
                                'preview', 'properties', 'before'
                            );
                            this.logTest('ãƒ†ã‚¹ãƒˆ3: preview â†’ properties ã®å‰', 'info');
                            break;
                            
                        default:
                            throw new Error(`æœªçŸ¥ã®ãƒ†ã‚¹ãƒˆID: ${testId}`);
                    }
                    
                    if (result.success) {
                        this.successCount++;
                        this.logTest(`${testId}æˆåŠŸ: ${result.newOrder.join(' â†’ ')}`, 'success');
                        this.updateStatus('ãƒ†ã‚¹ãƒˆæˆåŠŸ');
                        this.flashSuccess();
                    } else {
                        this.errorCount++;
                        this.logTest(`${testId}å¤±æ•—: ${result.error}`, 'error');
                        this.updateStatus('ãƒ†ã‚¹ãƒˆå¤±æ•—');
                    }
                    
                } catch (error) {
                    this.errorCount++;
                    this.logTest(`${testId}ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                    this.updateStatus('ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼');
                }
                
                this.updateStatistics();
            }
            
            // ãƒ‘ãƒãƒ«ãƒªã‚»ãƒƒãƒˆ
            resetPanels() {
                try {
                    const result = this.modularPanelSystem.panelInserter.resetToDefaultLayout();
                    if (result.success) {
                        this.logTest('ãƒ‘ãƒãƒ«ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒªã‚»ãƒƒãƒˆå®Œäº†', 'success');
                        this.updateStatus('ãƒªã‚»ãƒƒãƒˆå®Œäº†');
                        this.flashSuccess();
                    } else {
                        this.logTest(`ãƒªã‚»ãƒƒãƒˆå¤±æ•—: ${result.error}`, 'error');
                        this.updateStatus('ãƒªã‚»ãƒƒãƒˆå¤±æ•—');
                    }
                } catch (error) {
                    this.logTest(`ãƒªã‚»ãƒƒãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                    this.updateStatus('ãƒªã‚»ãƒƒãƒˆã‚¨ãƒ©ãƒ¼');
                }
            }
            
            // Grid Template Areasç›£è¦–
            startGridAreasMonitoring() {
                const updateDisplay = () => {
                    const gridContainer = document.body;
                    const computedStyle = getComputedStyle(gridContainer);
                    const areas = computedStyle.getPropertyValue('grid-template-areas');
                    
                    const display = document.getElementById('current-areas-display');
                    if (display) {
                        display.textContent = areas || 'æœªè¨­å®š';
                    }
                };
                
                // åˆå›æ›´æ–°
                updateDisplay();
                
                // å®šæœŸæ›´æ–°ï¼ˆ500msé–“éš”ï¼‰
                setInterval(updateDisplay, 500);
            }
            
            // UIæ›´æ–°ãƒ¡ã‚½ãƒƒãƒ‰
            updateStatus(status) {
                const statusEl = document.getElementById('test-status');
                if (statusEl) {
                    statusEl.textContent = status;
                }
            }
            
            updateStatistics() {
                document.getElementById('test-count').textContent = this.testCount;
                document.getElementById('success-count').textContent = this.successCount;
                document.getElementById('error-count').textContent = this.errorCount;
            }
            
            logTest(message, type = 'info') {
                const logContainer = document.getElementById('test-log-container');
                const logEntry = document.createElement('div');
                logEntry.className = `test-log ${type}`;
                
                const icon = {
                    'success': 'âœ…',
                    'info': 'ğŸ’¡',
                    'warning': 'âš ï¸',
                    'error': 'âŒ'
                }[type] || 'ğŸ’¬';
                
                const timestamp = new Date().toLocaleTimeString('ja-JP');
                logEntry.innerHTML = `
                    <span>${icon}</span>
                    <span>[${timestamp}] ${message}</span>
                `;
                
                // æœ€æ–°ãƒ­ã‚°ã‚’ä¸Šã«è¿½åŠ 
                logContainer.insertBefore(logEntry, logContainer.firstChild);
                
                // ãƒ­ã‚°æ•°åˆ¶é™ï¼ˆæœ€æ–°20ä»¶ã¾ã§ï¼‰
                while (logContainer.children.length > 20) {
                    logContainer.removeChild(logContainer.lastChild);
                }
            }
            
            flashSuccess() {
                document.body.classList.add('success-flash');
                setTimeout(() => {
                    document.body.classList.remove('success-flash');
                }, 600);
            }
        }
        
        // ãƒ†ã‚¹ãƒˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼åˆæœŸåŒ–
        const testController = new TestController();
        window.testController = testController;
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ï¼ˆHTMLå´ã‹ã‚‰å‘¼ã³å‡ºã—ï¼‰
        window.runTest = (testId) => {
            testController.runTest(testId);
        };
        
        window.resetPanels = () => {
            testController.resetPanels();
        };
        
        // ãƒ‡ãƒãƒƒã‚°ãƒ˜ãƒ«ãƒ—è¡¨ç¤ºåˆ¶å¾¡
        let helpTimeout;
        document.addEventListener('keydown', (e) => {
            if (e.key === 'F1') {
                e.preventDefault();
                document.getElementById('debug-help').classList.add('show');
                clearTimeout(helpTimeout);
                helpTimeout = setTimeout(() => {
                    document.getElementById('debug-help').classList.remove('show');
                }, 5000);
            }
        });
        
        // åˆæœŸåŒ–å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        console.log('ğŸ§ª ModularPanelSystemçµ±åˆãƒ†ã‚¹ãƒˆç’°å¢ƒæº–å‚™å®Œäº†');
        console.log('ğŸ”§ ãƒ‡ãƒãƒƒã‚°ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ:');
        console.log('  window.modularPanelSystem - ModularPanelSystemã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹');
        console.log('  window.testController - ãƒ†ã‚¹ãƒˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼');
        console.log('ğŸ’¡ F1ã‚­ãƒ¼ã§ãƒ‡ãƒãƒƒã‚°ãƒ˜ãƒ«ãƒ—è¡¨ç¤º');
        
    </script>
</body>
</html>