<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StableSpineRenderer - åŸºæœ¬å‹•ä½œç¢ºèª</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f8ff;
        }
        
        h1 {
            color: #333;
            text-align: center;
        }
        
        #spine-canvas {
            border: 2px solid #4CAF50;
            border-radius: 8px;
            background-color: white;
            display: block;
            margin: 20px auto;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .control-panel {
            text-align: center;
            margin: 20px 0;
        }
        
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        
        button:hover {
            background-color: #45a049;
        }
        
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        .status {
            background-color: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
        
        .success {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        
        .error {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        
        .animation-list {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ¯ StableSpineRenderer - åŸºæœ¬å‹•ä½œç¢ºèª</h1>
    
    <!-- ãƒãƒ‹ãƒ¥ã‚¢ãƒ«é€šã‚Šã®Canvasè¦ç´  -->
    <canvas id="spine-canvas" width="400" height="400"></canvas>
    
    <!-- åˆ¶å¾¡ãƒ‘ãƒãƒ« -->
    <div class="control-panel">
        <button id="init-btn" onclick="initializeRenderer()">ğŸ“¦ åˆæœŸåŒ–</button>
        <button id="stop-btn" onclick="stopRenderer()" disabled>â¹ï¸ åœæ­¢</button>
    </div>
    
    <!-- ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ï¼ˆpurattokunå°‚ç”¨ï¼‰ -->
    <div class="animation-list">
        <button onclick="playAnimation('taiki')" disabled id="anim-taiki">ğŸ± å¾…æ©Ÿ (taiki)</button>
        <button onclick="playAnimation('yarare')" disabled id="anim-yarare">ğŸ’« ã‚„ã‚‰ã‚Œ (yarare)</button>
        <button onclick="playAnimation('syutugen')" disabled id="anim-syutugen">âœ¨ å‡ºç¾ (syutugen)</button>
    </div>
    
    <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º -->
    <div id="status" class="status">ğŸ“‹ æº–å‚™å®Œäº† - 'ğŸ“¦ åˆæœŸåŒ–'ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦StableSpineRendererã‚’é–‹å§‹ã—ã¦ãã ã•ã„</div>
    
    <!-- ãƒãƒ‹ãƒ¥ã‚¢ãƒ«é€šã‚Šã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿ -->
    <script src="https://unpkg.com/@esotericsoftware/spine-webgl@4.1.24/dist/iife/spine-webgl.js"></script>
    <script src="../micromodules/spine-renderer/StableSpineRenderer.js"></script>
    
    <script>
        let renderer = null;
        
        function updateStatus(message, type = 'info') {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
        }
        
        function setAnimationButtonsEnabled(enabled) {
            const buttons = ['anim-taiki', 'anim-yarare', 'anim-syutugen'];
            buttons.forEach(id => {
                document.getElementById(id).disabled = !enabled;
            });
        }
        
        async function initializeRenderer() {
            try {
                updateStatus('ğŸ”„ StableSpineRendereråˆæœŸåŒ–ä¸­...', 'info');
                
                // ãƒœã‚¿ãƒ³ç„¡åŠ¹åŒ–
                document.getElementById('init-btn').disabled = true;
                
                // ãƒãƒ‹ãƒ¥ã‚¢ãƒ«é€šã‚Šã®1è¡Œä½œæˆ + åˆæœŸåŒ–
                renderer = StableSpineRenderer.createForCharacter('purattokun');
                await renderer.initialize();
                
                updateStatus('âœ… åˆæœŸåŒ–å®Œäº†ï¼ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã§å‹•ä½œç¢ºèªã—ã¦ãã ã•ã„', 'success');
                
                // ãƒœã‚¿ãƒ³æœ‰åŠ¹åŒ–
                document.getElementById('stop-btn').disabled = false;
                setAnimationButtonsEnabled(true);
                
                // ãƒãƒ‹ãƒ¥ã‚¢ãƒ«é€šã‚Šã®è‡ªå‹•ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å†ç”Ÿ
                renderer.playAnimation('taiki');
                updateStatus('âœ… åˆæœŸåŒ–å®Œäº†ï¼taikiã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å†ç”Ÿä¸­', 'success');
                
            } catch (error) {
                console.error('âŒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                updateStatus(`âŒ åˆæœŸåŒ–å¤±æ•—: ${error.message}`, 'error');
                
                // ãƒœã‚¿ãƒ³ãƒªã‚»ãƒƒãƒˆ
                document.getElementById('init-btn').disabled = false;
                document.getElementById('stop-btn').disabled = true;
                setAnimationButtonsEnabled(false);
            }
        }
        
        function playAnimation(animationName) {
            if (!renderer) {
                updateStatus('âŒ ã‚¨ãƒ©ãƒ¼: å…ˆã«åˆæœŸåŒ–ã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            try {
                renderer.playAnimation(animationName);
                updateStatus(`ğŸ¬ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å†ç”Ÿä¸­: ${animationName}`, 'success');
            } catch (error) {
                console.error(`âŒ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å†ç”Ÿã‚¨ãƒ©ãƒ¼:`, error);
                updateStatus(`âŒ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å†ç”Ÿå¤±æ•—: ${error.message}`, 'error');
            }
        }
        
        function stopRenderer() {
            if (renderer) {
                try {
                    // ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ã®åœæ­¢ï¼ˆdisposeç­‰ãŒã‚ã‚Œã°å‘¼ã³å‡ºã—ï¼‰
                    if (renderer.dispose) {
                        renderer.dispose();
                    }
                    renderer = null;
                    
                    updateStatus('â¹ï¸ ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ã‚’åœæ­¢ã—ã¾ã—ãŸ', 'info');
                    
                    // ãƒœã‚¿ãƒ³ãƒªã‚»ãƒƒãƒˆ
                    document.getElementById('init-btn').disabled = false;
                    document.getElementById('stop-btn').disabled = true;
                    setAnimationButtonsEnabled(false);
                    
                    // Canvas ã‚¯ãƒªã‚¢
                    const canvas = document.getElementById('spine-canvas');
                    const ctx = canvas.getContext('2d');
                    if (ctx) {
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                    }
                    
                } catch (error) {
                    console.error('âŒ åœæ­¢ã‚¨ãƒ©ãƒ¼:', error);
                    updateStatus(`âŒ åœæ­¢ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                }
            }
        }
        
        // ãƒ‡ãƒãƒƒã‚°æƒ…å ±è¡¨ç¤ºï¼ˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼‰
        window.addEventListener('load', () => {
            console.log('ğŸ¯ StableSpineRenderer ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†');
            console.log('ğŸ“‹ åˆ©ç”¨å¯èƒ½ãªæ“ä½œ:');
            console.log('  - initializeRenderer(): ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼åˆæœŸåŒ–');
            console.log('  - playAnimation(name): ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å†ç”Ÿ');
            console.log('  - stopRenderer(): ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼åœæ­¢');
            console.log('ğŸ“‚ purattokunåˆ©ç”¨å¯èƒ½ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³: taiki, yarare, syutugen');
            
            // ãƒ‡ãƒãƒƒã‚°ç”¨ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°
            window.debugRenderer = () => {
                console.log('ğŸ” ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼çŠ¶æ…‹:', renderer);
                if (renderer && renderer.config) {
                    console.log('âš™ï¸ è¨­å®š:', renderer.config);
                }
                if (renderer && renderer.skeleton) {
                    console.log('ğŸ’€ ã‚¹ã‚±ãƒ«ãƒˆãƒ³:', renderer.skeleton);
                    console.log('ğŸ¬ åˆ©ç”¨å¯èƒ½ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³:', renderer.skeleton.data.animations.map(a => a.name));
                }
            };
        });
    </script>
    
    <!-- ä½¿ç”¨æ–¹æ³• -->
    <div style="margin-top: 40px; padding: 20px; background-color: #f9f9f9; border-radius: 8px;">
        <h3>ğŸ“‹ ä½¿ç”¨æ–¹æ³•</h3>
        <ol>
            <li><strong>ã€ŒğŸ“¦ åˆæœŸåŒ–ã€ãƒœã‚¿ãƒ³</strong>ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ StableSpineRenderer.createForCharacter('purattokun')ã‚’å®Ÿè¡Œ</li>
            <li><strong>ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³</strong>ã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ purattokunå›ºæœ‰ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å†ç”Ÿ</li>
            <li><strong>F12ã‚³ãƒ³ã‚½ãƒ¼ãƒ«</strong>ã§è©³ç´°ãªãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’ç¢ºèªå¯èƒ½</li>
        </ol>
        
        <h3>ğŸ”§ ãƒ‡ãƒãƒƒã‚°ã‚³ãƒãƒ³ãƒ‰ï¼ˆF12ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼‰</h3>
        <ul>
            <li><code>debugRenderer()</code> - ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ã®è©³ç´°çŠ¶æ…‹è¡¨ç¤º</li>
            <li><code>renderer</code> - ç¾åœ¨ã®ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå‚ç…§</li>
        </ul>
        
        <h3>ğŸ“‚ æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ</h3>
        <ul>
            <li>âœ… HTTPã‚µãƒ¼ãƒãƒ¼çµŒç”±ã§purattokuã‚“ãŒæ­£å¸¸è¡¨ç¤º</li>
            <li>âœ… 'taiki'ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒè‡ªå‹•å†ç”Ÿ</li>
            <li>âœ… é»’æ ãªã—ã§ã‚¯ãƒªã‚¢ãªè¡¨ç¤º</li>
            <li>âœ… 3ã¤ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆtaiki/yarare/syutugenï¼‰ãŒåˆ‡ã‚Šæ›¿ãˆå¯èƒ½</li>
        </ul>
    </div>
    
</body>
</html>