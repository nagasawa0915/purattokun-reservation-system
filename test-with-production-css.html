<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ¬ç•ªCSSãƒ«ãƒ¼ãƒ«é©ç”¨ãƒ†ã‚¹ãƒˆ - ã·ã‚‰ã£ã¨ãã‚“</title>
    <style>
        /* ãƒªã‚»ãƒƒãƒˆ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* èƒŒæ™¯ã‚³ãƒ³ãƒ†ãƒŠ */
        .background-container {
            position: relative;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            overflow: hidden;
        }
        
        /* èƒŒæ™¯ç”»åƒ */
        .background-image {
            width: 100%;
            height: auto;
            display: block;
        }
        
        /* é›²ã®å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
        .cloud {
            position: absolute;
            opacity: 0.7;
            pointer-events: none;
        }
        
        /* å„é›²ã®ä½ç½® */
        .cloud1 { left: -5%; top: 10%; width: 8%; animation: moveCloud1 25s linear infinite; }
        .cloud2 { left: -5%; top: 15%; width: 8%; animation: moveCloud2 30s linear infinite; }
        .cloud3 { left: -5%; top: 8%; width: 8%; animation: moveCloud3 35s linear infinite; }
        
        /* é›²ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes moveCloud1 { from { left: -10%; } to { left: 110%; } }
        @keyframes moveCloud2 { from { left: -10%; } to { left: 110%; } }
        @keyframes moveCloud3 { from { left: -10%; } to { left: 110%; } }
        
        /* 
        ===========================================================
        æœ¬ç•ªã®CSSãƒ«ãƒ¼ãƒ«1: canvas[data-spine-character]
        å½¹å‰²: data-spine-characterå±æ€§ã‚’æŒã¤Canvasè¦ç´ ã®é…ç½®ã‚’åˆ¶å¾¡
        ===========================================================
        */
        canvas[data-spine-character] {
            position: absolute;
            left: 18%;            /* èƒŒæ™¯ç”»åƒã®å·¦ã‹ã‚‰18%ã®ä½ç½® */
            top: 49%;             /* èƒŒæ™¯ç”»åƒã®ä¸Šã‹ã‚‰49%ã®ä½ç½® */
            width: 16%;           /* èƒŒæ™¯ç”»åƒã®å¹…ã®16% */
            height: 16%;          /* èƒŒæ™¯ç”»åƒã®é«˜ã•ã®16% */
            transform: translate(-50%, -50%);  /* ä¸­å¿ƒç‚¹ã‚’åŸºæº–ã«é…ç½® */
            pointer-events: auto;  /* ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã«ã™ã‚‹ */
            z-index: 10;          /* ãƒ¬ã‚¤ãƒ¤ãƒ¼é †åºï¼ˆé«˜ã„å€¤ = å‰é¢ï¼‰ */
        }
        
        /* 
        ===========================================================
        æœ¬ç•ªã®CSSãƒ«ãƒ¼ãƒ«2: #purattokun-canvas
        å½¹å‰²: IDæŒ‡å®šã•ã‚ŒãŸCanvasè¦ç´ ã®åŸºæœ¬è¨­å®š
        æ³¨æ„: æœ¬ç•ªã§ã¯å®Ÿéš›ã«ã¯ä½¿ã‚ã‚Œã¦ã„ãªã„ï¼ˆIDãŒè¨­å®šã•ã‚Œã¦ã„ãªã„ãŸã‚ï¼‰
        ===========================================================
        */
        #purattokun-canvas {
            position: absolute;
            pointer-events: none;      /* ã‚¯ãƒªãƒƒã‚¯ç„¡åŠ¹ï¼ˆä¸Šè¨˜ãƒ«ãƒ¼ãƒ«ã¨çŸ›ç›¾ï¼‰ */
            z-index: 2;               /* ãƒ¬ã‚¤ãƒ¤ãƒ¼é †åºï¼ˆä½ã„å€¤ï¼‰ */
            /* ä½ç½®ã¯ JavaScript ã§è¨­å®š */
            transform-origin: center center;  /* å¤‰å½¢ã®åŸºæº–ç‚¹ã‚’ä¸­å¿ƒã« */
        }
        
        /* 
        ===========================================================
        æ¯”è¼ƒç”¨: ã‚·ãƒ³ãƒ—ãƒ«ã‚µãƒ³ãƒ—ãƒ«ã®ã‚ªãƒªã‚¸ãƒŠãƒ«ãƒ«ãƒ¼ãƒ«ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆï¼‰
        ===========================================================
        */
        /*
        #purattokun-canvas {
            position: absolute;
            left: 35%;
            top: 75%;
            transform: translate(-50%, -50%);
            width: 80%;
            height: 80%;
            pointer-events: auto;
        }
        */
        
        .info {
            margin: 20px;
            padding: 20px;
            background: #f0f0f0;
            border-radius: 8px;
        }
        
        .status {
            margin-top: 10px;
            padding: 10px;
            background: #e0e0e0;
            border-radius: 4px;
            font-family: monospace;
        }
        
        .css-rules-info {
            margin: 20px;
            padding: 20px;
            background: #fff3cd;
            border: 2px solid #ffeaa7;
            border-radius: 8px;
        }
        
        .css-rules-info h3 {
            color: #856404;
            margin-bottom: 10px;
        }
        
        .css-rules-info ul {
            list-style: none;
            padding-left: 0;
        }
        
        .css-rules-info li {
            margin: 5px 0;
            padding: 5px 10px;
            background: #fef3cd;
            border-radius: 4px;
        }
        
        .css-conflict {
            color: #d63031;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="info">
        <h1>æœ¬ç•ªCSSãƒ«ãƒ¼ãƒ«é©ç”¨ãƒ†ã‚¹ãƒˆ</h1>
        <p>ã‚·ãƒ³ãƒ—ãƒ«ã‚µãƒ³ãƒ—ãƒ«ã«æœ¬ç•ªã¨åŒã˜CSSãƒ«ãƒ¼ãƒ«ã‚’é©ç”¨ã—ã¦å‹•ä½œã‚’ç¢ºèª</p>
        <div class="status" id="status">åˆæœŸåŒ–ä¸­...</div>
    </div>
    
    <div class="css-rules-info">
        <h3>ğŸ¨ é©ç”¨ã•ã‚Œã¦ã„ã‚‹CSSãƒ«ãƒ¼ãƒ«ï¼š</h3>
        <ul>
            <li><strong>canvas[data-spine-character]</strong>: 
                <ul>
                    <li>ä½ç½®: left: 18%, top: 49%ï¼ˆèƒŒæ™¯ç”»åƒåŸºæº–ï¼‰</li>
                    <li>ã‚µã‚¤ã‚º: width: 16%, height: 16%ï¼ˆèƒŒæ™¯ç”»åƒåŸºæº–ï¼‰</li>
                    <li>transform: translate(-50%, -50%)ï¼ˆä¸­å¿ƒç‚¹é…ç½®ï¼‰</li>
                    <li>pointer-events: autoï¼ˆã‚¯ãƒªãƒƒã‚¯å¯èƒ½ï¼‰</li>
                    <li>z-index: 10ï¼ˆå‰é¢ã«é…ç½®ï¼‰</li>
                </ul>
            </li>
            <li><strong>#purattokun-canvas</strong>: 
                <ul>
                    <li>position: absolute</li>
                    <li class="css-conflict">pointer-events: noneï¼ˆã‚¯ãƒªãƒƒã‚¯ç„¡åŠ¹ - ä¸Šè¨˜ã¨çŸ›ç›¾ï¼ï¼‰</li>
                    <li>z-index: 2ï¼ˆèƒŒé¢å¯„ã‚Šï¼‰</li>
                    <li>ä½ç½®æŒ‡å®šãªã—ï¼ˆJavaScriptã§è¨­å®šæƒ³å®šï¼‰</li>
                </ul>
            </li>
        </ul>
        <p><strong>âš ï¸ å•é¡Œç‚¹:</strong> 2ã¤ã®ãƒ«ãƒ¼ãƒ«ãŒç«¶åˆã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ç‰¹ã«pointer-eventsã¨z-indexã®å€¤ãŒç•°ãªã‚Šã¾ã™ã€‚</p>
    </div>
    
    <!-- èƒŒæ™¯ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div class="background-container">
        <img src="assets/images/ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼TOP.png" alt="èƒŒæ™¯" class="background-image">
        <img src="assets/images/kumo1.png" alt="é›²1" class="cloud cloud1">
        <img src="assets/images/kumo2.png" alt="é›²2" class="cloud cloud2">
        <img src="assets/images/kumo3.png" alt="é›²3" class="cloud cloud3">
        <!-- Canvasè¦ç´ ï¼šä¸¡æ–¹ã®å±æ€§ã‚’è¨­å®šã—ã¦ãƒ†ã‚¹ãƒˆ -->
        <canvas id="purattokun-canvas" data-spine-character="purattokun"></canvas>
    </div>
    
    <!-- Spine WebGL Runtime -->
    <script src="https://unpkg.com/@esotericsoftware/spine-webgl@4.1.*/dist/iife/spine-webgl.js"></script>
    
    <!-- æœ€å°é™ã®Spineçµ±åˆ -->
    <script>
        const status = document.getElementById('status');
        
        // Canvasè¦ç´ ã®æƒ…å ±ã‚’è¡¨ç¤º
        function showCanvasInfo() {
            const canvas = document.getElementById('purattokun-canvas');
            const computed = window.getComputedStyle(canvas);
            
            console.log('ğŸ¨ Canvas CSSæƒ…å ±:');
            console.log('  - ID:', canvas.id);
            console.log('  - data-spine-character:', canvas.getAttribute('data-spine-character'));
            console.log('  - è¨ˆç®—ã•ã‚ŒãŸã‚¹ã‚¿ã‚¤ãƒ«:');
            console.log('    - position:', computed.position);
            console.log('    - left:', computed.left);
            console.log('    - top:', computed.top);
            console.log('    - width:', computed.width);
            console.log('    - height:', computed.height);
            console.log('    - transform:', computed.transform);
            console.log('    - pointer-events:', computed.pointerEvents);
            console.log('    - z-index:', computed.zIndex);
            
            // ã©ã¡ã‚‰ã®ãƒ«ãƒ¼ãƒ«ãŒå„ªå…ˆã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
            const rect = canvas.getBoundingClientRect();
            const container = document.querySelector('.background-container').getBoundingClientRect();
            const relativeLeft = ((rect.left - container.left) / container.width * 100).toFixed(1);
            const relativeTop = ((rect.top - container.top) / container.height * 100).toFixed(1);
            
            console.log('ğŸ“ å®Ÿéš›ã®ç›¸å¯¾ä½ç½®:');
            console.log('  - å·¦ã‹ã‚‰ã®ä½ç½®:', relativeLeft + '%');
            console.log('  - ä¸Šã‹ã‚‰ã®ä½ç½®:', relativeTop + '%');
        }
        
        // SpineåˆæœŸåŒ–ã‚’å¾…ã¤
        function waitForSpine() {
            if (typeof spine !== 'undefined') {
                status.textContent = 'âœ… Spineèª­ã¿è¾¼ã¿å®Œäº†';
                showCanvasInfo();
                initSpineCharacter();
            } else {
                status.textContent = 'â³ Spineèª­ã¿è¾¼ã¿ä¸­...';
                setTimeout(waitForSpine, 100);
            }
        }
        
        // Spineã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åˆæœŸåŒ–ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ã‚µãƒ³ãƒ—ãƒ«ã¨åŒã˜ï¼‰
        async function initSpineCharacter() {
            try {
                const canvas = document.getElementById('purattokun-canvas');
                const gl = canvas.getContext('webgl', { alpha: true });
                
                if (!gl) {
                    throw new Error('WebGLã‚µãƒãƒ¼ãƒˆãªã—');
                }
                
                // Canvasã‚µã‚¤ã‚ºè¨­å®šï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œï¼‰
                const updateCanvasSize = () => {
                    const rect = canvas.getBoundingClientRect();
                    canvas.width = rect.width;
                    canvas.height = rect.height;
                    console.log('Canvaså®Ÿã‚µã‚¤ã‚º:', canvas.width + 'x' + canvas.height);
                };
                updateCanvasSize();
                
                window.addEventListener('resize', updateCanvasSize);
                
                status.textContent = 'ğŸ“ Spineãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ä¸­...';
                
                // ã‚¢ã‚»ãƒƒãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼
                const basePath = 'assets/spine/characters/purattokun/';
                const assetManager = new spine.AssetManager(gl, basePath);
                assetManager.loadTextureAtlas('purattokun.atlas');
                assetManager.loadJson('purattokun.json');
                
                // ã‚¢ã‚»ãƒƒãƒˆèª­ã¿è¾¼ã¿å®Œäº†å¾…ã¡
                await new Promise((resolve, reject) => {
                    let checkCount = 0;
                    const maxChecks = 100;
                    
                    const checkAssets = () => {
                        checkCount++;
                        
                        if (assetManager.isLoadingComplete()) {
                            console.log('âœ… ã‚¢ã‚»ãƒƒãƒˆèª­ã¿è¾¼ã¿å®Œäº†');
                            resolve();
                        } else if (checkCount > maxChecks) {
                            const errors = assetManager.getErrors();
                            console.error('âŒ èª­ã¿è¾¼ã¿ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ:', errors);
                            reject(new Error('ã‚¢ã‚»ãƒƒãƒˆèª­ã¿è¾¼ã¿ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ'));
                        } else {
                            setTimeout(checkAssets, 100);
                        }
                    };
                    checkAssets();
                });
                
                // Spineã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆä»¥ä¸‹ã‚·ãƒ³ãƒ—ãƒ«ã‚µãƒ³ãƒ—ãƒ«ã¨åŒã˜ï¼‰
                const atlas = assetManager.get('purattokun.atlas');
                const atlasLoader = new spine.AtlasAttachmentLoader(atlas);
                const skeletonJson = new spine.SkeletonJson(atlasLoader);
                const skeletonData = skeletonJson.readSkeletonData(assetManager.get('purattokun.json'));
                
                const skeleton = new spine.Skeleton(skeletonData);
                skeleton.x = 0;
                skeleton.y = 0;
                skeleton.scaleX = skeleton.scaleY = 0.8;
                
                const animationStateData = new spine.AnimationStateData(skeleton.data);
                const animationState = new spine.AnimationState(animationStateData);
                
                // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
                if (skeleton.data.findAnimation('syutugen') && skeleton.data.findAnimation('taiki')) {
                    animationState.setAnimation(0, 'syutugen', false);
                    const listener = {
                        complete: (entry) => {
                            if (entry.animation.name === 'syutugen') {
                                animationState.setAnimation(0, 'taiki', true);
                                animationState.removeListener(listener);
                            }
                        }
                    };
                    animationState.addListener(listener);
                } else if (skeleton.data.findAnimation('taiki')) {
                    animationState.setAnimation(0, 'taiki', true);
                }
                
                // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
                const shader = spine.Shader.newTwoColoredTextured(gl);
                const renderer = new spine.SceneRenderer(canvas, gl);
                
                let lastTime = Date.now() / 1000;
                
                function render() {
                    const now = Date.now() / 1000;
                    const delta = now - lastTime;
                    lastTime = now;
                    
                    animationState.update(delta);
                    animationState.apply(skeleton);
                    skeleton.updateWorldTransform();
                    
                    gl.clearColor(0, 0, 0, 0);
                    gl.clear(gl.COLOR_BUFFER_BIT);
                    gl.viewport(0, 0, canvas.width, canvas.height);
                    
                    renderer.begin();
                    renderer.drawSkeleton(skeleton, true);
                    renderer.end();
                    
                    requestAnimationFrame(render);
                }
                
                render();
                status.textContent = 'âœ… Spineã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å‹•ä½œä¸­ï¼ˆæœ¬ç•ªCSSãƒ«ãƒ¼ãƒ«é©ç”¨ï¼‰';
                
            } catch (error) {
                status.textContent = 'âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message;
                console.error('SpineåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
            }
        }
        
        // é–‹å§‹
        waitForSpine();
    </script>
</body>
</html>