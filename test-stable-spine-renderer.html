<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¯ StableSpineRenderer ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 5px;
        }
        
        .spine-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 450px;
            background: #f8f9fa;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #e0e8ff;
        }
        
        #spine-canvas {
            border: 2px solid #ddd;
            border-radius: 8px;
            background: transparent;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        
        button {
            background: linear-gradient(45deg, #FF6B6B, #FF8E53);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            min-width: 120px;
            transition: all 0.3s ease;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255,107,107,0.4);
        }
        
        .secondary-btn {
            background: linear-gradient(45deg, #4ECDC4, #44A08D);
        }
        
        .secondary-btn:hover {
            box-shadow: 0 5px 15px rgba(78,205,196,0.4);
        }
        
        .status-panel {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .log-container {
            background: #1e1e1e;
            color: #00ff88;
            font-family: 'Courier New', monospace;
            padding: 20px;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
            font-size: 12px;
            line-height: 1.4;
            margin: 20px 0;
        }
        
        .comparison-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ StableSpineRenderer å®‰å®šæ€§ãƒ†ã‚¹ãƒˆ</h1>
        
        <div class="info-box">
            <h3>ğŸ“‹ ãƒ†ã‚¹ãƒˆæ¦‚è¦</h3>
            <p><strong>ç›®çš„</strong>: test-spine-basic-loading.html ã®æˆåŠŸãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’åŸºã«ä½œæˆã—ãŸ StableSpineRenderer ã®å‹•ä½œç¢ºèª</p>
            <ul>
                <li><strong>åŸºæº–ãƒšãƒ¼ã‚¸</strong>: test-spine-basic-loading.htmlï¼ˆé»’æ ãªã—ãƒ»ä½ç½®æ­£å¸¸ï¼‰</li>
                <li><strong>é‡è¦è¨­å®š</strong>: premultipliedAlpha: true, SceneRendererä½¿ç”¨</li>
                <li><strong>æœŸå¾…çµæœ</strong>: æ¯å›ã‚¨ãƒ©ãƒ¼ãªãèª­ã¿è¾¼ã¿ã€é»’æ å•é¡Œãªã—</li>
                <li><strong>æ±ç”¨æ€§</strong>: è¨­å®šå¤‰æ›´ã§ä»–ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ»ä½ç½®ã«ã‚‚å¯¾å¿œ</li>
            </ul>
        </div>
        
        <div class="comparison-box">
            <h3>ğŸ” æˆåŠŸãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã®æ¯”è¼ƒ</h3>
            <p><strong>æˆåŠŸãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆtest-spine-basic-loading.htmlï¼‰ã®é‡è¦è¦ç´ </strong>:</p>
            <ul>
                <li>WebGL: <code>premultipliedAlpha: true</code></li>
                <li>AssetManager: ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹ + ç›¸å¯¾ãƒ‘ã‚¹æ–¹å¼</li>
                <li>SceneRenderer: é«˜ãƒ¬ãƒ™ãƒ«APIä½¿ç”¨</li>
                <li>ä½ç½®: <code>x: 0, y: -100, scale: 0.55</code></li>
            </ul>
            <p>â†’ ã“ã‚Œã‚‰ã®è¨­å®šã‚’ StableSpineRenderer ã«çµ±åˆæ¸ˆã¿</p>
        </div>
        
        <div class="controls">
            <button onclick="initializeStableRenderer()">
                ğŸš€ StableSpineRenderer åˆæœŸåŒ–
            </button>
            <button class="secondary-btn" onclick="playAnimation('syutugen')">
                âœ¨ å‡ºç¾ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
            </button>
            <button class="secondary-btn" onclick="playAnimation('taiki')">
                ğŸ˜Š å¾…æ©Ÿã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
            </button>
            <button class="secondary-btn" onclick="playAnimation('yarare')">
                ğŸ’¥ ã‚„ã‚‰ã‚Œã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
            </button>
            <button class="secondary-btn" onclick="playSequence(['syutugen', 'taiki'])">
                ğŸ¬ å‡ºç¾â†’å¾…æ©Ÿã‚·ãƒ¼ã‚±ãƒ³ã‚¹
            </button>
        </div>
        
        <div class="controls">
            <button class="secondary-btn" onclick="testPositionChange()">
                ğŸ“ ä½ç½®å¤‰æ›´ãƒ†ã‚¹ãƒˆ
            </button>
            <button class="secondary-btn" onclick="testScaleChange()">
                ğŸ” ã‚¹ã‚±ãƒ¼ãƒ«å¤‰æ›´ãƒ†ã‚¹ãƒˆ
            </button>
            <button class="secondary-btn" onclick="showStatus()">
                ğŸ“Š ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
            </button>
            <button class="secondary-btn" onclick="clearLog()">
                ğŸ—‘ï¸ ãƒ­ã‚°ã‚¯ãƒªã‚¢
            </button>
        </div>
        
        <div class="spine-container">
            <canvas id="spine-canvas" width="400" height="400"></canvas>
        </div>
        
        <div class="status-panel">
            <h3>ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹</h3>
            <div id="status-display">
                StableSpineRenderer æœªåˆæœŸåŒ–
            </div>
        </div>
        
        <div class="log-container" id="log-display">
            ğŸ¯ StableSpineRenderer ãƒ†ã‚¹ãƒˆæº–å‚™ä¸­...\n
        </div>
    </div>

    <!-- Spine WebGL Runtimeï¼ˆæˆåŠŸãƒ‘ã‚¿ãƒ¼ãƒ³ã¨åŒã˜CDNç‰ˆï¼‰ -->
    <script src="https://unpkg.com/@esotericsoftware/spine-webgl@4.1.24/dist/iife/spine-webgl.js"></script>
    
    <!-- StableSpineRenderer ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« -->
    <script src="micromodules/spine-renderer/StableSpineRenderer.js"></script>
    
    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let stableRenderer = null;
        let logDisplay = null;
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            logDisplay = document.getElementById('log-display');
            testLog('ğŸ¯ StableSpineRenderer ãƒ†ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ èµ·å‹•', 'success');
            testLog('ğŸ“‹ åŸºæº–: test-spine-basic-loading.html ã®æˆåŠŸãƒ‘ã‚¿ãƒ¼ãƒ³', 'info');
            testLog('ğŸ”§ premultipliedAlpha: true, SceneRendererä½¿ç”¨', 'info');
        });
        
        /**
         * ãƒ­ã‚°è¡¨ç¤ºé–¢æ•°
         */
        function testLog(message, type = 'info') {
            if (!logDisplay) return;
            
            const timestamp = new Date().toLocaleTimeString();
            const statusIcon = type === 'error' ? 'âŒ' : 
                              type === 'success' ? 'âœ…' : 
                              type === 'warning' ? 'âš ï¸' : 'â„¹ï¸';
            
            const logLine = `[${timestamp}] ${statusIcon} ${message}\n`;
            logDisplay.textContent += logLine;
            logDisplay.scrollTop = logDisplay.scrollHeight;
            
            console.log(`StableSpineRenderer ãƒ†ã‚¹ãƒˆ: ${message}`);
        }
        
        /**
         * StableSpineRenderer åˆæœŸåŒ–
         */
        async function initializeStableRenderer() {
            try {
                testLog('ğŸš€ StableSpineRenderer åˆæœŸåŒ–é–‹å§‹', 'info');
                
                if (stableRenderer) {
                    testLog('âš ï¸ æ—¢ã«åˆæœŸåŒ–æ¸ˆã¿ - åœæ­¢ã—ã¦ã‹ã‚‰å†åˆæœŸåŒ–', 'warning');
                    stableRenderer.stop();
                }
                
                // StableSpineRenderer ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
                stableRenderer = new StableSpineRenderer({
                    canvas: '#spine-canvas',
                    character: 'purattokun',
                    basePath: '/assets/spine/characters/',
                    position: {
                        x: 0,
                        y: -100,    // test-spine-basic-loading.html ã¨åŒã˜
                        scaleX: 0.55,
                        scaleY: 0.55
                    },
                    defaultAnimation: 'taiki',
                    debug: true,
                    logCallback: testLog
                });
                
                // åˆæœŸåŒ–å®Ÿè¡Œ
                const success = await stableRenderer.initialize();
                
                if (success) {
                    testLog('ğŸ‰ StableSpineRenderer åˆæœŸåŒ–å®Œäº†ï¼', 'success');
                    updateStatus();
                } else {
                    testLog('âŒ StableSpineRenderer åˆæœŸåŒ–å¤±æ•—', 'error');
                }
                
            } catch (error) {
                testLog(`âŒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                console.error('StableSpineRenderer åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
            }
        }
        
        /**
         * ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å†ç”Ÿ
         */
        function playAnimation(animationName) {
            if (!stableRenderer) {
                testLog('âŒ StableSpineRenderer ãŒæœªåˆæœŸåŒ–ã§ã™', 'error');
                return;
            }
            
            const success = stableRenderer.playAnimation(animationName);
            if (success) {
                testLog(`ğŸ¬ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å†ç”Ÿ: ${animationName}`, 'info');
            }
        }
        
        /**
         * ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å†ç”Ÿ
         */
        function playSequence(animations) {
            if (!stableRenderer) {
                testLog('âŒ StableSpineRenderer ãŒæœªåˆæœŸåŒ–ã§ã™', 'error');
                return;
            }
            
            const success = stableRenderer.playSequence(animations);
            if (success) {
                testLog(`ğŸ¬ ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å†ç”Ÿ: ${animations.join(' â†’ ')}`, 'info');
            }
        }
        
        /**
         * ä½ç½®å¤‰æ›´ãƒ†ã‚¹ãƒˆ
         */
        function testPositionChange() {
            if (!stableRenderer) {
                testLog('âŒ StableSpineRenderer ãŒæœªåˆæœŸåŒ–ã§ã™', 'error');
                return;
            }
            
            // ãƒ©ãƒ³ãƒ€ãƒ ãªä½ç½®ã«å¤‰æ›´
            const x = Math.random() * 200 - 100;
            const y = Math.random() * 200 - 200;
            
            stableRenderer.setTransform(x, y);
            testLog(`ğŸ“ ä½ç½®å¤‰æ›´: (${x.toFixed(1)}, ${y.toFixed(1)})`, 'info');
        }
        
        /**
         * ã‚¹ã‚±ãƒ¼ãƒ«å¤‰æ›´ãƒ†ã‚¹ãƒˆ
         */
        function testScaleChange() {
            if (!stableRenderer) {
                testLog('âŒ StableSpineRenderer ãŒæœªåˆæœŸåŒ–ã§ã™', 'error');
                return;
            }
            
            // ãƒ©ãƒ³ãƒ€ãƒ ãªã‚¹ã‚±ãƒ¼ãƒ«
            const scale = 0.3 + Math.random() * 0.7; // 0.3-1.0
            
            stableRenderer.setTransform(null, null, scale, scale);
            testLog(`ğŸ” ã‚¹ã‚±ãƒ¼ãƒ«å¤‰æ›´: ${scale.toFixed(2)}`, 'info');
        }
        
        /**
         * ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
         */
        function showStatus() {
            if (!stableRenderer) {
                testLog('âŒ StableSpineRenderer ãŒæœªåˆæœŸåŒ–ã§ã™', 'error');
                return;
            }
            
            const status = stableRenderer.getStatus();
            testLog('ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹:', 'info');
            testLog(`   - åˆæœŸåŒ–æ¸ˆã¿: ${status.initialized}`, 'info');
            testLog(`   - èª­ã¿è¾¼ã¿ä¸­: ${status.loading}`, 'info');
            testLog(`   - ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œä¸­: ${status.isAnimationRunning}`, 'info');
            testLog(`   - Canvas: ${status.hasCanvas}`, 'info');
            testLog(`   - WebGL: ${status.hasWebGL}`, 'info');
            testLog(`   - ã‚¹ã‚±ãƒ«ãƒˆãƒ³: ${status.hasSkeleton}`, 'info');
            testLog(`   - ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼: ${status.config.character}`, 'info');
            
            updateStatus(status);
        }
        
        /**
         * ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
         */
        function updateStatus(status = null) {
            const statusDisplay = document.getElementById('status-display');
            if (!statusDisplay) return;
            
            if (!stableRenderer) {
                statusDisplay.innerHTML = 'StableSpineRenderer æœªåˆæœŸåŒ–';
                return;
            }
            
            if (!status) {
                status = stableRenderer.getStatus();
            }
            
            statusDisplay.innerHTML = `
                <strong>åˆæœŸåŒ–çŠ¶æ…‹:</strong> ${status.initialized ? 'âœ… å®Œäº†' : 'âŒ æœªå®Œäº†'}<br>
                <strong>èª­ã¿è¾¼ã¿çŠ¶æ…‹:</strong> ${status.loading ? 'â³ èª­ã¿è¾¼ã¿ä¸­' : 'âœ… å®Œäº†'}<br>
                <strong>ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³:</strong> ${status.isAnimationRunning ? 'ğŸ¬ å®Ÿè¡Œä¸­' : 'â¹ï¸ åœæ­¢ä¸­'}<br>
                <strong>ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼:</strong> ${status.config.character}<br>
                <strong>ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ:</strong> 
                Canvas: ${status.hasCanvas ? 'âœ…' : 'âŒ'}, 
                WebGL: ${status.hasWebGL ? 'âœ…' : 'âŒ'}, 
                ã‚¹ã‚±ãƒ«ãƒˆãƒ³: ${status.hasSkeleton ? 'âœ…' : 'âŒ'}
            `;
        }
        
        /**
         * ãƒ­ã‚°ã‚¯ãƒªã‚¢
         */
        function clearLog() {
            if (logDisplay) {
                logDisplay.textContent = 'ğŸ—‘ï¸ ãƒ­ã‚°ã‚¯ãƒªã‚¢ã•ã‚Œã¾ã—ãŸ\n';
            }
            testLog('ğŸ§ª ãƒ­ã‚°ã‚¯ãƒªã‚¢å®Ÿè¡Œ', 'info');
        }
        
        /**
         * ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
         */
        window.addEventListener('beforeunload', () => {
            if (stableRenderer) {
                stableRenderer.stop();
            }
        });
        
        /**
         * ãƒ‡ãƒãƒƒã‚°ç”¨ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°
         */
        window.stableSpineDebug = {
            renderer: () => stableRenderer,
            testLog: testLog,
            reinitialize: initializeStableRenderer
        };
        
        // åˆæœŸåŒ–å®Œäº†ãƒ­ã‚°
        testLog('ğŸ¯ StableSpineRenderer ãƒ†ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ æº–å‚™å®Œäº†', 'success');
        testLog('ğŸ’¡ "StableSpineRenderer åˆæœŸåŒ–" ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦é–‹å§‹', 'info');
        console.log('ãƒ‡ãƒãƒƒã‚°ç”¨: window.stableSpineDebug ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½');
    </script>
</body>
</html>