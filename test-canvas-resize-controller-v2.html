<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üéØ CanvasResizeController v2.0 Phase 1 „ÉÜ„Çπ„Éà</title>
    <style>
      body {
        margin: 0;
        padding: 20px;
        font-family: Arial, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        min-height: 100vh;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      .header {
        text-align: center;
        margin-bottom: 30px;
      }

      .header h1 {
        font-size: 2.5em;
        margin: 0;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      }

      .subtitle {
        font-size: 1.2em;
        opacity: 0.9;
        margin-top: 10px;
      }

      .test-layout {
        display: grid;
        grid-template-columns: 1fr 400px;
        gap: 30px;
        margin-top: 30px;
      }

      .canvas-area {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .canvas-container {
        position: relative;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        overflow: hidden;
        margin-bottom: 20px;
      }

      #test-canvas {
        border-radius: 15px;
        background: linear-gradient(45deg, #ff6b6b22, #4ecdc422);
        border: 2px dashed rgba(255, 255, 255, 0.3);
      }

      .canvas-info {
        background: rgba(0, 0, 0, 0.3);
        padding: 15px;
        border-radius: 10px;
        font-family: monospace;
        font-size: 0.9em;
        width: 100%;
        max-width: 400px;
      }

      /* ControlPanel „Çπ„Çø„Ç§„É´ */
      .canvas-resize-controller {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        padding: 20px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        height: fit-content;
      }

      .control-header h3 {
        margin: 0 0 15px 0;
        color: #ffd700;
      }

      .status-display {
        background: rgba(0, 0, 0, 0.2);
        padding: 8px 12px;
        border-radius: 5px;
        font-size: 0.9em;
        margin-bottom: 20px;
      }

      .control-section {
        margin-bottom: 25px;
        padding-bottom: 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .control-section.disabled {
        opacity: 0.5;
      }

      .control-section h4 {
        margin: 0 0 15px 0;
        color: #87ceeb;
        font-size: 1.1em;
      }

      .input-group {
        margin: 12px 0;
      }

      .input-group label {
        display: block;
        margin-bottom: 5px;
        font-size: 0.9em;
        color: rgba(255, 255, 255, 0.9);
      }

      .input-group input {
        width: 100%;
        padding: 8px;
        border-radius: 5px;
        border: none;
        background: rgba(255, 255, 255, 0.9);
        color: #333;
        font-size: 0.9em;
      }

      .input-group input[type="range"] {
        background: transparent;
        color: white;
      }

      .button-group {
        display: flex;
        gap: 10px;
        margin-top: 15px;
      }

      .btn {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.9em;
        transition: all 0.3s ease;
        flex: 1;
      }

      .btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      }

      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .btn.primary {
        background: linear-gradient(45deg, #ff6b6b, #ee5a52);
      }

      .btn.success {
        background: linear-gradient(45deg, #51cf66, #40c057);
      }

      .info-display {
        background: rgba(0, 0, 0, 0.3);
        padding: 12px;
        border-radius: 8px;
        font-family: monospace;
        font-size: 0.8em;
        line-height: 1.4;
      }

      .log-area {
        background: rgba(0, 0, 0, 0.4);
        padding: 15px;
        border-radius: 10px;
        height: 200px;
        overflow-y: auto;
        font-family: monospace;
        font-size: 0.8em;
        border: 1px solid rgba(255, 255, 255, 0.1);
        margin-top: 20px;
        white-space: pre-wrap;
      }

      /* Phase 1 „Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº */
      .phase-indicator {
        background: linear-gradient(45deg, #51cf66, #40c057);
        color: white;
        padding: 5px 10px;
        border-radius: 15px;
        font-size: 0.8em;
        display: inline-block;
        margin-left: 10px;
      }

      @media (max-width: 768px) {
        .test-layout {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- „Éò„ÉÉ„ÉÄ„Éº -->
      <div class="header">
        <h1>üéØ CanvasResizeController v2.0</h1>
        <div class="subtitle">
          Áµ±ÂêàÁ∑®ÈõÜÊ©üËÉΩ‰ªò„ÅçCanvasÂà∂Âæ°„Éû„Ç§„ÇØ„É≠„É¢„Ç∏„É•„Éº„É´
          <span class="phase-indicator">Phase 1 ÂÆüË£ÖÂÆå‰∫Ü</span>
        </div>
      </div>

      <div class="test-layout">
        <!-- CanvasË°®Á§∫„Ç®„É™„Ç¢ -->
        <div class="canvas-area">
          <div class="canvas-container" id="canvas-container">
            <canvas id="test-canvas" width="400" height="400"></canvas>
          </div>
          
          <div class="canvas-info" id="external-canvas-info">
            <strong>üìä CanvasÊÉÖÂ†±:</strong><br>
            <div id="external-info-content">Ë™≠„ÅøËæº„ÅøÂæÖÊ©ü‰∏≠...</div>
          </div>
        </div>

        <!-- Êìç‰Ωú„Éë„Éç„É´Ôºà„Åì„Åì„Å´ÂãïÁöÑÁîüÊàê„Åï„Çå„ÇãÔºâ -->
        <div id="control-panel-container">
          <!-- CanvasResizeController.createControlPanel() „ÅßÁîüÊàê -->
        </div>
      </div>

      <!-- „É≠„Ç∞„Ç®„É™„Ç¢ -->
      <div class="log-area" id="log-area"></div>
    </div>

    <!-- CanvasResizeController v2.0 -->
    <script src="micromodules/canvas-resize/CanvasResizeController.js"></script>

    <script>
      /**
       * üéØ CanvasResizeController v2.0 Phase 1 „ÉÜ„Çπ„ÉàÁí∞Â¢É
       * 
       * Phase 1 ÂÆüË£ÖÊ©üËÉΩ:
       * ‚úÖ CanvasËß£ÂÉèÂ∫¶Âà∂Âæ°ÔºàÊ≠£ÊñπÂΩ¢Ôºâ
       * ‚úÖ „Ç≠„É£„É©„ÇØ„Çø„Éº„Çπ„Ç±„Éº„É´„Éª‰ΩçÁΩÆË™øÊï¥
       * ‚úÖ Âü∫Êú¨UIÊìç‰Ωú„Éë„Éç„É´
       * ‚úÖ ÈÄèÊòéËÉåÊôØÂØæÂøú
       * ‚úÖ Âõ∫ÂÆöË°®Á§∫„Çµ„Ç§„Ç∫
       */
      class CanvasResizeControllerV2Test {
        constructor() {
          this.canvas = document.getElementById("test-canvas");
          this.logArea = document.getElementById("log-area");
          this.spineRenderer = null; // Phase 1„Åß„ÅØÊ®°Êì¨ÂÆüË£Ö
          
          // Ê®°Êì¨Spine„Ç≠„É£„É©„ÇØ„Çø„Éº‰ΩúÊàê
          this.createMockSpineRenderer();
          
          // CanvasResizeController v2.0 „Ç§„É≥„Çπ„Çø„É≥„Çπ‰ΩúÊàê
          this.controller = new CanvasResizeController({
            canvas: this.canvas,
            spineRenderer: this.spineRenderer,
            onLog: (message) => this.addLog(message),
            onError: (message) => this.addLog(`üî¥ ${message}`),
            enableLogging: true,
            config: {
              defaultSize: 400,
              fixedDisplaySize: 350,
              transparentBackground: true
            }
          });
          
          this.initializeTest();
        }

        /**
         * üé≠ Ê®°Êì¨Spine„Ç≠„É£„É©„ÇØ„Çø„Éº‰ΩúÊàê
         */
        createMockSpineRenderer() {
          // Phase 1„ÉÜ„Çπ„ÉàÁî®„ÅÆÊ®°Êì¨„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà
          this.spineRenderer = {
            skeleton: {
              scaleX: 1.0,
              scaleY: 1.0,
              x: 200,
              y: 200
            }
          };
          
          this.addLog('üé≠ Ê®°Êì¨Spine„Ç≠„É£„É©„ÇØ„Çø„Éº‰ΩúÊàêÂÆå‰∫ÜÔºàPhase 1„ÉÜ„Çπ„ÉàÁî®Ôºâ');
        }

        /**
         * üöÄ „ÉÜ„Çπ„ÉàÁí∞Â¢ÉÂàùÊúüÂåñ
         */
        initializeTest() {
          // Êìç‰Ωú„Éë„Éç„É´‰ΩúÊàê
          const panelContainer = document.getElementById('control-panel-container');
          this.controller.createControlPanel(panelContainer);
          
          // ÂàùÊúüÊÉÖÂ†±Êõ¥Êñ∞
          this.updateExternalInfo();
          
          // CanvasÊèèÁîª„ÉÜ„Çπ„Éà
          this.drawTestPattern();
          
          // ÂÆöÊúüÁöÑ„Å™ÊÉÖÂ†±Êõ¥Êñ∞
          setInterval(() => {
            this.updateExternalInfo();
            this.controller.updateInfo();
          }, 1000);
          
          this.addLog('üöÄ CanvasResizeController v2.0 Phase 1 „ÉÜ„Çπ„ÉàÁí∞Â¢É Ëµ∑ÂãïÂÆå‰∫Ü');
          this.addLog('‚úÖ ÂÆüË£ÖÊ∏à„Åø: CanvasËß£ÂÉèÂ∫¶Âà∂Âæ°„Éª„Ç≠„É£„É©„ÇØ„Çø„ÉºÂà∂Âæ°„ÉªÂü∫Êú¨UI');
          this.addLog('üìã Phase 2‰∫àÂÆö: BBÁµ±ÂêàÊìç‰Ωú„ÉªÁµ±Âêà„Éâ„É©„ÉÉ„Ç∞„Éª„É™„Çµ„Ç§„Ç∫');
        }

        /**
         * üé® Canvas„ÉÜ„Çπ„Éà„Éë„Çø„Éº„É≥ÊèèÁîª
         */
        drawTestPattern() {
          const ctx = this.canvas.getContext('2d');
          
          // ÈÄèÊòéËÉåÊôØ„ÇØ„É™„Ç¢
          ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
          
          // ‰∏≠Â§ÆÂçÅÂ≠óÁ∑ö
          ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
          ctx.lineWidth = 1;
          ctx.setLineDash([5, 5]);
          
          const centerX = this.canvas.width / 2;
          const centerY = this.canvas.height / 2;
          
          ctx.beginPath();
          ctx.moveTo(centerX, 0);
          ctx.lineTo(centerX, this.canvas.height);
          ctx.moveTo(0, centerY);
          ctx.lineTo(this.canvas.width, centerY);
          ctx.stroke();
          
          // Ê®°Êì¨„Ç≠„É£„É©„ÇØ„Çø„Éº‰ΩçÁΩÆË°®Á§∫
          if (this.spineRenderer && this.spineRenderer.skeleton) {
            const char = this.spineRenderer.skeleton;
            
            ctx.fillStyle = 'rgba(255, 107, 107, 0.7)';
            ctx.fillRect(char.x - 20 * char.scaleX, char.y - 20 * char.scaleY, 
                        40 * char.scaleX, 40 * char.scaleY);
            
            ctx.fillStyle = 'white';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('üê±', char.x, char.y + 5);
            
            // ÊÉÖÂ†±Ë°®Á§∫
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.font = '10px monospace';
            ctx.textAlign = 'left';
            ctx.fillText(`Scale: ${char.scaleX.toFixed(1)}`, 10, 20);
            ctx.fillText(`Pos: (${Math.round(char.x)}, ${Math.round(char.y)})`, 10, 35);
          }
          
          // CanvasÊÉÖÂ†±
          ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
          ctx.font = '10px monospace';
          ctx.textAlign = 'right';
          ctx.fillText(`Canvas: ${this.canvas.width}x${this.canvas.height}`, 
                      this.canvas.width - 10, this.canvas.height - 20);
          ctx.fillText(`Display: ${this.canvas.style.width} x ${this.canvas.style.height}`, 
                      this.canvas.width - 10, this.canvas.height - 10);
        }

        /**
         * üìä Â§ñÈÉ®ÊÉÖÂ†±Ë°®Á§∫Êõ¥Êñ∞
         */
        updateExternalInfo() {
          const infoContent = document.getElementById('external-info-content');
          if (!infoContent) return;

          const state = this.controller.getState();
          
          let info = `CanvasËß£ÂÉèÂ∫¶: ${state.canvas.width}x${state.canvas.height}px\n`;
          info += `CanvasË°®Á§∫: ${state.canvas.displayWidth} x ${state.canvas.displayHeight}\n`;
          
          if (state.character) {
            info += `\nüìç „Ç≠„É£„É©„ÇØ„Çø„Éº:\n`;
            info += `  „Çπ„Ç±„Éº„É´: ${state.character.scale.x.toFixed(1)}\n`;
            info += `  ‰ΩçÁΩÆ: (${Math.round(state.character.position.x)}, ${Math.round(state.character.position.y)})`;
          } else {
            info += `\n‚ö†Ô∏è „Ç≠„É£„É©„ÇØ„Çø„Éº: Êú™Ë™≠„ÅøËæº„Åø`;
          }
          
          infoContent.textContent = info;
          
          // CanvasÂÜçÊèèÁîª
          this.drawTestPattern();
        }

        /**
         * üìã „É≠„Ç∞ËøΩÂä†
         */
        addLog(message) {
          const timestamp = new Date().toLocaleTimeString();
          this.logArea.textContent += `[${timestamp}] ${message}\n`;
          this.logArea.scrollTop = this.logArea.scrollHeight;
        }
      }

      // üöÄ ÂàùÊúüÂåñ
      document.addEventListener("DOMContentLoaded", () => {
        window.testController = new CanvasResizeControllerV2Test();
      });
    </script>
  </body>
</html>