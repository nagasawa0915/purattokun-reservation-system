<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ± Purattokun + StableSpineRenderer + BoundingBox ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #2E86AB 0%, #A23B72 100%);
            color: white;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
            margin-top: 10px;
        }
        
        .canvas-container {
            position: relative;
            width: 800px;
            height: 600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            overflow: hidden;
        }
        
        #spine-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        
        .controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            min-width: 250px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .control-group {
            margin-bottom: 15px;
        }
        
        .control-group h3 {
            margin: 0 0 10px 0;
            font-size: 14px;
            color: #ffd700;
        }
        
        .btn {
            display: block;
            width: 100%;
            padding: 8px 12px;
            margin: 5px 0;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
        }
        
        .btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
        }
        
        .btn.success {
            background: rgba(76, 175, 80, 0.8);
        }
        
        .btn.danger {
            background: rgba(244, 67, 54, 0.8);
        }
        
        .btn.primary {
            background: rgba(33, 150, 243, 0.8);
        }
        
        .log {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 350px;
            max-height: 250px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            padding: 10px;
            border-radius: 5px;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .status {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            font-size: 13px;
        }
        
        .status-label {
            color: #ccc;
        }
        
        .status-value {
            color: #ffd700;
            font-weight: bold;
        }
        
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            z-index: 1000;
        }
        
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #ffd700;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹è¡¨ç¤ºç”¨ã®z-indexã‚’ç¢ºä¿ */
        .bounding-box-overlay {
            z-index: 999 !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ± Purattokun + StableSpineRenderer + BoundingBox</h1>
            <div class="subtitle">æœ€æ–°å®‰å®šç‰ˆ - é»’æ å•é¡Œå®Œå…¨è§£æ±º + BBçµ±åˆãƒ†ã‚¹ãƒˆ + è‡ªå‹•ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ¤œå‡º</div>
        </div>
        
        <div class="canvas-container">
            <canvas id="spine-canvas" width="800" height="600"></canvas>
        </div>
    </div>
    
    <div class="status" id="status-panel">
        <h3 style="margin: 0 0 10px 0; color: #ffd700;">ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹</h3>
        <div class="status-item">
            <span class="status-label">StableSpineRenderer:</span>
            <span class="status-value" id="renderer-status">åˆæœŸåŒ–ä¸­</span>
        </div>
        <div class="status-item">
            <span class="status-label">Purattokunèª­ã¿è¾¼ã¿:</span>
            <span class="status-value" id="nezumi-status">å¾…æ©Ÿä¸­</span>
        </div>
        <div class="status-item">
            <span class="status-label">ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹:</span>
            <span class="status-value" id="bbox-status">å¾…æ©Ÿä¸­</span>
        </div>
        <div class="status-item">
            <span class="status-label">çµ±åˆçŠ¶æ…‹:</span>
            <span class="status-value" id="integration-status">æº–å‚™ä¸­</span>
        </div>
    </div>
    
    <div class="controls">
        <div class="control-group">
            <h3>â­ StableSpineRenderer</h3>
            <button class="btn primary" id="init-renderer">ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼åˆæœŸåŒ–</button>
            <button class="btn" id="load-nezumi">Purattokunèª­ã¿è¾¼ã¿</button>
            <button class="btn" id="play-search">å¾…æ©Ÿã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³</button>
            <button class="btn" id="play-kettei">ã‚„ã‚‰ã‚Œã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³</button>
        </div>
        
        <div class="control-group">
            <h3>ğŸ“¦ ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹</h3>
            <button class="btn" id="create-bbox">BBä½œæˆ</button>
            <button class="btn" id="toggle-bbox">BBè¡¨ç¤ºåˆ‡æ›¿</button>
            <button class="btn" id="test-resize">ãƒªã‚µã‚¤ã‚ºãƒ†ã‚¹ãƒˆ</button>
            <button class="btn danger" id="cleanup-bbox">BBã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—</button>
        </div>
        
        <div class="control-group">
            <h3>ğŸ§ª çµ±åˆãƒ†ã‚¹ãƒˆ</h3>
            <button class="btn success" id="full-test">å®Œå…¨çµ±åˆãƒ†ã‚¹ãƒˆ</button>
            <button class="btn" id="performance-test">ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ</button>
            <button class="btn danger" id="reset-all">å…¨ãƒªã‚»ãƒƒãƒˆ</button>
        </div>
        
        <div class="control-group">
            <h3>ğŸ”§ ãƒ‡ãƒãƒƒã‚°</h3>
            <button class="btn" id="debug-info">ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±è¡¨ç¤º</button>
            <button class="btn" id="clear-log">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
        </div>
    </div>
    
    <div class="log" id="log-panel">
        <div style="color: #ffd700; margin-bottom: 10px;">ğŸ“ ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°</div>
    </div>
    
    <div class="loading" id="loading-screen">
        <div class="spinner"></div>
        <div>StableSpineRenderer + BB ã‚·ã‚¹ãƒ†ãƒ èª­ã¿è¾¼ã¿ä¸­...</div>
    </div>

    <!-- Spine WebGL -->
    <script src="assets/js/libs/spine-webgl.js"></script>
    
    <!-- StableSpineRenderer -->
    <script src="micromodules/spine-renderer/StableSpineRenderer.js"></script>
    
    <!-- ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ãƒã‚¤ã‚¯ãƒ­ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« -->
    <script src="micromodules/bounding-box/PureBoundingBoxCore.js"></script>
    <script src="micromodules/bounding-box/PureBoundingBoxBounds.js"></script>
    <script src="micromodules/bounding-box/PureBoundingBoxUI.js"></script>
    <script src="micromodules/bounding-box/PureBoundingBoxEvents.js"></script>
    <script src="micromodules/bounding-box/PureBoundingBox.js"></script>

    <script>
        /**
         * ğŸ¯ Nezumi + StableSpineRenderer + BoundingBox çµ±åˆã‚·ã‚¹ãƒ†ãƒ 
         * 
         * ç‰¹å¾´:
         * - StableSpineRendererã«ã‚ˆã‚‹ç¢ºå®ŸãªSpineè¡¨ç¤ºï¼ˆé»’æ å•é¡Œè§£æ±ºæ¸ˆã¿ï¼‰
         * - PureBoundingBoxã«ã‚ˆã‚‹é«˜åº¦ãªãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ç·¨é›†
         * - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çµ±åˆãƒ†ã‚¹ãƒˆæ©Ÿèƒ½
         */
        class NezumiStableSpineBBIntegration {
            constructor() {
                this.canvas = document.getElementById('spine-canvas');
                
                // StableSpineRenderer
                this.spineRenderer = null;
                
                // PureBoundingBox
                this.boundingBox = null;
                
                // çŠ¶æ…‹ç®¡ç†
                this.rendererInitialized = false;
                this.nezumiLoaded = false;
                this.bboxCreated = false;
                this.integrationComplete = false;
                
                this.init();
            }
            
            async init() {
                this.log('ğŸš€ Nezumi StableSpine + BBçµ±åˆã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–é–‹å§‹');
                
                try {
                    // ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç¢ºèª
                    await this.checkDependencies();
                    
                    // UIåˆæœŸåŒ–
                    this.initUI();
                    
                    this.hideLoading();
                    this.log('âœ… åˆæœŸåŒ–å®Œäº† - ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼åˆæœŸåŒ–ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„');
                    this.updateStatus('integration-status', 'åˆæœŸåŒ–å®Œäº†');
                    
                } catch (error) {
                    this.log(`âŒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                    this.hideLoading();
                    this.updateStatus('integration-status', 'åˆæœŸåŒ–å¤±æ•—');
                }
            }
            
            async checkDependencies() {
                this.log('ğŸ” ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¾å­˜é–¢ä¿‚ç¢ºèªä¸­...');
                
                // Spine WebGLç¢ºèª
                if (typeof window.spine === 'undefined') {
                    throw new Error('Spine WebGLãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
                
                // StableSpineRendererç¢ºèª
                if (typeof window.StableSpineRenderer === 'undefined') {
                    throw new Error('StableSpineRendererãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
                
                // PureBoundingBoxç¢ºèª
                if (typeof window.PureBoundingBox === 'undefined') {
                    throw new Error('PureBoundingBoxãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
                
                this.log('âœ… å…¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç¢ºèªå®Œäº†');
            }
            
            initUI() {
                this.log('ğŸ¨ UIåˆæœŸåŒ–ä¸­...');
                
                // StableSpineRendereråˆ¶å¾¡
                document.getElementById('init-renderer').addEventListener('click', () => this.initRenderer());
                document.getElementById('load-nezumi').addEventListener('click', () => this.loadNezumi());
                document.getElementById('play-search').addEventListener('click', () => this.playAnimation('taiki'));
                document.getElementById('play-kettei').addEventListener('click', () => this.playAnimation('yarare'));
                
                // ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹åˆ¶å¾¡
                document.getElementById('create-bbox').addEventListener('click', () => this.createBoundingBox());
                document.getElementById('toggle-bbox').addEventListener('click', () => this.toggleBoundingBox());
                document.getElementById('test-resize').addEventListener('click', () => this.testResize());
                document.getElementById('cleanup-bbox').addEventListener('click', () => this.cleanupBoundingBox());
                
                // çµ±åˆãƒ†ã‚¹ãƒˆ
                document.getElementById('full-test').addEventListener('click', () => this.fullIntegrationTest());
                document.getElementById('performance-test').addEventListener('click', () => this.performanceTest());
                document.getElementById('reset-all').addEventListener('click', () => this.resetAll());
                
                // ãƒ‡ãƒãƒƒã‚°
                document.getElementById('debug-info').addEventListener('click', () => this.showDebugInfo());
                document.getElementById('clear-log').addEventListener('click', () => this.clearLog());
                
                this.log('âœ… UIåˆæœŸåŒ–å®Œäº†');
            }
            
            async initRenderer() {
                this.log('â­ StableSpineRendereråˆæœŸåŒ–ä¸­...');
                this.updateStatus('renderer-status', 'åˆæœŸåŒ–ä¸­');
                
                try {
                    // StableSpineRendererä½œæˆï¼ˆcanvasã‚‚åŒæ™‚ã«æŒ‡å®šï¼‰
                    this.spineRenderer = new StableSpineRenderer({
                        canvas: this.canvas,
                        character: 'purattokun',
                        basePath: '/assets/spine/characters/',
                        // defaultAnimation: è‡ªå‹•æ¤œå‡ºã•ã‚Œã‚‹ï¼ï¼ˆpurattokuã‚“ã®å ´åˆã¯'taiki'ãŒé¸æŠã•ã‚Œã‚‹ï¼‰
                        debug: true,
                        logCallback: (message, level) => this.log(`[Renderer] ${message}`)
                    });
                    
                    // åˆæœŸåŒ–å®Ÿè¡Œ
                    await this.spineRenderer.initialize();
                    
                    this.rendererInitialized = true;
                    this.updateStatus('renderer-status', 'åˆæœŸåŒ–å®Œäº†');
                    this.log('âœ… StableSpineRendereråˆæœŸåŒ–å®Œäº†');
                    this.log('ğŸ“ Nezumièª­ã¿è¾¼ã¿ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„');
                    
                } catch (error) {
                    this.log(`âŒ StableSpineRendereråˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                    this.updateStatus('renderer-status', 'åˆæœŸåŒ–å¤±æ•—');
                }
            }
            
            async loadNezumi() {
                if (!this.rendererInitialized) {
                    this.log('âš ï¸ å…ˆã«ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ã‚’åˆæœŸåŒ–ã—ã¦ãã ã•ã„');
                    return;
                }
                
                this.log('ğŸ± purattokunèª­ã¿è¾¼ã¿é–‹å§‹...');
                this.updateStatus('nezumi-status', 'èª­ã¿è¾¼ã¿ä¸­');
                
                try {
                    // StableSpineRendererã¯ initialize() ã§å…¨ã¦å®Œäº†
                    // æ—¢ã«èª­ã¿è¾¼ã¿ãƒ»æç”»ãƒ»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å…¨ã¦é–‹å§‹æ¸ˆã¿
                    
                    // åˆæœŸã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆè‡ªå‹•æ¤œå‡ºã•ã‚ŒãŸã‚‚ã®ãŒãã®ã¾ã¾ä½¿ç”¨ã•ã‚Œã‚‹ï¼‰
                    // è¿½åŠ ã®playAnimationã¯ä¸è¦ï¼ˆinitialize()ã§è‡ªå‹•é–‹å§‹ï¼‰
                    
                    this.nezumiLoaded = true;
                    this.updateStatus('nezumi-status', 'èª­ã¿è¾¼ã¿å®Œäº†');
                    this.log('âœ… purattokunèª­ã¿è¾¼ã¿å®Œäº† - è‡ªå‹•æ¤œå‡ºã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å†ç”Ÿä¸­');
                    
                } catch (error) {
                    this.log(`âŒ Nezumièª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                    this.updateStatus('nezumi-status', 'èª­ã¿è¾¼ã¿å¤±æ•—');
                }
            }
            
            playAnimation(animationName) {
                if (!this.nezumiLoaded) {
                    this.log('âš ï¸ å…ˆã«Nezumiã‚’èª­ã¿è¾¼ã‚“ã§ãã ã•ã„');
                    return;
                }
                
                try {
                    this.spineRenderer.playAnimation(animationName);
                    this.log(`ğŸ­ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å†ç”Ÿ: ${animationName}`);
                } catch (error) {
                    this.log(`âŒ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å†ç”Ÿã‚¨ãƒ©ãƒ¼: ${error.message}`);
                }
            }
            
            async createBoundingBox() {
                if (!this.nezumiLoaded) {
                    this.log('âš ï¸ å…ˆã«Nezumiã‚’èª­ã¿è¾¼ã‚“ã§ãã ã•ã„');
                    return;
                }
                
                this.log('ğŸ“¦ ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ä½œæˆä¸­...');
                this.updateStatus('bbox-status', 'ä½œæˆä¸­');
                
                try {
                    // PureBoundingBoxä½œæˆ
                    this.boundingBox = new window.PureBoundingBox({
                        targetElement: this.canvas,
                        nodeId: 'purattokun-spine-bb-canvas'
                    });
                    
                    // ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹å®Ÿè¡Œ
                    const result = await this.boundingBox.execute({ 
                        visible: true,
                        interactive: true,
                        showHandles: true
                    });
                    
                    if (result.success) {
                        this.bboxCreated = true;
                        this.updateStatus('bbox-status', 'ä½œæˆå®Œäº†');
                        this.log('âœ… ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ä½œæˆå®Œäº†');
                        this.log(`ğŸ“Š Bounds: x=${result.bounds.x}, y=${result.bounds.y}, w=${result.bounds.width}, h=${result.bounds.height}`);
                    } else {
                        this.log(`âŒ ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ä½œæˆå¤±æ•—: ${result.error}`);
                        this.updateStatus('bbox-status', 'ä½œæˆå¤±æ•—');
                    }
                    
                } catch (error) {
                    this.log(`âŒ ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                    this.updateStatus('bbox-status', 'ã‚¨ãƒ©ãƒ¼');
                }
            }
            
            toggleBoundingBox() {
                if (!this.boundingBox) {
                    this.log('âš ï¸ ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ãŒä½œæˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
                    return;
                }
                
                try {
                    const state = this.boundingBox.getState();
                    if (state.bounds && state.bounds.visible) {
                        this.boundingBox.hide();
                        this.log('ğŸ‘» ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹éè¡¨ç¤º');
                    } else {
                        this.boundingBox.show();
                        this.log('ğŸ‘ï¸ ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹è¡¨ç¤º');
                    }
                } catch (error) {
                    this.log(`âŒ è¡¨ç¤ºåˆ‡æ›¿ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                }
            }
            
            testResize() {
                if (!this.boundingBox) {
                    this.log('âš ï¸ ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ãŒä½œæˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
                    return;
                }
                
                this.log('ğŸ”§ ãƒªã‚µã‚¤ã‚ºãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...');
                
                try {
                    // ãƒ†ã‚¹ãƒˆç”¨ã®ãƒªã‚µã‚¤ã‚ºå®Ÿè¡Œ
                    const currentBounds = this.boundingBox.getBounds();
                    const newWidth = currentBounds.width * 1.2;
                    const newHeight = currentBounds.height * 1.2;
                    
                    this.boundingBox.resize(newWidth, newHeight);
                    this.log(`âœ… ãƒªã‚µã‚¤ã‚ºãƒ†ã‚¹ãƒˆå®Œäº†: ${newWidth.toFixed(0)} x ${newHeight.toFixed(0)}`);
                } catch (error) {
                    this.log(`âŒ ãƒªã‚µã‚¤ã‚ºãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                }
            }
            
            cleanupBoundingBox() {
                if (!this.boundingBox) {
                    this.log('âš ï¸ ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ãŒä½œæˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
                    return;
                }
                
                try {
                    this.boundingBox.cleanup();
                    this.boundingBox = null;
                    this.bboxCreated = false;
                    this.updateStatus('bbox-status', 'ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†');
                    this.log('ğŸ§¹ ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†');
                } catch (error) {
                    this.log(`âŒ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                }
            }
            
            async fullIntegrationTest() {
                this.log('ğŸ§ª å®Œå…¨çµ±åˆãƒ†ã‚¹ãƒˆé–‹å§‹');
                this.updateStatus('integration-status', 'çµ±åˆãƒ†ã‚¹ãƒˆä¸­');
                
                try {
                    // 1. ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼åˆæœŸåŒ–ç¢ºèª
                    if (!this.rendererInitialized) {
                        await this.initRenderer();
                        await new Promise(resolve => setTimeout(resolve, 1000));
                    }
                    
                    // 2. Nezumièª­ã¿è¾¼ã¿ç¢ºèª
                    if (!this.nezumiLoaded) {
                        await this.loadNezumi();
                        await new Promise(resolve => setTimeout(resolve, 2000));
                    }
                    
                    // 3. ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ä½œæˆç¢ºèª
                    if (!this.bboxCreated) {
                        await this.createBoundingBox();
                        await new Promise(resolve => setTimeout(resolve, 1000));
                    }
                    
                    // 4. å‹•ä½œãƒ†ã‚¹ãƒˆ
                    if (this.rendererInitialized && this.nezumiLoaded && this.bboxCreated) {
                        this.log('ğŸ¯ å‹•ä½œãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...');
                        
                        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åˆ‡ã‚Šæ›¿ãˆãƒ†ã‚¹ãƒˆ
                        this.playAnimation('yarare');
                        await new Promise(resolve => setTimeout(resolve, 2000));
                        this.playAnimation('taiki');
                        
                        // ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹è¡¨ç¤ºãƒ†ã‚¹ãƒˆ
                        this.toggleBoundingBox();
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        this.testResize();
                        await new Promise(resolve => setTimeout(resolve, 1000));
                        this.toggleBoundingBox();
                        
                        this.integrationComplete = true;
                        this.updateStatus('integration-status', 'çµ±åˆãƒ†ã‚¹ãƒˆæˆåŠŸ');
                        this.log('ğŸ‰ å®Œå…¨çµ±åˆãƒ†ã‚¹ãƒˆæˆåŠŸï¼å…¨æ©Ÿèƒ½æ­£å¸¸å‹•ä½œç¢ºèª');
                        
                    } else {
                        this.log('âŒ çµ±åˆãƒ†ã‚¹ãƒˆå¤±æ•— - ä¸€éƒ¨æ©Ÿèƒ½ãŒå‹•ä½œã—ã¦ã„ã¾ã›ã‚“');
                        this.updateStatus('integration-status', 'çµ±åˆãƒ†ã‚¹ãƒˆå¤±æ•—');
                    }
                    
                } catch (error) {
                    this.log(`âŒ çµ±åˆãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                    this.updateStatus('integration-status', 'ã‚¨ãƒ©ãƒ¼');
                }
            }
            
            async performanceTest() {
                this.log('âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆé–‹å§‹');
                
                const startTime = Date.now();
                
                try {
                    // ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
                    if (this.spineRenderer) {
                        const renderStart = Date.now();
                        for (let i = 0; i < 10; i++) {
                            this.playAnimation(i % 2 === 0 ? 'taiki' : 'yarare');
                            await new Promise(resolve => setTimeout(resolve, 100));
                        }
                        const renderTime = Date.now() - renderStart;
                        this.log(`ğŸ“Š ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹: ${renderTime}ms (10å›åˆ‡ã‚Šæ›¿ãˆ)`);
                    }
                    
                    // ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
                    if (this.boundingBox) {
                        const bboxStart = Date.now();
                        for (let i = 0; i < 5; i++) {
                            this.toggleBoundingBox();
                            await new Promise(resolve => setTimeout(resolve, 50));
                        }
                        const bboxTime = Date.now() - bboxStart;
                        this.log(`ğŸ“Š BBãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹: ${bboxTime}ms (5å›åˆ‡ã‚Šæ›¿ãˆ)`);
                    }
                    
                    const totalTime = Date.now() - startTime;
                    this.log(`âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå®Œäº†: ç·æ™‚é–“ ${totalTime}ms`);
                    
                } catch (error) {
                    this.log(`âŒ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                }
            }
            
            resetAll() {
                this.log('ğŸ”„ å…¨ãƒªã‚»ãƒƒãƒˆå®Ÿè¡Œä¸­...');
                
                try {
                    // ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
                    if (this.boundingBox) {
                        this.cleanupBoundingBox();
                    }
                    
                    // ã‚¹ãƒ‘ã‚¤ãƒ³ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ã‚¹ãƒˆãƒƒãƒ—
                    if (this.spineRenderer) {
                        this.spineRenderer.stop();
                        this.spineRenderer = null;
                    }
                    
                    // çŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆ
                    this.rendererInitialized = false;
                    this.nezumiLoaded = false;
                    this.bboxCreated = false;
                    this.integrationComplete = false;
                    
                    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
                    this.updateStatus('renderer-status', 'ãƒªã‚»ãƒƒãƒˆå®Œäº†');
                    this.updateStatus('nezumi-status', 'å¾…æ©Ÿä¸­');
                    this.updateStatus('bbox-status', 'å¾…æ©Ÿä¸­');
                    this.updateStatus('integration-status', 'ãƒªã‚»ãƒƒãƒˆå®Œäº†');
                    
                    // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚¯ãƒªã‚¢
                    const ctx = this.canvas.getContext('2d');
                    if (ctx) {
                        ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                    }
                    
                    this.log('âœ… å…¨ãƒªã‚»ãƒƒãƒˆå®Œäº†');
                    
                } catch (error) {
                    this.log(`âŒ ãƒªã‚»ãƒƒãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                }
            }
            
            showDebugInfo() {
                this.log('ğŸ” ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±è¡¨ç¤º');
                
                const info = {
                    rendererInitialized: this.rendererInitialized,
                    nezumiLoaded: this.nezumiLoaded,
                    bboxCreated: this.bboxCreated,
                    integrationComplete: this.integrationComplete,
                    canvasSize: `${this.canvas.width}x${this.canvas.height}`,
                    spineRenderer: !!this.spineRenderer,
                    boundingBox: !!this.boundingBox
                };
                
                Object.entries(info).forEach(([key, value]) => {
                    this.log(`  ${key}: ${value}`);
                });
                
                // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ç¢ºèª
                this.log('ğŸ“š ãƒ©ã‚¤ãƒ–ãƒ©ãƒªçŠ¶æ³:');
                this.log(`  spine: ${typeof window.spine}`);
                this.log(`  StableSpineRenderer: ${typeof window.StableSpineRenderer}`);
                this.log(`  PureBoundingBox: ${typeof window.PureBoundingBox}`);
            }
            
            clearLog() {
                const logPanel = document.getElementById('log-panel');
                logPanel.innerHTML = '<div style="color: #ffd700; margin-bottom: 10px;">ğŸ“ ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°</div>';
                this.log('ğŸ§¹ ãƒ­ã‚°ã‚¯ãƒªã‚¢å®Œäº†');
            }
            
            log(message) {
                const logPanel = document.getElementById('log-panel');
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = document.createElement('div');
                logEntry.style.marginBottom = '3px';
                logEntry.innerHTML = `<span style="color: #666">[${timestamp}]</span> ${message}`;
                logPanel.appendChild(logEntry);
                
                // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«èª¿æ•´
                logPanel.scrollTop = logPanel.scrollHeight;
                
                // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã‚‚å‡ºåŠ›
                console.log(`[NezumiStableSpineBB] ${message}`);
            }
            
            updateStatus(elementId, status) {
                const element = document.getElementById(elementId);
                if (element) {
                    element.textContent = status;
                }
            }
            
            hideLoading() {
                const loadingScreen = document.getElementById('loading-screen');
                if (loadingScreen) {
                    loadingScreen.style.display = 'none';
                }
            }
        }
        
        // ğŸš€ ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•
        window.addEventListener('load', async () => {
            // ãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª­ã¿è¾¼ã¿å¾…æ©Ÿ
            await new Promise(resolve => setTimeout(resolve, 500));
            
            console.log('ğŸ¯ Nezumi + StableSpineRenderer + BoundingBox çµ±åˆã‚·ã‚¹ãƒ†ãƒ èµ·å‹•');
            
            // ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
            window.nezumiIntegration = new NezumiStableSpineBBIntegration();
            
            // ãƒ‡ãƒãƒƒã‚°ç”¨ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°
            window.debugNezumiSystem = () => {
                if (window.nezumiIntegration) {
                    window.nezumiIntegration.showDebugInfo();
                }
            };
        });
    </script>
</body>
</html>