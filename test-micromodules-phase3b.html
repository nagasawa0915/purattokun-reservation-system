<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ElementObserver Phase 3-B ãƒã‚¤ã‚¯ãƒ­ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å˜ç‹¬ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background: #f5f5f5;
            color: #333;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        .header h1 {
            color: #007acc;
            margin: 0;
            font-size: 2.2em;
        }
        .header .subtitle {
            color: #666;
            margin-top: 10px;
            font-size: 1.1em;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #fafafa;
        }
        .test-section h2 {
            color: #333;
            margin-top: 0;
            padding-bottom: 10px;
            border-bottom: 1px solid #ccc;
        }
        .test-controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            min-width: 120px;
        }
        .btn-primary {
            background: #007acc;
            color: white;
        }
        .btn-primary:hover {
            background: #005a99;
            transform: translateY(-2px);
        }
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        .btn-secondary:hover {
            background: #545b62;
        }
        .btn-success {
            background: #28a745;
            color: white;
        }
        .btn-success:hover {
            background: #1e7e34;
        }
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        .btn-danger:hover {
            background: #bd2130;
        }
        .test-output {
            background: #1e1e1e;
            color: #f8f8f8;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            line-height: 1.4;
        }
        .status-indicator {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        .status-success {
            background: #d4edda;
            color: #155724;
        }
        .status-error {
            background: #f8d7da;
            color: #721c24;
        }
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        .module-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .module-card {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #007acc;
        }
        .module-card h3 {
            margin-top: 0;
            color: #007acc;
        }
        .module-card .description {
            color: #666;
            font-size: 14px;
            line-height: 1.5;
        }
        .summary-panel {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .summary-panel h3 {
            margin-top: 0;
        }
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .stat-item {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 4px;
            text-align: center;
        }
        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            display: block;
        }
        .stat-label {
            font-size: 0.9em;
            opacity: 0.8;
        }
        .progress-bar {
            background: #e0e0e0;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            background: #28a745;
            height: 100%;
            transition: width 0.3s ease;
        }
        /* ãƒ†ã‚¹ãƒˆå¯¾è±¡è¦ç´ ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .test-element {
            width: 120px;
            height: 80px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border: 2px solid #333;
            border-radius: 8px;
            position: absolute;
            top: 50px;
            left: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }
        .console-output {
            background: #282c34;
            color: #abb2bf;
            font-family: 'Fira Code', 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="header">
            <h1>ğŸ§ª ElementObserver Phase 3-B</h1>
            <div class="subtitle">ãƒã‚¤ã‚¯ãƒ­ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ†å‰²ã‚·ã‚¹ãƒ†ãƒ  å˜ç‹¬ãƒ†ã‚¹ãƒˆå®Ÿè¡Œç’°å¢ƒ</div>
        </div>

        <!-- æ¦‚è¦æƒ…å ± -->
        <div class="summary-panel">
            <h3>ğŸ¯ Phase 3-B ãƒã‚¤ã‚¯ãƒ­ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ¦‚è¦</h3>
            <p>ElementObserver Phase 3-Aã®99.9%é«˜é€ŸåŒ–æŠ€è¡“ã‚’4ã¤ã®ç‹¬ç«‹ãƒã‚¤ã‚¯ãƒ­ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«åˆ†å‰²ã—ã€å®Œå…¨ãªå˜ç‹¬ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚</p>
            <div class="summary-stats">
                <div class="stat-item">
                    <span class="stat-value">4</span>
                    <span class="stat-label">ãƒã‚¤ã‚¯ãƒ­ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">100%</span>
                    <span class="stat-label">ç‹¬ç«‹æ€§</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">0</span>
                    <span class="stat-label">å¤–éƒ¨ä¾å­˜</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value">âœ“</span>
                    <span class="stat-label">ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯é˜²æ­¢</span>
                </div>
            </div>
        </div>

        <!-- ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æƒ…å ± -->
        <div class="module-info">
            <div class="module-card">
                <h3>ğŸŒŠ PureEnvironmentObserver</h3>
                <div class="description">
                    ç’°å¢ƒå¤‰åŒ–ç›£è¦–å°‚é–€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«<br>
                    ãƒ»ResizeObserverçµ±åˆåˆ¶å¾¡<br>
                    ãƒ»DPRãƒ»ã‚ºãƒ¼ãƒ ãƒ»ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆç›£è¦–<br>
                    ãƒ»æ•°å€¤ã®ã¿å…¥å‡ºåŠ›ï¼ˆ932è¡Œï¼‰
                </div>
            </div>
            <div class="module-card">
                <h3>ğŸ§® PureScaleCalculator</h3>
                <div class="description">
                    ã‚¹ã‚±ãƒ¼ãƒ«å€¤è¨ˆç®—å°‚é–€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«<br>
                    ãƒ»5ã¤ã®ã‚¹ã‚±ãƒ¼ãƒ«ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ<br>
                    ãƒ»ç´”ç²‹ãªæ•°å€¤è¨ˆç®—ã®ã¿<br>
                    ãƒ»å¢ƒç•Œå€¤ãƒ†ã‚¹ãƒˆå®Œå‚™ï¼ˆ600è¡Œï¼‰
                </div>
            </div>
            <div class="module-card">
                <h3>ğŸ¨ PurePinHighlighter</h3>
                <div class="description">
                    è¦ç´ ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤ºå°‚é–€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«<br>
                    ãƒ»F12é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«é¢¨UI<br>
                    ãƒ»ãƒã‚¦ã‚¹ã‚ªãƒ¼ãƒãƒ¼ãƒã‚¤ãƒ©ã‚¤ãƒˆ<br>
                    ãƒ»DOMæ“ä½œãƒ»ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯é˜²æ­¢ï¼ˆ613è¡Œï¼‰
                </div>
            </div>
            <div class="module-card">
                <h3>ğŸš€ PinSystemIntegrator</h3>
                <div class="description">
                    çµ±åˆåˆ¶å¾¡ã‚·ã‚¹ãƒ†ãƒ <br>
                    ãƒ»3ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å”èª¿åˆ¶å¾¡<br>
                    ãƒ»ElementObserveräº’æ›API<br>
                    ãƒ»Phase 3-Açµ±åˆæŠ€è¡“ï¼ˆ1,198è¡Œï¼‰
                </div>
            </div>
        </div>

        <!-- å…¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä¸€æ‹¬ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h2>ğŸ¯ å…¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä¸€æ‹¬ãƒ†ã‚¹ãƒˆ</h2>
            <div class="test-controls">
                <button class="btn btn-primary" onclick="runAllTests()">ğŸš€ å…¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                <button class="btn btn-secondary" onclick="clearOutput()">ğŸ—‘ï¸ å‡ºåŠ›ã‚¯ãƒªã‚¢</button>
                <button class="btn btn-success" onclick="runPerformanceTest()">âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ</button>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="overall-progress" style="width: 0%"></div>
            </div>
            <div class="test-output console-output" id="all-test-output"></div>
        </div>

        <!-- å€‹åˆ¥ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h2>ğŸ”¬ å€‹åˆ¥ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆ</h2>
            <div class="test-controls">
                <button class="btn btn-primary" onclick="testEnvironmentObserver()">ğŸŒŠ ç’°å¢ƒç›£è¦–ãƒ†ã‚¹ãƒˆ</button>
                <button class="btn btn-primary" onclick="testScaleCalculator()">ğŸ§® ã‚¹ã‚±ãƒ¼ãƒ«è¨ˆç®—ãƒ†ã‚¹ãƒˆ</button>
                <button class="btn btn-primary" onclick="testPinHighlighter()">ğŸ¨ ãƒã‚¤ãƒ©ã‚¤ãƒˆãƒ†ã‚¹ãƒˆ</button>
                <button class="btn btn-primary" onclick="testPinIntegrator()">ğŸš€ çµ±åˆåˆ¶å¾¡ãƒ†ã‚¹ãƒˆ</button>
            </div>
            <div class="test-output console-output" id="individual-test-output"></div>
        </div>

        <!-- ãƒ†ã‚¹ãƒˆã‚¿ãƒ¼ã‚²ãƒƒãƒˆè¦ç´  -->
        <div class="test-section">
            <h2>ğŸ¯ ãƒ†ã‚¹ãƒˆå¯¾è±¡è¦ç´ </h2>
            <p>ä»¥ä¸‹ã®è¦ç´ ã‚’ä½¿ç”¨ã—ã¦ãƒã‚¤ã‚¯ãƒ­ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å‹•ä½œã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ï¼š</p>
            <div class="test-element" id="test-target-element">Test Element</div>
        </div>

        <!-- ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼ -->
        <div class="test-section">
            <h2>ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼</h2>
            <div id="test-summary">ãƒ†ã‚¹ãƒˆæœªå®Ÿè¡Œ</div>
        </div>
    </div>

    <!-- ãƒã‚¤ã‚¯ãƒ­ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿ -->
    <script src="micromodules/environment-observer/PureEnvironmentObserver.js"></script>
    <script src="micromodules/scale-calculator/PureScaleCalculator.js"></script>
    <script src="micromodules/pin-highlighter/PurePinHighlighter.js"></script>
    <script src="micromodules/pin-system/PinSystemIntegrator.js"></script>

    <script>
        // ========================================
        // ãƒ†ã‚¹ãƒˆåˆ¶å¾¡ã‚·ã‚¹ãƒ†ãƒ 
        // ========================================

        class TestController {
            constructor() {
                this.results = {
                    total: 0,
                    passed: 0,
                    failed: 0,
                    modules: {
                        environment: null,
                        scale: null,
                        highlighter: null,
                        integrator: null
                    },
                    startTime: null,
                    endTime: null
                };
                this.outputElement = document.getElementById('all-test-output');
                this.individualOutputElement = document.getElementById('individual-test-output');
            }

            log(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                const prefix = {
                    'info': 'ğŸ”µ',
                    'success': 'âœ…',
                    'error': 'âŒ',
                    'warning': 'âš ï¸'
                }[type] || 'ğŸ”µ';
                
                const formattedMessage = `[${timestamp}] ${prefix} ${message}`;
                
                if (this.outputElement) {
                    this.outputElement.textContent += formattedMessage + '\n';
                    this.outputElement.scrollTop = this.outputElement.scrollHeight;
                }
                
                console.log(formattedMessage);
            }

            logToIndividual(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                const prefix = {
                    'info': 'ğŸ”µ',
                    'success': 'âœ…',
                    'error': 'âŒ',
                    'warning': 'âš ï¸'
                }[type] || 'ğŸ”µ';
                
                const formattedMessage = `[${timestamp}] ${prefix} ${message}`;
                
                if (this.individualOutputElement) {
                    this.individualOutputElement.textContent += formattedMessage + '\n';
                    this.individualOutputElement.scrollTop = this.individualOutputElement.scrollHeight;
                }
                
                console.log(formattedMessage);
            }

            updateProgress(percent) {
                const progressBar = document.getElementById('overall-progress');
                if (progressBar) {
                    progressBar.style.width = `${percent}%`;
                }
            }

            updateSummary() {
                const summaryElement = document.getElementById('test-summary');
                if (!summaryElement) return;

                const duration = this.results.endTime ? 
                    (this.results.endTime - this.results.startTime) / 1000 : 0;

                const html = `
                    <div class="summary-stats">
                        <div class="stat-item ${this.results.failed === 0 ? 'status-success' : 'status-error'}">
                            <span class="stat-value">${this.results.total}</span>
                            <span class="stat-label">ç·ãƒ†ã‚¹ãƒˆæ•°</span>
                        </div>
                        <div class="stat-item status-success">
                            <span class="stat-value">${this.results.passed}</span>
                            <span class="stat-label">æˆåŠŸ</span>
                        </div>
                        <div class="stat-item ${this.results.failed > 0 ? 'status-error' : 'status-success'}">
                            <span class="stat-value">${this.results.failed}</span>
                            <span class="stat-label">å¤±æ•—</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value">${duration.toFixed(2)}s</span>
                            <span class="stat-label">å®Ÿè¡Œæ™‚é–“</span>
                        </div>
                    </div>
                    <h4>ğŸ“‹ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ¥çµæœ:</h4>
                    <ul>
                        <li>ğŸŒŠ ç’°å¢ƒç›£è¦–: ${this.formatModuleResult('environment')}</li>
                        <li>ğŸ§® ã‚¹ã‚±ãƒ¼ãƒ«è¨ˆç®—: ${this.formatModuleResult('scale')}</li>
                        <li>ğŸ¨ ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤º: ${this.formatModuleResult('highlighter')}</li>
                        <li>ğŸš€ çµ±åˆåˆ¶å¾¡: ${this.formatModuleResult('integrator')}</li>
                    </ul>
                `;

                summaryElement.innerHTML = html;
            }

            formatModuleResult(moduleKey) {
                const result = this.results.modules[moduleKey];
                if (!result) return 'â³ æœªå®Ÿè¡Œ';
                
                const successRate = result.total > 0 ? 
                    ((result.passed / result.total) * 100).toFixed(1) : '0';
                
                return `${result.passed}/${result.total} (${successRate}%) ${result.failed === 0 ? 'âœ…' : 'âŒ'}`;
            }
        }

        const testController = new TestController();

        // ========================================
        // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œé–¢æ•°
        // ========================================

        async function runAllTests() {
            testController.results.startTime = Date.now();
            testController.log('ğŸš€ ElementObserver Phase 3-B ãƒã‚¤ã‚¯ãƒ­ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«çµ±åˆãƒ†ã‚¹ãƒˆé–‹å§‹', 'info');
            testController.updateProgress(0);

            // ä¾å­˜ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç¢ºèª
            testController.log('ğŸ“‹ ãƒã‚¤ã‚¯ãƒ­ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä¾å­˜é–¢ä¿‚ç¢ºèª...', 'info');
            
            const modules = {
                'PureEnvironmentObserver': window.PureEnvironmentObserver,
                'PureScaleCalculator': window.PureScaleCalculator,
                'PurePinHighlighter': window.PurePinHighlighter,
                'PinSystemIntegrator': window.PinSystemIntegrator
            };

            let allModulesAvailable = true;
            Object.entries(modules).forEach(([name, module]) => {
                if (typeof module !== 'undefined') {
                    testController.log(`âœ… ${name} ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿æˆåŠŸ`, 'success');
                } else {
                    testController.log(`âŒ ${name} ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿å¤±æ•—`, 'error');
                    allModulesAvailable = false;
                }
            });

            if (!allModulesAvailable) {
                testController.log('âŒ å¿…è¦ãªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚ãƒ†ã‚¹ãƒˆã‚’ä¸­æ­¢ã—ã¾ã™ã€‚', 'error');
                return;
            }

            testController.updateProgress(10);

            // å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒ†ã‚¹ãƒˆã‚’é †æ¬¡å®Ÿè¡Œ
            const testSequence = [
                { name: 'ç’°å¢ƒç›£è¦–', key: 'environment', fn: () => PureEnvironmentObserver.test(), progress: 30 },
                { name: 'ã‚¹ã‚±ãƒ¼ãƒ«è¨ˆç®—', key: 'scale', fn: () => PureScaleCalculator.test(), progress: 50 },
                { name: 'ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤º', key: 'highlighter', fn: () => PurePinHighlighter.test(), progress: 70 },
                { name: 'çµ±åˆåˆ¶å¾¡', key: 'integrator', fn: () => PinSystemIntegrator.test(), progress: 90 }
            ];

            for (const test of testSequence) {
                testController.log(`\nğŸ”¬ ${test.name}ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« ãƒ†ã‚¹ãƒˆé–‹å§‹...`, 'info');
                
                try {
                    const result = await test.fn();
                    testController.results.modules[test.key] = result;
                    testController.results.total += result.total || (result.passed + result.failed);
                    testController.results.passed += result.passed;
                    testController.results.failed += result.failed;

                    if (result.failed === 0) {
                        testController.log(`âœ… ${test.name}ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« ãƒ†ã‚¹ãƒˆå®Œäº† (${result.passed}ä»¶æˆåŠŸ)`, 'success');
                    } else {
                        testController.log(`âŒ ${test.name}ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« ãƒ†ã‚¹ãƒˆå®Œäº† (${result.passed}ä»¶æˆåŠŸ, ${result.failed}ä»¶å¤±æ•—)`, 'error');
                        if (result.errors && result.errors.length > 0) {
                            result.errors.forEach(error => {
                                testController.log(`   ğŸ’¥ ${error}`, 'error');
                            });
                        }
                    }
                } catch (error) {
                    testController.log(`âŒ ${test.name}ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                    testController.results.failed++;
                    testController.results.modules[test.key] = { passed: 0, failed: 1, total: 1, errors: [error.message] };
                }

                testController.updateProgress(test.progress);
                await new Promise(resolve => setTimeout(resolve, 500)); // è¦–è¦šçš„ãªé–“éš”
            }

            testController.results.endTime = Date.now();
            testController.updateProgress(100);

            // æœ€çµ‚çµæœ
            const duration = (testController.results.endTime - testController.results.startTime) / 1000;
            testController.log('\nğŸ‰ å…¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆå®Œäº†!', 'success');
            testController.log(`ğŸ“Š çµæœ: ${testController.results.passed}/${testController.results.total} æˆåŠŸ (å®Ÿè¡Œæ™‚é–“: ${duration.toFixed(2)}ç§’)`, 'info');

            if (testController.results.failed === 0) {
                testController.log('ğŸ‰ ğŸ‰ ğŸ‰ å…¨ãƒ†ã‚¹ãƒˆæˆåŠŸ! ãƒã‚¤ã‚¯ãƒ­ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ†å‰²ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸å‹•ä½œç¢ºèªå®Œäº† ğŸ‰ ğŸ‰ ğŸ‰', 'success');
            } else {
                testController.log(`âš ï¸ ${testController.results.failed}ä»¶ã®ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¾ã—ãŸã€‚è©³ç´°ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚`, 'warning');
            }

            testController.updateSummary();
        }

        function testEnvironmentObserver() {
            testController.logToIndividual('ğŸŒŠ PureEnvironmentObserver å˜ç‹¬ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...', 'info');
            try {
                const result = PureEnvironmentObserver.test();
                testController.logToIndividual(`âœ… ç’°å¢ƒç›£è¦–ãƒ†ã‚¹ãƒˆå®Œäº†: ${result.passed}/${result.total} æˆåŠŸ`, 'success');
            } catch (error) {
                testController.logToIndividual(`âŒ ç’°å¢ƒç›£è¦–ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        function testScaleCalculator() {
            testController.logToIndividual('ğŸ§® PureScaleCalculator å˜ç‹¬ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...', 'info');
            try {
                const result = PureScaleCalculator.test();
                testController.logToIndividual(`âœ… ã‚¹ã‚±ãƒ¼ãƒ«è¨ˆç®—ãƒ†ã‚¹ãƒˆå®Œäº†: ${result.passed}/${result.total} æˆåŠŸ`, 'success');
            } catch (error) {
                testController.logToIndividual(`âŒ ã‚¹ã‚±ãƒ¼ãƒ«è¨ˆç®—ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        function testPinHighlighter() {
            testController.logToIndividual('ğŸ¨ PurePinHighlighter å˜ç‹¬ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...', 'info');
            try {
                const result = PurePinHighlighter.test();
                testController.logToIndividual(`âœ… ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤ºãƒ†ã‚¹ãƒˆå®Œäº†: ${result.passed}/${result.failed} æˆåŠŸ`, 'success');
            } catch (error) {
                testController.logToIndividual(`âŒ ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤ºãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        function testPinIntegrator() {
            testController.logToIndividual('ğŸš€ PinSystemIntegrator å˜ç‹¬ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...', 'info');
            try {
                const result = PinSystemIntegrator.test();
                testController.logToIndividual(`âœ… çµ±åˆåˆ¶å¾¡ãƒ†ã‚¹ãƒˆå®Œäº†: ${result.passed}/${result.failed} æˆåŠŸ`, 'success');
            } catch (error) {
                testController.logToIndividual(`âŒ çµ±åˆåˆ¶å¾¡ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        function runPerformanceTest() {
            testController.log('âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...', 'info');
            
            try {
                if (typeof PureScaleCalculator.performanceTest === 'function') {
                    const perfResult = PureScaleCalculator.performanceTest(1000);
                    testController.log('ğŸ“ˆ PureScaleCalculator ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çµæœ:', 'info');
                    Object.entries(perfResult).forEach(([mode, stats]) => {
                        testController.log(`   ${mode}: ${stats.avgTime.toFixed(4)}ms/å›, ${stats.opsPerSecond} ops/sec`, 'info');
                    });
                } else {
                    testController.log('âš ï¸ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã¯ PureScaleCalculator ã§ã®ã¿åˆ©ç”¨å¯èƒ½ã§ã™', 'warning');
                }
            } catch (error) {
                testController.log(`âŒ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }

        function clearOutput() {
            if (testController.outputElement) {
                testController.outputElement.textContent = '';
            }
            if (testController.individualOutputElement) {
                testController.individualOutputElement.textContent = '';
            }
            testController.updateProgress(0);
            
            // çµæœã‚’ãƒªã‚»ãƒƒãƒˆ
            testController.results = {
                total: 0,
                passed: 0,
                failed: 0,
                modules: {
                    environment: null,
                    scale: null,
                    highlighter: null,
                    integrator: null
                },
                startTime: null,
                endTime: null
            };
            
            document.getElementById('test-summary').innerHTML = 'ãƒ†ã‚¹ãƒˆæœªå®Ÿè¡Œ';
        }

        // ========================================
        // åˆæœŸåŒ–ãƒ»è‡ªå‹•å®Ÿè¡Œ
        // ========================================

        document.addEventListener('DOMContentLoaded', function() {
            testController.log('ğŸš€ ElementObserver Phase 3-B ãƒ†ã‚¹ãƒˆç’°å¢ƒåˆæœŸåŒ–å®Œäº†', 'success');
            testController.log('ğŸ“‹ 4ã¤ã®ãƒã‚¤ã‚¯ãƒ­ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿ç¢ºèªä¸­...', 'info');
            
            // ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å­˜åœ¨ç¢ºèª
            const moduleStatus = {
                'PureEnvironmentObserver': typeof PureEnvironmentObserver !== 'undefined',
                'PureScaleCalculator': typeof PureScaleCalculator !== 'undefined',
                'PurePinHighlighter': typeof PurePinHighlighter !== 'undefined',
                'PinSystemIntegrator': typeof PinSystemIntegrator !== 'undefined'
            };

            Object.entries(moduleStatus).forEach(([name, available]) => {
                testController.log(`${available ? 'âœ…' : 'âŒ'} ${name}: ${available ? 'åˆ©ç”¨å¯èƒ½' : 'æœªèª­ã¿è¾¼ã¿'}`, available ? 'success' : 'error');
            });

            const allAvailable = Object.values(moduleStatus).every(status => status);
            if (allAvailable) {
                testController.log('ğŸ‰ å…¨ãƒã‚¤ã‚¯ãƒ­ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ­£å¸¸èª­ã¿è¾¼ã¿å®Œäº†! ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæº–å‚™OK', 'success');
                testController.log('ğŸ’¡ "ğŸš€ å…¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ" ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å˜ç‹¬ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¦ãã ã•ã„', 'info');
            } else {
                testController.log('âš ï¸ ä¸€éƒ¨ã®ãƒã‚¤ã‚¯ãƒ­ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“', 'warning');
            }
        });

    </script>
</body>
</html>