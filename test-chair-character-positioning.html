<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¤…å­ã¨ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é…ç½®ãƒ†ã‚¹ãƒˆ - ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹å®Ÿç”¨æ¤œè¨¼</title>
    
    <style>
        /* ğŸ“± ãƒ™ãƒ¼ã‚¹ã‚¹ã‚¿ã‚¤ãƒ« */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* ğŸ“„ ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .header h1 {
            text-align: center;
            color: #333;
            font-size: 1.8em;
        }
        
        .header p {
            text-align: center;
            margin-top: 10px;
            color: #666;
            font-size: 0.9em;
        }
        
        /* ğŸ“Š ãƒ–ãƒ¬ã‚¤ã‚¯ãƒã‚¤ãƒ³ãƒˆè¡¨ç¤º */
        .breakpoint-display {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 10000;
            font-family: monospace;
        }
        
        /* ğŸ  ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* ğŸ’» ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« */
        .control-panel {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .control-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .control-button {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            min-width: 120px;
        }
        
        .control-button.primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }
        
        .control-button.success {
            background: linear-gradient(45deg, #56ab2f, #a8e6cf);
            color: white;
        }
        
        .control-button.warning {
            background: linear-gradient(45deg, #f093fb, #f5576c);
            color: white;
        }
        
        .control-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        /* ğŸ› ï¸ ãƒ‡ãƒãƒƒã‚°æƒ…å ± */
        .debug-info {
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-family: monospace;
            font-size: 12px;
            margin: 20px 0;
            max-height: 200px;
            overflow-y: auto;
        }
        
        /* ğŸ¨ ã‚·ãƒ¼ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ */
        .scene-container {
            position: relative;
            width: 100%;
            height: 600px;
            background: linear-gradient(to bottom, #87ceeb 0%, #98fb98 70%, #8fbc8f 100%);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin: 20px 0;
        }
        
        /* ğŸª‘ ãƒ•ãƒªãƒ¼ç”»åƒæ¤…å­ãƒ‡ã‚¶ã‚¤ãƒ³ï¼ˆå®Ÿç”¨ãƒ†ã‚¹ãƒˆç”¨ï¼‰ */
        .chair {
            position: absolute;
            width: 200px;
            height: 180px;
            left: 50%;
            top: 62%;
            transform: translate(-50%, -50%);
            z-index: 1;
            /* ãƒ•ãƒªãƒ¼ç”»åƒæ¤…å­: ã‚¨ãƒ¬ã‚¬ãƒ³ãƒˆãªãƒ€ã‚¤ãƒ‹ãƒ³ã‚°ãƒã‚§ã‚¢ï¼ˆPixabayï¼‰ */
            background-image: url('https://cdn.pixabay.com/photo/2017/08/27/10/16/interior-2681608_1280.jpg');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            /* æ¤…å­ã®ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆã¨é®®æ˜åº¦å‘ä¸Š */
            filter: contrast(1.2) brightness(1.1) saturate(1.1);
            border-radius: 10px;
        }
        
        /* æ¤…å­ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆç”»åƒèª­ã¿è¾¼ã¿å¤±æ•—æ™‚ï¼‰ */
        .chair.fallback {
            background: linear-gradient(135deg, #8B4513 0%, #A0522D 50%, #654321 100%);
            border: 3px solid #654321;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .chair.fallback::before {
            content: 'ğŸª‘';
            font-size: 80px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        /* ä»£æ›¿æ¤…å­ç”»åƒï¼ˆè¤‡æ•°ã®ãƒ•ãƒªãƒ¼ç”»åƒã‹ã‚‰é¸æŠå¯èƒ½ï¼‰ */
        .chair.style-modern {
            /* ãƒ¢ãƒ€ãƒ³ã‚ªãƒ•ã‚£ã‚¹ãƒã‚§ã‚¢ï¼ˆUnsplashï¼‰ */
            background-image: url('https://images.unsplash.com/photo-1586023492125-27b2c045efd7?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80');
        }
        
        .chair.style-vintage {
            /* ãƒ´ã‚£ãƒ³ãƒ†ãƒ¼ã‚¸ã‚¢ãƒ¼ãƒ ãƒã‚§ã‚¢ï¼ˆUnsplashï¼‰ */
            background-image: url('https://images.unsplash.com/photo-1506439773649-6e0eb8cfb237?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80');
        }
        
        .chair.style-bench {
            /* ãƒ‘ãƒ¼ã‚¯ãƒ™ãƒ³ãƒï¼ˆå±‹å¤–ã‚·ãƒ¼ãƒ³ç”¨ï¼‰ï¼ˆUnsplashï¼‰ */
            background-image: url('https://images.unsplash.com/photo-1559827260-dc66d52bef19?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80');
            width: 280px;
            height: 120px;
        }
        
        .chair.style-sofa {
            /* ã‚¨ãƒ¬ã‚¬ãƒ³ãƒˆã‚½ãƒ•ã‚¡ï¼ˆãƒªãƒ“ãƒ³ã‚°ã‚·ãƒ¼ãƒ³ç”¨ï¼‰ï¼ˆUnsplashï¼‰ */
            background-image: url('https://images.unsplash.com/photo-1555041469-a586c61ea9bc?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80');
            width: 300px;
            height: 200px;
        }
        
        /* ğŸ¯ Spineã‚­ãƒ£ãƒ³ãƒã‚¹ */
        #purattokun-canvas {
            position: absolute;
            z-index: 5;
            pointer-events: none; /* ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ç·¨é›†ã‚’å„ªå…ˆ */
            /* åˆæœŸä½ç½®: æ¤…å­ã«åº§ã£ãŸçŠ¶æ…‹ */
            left: 50%;
            top: 55%;
            transform: translate(-50%, -50%);
            width: 120px;           /* å›ºå®šã‚µã‚¤ã‚ºï¼ˆæ­ªã¿é˜²æ­¢ï¼‰ */
            height: 120px;          /* å›ºå®šã‚µã‚¤ã‚ºï¼ˆæ­ªã¿é˜²æ­¢ï¼‰ */
            aspect-ratio: 1 / 1;    /* 1:1ã®æ­£æ–¹å½¢ã‚’å¼·åˆ¶ç¶­æŒ */
        }
        
        /* ğŸ“Š ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        @media (max-width: 768px) {
            .main-container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 1.4em;
            }
            
            .scene-container {
                height: 400px;
            }
            
            .chair {
                width: 120px;
                height: 100px;
            }
            
            .chair.style-bench {
                width: 160px;
                height: 80px;
            }
            
            .chair.style-sofa {
                width: 180px;
                height: 120px;
            }
            
            #purattokun-canvas {
                width: 100px;         /* ãƒ¢ãƒã‚¤ãƒ«ç”¨å›ºå®šã‚µã‚¤ã‚º */
                height: 100px;        /* ãƒ¢ãƒã‚¤ãƒ«ç”¨å›ºå®šã‚µã‚¤ã‚º */
                aspect-ratio: 1 / 1;  /* ãƒ¢ãƒã‚¤ãƒ«ã§ã‚‚ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”å›ºå®š */
            }
            
            .control-row {
                flex-direction: column;
            }
            
            .control-button {
                min-width: 100%;
            }
        }
        
        /* ğŸ¨ æ¤…å­ã‚¹ã‚¿ã‚¤ãƒ«åˆ‡ã‚Šæ›¿ãˆUI */
        .chair-style-selector {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 100;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            max-width: 120px;
        }
        
        .style-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s ease;
            text-align: left;
        }
        
        .style-btn:hover {
            background: rgba(102, 126, 234, 0.8);
            color: white;
            transform: translateX(3px);
        }
        
        .style-btn.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }
        
        /* ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ */
        @media (max-width: 768px) {
            .chair-style-selector {
                flex-direction: row;
                max-width: 100%;
                left: 50%;
                transform: translateX(-50%);
                overflow-x: auto;
            }
            
            .style-btn {
                white-space: nowrap;
                min-width: 80px;
                text-align: center;
                font-size: 10px;
            }
        }
        
        /* ğŸŒ¿ è£…é£¾çš„è¦ç´  */
        .floor-pattern {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100px;
            background: repeating-linear-gradient(
                90deg,
                #deb887 0px,
                #deb887 50px,
                #d2b48c 50px,
                #d2b48c 100px
            );
            opacity: 0.3;
        }
        
        .wall-texture {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 100px;
            background: linear-gradient(
                180deg,
                rgba(255,255,255,0.1) 0%,
                rgba(255,255,255,0.05) 50%,
                rgba(0,0,0,0.05) 100%
            );
        }
        
        /* ğŸ† ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes chairGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.3); }
            50% { box-shadow: 0 0 40px rgba(255, 215, 0, 0.6); }
        }
        
        .chair.highlight {
            animation: chairGlow 2s ease-in-out infinite;
        }
        
        /* ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹é–¢é€£ã‚¹ã‚¿ã‚¤ãƒ« */
        .bb-edit-active {
            border: 2px dashed #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
        }
        
        .bb-edit-active #purattokun-canvas {
            pointer-events: auto;
            border: 2px solid #4ecdc4;
            border-radius: 10px;
            /* ğŸ¯ ç·¨é›†ä¸­ã‚‚ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”å›ºå®šè¡¨ç¤º */
            box-shadow: 0 0 15px rgba(78, 205, 196, 0.3);
        }
        
        /* ğŸ¯ ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”å›ºå®šã®è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ */
        .bb-edit-active #purattokun-canvas::after {
            content: "ğŸ“ 1:1æ¯”ç‡å›ºå®š";
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(78, 205, 196, 0.9);
            color: white;
            padding: 4px 8px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: bold;
            white-space: nowrap;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <!-- ğŸ“Š ãƒ–ãƒ¬ã‚¤ã‚¯ãƒã‚¤ãƒ³ãƒˆè¡¨ç¤º -->
    <div class="breakpoint-display" id="breakpointDisplay">
        PC: 1024px+
    </div>
    
    <!-- ğŸ“„ ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="header">
        <h1>ğŸª‘ æ¤…å­ã¨ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é…ç½®ãƒ†ã‚¹ãƒˆ</h1>
        <p>PureBoundingBoxçµ±åˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆãƒãƒ‹ãƒ¥ã‚¢ãƒ«æº–æ‹ ç‰ˆï¼‰ - ã€Œæ¤…å­ã«åº§ã‚‹ã€ã‚·ãƒ¼ãƒ³<br>
        ğŸ¯ <strong>ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”å›ºå®šæ©Ÿèƒ½æ­è¼‰</strong> - ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®ç¸¦æ¨ªæ¯”æ­ªã¿ã‚’å®Œå…¨é˜²æ­¢</p>
    </div>
    
    <div class="main-container">
        <!-- ğŸ’» ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« -->
        <div class="control-panel">
            <div class="control-row">
                <button class="control-button primary" onclick="startBoundingBoxEdit()">
                    ğŸ¯ ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ç·¨é›†é–‹å§‹
                </button>
                <button class="control-button success" onclick="saveBoundingBoxPosition()">
                    ğŸ’¾ ä½ç½®ä¿å­˜
                </button>
                <button class="control-button warning" onclick="cancelBoundingBoxEdit()">
                    âŒ ç·¨é›†ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                </button>
            </div>
            <div class="control-row">
                <button class="control-button primary" onclick="toggleChairHighlight()">
                    âœ¨ æ¤…å­ãƒã‚¤ãƒ©ã‚¤ãƒˆåˆ‡æ›¿
                </button>
                <button class="control-button primary" onclick="testResponsivePositioning()">
                    ğŸ“± ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ†ã‚¹ãƒˆ
                </button>
                <button class="control-button success" onclick="resetToChairPosition()">
                    ğŸª‘ æ¤…å­ä½ç½®ã«ãƒªã‚»ãƒƒãƒˆ
                </button>
                <button class="control-button primary" onclick="analyzeImageQuality()">
                    ğŸ–¼ï¸ ç”»åƒå“è³ªåˆ†æ
                </button>
                <button class="control-button warning" onclick="cleanupBoundingBox()">
                    ğŸ§¹ ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
                </button>
                <button class="control-button primary" onclick="checkAspectRatio()">
                    ğŸ“ ç¸¦æ¨ªæ¯”æ¤œè¨¼
                </button>
                <button class="control-button danger" onclick="diagnoseEditingTransformIssue()">
                    ğŸ” ç·¨é›†å‰å¾ŒCSSçŠ¶æ…‹è¨ºæ–­
                </button>
            </div>
        </div>
        
        <!-- ğŸ† ã‚·ãƒ¼ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ -->
        <div class="scene-container" id="sceneContainer">
            <!-- å£ã®ãƒ†ã‚¯ã‚¹ãƒãƒ£ -->
            <div class="wall-texture"></div>
            
            <!-- åºŠã®ãƒ‘ã‚¿ãƒ¼ãƒ³ -->
            <div class="floor-pattern"></div>
            
            <!-- ãƒ•ãƒªãƒ¼ç”»åƒæ¤…å­ï¼ˆå®Ÿç”¨ãƒ†ã‚¹ãƒˆç”¨ï¼‰ -->
            <div class="chair" id="chairElement" data-style="default">
                <!-- ç”»åƒãŒè‡ªå‹•çš„ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
            </div>
            
            <!-- æ¤…å­ã‚¹ã‚¿ã‚¤ãƒ«åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ï¼ˆå®Ÿç”¨æ¤œè¨¼ç”¨ï¼‰ -->
            <div class="chair-style-selector" id="chairStyleSelector">
                <button onclick="changeChairStyle('default')" class="style-btn active" data-style="default">ğŸª‘ ãƒ€ã‚¤ãƒ‹ãƒ³ã‚°</button>
                <button onclick="changeChairStyle('modern')" class="style-btn" data-style="modern">ğŸ’º ãƒ¢ãƒ€ãƒ³</button>
                <button onclick="changeChairStyle('vintage')" class="style-btn" data-style="vintage">ğŸ›‹ï¸ ãƒ´ã‚£ãƒ³ãƒ†ãƒ¼ã‚¸</button>
                <button onclick="changeChairStyle('bench')" class="style-btn" data-style="bench">ğŸª‘ ãƒ™ãƒ³ãƒ</button>
                <button onclick="changeChairStyle('sofa')" class="style-btn" data-style="sofa">ğŸ›‹ï¸ ã‚½ãƒ•ã‚¡</button>
            </div>
            
            <!-- Spineã‚­ãƒ£ãƒ³ãƒã‚¹ -->
            <canvas id="purattokun-canvas" width="200" height="200"></canvas>
        </div>
        
        <!-- ğŸ› ï¸ ãƒ‡ãƒãƒƒã‚°æƒ…å ± -->
        <div class="debug-info" id="debugInfo">
            ğŸ—ºï¸ ãƒ‡ãƒãƒƒã‚°æƒ…å ±: åˆæœŸåŒ–ä¸­...<br>
            âŒ¨ï¸ ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ: [E]ç·¨é›†é–‹å§‹ [S]ä¿å­˜ [ESC]ã‚­ãƒ£ãƒ³ã‚»ãƒ« [H]æ¤…å­ãƒã‚¤ãƒ©ã‚¤ãƒˆ [R]ãƒªã‚»ãƒƒãƒˆ [A]ç¸¦æ¨ªæ¯”æ¤œè¨¼ [C]ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
        </div>
    </div>
    
    <!-- ğŸš€ JavaScriptãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿ -->
    <script src="/assets/js/libs/spine-webgl.js"></script>
    <script src="/micromodules/spine-renderer/StableSpineRenderer.js"></script>
    
    <!-- âœ… PureBoundingBox ãƒãƒ‹ãƒ¥ã‚¢ãƒ«æº–æ‹ ã®æ­£ã—ã„èª­ã¿è¾¼ã¿é †åº -->
    <script src="micromodules/bounding-box/PureBoundingBoxCore.js"></script>
    <script src="micromodules/bounding-box/PureBoundingBoxBounds.js"></script>
    <script src="micromodules/bounding-box/PureBoundingBoxUI.js"></script>
    <script src="micromodules/bounding-box/PureBoundingBoxEvents.js"></script>
    <script src="micromodules/bounding-box/PureBoundingBox.js"></script>
    
    <script>
        // ğŸŒ ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let spineRenderer = null;
        let boundingBox = null;  // âœ… çµ±åˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ä½¿ç”¨
        let isEditingBB = false;
        let chairHighlighted = false;
        
        // ğŸ“Š ãƒ–ãƒ¬ã‚¤ã‚¯ãƒã‚¤ãƒ³ãƒˆç›£è¦–
        function updateBreakpointDisplay() {
            const width = window.innerWidth;
            const display = document.getElementById('breakpointDisplay');
            
            if (width <= 768) {
                display.textContent = `Mobile: ${width}px`;
                display.style.background = 'rgba(255, 107, 107, 0.9)';
            } else if (width <= 1024) {
                display.textContent = `Tablet: ${width}px`;
                display.style.background = 'rgba(255, 193, 7, 0.9)';
            } else {
                display.textContent = `PC: ${width}px`;
                display.style.background = 'rgba(40, 167, 69, 0.9)';
            }
        }
        
        // ğŸ› ï¸ ãƒ‡ãƒãƒƒã‚°æƒ…å ±æ›´æ–°
        function updateDebugInfo(message) {
            const debugDiv = document.getElementById('debugInfo');
            const timestamp = new Date().toLocaleTimeString();
            debugDiv.innerHTML += `<br>[${timestamp}] ${message}`;
            debugDiv.scrollTop = debugDiv.scrollHeight;
        }
        
        // ğŸš€ åˆæœŸåŒ–å‡¦ç†
        async function initializeChairTest() {
            try {
                updateDebugInfo('ğŸš€ æ¤…å­ãƒ†ã‚¹ãƒˆç’°å¢ƒåˆæœŸåŒ–é–‹å§‹');
                
                // StableSpineRendereråˆæœŸåŒ–
                updateDebugInfo('ğŸ¯ StableSpineRendereråˆæœŸåŒ–ä¸­...');
                spineRenderer = new StableSpineRenderer({
                    canvas: '#purattokun-canvas',
                    character: 'purattokun',
                    basePath: '/assets/spine/characters/',
                    position: {
                        x: 0,    // Canvasä¸­å¤®ã‚’åŸºæº–
                        y: -30,   // å°‘ã—ä¸Šã¸ï¼ˆæ¤…å­ã«åº§ã£ãŸçŠ¶æ…‹ï¼‰
                        scaleX: 0.8,
                        scaleY: 0.8
                    }
                });
                
                await spineRenderer.initialize();
                updateDebugInfo('âœ… Spineã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼èª­ã¿è¾¼ã¿æˆåŠŸ');
                
                // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹
                spineRenderer.playAnimation('taiki');
                
                // ğŸ¯ ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”å›ºå®šç¢ºèª
                updateDebugInfo('ğŸ“ ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”å›ºå®šè¨­å®šç¢ºèªä¸­...');
                checkAspectRatio();
                
                // âœ… PureBoundingBoxçµ±åˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹åˆæœŸåŒ–ï¼ˆãƒãƒ‹ãƒ¥ã‚¢ãƒ«æº–æ‹ ï¼‰
                updateDebugInfo('ğŸ“œ PureBoundingBoxçµ±åˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹åˆæœŸåŒ–ä¸­...');
                const targetElement = document.querySelector('#purattokun-canvas');
                
                boundingBox = new PureBoundingBox({
                    targetElement: targetElement
                });
                
                updateDebugInfo('âœ… ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ã‚·ã‚¹ãƒ†ãƒ æº–å‚™å®Œäº†ï¼ˆçµ±åˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ä½¿ç”¨ï¼‰');
                updateDebugInfo('ğŸ  æ¤…å­ã¨ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®å®Ÿç”¨ãƒ†ã‚¹ãƒˆç’°å¢ƒãŒæº–å‚™å®Œäº†ã—ã¾ã—ãŸï¼');
                
            } catch (error) {
                console.error('Initialization failed:', error);
                updateDebugInfo(`âŒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }
        
        // ğŸ¯ ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ç·¨é›†é–‹å§‹ï¼ˆãƒãƒ‹ãƒ¥ã‚¢ãƒ«æº–æ‹ ï¼‰
        async function startBoundingBoxEdit() {
            if (!boundingBox) {
                updateDebugInfo('âŒ ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ã‚·ã‚¹ãƒ†ãƒ ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                return;
            }
            
            try {
                // âœ… ãƒãƒ‹ãƒ¥ã‚¢ãƒ«æº–æ‹ ã® execute() ãƒ¡ã‚½ãƒƒãƒ‰ä½¿ç”¨
                const result = await boundingBox.execute();
                
                if (result.success) {
                    isEditingBB = true;
                    // ã‚·ãƒ¼ãƒ³ã‚³ãƒ³ãƒ†ãƒŠã«ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é©ç”¨
                    document.getElementById('sceneContainer').classList.add('bb-edit-active');
                    updateDebugInfo('ğŸ¯ ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ç·¨é›†ãƒ¢ãƒ¼ãƒ‰é–‹å§‹ - æ¤…å­ã¨ã®ä½ç½®é–¢ä¿‚ã‚’èª¿æ•´ã—ã¦ãã ã•ã„');
                } else {
                    updateDebugInfo(`âŒ ç·¨é›†é–‹å§‹ã‚¨ãƒ©ãƒ¼: ${result.error}`);
                }
            } catch (error) {
                console.error('ç·¨é›†é–‹å§‹ã‚¨ãƒ©ãƒ¼:', error);
                updateDebugInfo(`âŒ ç·¨é›†é–‹å§‹ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }
        
        // ğŸ’¾ ä½ç½®ä¿å­˜ï¼ˆãƒãƒ‹ãƒ¥ã‚¢ãƒ«æº–æ‹ ã®çŠ¶æ…‹å–å¾—ä½¿ç”¨ï¼‰
        function saveBoundingBoxPosition() {
            if (!boundingBox || !isEditingBB) {
                updateDebugInfo('âŒ ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã§ã¯ã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            
            try {
                // âœ… ãƒãƒ‹ãƒ¥ã‚¢ãƒ«æº–æ‹ ã® getState() ãƒ¡ã‚½ãƒƒãƒ‰ä½¿ç”¨
                const state = boundingBox.getState();
                updateDebugInfo(`ğŸ’¾ ç¾åœ¨ã®çŠ¶æ…‹: ${JSON.stringify(state, null, 2)}`);
                
                // ç·¨é›†çµ‚äº†ï¼ˆéè¡¨ç¤ºï¼‰
                boundingBox.hide();
                isEditingBB = false;
                
                // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è§£é™¤
                document.getElementById('sceneContainer').classList.remove('bb-edit-active');
                updateDebugInfo('ğŸ’¾ ä½ç½®ãŒä¿å­˜ã•ã‚Œã¾ã—ãŸ - æ¤…å­ã¨ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®ä½ç½®é–¢ä¿‚ãŒå›ºå®šã•ã‚Œã¾ã—ãŸ');
                
                // ä¿å­˜å¾Œã®ä½ç½®æƒ…å ±ã‚’è¡¨ç¤º
                showPositionInfo();
                
                // ğŸ¯ ä¿å­˜å¾Œã®ç¸¦æ¨ªæ¯”æ¤œè¨¼
                setTimeout(() => {
                    checkAspectRatio();
                }, 100);
            } catch (error) {
                console.error('ä½ç½®ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
                updateDebugInfo(`âŒ ä½ç½®ä¿å­˜ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }
        
        // âŒ ç·¨é›†ã‚­ãƒ£ãƒ³ã‚»ãƒ«ï¼ˆãƒãƒ‹ãƒ¥ã‚¢ãƒ«æº–æ‹ ï¼‰
        function cancelBoundingBoxEdit() {
            if (!boundingBox) return;
            
            try {
                // âœ… ãƒãƒ‹ãƒ¥ã‚¢ãƒ«æº–æ‹ ã® hide() ãƒ¡ã‚½ãƒƒãƒ‰ã§ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                boundingBox.hide();
                isEditingBB = false;
                
                // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è§£é™¤
                document.getElementById('sceneContainer').classList.remove('bb-edit-active');
                updateDebugInfo('âŒ ç·¨é›†ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸ - å…ƒã®ä½ç½®ã«æˆ»ã‚Šã¾ã—ãŸ');
            } catch (error) {
                console.error('ç·¨é›†ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã‚¨ãƒ©ãƒ¼:', error);
                updateDebugInfo(`âŒ ç·¨é›†ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }
        
        // âœ¨ æ¤…å­ãƒã‚¤ãƒ©ã‚¤ãƒˆåˆ‡æ›¿
        function toggleChairHighlight() {
            chairHighlighted = !chairHighlighted;
            const chair = document.getElementById('chairElement');
            
            if (chairHighlighted) {
                chair.classList.add('highlight');
                updateDebugInfo('âœ¨ æ¤…å­ãƒã‚¤ãƒ©ã‚¤ãƒˆON - æ¤…å­ã®ä½ç½®ãŒåˆ†ã‹ã‚Šã‚„ã™ããªã‚Šã¾ã—ãŸ');
            } else {
                chair.classList.remove('highlight');
                updateDebugInfo('ğŸ”† æ¤…å­ãƒã‚¤ãƒ©ã‚¤ãƒˆOFF');
            }
        }
        
        // ğŸ“± ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ†ã‚¹ãƒˆ
        function testResponsivePositioning() {
            updateDebugInfo('ğŸ“± ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ†ã‚¹ãƒˆé–‹å§‹ - ãƒ–ãƒ©ã‚¦ã‚¶ã‚µã‚¤ã‚ºã‚’å¤‰æ›´ã—ã¦ä½ç½®é–¢ä¿‚ã‚’ç¢ºèªã—ã¦ãã ã•ã„');
            showPositionInfo();
        }
        
        // ğŸª‘ æ¤…å­ä½ç½®ã«ãƒªã‚»ãƒƒãƒˆ
        function resetToChairPosition() {
            const canvas = document.getElementById('purattokun-canvas');
            const chair = document.getElementById('chairElement');
            const currentStyle = chair.dataset.style || 'default';
            
            // æ¤…å­ã‚¹ã‚¿ã‚¤ãƒ«åˆ¥ã®æœ€é©ä½ç½®
            const positions = {
                'default': { left: '50%', top: '55%' },    // ãƒ€ã‚¤ãƒ‹ãƒ³ã‚°
                'modern': { left: '50%', top: '52%' },     // ãƒ¢ãƒ€ãƒ³ï¼ˆå°‘ã—é«˜ã‚ï¼‰
                'vintage': { left: '50%', top: '58%' },    // ãƒ´ã‚£ãƒ³ãƒ†ãƒ¼ã‚¸ï¼ˆä½ã‚ï¼‰
                'bench': { left: '50%', top: '45%' },      // ãƒ™ãƒ³ãƒï¼ˆé«˜ã‚ï¼‰
                'sofa': { left: '50%', top: '62%' }        // ã‚½ãƒ•ã‚¡ï¼ˆæœ€ã‚‚ä½ã‚ï¼‰
            };
            
            const pos = positions[currentStyle] || positions.default;
            canvas.style.left = pos.left;
            canvas.style.top = pos.top;
            canvas.style.transform = 'translate(-50%, -50%)';
            
            updateDebugInfo(`ğŸª‘ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’${currentStyle}æ¤…å­ã®æœ€é©ä½ç½®ã«ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ`);
        }
        
        // ğŸ¨ æ¤…å­ã‚¹ã‚¿ã‚¤ãƒ«å¤‰æ›´
        function changeChairStyle(style) {
            const chair = document.getElementById('chairElement');
            const buttons = document.querySelectorAll('.style-btn');
            
            // æ¤…å­ã®ã‚¯ãƒ©ã‚¹ã‚’æ›´æ–°
            chair.className = 'chair';
            if (style !== 'default') {
                chair.classList.add(`style-${style}`);
            }
            chair.dataset.style = style;
            
            // ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹æ›´æ–°
            buttons.forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-style="${style}"]`).classList.add('active');
            
            updateDebugInfo(`ğŸ¨ æ¤…å­ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ã€Œ${style}ã€ã«å¤‰æ›´ã—ã¾ã—ãŸ`);
            
            // ç”»åƒèª­ã¿è¾¼ã¿çŠ¶æ³ã‚’ãƒã‚§ãƒƒã‚¯
            setTimeout(checkImageLoad, 500);
        }
        
        // ğŸ–¼ï¸ ç”»åƒèª­ã¿è¾¼ã¿çŠ¶æ³ãƒã‚§ãƒƒã‚¯
        function checkImageLoad() {
            const chair = document.getElementById('chairElement');
            const computedStyle = window.getComputedStyle(chair);
            const backgroundImage = computedStyle.backgroundImage;
            
            if (backgroundImage === 'none' || backgroundImage === '') {
                chair.classList.add('fallback');
                updateDebugInfo('âš ï¸ ç”»åƒèª­ã¿è¾¼ã¿å¤±æ•— - ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è¡¨ç¤ºä¸­');
            } else {
                chair.classList.remove('fallback');
                updateDebugInfo('âœ… æ¤…å­ç”»åƒèª­ã¿è¾¼ã¿æˆåŠŸ');
            }
        }
        
        // ğŸ–¼ï¸ ç”»åƒå“è³ªåˆ†æ
        function analyzeImageQuality() {
            const chair = document.getElementById('chairElement');
            const rect = chair.getBoundingClientRect();
            const style = chair.dataset.style || 'default';
            
            const imageInfo = {
                'default': { name: 'ã‚¨ãƒ¬ã‚¬ãƒ³ãƒˆãƒ€ã‚¤ãƒ‹ãƒ³ã‚°ãƒã‚§ã‚¢', source: 'Pixabay', resolution: '1280x960' },
                'modern': { name: 'ãƒ¢ãƒ€ãƒ³ã‚ªãƒ•ã‚£ã‚¹ãƒã‚§ã‚¢', source: 'Unsplash', resolution: '1000x1333' },
                'vintage': { name: 'ãƒ´ã‚£ãƒ³ãƒ†ãƒ¼ã‚¸ã‚¢ãƒ¼ãƒ ãƒã‚§ã‚¢', source: 'Unsplash', resolution: '1000x1500' },
                'bench': { name: 'ãƒ‘ãƒ¼ã‚¯ãƒ™ãƒ³ãƒ', source: 'Unsplash', resolution: '1000x667' },
                'sofa': { name: 'ã‚¨ãƒ¬ã‚¬ãƒ³ãƒˆã‚½ãƒ•ã‚¡', source: 'Unsplash', resolution: '1000x667' }
            };
            
            const info = imageInfo[style] || imageInfo.default;
            
            updateDebugInfo(`ğŸ–¼ï¸ ç”»åƒå“è³ªåˆ†æ:`);
            updateDebugInfo(`  æ¤…å­: ${info.name}`);
            updateDebugInfo(`  å‡ºå…¸: ${info.source} (å•†ç”¨åˆ©ç”¨å¯)`);
            updateDebugInfo(`  å…ƒè§£åƒåº¦: ${info.resolution}`);
            updateDebugInfo(`  è¡¨ç¤ºã‚µã‚¤ã‚º: ${rect.width.toFixed(0)}x${rect.height.toFixed(0)}px`);
            updateDebugInfo(`  ã‚¹ã‚±ãƒ¼ãƒ«æ¯”: ${(rect.width/parseInt(info.resolution.split('x')[0])*100).toFixed(1)}%`);
        }
        
        // ğŸ—ºï¸ ä½ç½®æƒ…å ±è¡¨ç¤º
        function showPositionInfo() {
            const canvas = document.getElementById('purattokun-canvas');
            const chair = document.getElementById('chairElement');
            const canvasRect = canvas.getBoundingClientRect();
            const chairRect = chair.getBoundingClientRect();
            
            updateDebugInfo(`ğŸ—ºï¸ ä½ç½®æƒ…å ±:`);
            updateDebugInfo(`  ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼: left=${canvas.style.left}, top=${canvas.style.top}`);
            updateDebugInfo(`  æ¤…å­ã¨ã®ç›¸å¯¾ä½ç½®: æ¨ª${(canvasRect.left - chairRect.left).toFixed(1)}px, ç¸¦${(canvasRect.top - chairRect.top).toFixed(1)}px`);
            updateDebugInfo(`  ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚º: ${window.innerWidth} x ${window.innerHeight}`);
        }
        
        // ğŸ§¹ ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆãƒãƒ‹ãƒ¥ã‚¢ãƒ«æº–æ‹ ï¼‰
        function cleanupBoundingBox() {
            if (!boundingBox) {
                updateDebugInfo('âš ï¸ ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                return;
            }
            
            try {
                // âœ… ãƒãƒ‹ãƒ¥ã‚¢ãƒ«æº–æ‹ ã® cleanup() ãƒ¡ã‚½ãƒƒãƒ‰ä½¿ç”¨
                boundingBox.cleanup();
                isEditingBB = false;
                
                // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è§£é™¤
                document.getElementById('sceneContainer').classList.remove('bb-edit-active');
                updateDebugInfo('ğŸ§¹ ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ã¾ã—ãŸ');
            } catch (error) {
                console.error('ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚¨ãƒ©ãƒ¼:', error);
                updateDebugInfo(`âŒ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }
        
        // ğŸ“ ç¸¦æ¨ªæ¯”æ¤œè¨¼ï¼ˆã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”å›ºå®šç¢ºèªï¼‰
        function checkAspectRatio() {
            const canvas = document.getElementById('purattokun-canvas');
            const rect = canvas.getBoundingClientRect();
            const computedStyle = window.getComputedStyle(canvas);
            
            // å®Ÿéš›ã®ã‚µã‚¤ã‚º
            const actualWidth = rect.width;
            const actualHeight = rect.height;
            const aspectRatio = (actualWidth / actualHeight).toFixed(3);
            
            // CSSè¨­å®šç¢ºèª
            const cssAspectRatio = computedStyle.aspectRatio;
            const cssWidth = computedStyle.width;
            const cssHeight = computedStyle.height;
            
            updateDebugInfo(`ğŸ“ ç¸¦æ¨ªæ¯”æ¤œè¨¼çµæœ:`);
            updateDebugInfo(`  CSSè¨­å®š: aspect-ratio=${cssAspectRatio}`);
            updateDebugInfo(`  CSS ã‚µã‚¤ã‚º: ${cssWidth} x ${cssHeight}`);
            updateDebugInfo(`  å®Ÿéš›ã®ã‚µã‚¤ã‚º: ${actualWidth.toFixed(1)} x ${actualHeight.toFixed(1)}px`);
            updateDebugInfo(`  å®Ÿéš›ã®æ¯”ç‡: ${aspectRatio} (1.000 = æ­£æ–¹å½¢)`);
            
            if (Math.abs(parseFloat(aspectRatio) - 1.0) < 0.01) {
                updateDebugInfo(`âœ… ç¸¦æ¨ªæ¯”å›ºå®š: æ­£å¸¸ï¼ˆå®Œç’§ãª1:1æ­£æ–¹å½¢ï¼‰`);
            } else if (Math.abs(parseFloat(aspectRatio) - 1.0) < 0.1) {
                updateDebugInfo(`âš ï¸ ç¸¦æ¨ªæ¯”å›ºå®š: ã»ã¼æ­£å¸¸ï¼ˆã‚ãšã‹ãªèª¤å·®: ${aspectRatio}ï¼‰`);
            } else {
                updateDebugInfo(`âŒ ç¸¦æ¨ªæ¯”å›ºå®š: ç•°å¸¸ï¼ˆæ­ªã¿ãŒç™ºç”Ÿ: ${aspectRatio}ï¼‰`);
                updateDebugInfo(`   â†’ ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ç·¨é›†ã§ä¿®æ­£ã—ã¦ãã ã•ã„`);
            }
        }

        // ğŸ” ç·¨é›†å‰å¾Œã®CSSçŠ¶æ…‹è¨ºæ–­æ©Ÿèƒ½
        let beforeEditingState = null;
        let afterEditingState = null;

        function diagnoseEditingTransformIssue() {
            const canvas = document.getElementById("purattokun-canvas");
            
            updateDebugInfo("ğŸ” ç·¨é›†å‰å¾ŒCSSçŠ¶æ…‹è¨ºæ–­é–‹å§‹...");
            updateDebugInfo("   1. ã¾ãš[ğŸ“ ç¸¦æ¨ªæ¯”æ¤œè¨¼]ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦åˆæœŸçŠ¶æ…‹ã‚’ç¢ºèª");
            updateDebugInfo("   2. æ¬¡ã«[ğŸ¯ ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ç·¨é›†é–‹å§‹]ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™");
            updateDebugInfo("   3. å†åº¦ã“ã®è¨ºæ–­ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦çŠ¶æ…‹æ¯”è¼ƒ");
            
            // ç¾åœ¨ã®è©³ç´°ãªCSSçŠ¶æ…‹ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£
            const currentState = captureDetailedCSSState(canvas);
            
            if (!isEditingBB) {
                // ç·¨é›†é–‹å§‹å‰ã®çŠ¶æ…‹ã‚’ä¿å­˜
                beforeEditingState = currentState;
                updateDebugInfo("âœ… ç·¨é›†é–‹å§‹å‰ã®çŠ¶æ…‹ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ã¾ã—ãŸ");
                showCSSState("ç·¨é›†å‰", currentState);
            } else {
                // ç·¨é›†ä¸­ã®çŠ¶æ…‹ã‚’ä¿å­˜ã—ã¦æ¯”è¼ƒ
                afterEditingState = currentState;
                updateDebugInfo("âœ… ç·¨é›†ä¸­ã®çŠ¶æ…‹ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ã¾ã—ãŸ");
                showCSSState("ç·¨é›†ä¸­", currentState);
                
                if (beforeEditingState) {
                    updateDebugInfo("ğŸ” ==================== è©³ç´°æ¯”è¼ƒåˆ†æ ====================");
                    compareCSSStates(beforeEditingState, afterEditingState);
                    analyzePotentialIssues(beforeEditingState, afterEditingState);
                }
            }
        }
        
        function captureDetailedCSSState(element) {
            const computed = getComputedStyle(element);
            const inline = element.style;
            const rect = element.getBoundingClientRect();
            
            return {
                timestamp: new Date().toISOString(),
                // ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«
                inline: {
                    left: inline.left || "unset",
                    top: inline.top || "unset",
                    width: inline.width || "unset",
                    height: inline.height || "unset",
                    transform: inline.transform || "unset",
                    aspectRatio: inline.aspectRatio || "unset"
                },
                // è¨ˆç®—æ¸ˆã¿ã‚¹ã‚¿ã‚¤ãƒ«
                computed: {
                    left: computed.left,
                    top: computed.top,
                    width: computed.width,
                    height: computed.height,
                    transform: computed.transform,
                    aspectRatio: computed.aspectRatio,
                    position: computed.position,
                    display: computed.display
                },
                // å®Ÿéš›ã®æç”»çŠ¶æ…‹
                rect: {
                    width: rect.width,
                    height: rect.height,
                    left: rect.left,
                    top: rect.top,
                    aspectRatio: (rect.width / rect.height).toFixed(4)
                }
            };
        }
        
        function showCSSState(phase, state) {
            updateDebugInfo(`ğŸ“Š ${phase}ã®è©³ç´°çŠ¶æ…‹:`);
            updateDebugInfo(`  ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³CSS: transform="${state.inline.transform}"`);
            updateDebugInfo(`  è¨ˆç®—æ¸ˆã¿CSS: transform="${state.computed.transform}"`);
            updateDebugInfo(`  aspect-ratio: inline="${state.inline.aspectRatio}" computed="${state.computed.aspectRatio}"`);
            updateDebugInfo(`  å®Ÿéš›ã®ã‚µã‚¤ã‚º: ${state.rect.width.toFixed(1)}Ã—${state.rect.height.toFixed(1)}px`);
            updateDebugInfo(`  å®Ÿéš›ã®ç¸¦æ¨ªæ¯”: ${state.rect.aspectRatio}`);
        }
        
        function compareCSSStates(before, after) {
            updateDebugInfo("ğŸ” å¤‰æ›´ç‚¹åˆ†æ:");
            
            // transformã®å¤‰åŒ–
            if (before.inline.transform !== after.inline.transform) {
                updateDebugInfo(`  ğŸ”„ transformå¤‰åŒ–: "${before.inline.transform}" â†’ "${after.inline.transform}"`);
            }
            if (before.computed.transform !== after.computed.transform) {
                updateDebugInfo(`  ğŸ”„ è¨ˆç®—æ¸ˆã¿transformå¤‰åŒ–: "${before.computed.transform}" â†’ "${after.computed.transform}"`);
            }
            
            // aspect-ratioã®å¤‰åŒ–
            if (before.computed.aspectRatio !== after.computed.aspectRatio) {
                updateDebugInfo(`  ğŸ“ aspect-ratioå¤‰åŒ–: "${before.computed.aspectRatio}" â†’ "${after.computed.aspectRatio}"`);
            }
            
            // å®Ÿéš›ã®ç¸¦æ¨ªæ¯”ã®å¤‰åŒ–
            const aspectRatioDiff = Math.abs(parseFloat(before.rect.aspectRatio) - parseFloat(after.rect.aspectRatio));
            if (aspectRatioDiff > 0.001) {
                updateDebugInfo(`  âŒ å®Ÿéš›ã®ç¸¦æ¨ªæ¯”å¤‰åŒ–: ${before.rect.aspectRatio} â†’ ${after.rect.aspectRatio} (å·®: ${aspectRatioDiff.toFixed(4)})`);
            } else {
                updateDebugInfo(`  âœ… å®Ÿéš›ã®ç¸¦æ¨ªæ¯”ç¶­æŒ: ${before.rect.aspectRatio}`);
            }
        }
        
        function analyzePotentialIssues(before, after) {
            updateDebugInfo("ğŸ” å•é¡Œåˆ†æ:");
            
            // transform: noneã®å•é¡Œ
            if (after.inline.transform === "none" && before.inline.transform !== "none") {
                updateDebugInfo(`  âš ï¸ æ½œåœ¨çš„å•é¡Œ: transformç„¡åŠ¹åŒ–ã«ã‚ˆã‚Š aspect-ratio ãŒå½±éŸ¿ã‚’å—ã‘ã‚‹å¯èƒ½æ€§`);
                updateDebugInfo(`     - ç·¨é›†å‰: "${before.inline.transform}"`);
                updateDebugInfo(`     - ç·¨é›†ä¸­: "${after.inline.transform}"`);
                updateDebugInfo(`     â†’ ã“ã‚ŒãŒæ­ªã¿ã®æ ¹æœ¬åŸå› ã®å¯èƒ½æ€§ãŒé«˜ã„`);
            }
            
            // aspect-ratioã®ç„¡åŠ¹åŒ–
            if (before.computed.aspectRatio !== "auto" && after.computed.aspectRatio === "auto") {
                updateDebugInfo(`  ğŸš¨ critical: aspect-ratio ãŒç„¡åŠ¹åŒ–ã•ã‚Œã¾ã—ãŸ`);
                updateDebugInfo(`     - ç·¨é›†å‰: "${before.computed.aspectRatio}"`);
                updateDebugInfo(`     - ç·¨é›†ä¸­: "${after.computed.aspectRatio}"`);
                updateDebugInfo(`     â†’ ã“ã‚Œã«ã‚ˆã‚Šç¸¦æ¨ªæ¯”ãŒå›ºå®šã•ã‚Œãªããªã‚Šã¾ã—ãŸ`);
            }
            
            // å®Ÿéš›ã®æ­ªã¿æ¤œå‡º
            const aspectRatioDiff = Math.abs(parseFloat(before.rect.aspectRatio) - parseFloat(after.rect.aspectRatio));
            if (aspectRatioDiff > 0.01) {
                updateDebugInfo(`  ğŸš¨ æ­ªã¿æ¤œå‡º: å®Ÿéš›ã®ç¸¦æ¨ªæ¯”ãŒ${aspectRatioDiff.toFixed(4)}å¤‰åŒ–`);
                updateDebugInfo(`     â†’ ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºæ™‚ã«æ­ªã¿ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§`);
            }
            
            // è§£æ±ºç­–ã®æç¤º
            if (after.inline.transform === "none") {
                updateDebugInfo("ğŸ”§ æ¨å¥¨è§£æ±ºç­–:");
                updateDebugInfo("   1. enterEditingMode() ã§ transform = none ã«ã™ã‚‹ä»£ã‚ã‚Šã«");
                updateDebugInfo("   2. transform-origin ã‚’èª¿æ•´ã—ã¦ aspect-ratio ã‚’ç¶­æŒ");
                updateDebugInfo("   3. ã¾ãŸã¯ aspect-ratio ã‚’æ˜ç¤ºçš„ã«ä¿æŒã™ã‚‹ä»•çµ„ã¿ã®å®Ÿè£…");
            }
        }
        
        // ğŸ”„ ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        window.addEventListener('resize', updateBreakpointDisplay);
        window.addEventListener('resize', () => {
            updateDebugInfo('ğŸ”„ ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºæ¤œçŸ¥ - ä½ç½®é–¢ä¿‚ã‚’ç¢ºèªä¸­...');
            setTimeout(showPositionInfo, 100); // ãƒªã‚µã‚¤ã‚ºå¾Œã«æƒ…å ±æ›´æ–°
        });
        
        // ğŸš€ ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å¾Œã®åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            updateBreakpointDisplay();
            initializeChairTest();
            
            // ç”»åƒèª­ã¿è¾¼ã¿çŠ¶æ³ã‚’ç›£è¦–
            setTimeout(checkImageLoad, 1000);
        });
        
        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
        document.addEventListener('keydown', (e) => {
            if (e.key === 'e' || e.key === 'E') {
                startBoundingBoxEdit();
            } else if (e.key === 's' || e.key === 'S') {
                saveBoundingBoxPosition();
            } else if (e.key === 'Escape') {
                cancelBoundingBoxEdit();
            } else if (e.key === 'h' || e.key === 'H') {
                toggleChairHighlight();
            } else if (e.key === 'r' || e.key === 'R') {
                resetToChairPosition();
            } else if (e.key === 'c' || e.key === 'C') {
                cleanupBoundingBox();
            } else if (e.key === 'a' || e.key === 'A') {
                checkAspectRatio();
            }
        });
    </script>
</body>
</html>