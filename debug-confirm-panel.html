<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¢ºèªãƒ‘ãƒãƒ«ä½ç½®å•é¡Œãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            margin: 0;
            background: #f0f0f0;
        }
        
        .debug-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 400px;
            background: white;
            border: 2px solid #333;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 10000;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .debug-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
        }
        
        .debug-section {
            margin-bottom: 20px;
            padding: 10px;
            background: #f8f8f8;
            border-radius: 5px;
        }
        
        .debug-label {
            font-weight: bold;
            color: #666;
            margin-bottom: 5px;
        }
        
        .debug-value {
            font-family: monospace;
            background: #fff;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
            margin-bottom: 10px;
            word-break: break-all;
        }
        
        .debug-button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            color: white;
        }
        
        .btn-analyze { background: #2196f3; }
        .btn-fix { background: #4caf50; }
        .btn-reset { background: #ff9800; }
        .btn-test { background: #9c27b0; }
        
        .status-ok { color: #4caf50; }
        .status-warning { color: #ff9800; }
        .status-error { color: #f44336; }
        
        .test-panel {
            position: fixed;
            width: 200px;
            height: 150px;
            background: white;
            border: 2px solid #333;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        
        .test-panel-header {
            background: #f0f0f0;
            padding: 10px;
            margin: -20px -20px 10px -20px;
            border-radius: 8px 8px 0 0;
            cursor: move;
            text-align: center;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>ğŸ” ç¢ºèªãƒ‘ãƒãƒ«ä½ç½®å•é¡Œãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«</h1>
    <p>ã“ã®ãƒ„ãƒ¼ãƒ«ã§ç¢ºèªãƒ‘ãƒãƒ«ã®ä½ç½®å•é¡Œã‚’å¾¹åº•èª¿æŸ»ã—ã¾ã™ã€‚</p>
    
    <!-- ãƒ†ã‚¹ãƒˆç”¨ç¢ºèªãƒ‘ãƒãƒ« -->
    <div id="test-confirm-panel" class="test-panel" style="display: none;">
        <div class="test-panel-header">ãƒ†ã‚¹ãƒˆç¢ºèªãƒ‘ãƒãƒ«</div>
        <p>ç·¨é›†ã‚’ç¢ºå®šã—ã¾ã™ã‹ï¼Ÿ</p>
        <button style="margin: 5px;">ä¿å­˜</button>
        <button style="margin: 5px;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
    </div>
    
    <!-- ãƒ‡ãƒãƒƒã‚°ãƒ‘ãƒãƒ« -->
    <div class="debug-panel">
        <div class="debug-title">ğŸ› ï¸ ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«</div>
        
        <div class="debug-section">
            <button class="debug-button btn-analyze" onclick="analyzePanel()">ğŸ” ãƒ‘ãƒãƒ«åˆ†æå®Ÿè¡Œ</button>
            <button class="debug-button btn-test" onclick="createTestPanel()">ğŸ“¦ ãƒ†ã‚¹ãƒˆãƒ‘ãƒãƒ«ä½œæˆ</button>
            <button class="debug-button btn-fix" onclick="applyFix()">ğŸ”§ ä¿®æ­£é©ç”¨</button>
            <button class="debug-button btn-reset" onclick="resetAll()">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
        </div>
        
        <div id="debug-output"></div>
    </div>
    
    <script>
        let debugOutput = document.getElementById('debug-output');
        let testPanel = null;
        
        function log(title, data, status = 'normal') {
            const section = document.createElement('div');
            section.className = 'debug-section';
            
            const label = document.createElement('div');
            label.className = 'debug-label';
            label.innerHTML = title;
            
            const value = document.createElement('div');
            value.className = 'debug-value';
            
            if (typeof data === 'object') {
                value.innerHTML = JSON.stringify(data, null, 2);
            } else {
                value.innerHTML = data;
            }
            
            if (status === 'ok') {
                label.classList.add('status-ok');
            } else if (status === 'warning') {
                label.classList.add('status-warning');
            } else if (status === 'error') {
                label.classList.add('status-error');
            }
            
            section.appendChild(label);
            section.appendChild(value);
            debugOutput.appendChild(section);
        }
        
        function clearLog() {
            debugOutput.innerHTML = '';
        }
        
        function analyzePanel() {
            clearLog();
            
            // å®Ÿéš›ã®ç¢ºèªãƒ‘ãƒãƒ«ã‚’æ¢ã™
            const panel = document.getElementById('edit-confirm-panel') || 
                         document.querySelector('.confirm-panel') ||
                         document.getElementById('test-confirm-panel');
            
            if (!panel) {
                log('ğŸš¨ ãƒ‘ãƒãƒ«æ¤œå‡º', 'ãƒ‘ãƒãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
                return;
            }
            
            log('âœ… ãƒ‘ãƒãƒ«æ¤œå‡º', `ID: ${panel.id}, Class: ${panel.className}`, 'ok');
            
            // ã‚¹ã‚¿ã‚¤ãƒ«æƒ…å ±ã‚’è©³ç´°ã«å–å¾—
            const computedStyle = window.getComputedStyle(panel);
            const rect = panel.getBoundingClientRect();
            
            // ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«
            log('ğŸ“ ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«', {
                position: panel.style.position || '(æœªè¨­å®š)',
                top: panel.style.top || '(æœªè¨­å®š)',
                bottom: panel.style.bottom || '(æœªè¨­å®š)',
                left: panel.style.left || '(æœªè¨­å®š)',
                right: panel.style.right || '(æœªè¨­å®š)',
                transform: panel.style.transform || '(æœªè¨­å®š)'
            });
            
            // è¨ˆç®—ã•ã‚ŒãŸã‚¹ã‚¿ã‚¤ãƒ«
            log('ğŸ¨ è¨ˆç®—æ¸ˆã¿ã‚¹ã‚¿ã‚¤ãƒ«', {
                position: computedStyle.position,
                top: computedStyle.top,
                bottom: computedStyle.bottom,
                left: computedStyle.left,
                right: computedStyle.right,
                transform: computedStyle.transform
            });
            
            // å®Ÿéš›ã®ä½ç½®
            log('ğŸ“ å®Ÿéš›ã®ä½ç½® (getBoundingClientRect)', {
                top: rect.top,
                bottom: rect.bottom,
                left: rect.left,
                right: rect.right,
                width: rect.width,
                height: rect.height
            });
            
            // å•é¡Œè¨ºæ–­
            const problems = [];
            
            if (computedStyle.bottom !== 'auto' && computedStyle.bottom !== '') {
                problems.push(`bottomå€¤ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™: ${computedStyle.bottom}`);
            }
            
            if (rect.bottom > window.innerHeight - 100) {
                problems.push(`ãƒ‘ãƒãƒ«ãŒç”»é¢ä¸‹éƒ¨ã«å¯„ã£ã¦ã„ã¾ã™ (bottom: ${rect.bottom}, ç”»é¢é«˜ã•: ${window.innerHeight})`);
            }
            
            if (computedStyle.position !== 'fixed' && computedStyle.position !== 'absolute') {
                problems.push(`positionå€¤ãŒé©åˆ‡ã§ãªã„å¯èƒ½æ€§: ${computedStyle.position}`);
            }
            
            if (problems.length > 0) {
                log('âš ï¸ æ¤œå‡ºã•ã‚ŒãŸå•é¡Œ', problems.join('\n'), 'warning');
            } else {
                log('âœ… å•é¡Œãªã—', 'ãƒ‘ãƒãƒ«ã®ä½ç½®è¨­å®šã¯æ­£å¸¸ã§ã™', 'ok');
            }
            
            // CSSãƒ«ãƒ¼ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯
            checkCSSRules(panel);
        }
        
        function checkCSSRules(element) {
            const sheets = document.styleSheets;
            const matchingRules = [];
            
            try {
                for (let sheet of sheets) {
                    try {
                        const rules = sheet.cssRules || sheet.rules;
                        for (let rule of rules) {
                            if (rule.selectorText && element.matches(rule.selectorText)) {
                                matchingRules.push({
                                    selector: rule.selectorText,
                                    styles: rule.style.cssText
                                });
                            }
                        }
                    } catch (e) {
                        // ã‚¯ãƒ­ã‚¹ã‚ªãƒªã‚¸ãƒ³ã®å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
                    }
                }
            } catch (e) {
                log('âš ï¸ CSSè§£æã‚¨ãƒ©ãƒ¼', e.message, 'warning');
            }
            
            if (matchingRules.length > 0) {
                log('ğŸ¨ é©ç”¨ã•ã‚Œã¦ã„ã‚‹CSSãƒ«ãƒ¼ãƒ«', matchingRules);
            }
        }
        
        function createTestPanel() {
            testPanel = document.getElementById('test-confirm-panel');
            testPanel.style.display = 'block';
            
            // åˆæœŸä½ç½®ã‚’ç”»é¢ä¸­å¤®ã«è¨­å®š
            const centerX = (window.innerWidth - 240) / 2; // ãƒ‘ãƒãƒ«å¹…è€ƒæ…®
            const centerY = (window.innerHeight - 200) / 2; // ãƒ‘ãƒãƒ«é«˜ã•è€ƒæ…®
            
            testPanel.style.position = 'fixed';
            testPanel.style.left = centerX + 'px';
            testPanel.style.top = centerY + 'px';
            testPanel.style.bottom = ''; // bottomã‚’æ˜ç¤ºçš„ã«ã‚¯ãƒªã‚¢
            testPanel.style.right = ''; // rightã‚’æ˜ç¤ºçš„ã«ã‚¯ãƒªã‚¢
            testPanel.style.transform = 'none';
            
            log('ğŸ“¦ ãƒ†ã‚¹ãƒˆãƒ‘ãƒãƒ«ä½œæˆ', {
                åˆæœŸä½ç½®: { x: centerX, y: centerY }
            }, 'ok');
            
            // ãƒ‰ãƒ©ãƒƒã‚°æ©Ÿèƒ½ã‚’è¿½åŠ 
            setupDragging(testPanel);
            
            // ä½œæˆå¾Œã™ãã«åˆ†æ
            setTimeout(() => analyzePanel(), 100);
        }
        
        function setupDragging(panel) {
            const header = panel.querySelector('.test-panel-header');
            let isDragging = false;
            let offset = { x: 0, y: 0 };
            
            header.addEventListener('mousedown', (e) => {
                isDragging = true;
                const rect = panel.getBoundingClientRect();
                offset.x = e.clientX - rect.left;
                offset.y = e.clientY - rect.top;
                e.preventDefault();
            });
            
            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                
                const newX = e.clientX - offset.x;
                const newY = e.clientY - offset.y;
                
                panel.style.left = newX + 'px';
                panel.style.top = newY + 'px';
                panel.style.bottom = ''; // ç§»å‹•æ™‚ã‚‚ bottom ã‚’ã‚¯ãƒªã‚¢
                panel.style.right = ''; // ç§»å‹•æ™‚ã‚‚ right ã‚’ã‚¯ãƒªã‚¢
            });
            
            document.addEventListener('mouseup', () => {
                if (isDragging) {
                    isDragging = false;
                    analyzePanel(); // ãƒ‰ãƒ©ãƒƒã‚°çµ‚äº†æ™‚ã«å†åˆ†æ
                }
            });
        }
        
        function applyFix() {
            clearLog();
            
            const panel = document.getElementById('edit-confirm-panel') || 
                         document.querySelector('.confirm-panel') ||
                         document.getElementById('test-confirm-panel');
            
            if (!panel) {
                log('ğŸš¨ ã‚¨ãƒ©ãƒ¼', 'ãƒ‘ãƒãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
                return;
            }
            
            // å¼·åˆ¶çš„ã«ä¿®æ­£ã‚’é©ç”¨
            const centerX = (window.innerWidth - panel.offsetWidth) / 2;
            const centerY = (window.innerHeight - panel.offsetHeight) / 2;
            
            // ã™ã¹ã¦ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ä¸€åº¦ã«ãƒªã‚»ãƒƒãƒˆ
            panel.style.cssText = `
                position: fixed !important;
                left: ${centerX}px !important;
                top: ${centerY}px !important;
                bottom: unset !important;
                right: unset !important;
                transform: none !important;
                margin: 0 !important;
            `;
            
            log('âœ… ä¿®æ­£é©ç”¨å®Œäº†', {
                æ–°ã—ã„ä½ç½®: { x: centerX, y: centerY },
                é©ç”¨ã—ãŸã‚¹ã‚¿ã‚¤ãƒ«: panel.style.cssText
            }, 'ok');
            
            // ä¿®æ­£å¾Œã®çŠ¶æ…‹ã‚’ç¢ºèª
            setTimeout(() => analyzePanel(), 100);
        }
        
        function resetAll() {
            clearLog();
            if (testPanel) {
                testPanel.style.display = 'none';
            }
            log('ğŸ”„ ãƒªã‚»ãƒƒãƒˆå®Œäº†', 'åˆæœŸçŠ¶æ…‹ã«æˆ»ã—ã¾ã—ãŸ', 'ok');
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•åˆ†æ
        window.addEventListener('load', () => {
            setTimeout(() => {
                log('ğŸš€ ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«èµ·å‹•', 'æº–å‚™å®Œäº†', 'ok');
                analyzePanel();
            }, 500);
        });
    </script>
</body>
</html>