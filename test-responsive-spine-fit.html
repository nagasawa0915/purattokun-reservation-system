<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èƒŒæ™¯ç”»åƒå®Œå…¨ãƒ•ã‚£ãƒƒãƒˆãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ†ã‚¹ãƒˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f0f0;
            overflow-x: hidden;
        }

        /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ */
        .responsive-container {
            position: relative;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        /* èƒŒæ™¯ç”»åƒã‚¨ãƒªã‚¢ */
        .background-area {
            position: absolute;
            top: 10%;
            left: 10%;
            width: 80%;
            height: 70%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 600"><rect width="800" height="600" fill="%23e8f4f8"/><rect x="100" y="200" width="600" height="200" fill="%23d1ecf1" stroke="%234a90a4" stroke-width="3" rx="20"/><circle cx="200" cy="300" r="80" fill="%23b8e6b8" stroke="%23228b22" stroke-width="4"/><circle cx="600" cy="300" r="60" fill="%23ffb6c1" stroke="%23ff69b4" stroke-width="3"/><text x="400" y="330" font-family="Arial" font-size="24" fill="%23333" text-anchor="middle">èƒŒæ™¯ç”»åƒã‚µãƒ³ãƒ—ãƒ«</text></svg>') center/contain no-repeat;
            border: 2px solid #333;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        /* Spineã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é…ç½®ã‚¨ãƒªã‚¢ */
        .spine-container {
            position: absolute;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, #ff6b6b, #ee5a6f);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
            transition: all 0.3s ease;
            cursor: pointer;
            transform-origin: center center;
            /* CSSå¤‰æ•°ã§ã‚µã‚¤ã‚ºãƒ»ä½ç½®åˆ¶å¾¡ */
            transform: translate(var(--spine-x, 0), var(--spine-y, 0)) scale(var(--spine-scale, 1));
        }

        .spine-container:hover {
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.6);
            transform: translate(var(--spine-x, 0), var(--spine-y, 0)) scale(calc(var(--spine-scale, 1) * 1.1));
        }

        /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« */
        .control-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            width: 280px;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .control-group input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }

        .control-group .value-display {
            font-size: 12px;
            color: #666;
            text-align: right;
        }

        .control-button {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .control-button:hover {
            background: #ee5a6f;
        }

        .status-display {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            margin-top: 15px;
        }

        /* ãƒ‡ãƒãƒƒã‚°æƒ…å ±è¡¨ç¤º */
        .debug-overlay {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            max-width: 400px;
            z-index: 1000;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–èª¿æ•´ */
        @media (max-width: 768px) {
            .control-panel {
                position: relative;
                top: 10px;
                right: 10px;
                width: calc(100% - 20px);
                margin-bottom: 20px;
            }

            .background-area {
                top: 180px;
                left: 5%;
                width: 90%;
                height: 60vh;
            }

            .debug-overlay {
                position: relative;
                bottom: auto;
                left: auto;
                margin: 10px;
                width: calc(100% - 20px);
            }
        }

        /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾© */
        @keyframes pulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        .responsive-container.active {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <div class="responsive-container" id="responsiveContainer">
        <!-- èƒŒæ™¯ç”»åƒã‚¨ãƒªã‚¢ -->
        <div class="background-area" id="backgroundArea"></div>
        
        <!-- Spineã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ -->
        <div class="spine-container" id="spineContainer">
            <div>ã·ã‚‰ã£ã¨<br>ãã‚“</div>
        </div>
    </div>

    <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« -->
    <div class="control-panel">
        <h3>ğŸ¯ ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ•ã‚£ãƒƒãƒˆåˆ¶å¾¡</h3>
        
        <div class="control-group">
            <label>èƒŒæ™¯é ˜åŸŸé¸æŠ</label>
            <select id="regionSelect">
                <option value="shop-front">ãŠåº—å‰ã‚¨ãƒªã‚¢</option>
                <option value="road-area">é“è·¯ã‚¨ãƒªã‚¢</option>
                <option value="center-area">ä¸­å¤®ã‚¨ãƒªã‚¢</option>
            </select>
        </div>
        
        <div class="control-group">
            <label>ãƒ•ã‚£ãƒƒãƒˆæ¯”ç‡: <span id="ratioValue">1.0</span></label>
            <input type="range" id="ratioSlider" min="0.5" max="2.0" step="0.1" value="1.0">
        </div>
        
        <div class="control-group">
            <label>ãƒ•ã‚£ãƒƒãƒˆãƒ¢ãƒ¼ãƒ‰</label>
            <select id="fitModeSelect">
                <option value="contain">å®Œå…¨åã¾ã‚Š</option>
                <option value="cover">ã‚¨ãƒªã‚¢å…¨ä½“</option>
                <option value="exact">æ­£ç¢ºã‚µã‚¤ã‚º</option>
            </select>
        </div>
        
        <button class="control-button" id="toggleSystem">ã‚·ã‚¹ãƒ†ãƒ  ON/OFF</button>
        <button class="control-button" id="resetPosition">ä½ç½®ãƒªã‚»ãƒƒãƒˆ</button>
        <button class="control-button" id="testResize">ãƒªã‚µã‚¤ã‚ºãƒ†ã‚¹ãƒˆ</button>
        
        <div class="status-display" id="statusDisplay">
            ã‚·ã‚¹ãƒ†ãƒ å¾…æ©Ÿä¸­...
        </div>
    </div>

    <!-- ãƒ‡ãƒãƒƒã‚°æƒ…å ± -->
    <div class="debug-overlay" id="debugOverlay">
        <div><strong>ğŸ” ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æƒ…å ±</strong></div>
        <div>èƒŒæ™¯ã‚µã‚¤ã‚º: <span id="bgSize">æœªå–å¾—</span></div>
        <div>é ˜åŸŸã‚µã‚¤ã‚º: <span id="regionSize">æœªå–å¾—</span></div>
        <div>ã‚­ãƒ£ãƒ©ä½ç½®: <span id="spinePos">æœªå–å¾—</span></div>
        <div>ç¸®å°ºæ¯”ç‡: <span id="scaleInfo">æœªå–å¾—</span></div>
        <div>ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦: <span id="windowSize">æœªå–å¾—</span></div>
    </div>

    <script>
        // ğŸ¯ èƒŒæ™¯ç”»åƒå®Œå…¨ãƒ•ã‚£ãƒƒãƒˆãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…
        class ResponsiveSpineFitSystem {
            constructor(options = {}) {
                this.backgroundElement = options.backgroundElement;
                this.spineContainer = options.spineContainer;
                this.debugOverlay = options.debugOverlay;
                
                // èƒŒæ™¯é ˜åŸŸå®šç¾©ï¼ˆ%ãƒ™ãƒ¼ã‚¹ï¼‰
                this.regions = new Map([
                    ['shop-front', { x: 15, y: 35, width: 20, height: 30, fitMode: 'contain' }],
                    ['road-area', { x: 65, y: 35, width: 15, height: 25, fitMode: 'contain' }],
                    ['center-area', { x: 35, y: 25, width: 30, height: 50, fitMode: 'contain' }]
                ]);
                
                this.currentRegion = 'shop-front';
                this.baseRatio = 1.0;
                this.isActive = false;
                this.observers = new Map();
                
                // åŸºæº–ãƒ¡ãƒˆãƒªã‚¯ã‚¹
                this.baseMetrics = {
                    bgWidth: 0,
                    bgHeight: 0,
                    spineWidth: 100,
                    spineHeight: 100
                };
                
                this.init();
            }
            
            init() {
                this.calculateBaseMetrics();
                this.setupEventListeners();
                this.setupBackgroundObserver();
                this.updateDebugInfo();
                this.start();
            }
            
            calculateBaseMetrics() {
                const bgRect = this.backgroundElement.getBoundingClientRect();
                this.baseMetrics.bgWidth = bgRect.width;
                this.baseMetrics.bgHeight = bgRect.height;
                
                const spineRect = this.spineContainer.getBoundingClientRect();
                this.baseMetrics.spineWidth = spineRect.width;
                this.baseMetrics.spineHeight = spineRect.height;
            }
            
            setupBackgroundObserver() {
                const observer = new ResizeObserver((entries) => {
                    for (const entry of entries) {
                        this.onBackgroundResize(entry);
                    }
                });
                
                observer.observe(this.backgroundElement);
                this.observers.set('background', observer);
                
                // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºã‚‚ç›£è¦–
                window.addEventListener('resize', () => {
                    setTimeout(() => this.updateAll(), 100);
                });
            }
            
            onBackgroundResize(entry) {
                if (!this.isActive) return;
                
                const { width, height } = entry.contentRect;
                console.log(`ğŸ”„ èƒŒæ™¯ãƒªã‚µã‚¤ã‚ºæ¤œå‡º: ${width}x${height}`);
                
                this.adjustSpineToFit(width, height);
                this.updateDebugInfo();
            }
            
            adjustSpineToFit(bgWidth, bgHeight) {
                const region = this.regions.get(this.currentRegion);
                if (!region) return;
                
                // â—¯é ˜åŸŸã®çµ¶å¯¾åº§æ¨™ãƒ»ã‚µã‚¤ã‚ºè¨ˆç®—
                const regionData = {
                    x: bgWidth * (region.x / 100),
                    y: bgHeight * (region.y / 100),
                    width: bgWidth * (region.width / 100),
                    height: bgHeight * (region.height / 100)
                };
                
                // ãƒ•ã‚£ãƒƒãƒˆç¸®å°ºè¨ˆç®—
                const scaleX = regionData.width / this.baseMetrics.spineWidth;
                const scaleY = regionData.height / this.baseMetrics.spineHeight;
                let fitScale = Math.min(scaleX, scaleY) * this.baseRatio;
                
                // ãƒ•ã‚£ãƒƒãƒˆãƒ¢ãƒ¼ãƒ‰é©ç”¨
                const fitMode = region.fitMode || 'contain';
                if (fitMode === 'cover') {
                    fitScale = Math.max(scaleX, scaleY) * this.baseRatio;
                } else if (fitMode === 'exact') {
                    fitScale = this.baseRatio;
                }
                
                // èƒŒæ™¯è¦ç´ ã®ä½ç½®ã‚’è€ƒæ…®ã—ãŸçµ¶å¯¾ä½ç½®è¨ˆç®—
                const bgRect = this.backgroundElement.getBoundingClientRect();
                const absoluteX = bgRect.left + regionData.x + (regionData.width / 2);
                const absoluteY = bgRect.top + regionData.y + (regionData.height / 2);
                
                // CSSå¤‰æ•°ã§ä½ç½®ãƒ»ã‚¹ã‚±ãƒ¼ãƒ«åˆ¶å¾¡
                this.spineContainer.style.setProperty('--spine-x', `${absoluteX - bgRect.left}px`);
                this.spineContainer.style.setProperty('--spine-y', `${absoluteY - bgRect.top}px`);
                this.spineContainer.style.setProperty('--spine-scale', fitScale);
                
                // çµ¶å¯¾ä½ç½®è¨­å®š
                this.spineContainer.style.left = `${absoluteX - (this.baseMetrics.spineWidth * fitScale) / 2}px`;
                this.spineContainer.style.top = `${absoluteY - (this.baseMetrics.spineHeight * fitScale) / 2}px`;
                
                console.log(`âœ… ãƒ•ã‚£ãƒƒãƒˆé©ç”¨ - ä½ç½®:(${Math.round(absoluteX)}, ${Math.round(absoluteY)}), ã‚¹ã‚±ãƒ¼ãƒ«:${fitScale.toFixed(2)}`);
            }
            
            updateAll() {
                const bgRect = this.backgroundElement.getBoundingClientRect();
                this.adjustSpineToFit(bgRect.width, bgRect.height);
                this.updateDebugInfo();
            }
            
            setupEventListeners() {
                // åœ°åŸŸé¸æŠ
                document.getElementById('regionSelect').addEventListener('change', (e) => {
                    this.currentRegion = e.target.value;
                    this.updateAll();
                    this.updateStatus(`åœ°åŸŸå¤‰æ›´: ${e.target.value}`);
                });
                
                // æ¯”ç‡èª¿æ•´
                const ratioSlider = document.getElementById('ratioSlider');
                ratioSlider.addEventListener('input', (e) => {
                    this.baseRatio = parseFloat(e.target.value);
                    document.getElementById('ratioValue').textContent = this.baseRatio;
                    this.updateAll();
                });
                
                // ãƒ•ã‚£ãƒƒãƒˆãƒ¢ãƒ¼ãƒ‰
                document.getElementById('fitModeSelect').addEventListener('change', (e) => {
                    const region = this.regions.get(this.currentRegion);
                    if (region) {
                        region.fitMode = e.target.value;
                        this.updateAll();
                        this.updateStatus(`ãƒ•ã‚£ãƒƒãƒˆãƒ¢ãƒ¼ãƒ‰: ${e.target.value}`);
                    }
                });
                
                // ã‚·ã‚¹ãƒ†ãƒ ãƒˆã‚°ãƒ«
                document.getElementById('toggleSystem').addEventListener('click', () => {
                    this.isActive = !this.isActive;
                    document.getElementById('toggleSystem').textContent = 
                        this.isActive ? 'ã‚·ã‚¹ãƒ†ãƒ  OFF' : 'ã‚·ã‚¹ãƒ†ãƒ  ON';
                    this.updateStatus(this.isActive ? 'ã‚·ã‚¹ãƒ†ãƒ é–‹å§‹' : 'ã‚·ã‚¹ãƒ†ãƒ åœæ­¢');
                    
                    if (this.isActive) {
                        this.updateAll();
                    }
                });
                
                // ä½ç½®ãƒªã‚»ãƒƒãƒˆ
                document.getElementById('resetPosition').addEventListener('click', () => {
                    this.spineContainer.style.removeProperty('--spine-x');
                    this.spineContainer.style.removeProperty('--spine-y');
                    this.spineContainer.style.removeProperty('--spine-scale');
                    this.spineContainer.style.left = '';
                    this.spineContainer.style.top = '';
                    this.updateStatus('ä½ç½®ãƒªã‚»ãƒƒãƒˆå®Œäº†');
                });
                
                // ãƒªã‚µã‚¤ã‚ºãƒ†ã‚¹ãƒˆ
                document.getElementById('testResize').addEventListener('click', () => {
                    this.testResize();
                });
            }
            
            testResize() {
                const container = document.getElementById('responsiveContainer');
                container.classList.add('active');
                
                // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãã§ã‚µã‚¤ã‚ºã‚’å¤‰æ›´
                const originalWidth = this.backgroundElement.style.width || '80%';
                const originalHeight = this.backgroundElement.style.height || '70%';
                
                // å°ã•ãã™ã‚‹
                this.backgroundElement.style.width = '60%';
                this.backgroundElement.style.height = '50%';
                this.updateStatus('ãƒªã‚µã‚¤ã‚ºãƒ†ã‚¹ãƒˆ: ç¸®å°');
                
                setTimeout(() => {
                    // å¤§ããã™ã‚‹
                    this.backgroundElement.style.width = '90%';
                    this.backgroundElement.style.height = '80%';
                    this.updateStatus('ãƒªã‚µã‚¤ã‚ºãƒ†ã‚¹ãƒˆ: æ‹¡å¤§');
                }, 1000);
                
                setTimeout(() => {
                    // å…ƒã«æˆ»ã™
                    this.backgroundElement.style.width = originalWidth;
                    this.backgroundElement.style.height = originalHeight;
                    this.updateStatus('ãƒªã‚µã‚¤ã‚ºãƒ†ã‚¹ãƒˆ: å®Œäº†');
                    container.classList.remove('active');
                }, 2000);
            }
            
            updateDebugInfo() {
                if (!this.debugOverlay) return;
                
                const bgRect = this.backgroundElement.getBoundingClientRect();
                const spineRect = this.spineContainer.getBoundingClientRect();
                const region = this.regions.get(this.currentRegion);
                
                document.getElementById('bgSize').textContent = 
                    `${Math.round(bgRect.width)}Ã—${Math.round(bgRect.height)}`;
                
                if (region) {
                    const regionWidth = bgRect.width * (region.width / 100);
                    const regionHeight = bgRect.height * (region.height / 100);
                    document.getElementById('regionSize').textContent = 
                        `${Math.round(regionWidth)}Ã—${Math.round(regionHeight)}`;
                }
                
                document.getElementById('spinePos').textContent = 
                    `(${Math.round(spineRect.left)}, ${Math.round(spineRect.top)})`;
                
                const currentScale = this.spineContainer.style.getPropertyValue('--spine-scale') || '1';
                document.getElementById('scaleInfo').textContent = 
                    `${parseFloat(currentScale).toFixed(2)}x`;
                
                document.getElementById('windowSize').textContent = 
                    `${window.innerWidth}Ã—${window.innerHeight}`;
            }
            
            updateStatus(message) {
                const statusEl = document.getElementById('statusDisplay');
                statusEl.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
            }
            
            start() {
                this.isActive = true;
                document.getElementById('toggleSystem').textContent = 'ã‚·ã‚¹ãƒ†ãƒ  OFF';
                this.updateAll();
                this.updateStatus('ã‚·ã‚¹ãƒ†ãƒ é–‹å§‹å®Œäº†');
            }
            
            destroy() {
                this.observers.forEach(observer => observer.disconnect());
                this.observers.clear();
                this.updateStatus('ã‚·ã‚¹ãƒ†ãƒ åœæ­¢');
            }
        }

        // ğŸš€ ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ¯ èƒŒæ™¯ç”»åƒå®Œå…¨ãƒ•ã‚£ãƒƒãƒˆãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ä¸­...');
            
            const system = new ResponsiveSpineFitSystem({
                backgroundElement: document.getElementById('backgroundArea'),
                spineContainer: document.getElementById('spineContainer'),
                debugOverlay: document.getElementById('debugOverlay')
            });
            
            // ã‚°ãƒ­ãƒ¼ãƒãƒ«å‚ç…§ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
            window.responsiveSpineFitSystem = system;
            
            console.log('âœ… ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†');
            console.log('ğŸ® F12ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ "responsiveSpineFitSystem" ã‹ã‚‰ã‚·ã‚¹ãƒ†ãƒ åˆ¶å¾¡å¯èƒ½');
            
            // å®šæœŸçš„ãªãƒ‡ãƒãƒƒã‚°æƒ…å ±æ›´æ–°
            setInterval(() => {
                if (system.isActive) {
                    system.updateDebugInfo();
                }
            }, 500);
        });

        // ğŸ”§ ãƒ‡ãƒãƒƒã‚°ç”¨é–¢æ•°
        window.debugResponsiveSystem = () => {
            const system = window.responsiveSpineFitSystem;
            if (!system) {
                console.log('âŒ ã‚·ã‚¹ãƒ†ãƒ ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                return;
            }
            
            console.log('ğŸ¯ ResponsiveSpineFitSystem ãƒ‡ãƒãƒƒã‚°æƒ…å ±:');
            console.log('- ç¾åœ¨ã®åœ°åŸŸ:', system.currentRegion);
            console.log('- ãƒ™ãƒ¼ã‚¹æ¯”ç‡:', system.baseRatio);
            console.log('- ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹:', system.isActive ? 'ON' : 'OFF');
            console.log('- å®šç¾©æ¸ˆã¿åœ°åŸŸ:', Array.from(system.regions.keys()));
            console.log('- åŸºæº–ãƒ¡ãƒˆãƒªã‚¯ã‚¹:', system.baseMetrics);
        };
    </script>
</body>
</html>