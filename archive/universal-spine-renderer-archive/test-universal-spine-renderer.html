<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniversalSpineRenderer çµ±åˆãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            margin: 10px 0;
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .test-area {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .canvas-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        
        #spine-canvas {
            width: 100%;
            height: 500px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .controls {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        .control-group h3 {
            margin: 0 0 10px 0;
            font-size: 1.2em;
            color: #fff;
        }
        
        .btn {
            width: 100%;
            padding: 12px;
            margin: 5px 0;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn.success {
            background: linear-gradient(45deg, #4CAF50, #45a049);
        }
        
        .btn.warning {
            background: linear-gradient(45deg, #ff9800, #e68900);
        }
        
        .btn.danger {
            background: linear-gradient(45deg, #f44336, #da190b);
        }
        
        .status-area {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            backdrop-filter: blur(10px);
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .status-item:last-child {
            border-bottom: none;
        }
        
        .status-value {
            font-weight: bold;
            padding: 4px 12px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.2);
        }
        
        .log-area {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.4;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 5px;
            border-radius: 3px;
        }
        
        .log-info {
            color: #4CAF50;
        }
        
        .log-warning {
            color: #ff9800;
        }
        
        .log-error {
            color: #f44336;
        }
        
        .log-debug {
            color: #9C27B0;
        }
        
        @media (max-width: 768px) {
            .test-area {
                grid-template-columns: 1fr;
            }
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .success-message {
            background: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }
        
        .error-message {
            background: rgba(244, 67, 54, 0.2);
            color: #f44336;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border: 1px solid rgba(244, 67, 54, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ UniversalSpineRenderer</h1>
            <p>PureSpineLoaderçµ±åˆå‹æ±ç”¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« - çµ±åˆãƒ†ã‚¹ãƒˆ</p>
            <p>ä»»æ„ã®Spineãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§åˆ©ç”¨å¯èƒ½ãªå®Œå…¨çµ±åˆãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ </p>
            <div style="background: rgba(255, 0, 0, 0.1); padding: 10px; border-radius: 8px; margin: 10px 0; font-size: 14px;">
                âš ï¸ <strong>é‡è¦</strong>: HTTPã‚µãƒ¼ãƒãƒ¼å¿…é ˆ - <code>python server.py</code> ã¾ãŸã¯ <code>python -m http.server 8000</code> ã§èµ·å‹•ã—ã¦ãã ã•ã„
            </div>
        </div>
        
        <div class="test-area">
            <div class="canvas-container">
                <canvas id="spine-canvas"></canvas>
                
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>èª­ã¿è¾¼ã¿ä¸­...</p>
                </div>
            </div>
            
            <div class="controls">
                <div class="control-group">
                    <h3>ğŸ¬ åŸºæœ¬åˆ¶å¾¡</h3>
                    <button class="btn" onclick="initializeRenderer()">åˆæœŸåŒ–</button>
                    <button class="btn" onclick="startRendering()">ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é–‹å§‹</button>
                    <button class="btn warning" onclick="stopRendering()">ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°åœæ­¢</button>
                    <button class="btn danger" onclick="disposeRenderer()">ãƒªã‚½ãƒ¼ã‚¹è§£æ”¾</button>
                </div>
                
                <div class="control-group">
                    <h3>ğŸ“¦ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼èª­ã¿è¾¼ã¿</h3>
                    <button class="btn success" onclick="loadPurattokun()">ã·ã‚‰ã£ã¨ãã‚“èª­ã¿è¾¼ã¿</button>
                    <button class="btn success" onclick="loadNezumi()">ã­ãšã¿èª­ã¿è¾¼ã¿</button>
                    <button class="btn" onclick="loadAllCharacters()">å…¨ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼èª­ã¿è¾¼ã¿</button>
                </div>
                
                <div class="control-group">
                    <h3>ğŸ­ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åˆ¶å¾¡</h3>
                    <button class="btn" onclick="playAnimation('purattokun', 'taiki')">å¾…æ©Ÿã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³</button>
                    <button class="btn" onclick="playAnimation('purattokun', 'syutugen')">å‡ºç¾ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³</button>
                    <button class="btn" onclick="toggleVisibility('purattokun')">è¡¨ç¤ºåˆ‡æ›¿</button>
                </div>
                
                <div class="control-group">
                    <h3>ğŸ”§ ãƒ†ã‚¹ãƒˆæ©Ÿèƒ½</h3>
                    <button class="btn" onclick="runDiagnostics()">è¨ºæ–­å®Ÿè¡Œ</button>
                    <button class="btn" onclick="stressTest()">ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆ</button>
                    <button class="btn" onclick="clearLogs()">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
                </div>
            </div>
        </div>
        
        <div class="status-area">
            <h3>ğŸ“Š ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</h3>
            <div class="status-item">
                <span>åˆæœŸåŒ–çŠ¶æ…‹</span>
                <span class="status-value" id="status-initialized">æœªåˆæœŸåŒ–</span>
            </div>
            <div class="status-item">
                <span>ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°çŠ¶æ…‹</span>
                <span class="status-value" id="status-rendering">åœæ­¢ä¸­</span>
            </div>
            <div class="status-item">
                <span>èª­ã¿è¾¼ã¿æ¸ˆã¿ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼</span>
                <span class="status-value" id="status-characters">0</span>
            </div>
            <div class="status-item">
                <span>ãƒ•ãƒ¬ãƒ¼ãƒ æ•°</span>
                <span class="status-value" id="status-frames">0</span>
            </div>
            <div class="status-item">
                <span>WebGLå¯¾å¿œ</span>
                <span class="status-value" id="status-webgl">ç¢ºèªä¸­</span>
            </div>
            <div class="status-item">
                <span>ã‚¨ãƒ©ãƒ¼æ•°</span>
                <span class="status-value" id="status-errors">0</span>
            </div>
        </div>
        
        <div class="log-area" id="log-area">
            <div class="log-entry log-info">ğŸš€ UniversalSpineRendererçµ±åˆãƒ†ã‚¹ãƒˆé–‹å§‹</div>
        </div>
    </div>

    <!-- Spine WebGL Runtime -->
    <script src="assets/js/libs/spine-webgl.js"></script>
    
    <!-- UniversalSpineRenderer -->
    <script src="micromodules/spine-renderer/UniversalSpineRenderer.js"></script>
    
    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let renderer = null;
        let statusUpdateInterval = null;
        
        // ãƒ­ã‚°é–¢æ•°
        function addLog(message, type = 'info') {
            const logArea = document.getElementById('log-area');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.textContent = `${new Date().toLocaleTimeString()} - ${message}`;
            logArea.appendChild(logEntry);
            logArea.scrollTop = logArea.scrollHeight;
            
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
        function updateStatus() {
            if (!renderer) return;
            
            const status = renderer.getStatus();
            
            document.getElementById('status-initialized').textContent = 
                status.initialized ? 'âœ… åˆæœŸåŒ–æ¸ˆã¿' : 'âŒ æœªåˆæœŸåŒ–';
            document.getElementById('status-rendering').textContent = 
                status.rendering ? 'ğŸ¬ å‹•ä½œä¸­' : 'â¸ï¸ åœæ­¢ä¸­';
            document.getElementById('status-characters').textContent = status.charactersLoaded;
            document.getElementById('status-frames').textContent = status.frameCount;
            document.getElementById('status-webgl').textContent = 
                status.webglSupported ? 'âœ… å¯¾å¿œ' : 'âŒ éå¯¾å¿œ';
            document.getElementById('status-errors').textContent = status.errors;
        }
        
        // ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼åˆæœŸåŒ–
        async function initializeRenderer() {
            try {
                addLog('ğŸ”§ UniversalSpineRendereråˆæœŸåŒ–é–‹å§‹');
                showLoading(true);
                
                // Spine WebGLãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ç¢ºèªã‚’å…ˆã«å®Ÿè¡Œ
                if (!window.spine) {
                    addLog('âŒ Spine WebGLãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                    addLog('ğŸ” åˆ©ç”¨å¯èƒ½ãªSpineé–¢é€£å¤‰æ•°:', 'debug');
                    const spineVars = Object.keys(window).filter(key => 
                        key.toLowerCase().includes('spine')
                    );
                    addLog(`  - ${spineVars.join(', ') || 'è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“'}`, 'debug');
                    return;
                }
                
                addLog('âœ… Spine WebGLãƒ©ã‚¤ãƒ–ãƒ©ãƒªç¢ºèªæ¸ˆã¿', 'info');
                addLog(`ğŸ“‹ åˆ©ç”¨å¯èƒ½ãªSpineã‚¯ãƒ©ã‚¹æ•°: ${Object.keys(window.spine).length}`, 'debug');
                
                const canvas = document.getElementById('spine-canvas');
                if (!canvas) {
                    addLog('âŒ Canvasè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
                    return;
                }
                
                addLog('ğŸ“± Canvasè¦ç´ ç¢ºèªæ¸ˆã¿', 'debug');
                
                renderer = new UniversalSpineRenderer({
                    canvas: canvas,
                    config: {
                        debugMode: true,
                        errorRecovery: true,
                        autoResize: true
                    }
                });
                
                // ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼è¨­å®š
                renderer.on('initialized', () => {
                    addLog('âœ… åˆæœŸåŒ–å®Œäº†', 'info');
                });
                
                renderer.on('error', (error) => {
                    addLog(`âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                });
                
                renderer.on('characterLoaded', (character) => {
                    addLog(`ğŸ“¦ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼èª­ã¿è¾¼ã¿å®Œäº†: ${character.name}`, 'info');
                });
                
                renderer.on('webglcontextlost', () => {
                    addLog('âš ï¸ WebGL Context Lost', 'warning');
                });
                
                renderer.on('webglcontextrestored', () => {
                    addLog('ğŸ”„ WebGL Context Restored', 'info');
                });
                
                const success = await renderer.initialize();
                
                if (success) {
                    addLog('âœ… UniversalSpineRendereråˆæœŸåŒ–æˆåŠŸ', 'info');
                    
                    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°é–‹å§‹
                    statusUpdateInterval = setInterval(updateStatus, 500);
                } else {
                    addLog('âŒ UniversalSpineRendereråˆæœŸåŒ–å¤±æ•—', 'error');
                }
                
            } catch (error) {
                addLog(`âŒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            } finally {
                showLoading(false);
            }
        }
        
        // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é–‹å§‹
        function startRendering() {
            if (!renderer) {
                addLog('âŒ ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                return;
            }
            
            addLog('ğŸ¬ ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é–‹å§‹');
            renderer.startRenderLoop();
        }
        
        // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°åœæ­¢
        function stopRendering() {
            if (!renderer) {
                addLog('âŒ ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                return;
            }
            
            addLog('â¸ï¸ ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°åœæ­¢');
            renderer.stopRenderLoop();
        }
        
        // ã·ã‚‰ã£ã¨ãã‚“èª­ã¿è¾¼ã¿
        async function loadPurattokun() {
            if (!renderer) {
                addLog('âŒ ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                return;
            }
            
            try {
                addLog('ğŸ“¦ ã·ã‚‰ã£ã¨ãã‚“èª­ã¿è¾¼ã¿é–‹å§‹');
                showLoading(true);
                
                const character = await renderer.loadCharacter({
                    name: 'purattokun',
                    atlasPath: 'assets/spine/characters/purattokun/purattokun.atlas',
                    jsonPath: 'assets/spine/characters/purattokun/purattokun.json',
                    position: { x: 300, y: 400 },
                    scale: 0.6,
                    defaultAnimation: 'taiki'
                });
                
                addLog('âœ… ã·ã‚‰ã£ã¨ãã‚“èª­ã¿è¾¼ã¿å®Œäº†', 'info');
                
            } catch (error) {
                addLog(`âŒ ã·ã‚‰ã£ã¨ãã‚“èª­ã¿è¾¼ã¿å¤±æ•—: ${error.message}`, 'error');
            } finally {
                showLoading(false);
            }
        }
        
        // ã­ãšã¿èª­ã¿è¾¼ã¿
        async function loadNezumi() {
            if (!renderer) {
                addLog('âŒ ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                return;
            }
            
            try {
                addLog('ğŸ“¦ ã­ãšã¿èª­ã¿è¾¼ã¿é–‹å§‹');
                showLoading(true);
                
                const character = await renderer.loadCharacter({
                    name: 'nezumi',
                    atlasPath: 'assets/spine/characters/nezumi/nezumi.atlas',
                    jsonPath: 'assets/spine/characters/nezumi/nezumi.json',
                    position: { x: 500, y: 350 },
                    scale: 0.8,
                    defaultAnimation: 'idle'
                });
                
                addLog('âœ… ã­ãšã¿èª­ã¿è¾¼ã¿å®Œäº†', 'info');
                
            } catch (error) {
                addLog(`âŒ ã­ãšã¿èª­ã¿è¾¼ã¿å¤±æ•—: ${error.message}`, 'error');
            } finally {
                showLoading(false);
            }
        }
        
        // å…¨ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼èª­ã¿è¾¼ã¿
        async function loadAllCharacters() {
            addLog('ğŸ“¦ å…¨ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼èª­ã¿è¾¼ã¿é–‹å§‹');
            
            await loadPurattokun();
            await new Promise(resolve => setTimeout(resolve, 500));
            await loadNezumi();
            
            addLog('âœ… å…¨ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼èª­ã¿è¾¼ã¿å®Œäº†', 'info');
        }
        
        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å†ç”Ÿ
        function playAnimation(characterName, animationName) {
            if (!renderer) {
                addLog('âŒ ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                return;
            }
            
            const character = renderer.getCharacter(characterName);
            if (!character) {
                addLog(`âŒ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ '${characterName}' ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`, 'error');
                return;
            }
            
            character.setAnimation(animationName);
            addLog(`ğŸ­ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å†ç”Ÿ: ${characterName} - ${animationName}`);
        }
        
        // è¡¨ç¤ºåˆ‡æ›¿
        function toggleVisibility(characterName) {
            if (!renderer) {
                addLog('âŒ ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                return;
            }
            
            const character = renderer.getCharacter(characterName);
            if (!character) {
                addLog(`âŒ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ '${characterName}' ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`, 'error');
                return;
            }
            
            if (character.isVisible) {
                character.hide();
                addLog(`ğŸ‘ï¸ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼éè¡¨ç¤º: ${characterName}`);
            } else {
                character.show();
                addLog(`ğŸ‘ï¸ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¡¨ç¤º: ${characterName}`);
            }
        }
        
        // è¨ºæ–­å®Ÿè¡Œ
        function runDiagnostics() {
            if (!renderer) {
                addLog('âŒ ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                return;
            }
            
            const status = renderer.getStatus();
            addLog('ğŸ” è¨ºæ–­çµæœ:', 'debug');
            addLog(`  - åˆæœŸåŒ–: ${status.initialized}`, 'debug');
            addLog(`  - ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°: ${status.rendering}`, 'debug');
            addLog(`  - ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æ•°: ${status.charactersLoaded}`, 'debug');
            addLog(`  - ãƒ•ãƒ¬ãƒ¼ãƒ æ•°: ${status.frameCount}`, 'debug');
            addLog(`  - WebGLå¯¾å¿œ: ${status.webglSupported}`, 'debug');
            addLog(`  - ã‚¨ãƒ©ãƒ¼æ•°: ${status.errors}`, 'debug');
        }
        
        // ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆ
        async function stressTest() {
            addLog('âš¡ ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            // åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ
            await initializeRenderer();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
            await loadAllCharacters();
            await new Promise(resolve => setTimeout(resolve, 500));
            
            // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆ
            startRendering();
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åˆ‡æ›¿ãƒ†ã‚¹ãƒˆ
            for (let i = 0; i < 5; i++) {
                playAnimation('purattokun', 'syutugen');
                await new Promise(resolve => setTimeout(resolve, 1000));
                playAnimation('purattokun', 'taiki');
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
            
            addLog('âœ… ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆå®Œäº†', 'info');
        }
        
        // ãƒªã‚½ãƒ¼ã‚¹è§£æ”¾
        function disposeRenderer() {
            if (!renderer) {
                addLog('âŒ ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“', 'error');
                return;
            }
            
            addLog('ğŸ§¹ ãƒªã‚½ãƒ¼ã‚¹è§£æ”¾é–‹å§‹');
            
            if (statusUpdateInterval) {
                clearInterval(statusUpdateInterval);
                statusUpdateInterval = null;
            }
            
            renderer.dispose();
            renderer = null;
            
            addLog('âœ… ãƒªã‚½ãƒ¼ã‚¹è§£æ”¾å®Œäº†', 'info');
        }
        
        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }
        
        // ãƒ­ã‚°ã‚¯ãƒªã‚¢
        function clearLogs() {
            document.getElementById('log-area').innerHTML = 
                '<div class="log-entry log-info">ğŸš€ ãƒ­ã‚°ã‚¯ãƒªã‚¢</div>';
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        window.addEventListener('load', () => {
            addLog('ğŸ“± ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†');
            addLog('ğŸ” Spine WebGLãƒ©ã‚¤ãƒ–ãƒ©ãƒªç¢ºèªä¸­...');
            
            // è©³ç´°ç¢ºèª
            console.log('ğŸ” ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç¢ºèªè©³ç´°:');
            console.log('  - window.spine:', window.spine);
            console.log('  - spine keys:', window.spine ? Object.keys(window.spine) : 'none');
            console.log('  - UniversalSpineRenderer:', typeof window.UniversalSpineRenderer);
            
            if (typeof window.spine !== 'undefined') {
                addLog('âœ… Spine WebGLãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª­ã¿è¾¼ã¿æˆåŠŸ', 'info');
                addLog(`ğŸ“‹ Spine classes: ${Object.keys(window.spine).length}å€‹`, 'debug');
            } else {
                addLog('âŒ Spine WebGLãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª­ã¿è¾¼ã¿å¤±æ•—', 'error');
                addLog('ğŸ” ç¾åœ¨ã®URL: ' + window.location.href, 'debug');
                addLog('ğŸ” æ¨å¥¨URL: http://localhost:8000/test-universal-spine-renderer.html', 'debug');
                
                // ä»£æ›¿ç¢ºèª
                const spineKeys = Object.keys(window).filter(key => 
                    key.includes('spine') || key.includes('Spine')
                );
                if (spineKeys.length > 0) {
                    addLog(`ğŸ” Spineé–¢é€£å¤‰æ•°ç™ºè¦‹: ${spineKeys.join(', ')}`, 'debug');
                } else {
                    addLog('âŒ Spineé–¢é€£å¤‰æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
                    addLog('ğŸ’¡ è§£æ±ºæ–¹æ³•: python server.py ã‚’å®Ÿè¡Œã—ã¦HTTPã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•', 'warning');
                }
            }
            
            if (typeof window.UniversalSpineRenderer !== 'undefined') {
                addLog('âœ… UniversalSpineRendererãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿æˆåŠŸ', 'info');
                
                // ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒæ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹å ´åˆã€è‡ªå‹•åˆæœŸåŒ–ã‚’ææ¡ˆ
                if (typeof window.spine !== 'undefined') {
                    addLog('ğŸš€ æº–å‚™å®Œäº†: åˆæœŸåŒ–ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„', 'info');
                }
            } else {
                addLog('âŒ UniversalSpineRendererãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿å¤±æ•—', 'error');
            }
        });
        
        // ãƒšãƒ¼ã‚¸ã‚¢ãƒ³ãƒ­ãƒ¼ãƒ‰æ™‚ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
        window.addEventListener('beforeunload', () => {
            if (renderer) {
                renderer.dispose();
            }
        });
    </script>
</body>
</html>