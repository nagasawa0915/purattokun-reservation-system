<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ­ Timeline Studio Demo - Theater UI Timeline System</title>
    
    <!-- Timeline Studio CSS -->
    <link rel="stylesheet" href="theater-studio.css">
    
    <style>
        /* ãƒ‡ãƒ¢ç”¨è¿½åŠ ã‚¹ã‚¿ã‚¤ãƒ« */
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f1419 0%, #1a1f29 100%);
            color: #e8e8e8;
        }
        
        .demo-header {
            padding: 20px;
            text-align: center;
            background: rgba(26, 37, 51, 0.8);
            border-bottom: 2px solid #3a5f7a;
        }
        
        .demo-title {
            font-size: 32px;
            color: #d4af37;
            margin-bottom: 10px;
        }
        
        .demo-subtitle {
            font-size: 16px;
            color: #8fa4b8;
            margin-bottom: 20px;
        }
        
        .demo-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        .btn-demo {
            padding: 10px 20px;
            background: linear-gradient(45deg, #3a5f7a, #4a6f8a);
            color: #ffffff;
            border: 1px solid #5a7f9a;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .btn-demo:hover {
            background: linear-gradient(45deg, #4a6f8a, #5a7f9a);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(74, 111, 138, 0.4);
        }
        
        .status-panel {
            background: rgba(36, 52, 71, 0.8);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            padding: 5px 10px;
            border-radius: 4px;
            background: rgba(74, 111, 138, 0.2);
        }
        
        .status-label {
            color: #8fa4b8;
        }
        
        .status-value {
            color: #d4af37;
            font-weight: 600;
        }
        
        .error-panel {
            background: rgba(139, 69, 19, 0.3);
            border: 1px solid #ff6b6b;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 20px;
            display: none;
        }
        
        .error-title {
            color: #ff6b6b;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .error-message {
            color: #ffcccc;
            font-size: 14px;
        }
        
        #timeline-studio-container {
            min-height: 80vh;
        }
        
        .console-output {
            background: rgba(15, 20, 25, 0.8);
            border: 1px solid #3a5f7a;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 20px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 2px 5px;
            border-radius: 3px;
        }
        
        .log-info { background: rgba(74, 111, 138, 0.2); color: #8fa4b8; }
        .log-success { background: rgba(46, 125, 50, 0.2); color: #81c784; }
        .log-warning { background: rgba(245, 124, 0, 0.2); color: #ffb74d; }
        .log-error { background: rgba(211, 47, 47, 0.2); color: #e57373; }
    </style>
</head>
<body>
    <!-- ãƒ‡ãƒ¢ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="demo-header">
        <h1 class="demo-title">ğŸ­ Timeline Studio Demo</h1>
        <p class="demo-subtitle">Theater UI Concept - Spineç”¨ãƒãƒ³ãƒªãƒ‹ã‚¢ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ç·¨é›†ã‚·ã‚¹ãƒ†ãƒ </p>
        
        <div class="demo-controls">
            <button class="btn-demo" onclick="initializeDemo()">ğŸš€ Initialize Systems</button>
            <button class="btn-demo" onclick="createSampleClip()">ğŸª Add Sample Clip</button>
            <button class="btn-demo" onclick="testPlayback()">â–¶ï¸ Test Playback</button>
            <button class="btn-demo" onclick="testBake()">ğŸ“¦ Test Bake</button>
            <button class="btn-demo" onclick="showSystemStatus()">ğŸ“Š System Status</button>
        </div>
        
        <div class="status-panel" id="status-panel">
            <div class="status-item">
                <span class="status-label">Theater Studio:</span>
                <span class="status-value" id="status-theater">æœªåˆæœŸåŒ–</span>
            </div>
            <div class="status-item">
                <span class="status-label">Timeline Engine:</span>
                <span class="status-value" id="status-timeline">æœªåˆæœŸåŒ–</span>
            </div>
            <div class="status-item">
                <span class="status-label">Spine Integration:</span>
                <span class="status-value" id="status-spine">æœªåˆæœŸåŒ–</span>
            </div>
            <div class="status-item">
                <span class="status-label">Bake System:</span>
                <span class="status-value" id="status-bake">æœªåˆæœŸåŒ–</span>
            </div>
        </div>
        
        <div class="error-panel" id="error-panel">
            <div class="error-title">âŒ ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼</div>
            <div class="error-message" id="error-message"></div>
        </div>
    </div>
    
    <!-- Timeline Studio ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div id="timeline-studio-container"></div>
    
    <!-- ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ› -->
    <div class="console-output" id="console-output">
        <div class="log-entry log-info">[INFO] Timeline Studio Demo æº–å‚™ä¸­...</div>
    </div>
    
    <!-- Timeline Studio Scripts -->
    <script src="timeline-studio-core.js"></script>
    <script src="timeline-control-engine.js"></script>
    <script src="spine-integration-api.js"></script>
    <script src="bake-output-system.js"></script>
    
    <script>
        // ========== ãƒ‡ãƒ¢åˆ¶å¾¡ã‚¹ã‚¯ãƒªãƒ—ãƒˆ ========== //
        
        let demoState = {
            initialized: false,
            systems: {
                theater: false,
                timeline: false,
                spine: false,
                bake: false
            }
        };
        
        // ãƒ­ã‚°å‡ºåŠ›ã‚·ã‚¹ãƒ†ãƒ 
        function logToConsole(level, message) {
            const timestamp = new Date().toLocaleTimeString();
            const logClass = `log-${level}`;
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${logClass}`;
            logEntry.textContent = `[${timestamp}] [${level.toUpperCase()}] ${message}`;
            
            const consoleOutput = document.getElementById('console-output');
            consoleOutput.appendChild(logEntry);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
            
            // 100ã‚¨ãƒ³ãƒˆãƒªãƒ¼åˆ¶é™
            if (consoleOutput.children.length > 100) {
                consoleOutput.removeChild(consoleOutput.firstChild);
            }
        }
        
        // ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
        function showError(message) {
            const errorPanel = document.getElementById('error-panel');
            const errorMessage = document.getElementById('error-message');
            errorMessage.textContent = message;
            errorPanel.style.display = 'block';
            
            logToConsole('error', message);
        }
        
        // ã‚¨ãƒ©ãƒ¼éè¡¨ç¤º
        function hideError() {
            document.getElementById('error-panel').style.display = 'none';
        }
        
        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
        function updateStatus(system, status) {
            const statusElement = document.getElementById(`status-${system}`);
            if (statusElement) {
                statusElement.textContent = status;
                statusElement.style.color = status.includes('âœ…') ? '#81c784' : 
                                          status.includes('âŒ') ? '#e57373' : 
                                          status.includes('âš ï¸') ? '#ffb74d' : '#d4af37';
            }
            
            logToConsole('info', `${system} status: ${status}`);
        }
        
        // ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
        async function initializeDemo() {
            hideError();
            logToConsole('info', 'ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–é–‹å§‹...');
            
            try {
                // 1. Theater Studio åˆæœŸåŒ–
                updateStatus('theater', 'åˆæœŸåŒ–ä¸­...');
                if (typeof window.initTheaterStudio === 'function') {
                    await window.initTheaterStudio('timeline-studio-container');
                    demoState.systems.theater = true;
                    updateStatus('theater', 'âœ… åˆæœŸåŒ–å®Œäº†');
                } else {
                    throw new Error('Theater Studio åˆæœŸåŒ–é–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
                
                // 2. Timeline Engine åˆæœŸåŒ–
                updateStatus('timeline', 'åˆæœŸåŒ–ä¸­...');
                if (window.timelineEngine) {
                    const success = window.timelineEngine.initialize(window.TheaterStudio);
                    if (success) {
                        demoState.systems.timeline = true;
                        updateStatus('timeline', 'âœ… åˆæœŸåŒ–å®Œäº†');
                    } else {
                        throw new Error('Timeline Engine åˆæœŸåŒ–å¤±æ•—');
                    }
                } else {
                    throw new Error('Timeline Engine ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
                
                // 3. Spine Integration åˆæœŸåŒ–
                updateStatus('spine', 'åˆæœŸåŒ–ä¸­...');
                if (typeof window.initSpineIntegration === 'function') {
                    const integrationStatus = await window.initSpineIntegration();
                    if (integrationStatus && integrationStatus.ready) {
                        demoState.systems.spine = true;
                        updateStatus('spine', 'âœ… çµ±åˆå®Œäº†');
                    } else {
                        demoState.systems.spine = false;
                        updateStatus('spine', 'âš ï¸ çµ±åˆåˆ¶é™ï¼ˆSpineã‚·ã‚¹ãƒ†ãƒ æœªæ¤œå‡ºï¼‰');
                    }
                } else {
                    throw new Error('Spine Integration åˆæœŸåŒ–é–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
                
                // 4. Bake System åˆæœŸåŒ–
                updateStatus('bake', 'åˆæœŸåŒ–ä¸­...');
                if (window.bakeSystem) {
                    await window.bakeSystem.initialize(window.timelineEngine, window.spineIntegration);
                    demoState.systems.bake = true;
                    updateStatus('bake', 'âœ… åˆæœŸåŒ–å®Œäº†');
                } else {
                    throw new Error('Bake System ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
                
                demoState.initialized = true;
                logToConsole('success', 'ğŸ­ Timeline Studio Demo åˆæœŸåŒ–å®Œäº†');
                
            } catch (error) {
                showError(`åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                logToConsole('error', `åˆæœŸåŒ–å¤±æ•—: ${error.message}`);
            }
        }
        
        // ã‚µãƒ³ãƒ—ãƒ«ã‚¯ãƒªãƒƒãƒ—ä½œæˆ
        function createSampleClip() {
            if (!demoState.initialized) {
                showError('å…ˆã«ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸåŒ–ã—ã¦ãã ã•ã„');
                return;
            }
            
            try {
                // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚¯ãƒªãƒƒãƒ—ä½œæˆ
                const clip = window.timelineEngine.createCharacterClip(
                    'character-1',      // ãƒˆãƒ©ãƒƒã‚¯ID
                    'purattokun',       // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ID
                    'idle',             // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å
                    1000,               // é–‹å§‹æ™‚é–“ï¼ˆ1ç§’ï¼‰
                    3000                // ç¶™ç¶šæ™‚é–“ï¼ˆ3ç§’ï¼‰
                );
                
                if (clip) {
                    logToConsole('success', `ã‚µãƒ³ãƒ—ãƒ«ã‚¯ãƒªãƒƒãƒ—ä½œæˆ: ${clip.name}`);
                } else {
                    throw new Error('ã‚¯ãƒªãƒƒãƒ—ä½œæˆå¤±æ•—');
                }
                
            } catch (error) {
                showError(`ã‚¯ãƒªãƒƒãƒ—ä½œæˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }
        
        // å†ç”Ÿãƒ†ã‚¹ãƒˆ
        function testPlayback() {
            if (!demoState.initialized) {
                showError('å…ˆã«ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸåŒ–ã—ã¦ãã ã•ã„');
                return;
            }
            
            try {
                window.timelineEngine.play();
                logToConsole('info', 'ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³å†ç”Ÿé–‹å§‹');
                
                // 5ç§’å¾Œã«è‡ªå‹•åœæ­¢
                setTimeout(() => {
                    window.timelineEngine.stop();
                    logToConsole('info', 'ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³å†ç”Ÿåœæ­¢');
                }, 5000);
                
            } catch (error) {
                showError(`å†ç”Ÿã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }
        
        // ãƒ™ã‚¤ã‚¯ãƒ†ã‚¹ãƒˆ
        async function testBake() {
            if (!demoState.initialized) {
                showError('å…ˆã«ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸåŒ–ã—ã¦ãã ã•ã„');
                return;
            }
            
            try {
                logToConsole('info', 'ãƒ™ã‚¤ã‚¯å‡¦ç†é–‹å§‹...');
                const project = await window.bakeSystem.startBake('demo-project');
                
                if (project && project.status === 'completed') {
                    logToConsole('success', `ãƒ™ã‚¤ã‚¯å®Œäº†: ${project.name} (${project.duration}ms)`);
                    
                    // å‡ºåŠ›ç¢ºèª
                    if (project.output && project.output.code) {
                        logToConsole('info', `å‡ºåŠ›ã‚µã‚¤ã‚º: ${(project.output.size / 1024).toFixed(1)}KB`);
                    }
                } else {
                    throw new Error('ãƒ™ã‚¤ã‚¯å‡¦ç†ãŒå®Œäº†ã—ã¾ã›ã‚“ã§ã—ãŸ');
                }
                
            } catch (error) {
                showError(`ãƒ™ã‚¤ã‚¯ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }
        
        // ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹è¡¨ç¤º
        function showSystemStatus() {
            const status = {
                theater: window.TheaterStudio ? window.TheaterStudio.getStudioState() : null,
                timeline: window.timelineEngine ? window.timelineEngine.getEngineState() : null,
                spine: window.spineIntegration ? window.spineIntegration.getIntegrationState() : null,
                bake: window.bakeSystem ? window.bakeSystem.getBakeState() : null
            };
            
            console.log('ğŸ­ Timeline Studio ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹:', status);
            logToConsole('info', 'ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›ã—ã¾ã—ãŸ');
        }
        
        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
        window.addEventListener('theaterStudio:studioReady', (e) => {
            logToConsole('success', `Theater Studio æº–å‚™å®Œäº†: ${e.detail.studio} v${e.detail.version}`);
        });
        
        window.addEventListener('timelineEngine:playbackStarted', (e) => {
            logToConsole('info', `ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³å†ç”Ÿé–‹å§‹: ${e.detail.currentTime}ms`);
        });
        
        window.addEventListener('timelineEngine:clipActivated', (e) => {
            logToConsole('info', `ã‚¯ãƒªãƒƒãƒ—ã‚¢ã‚¯ãƒ†ã‚£ãƒ–: ${e.detail.clip.name}`);
        });
        
        window.addEventListener('bakeSystem:bakeCompleted', (e) => {
            logToConsole('success', `ãƒ™ã‚¤ã‚¯å®Œäº†: ${e.detail.project.name}`);
        });
        
        // åˆæœŸãƒ­ã‚°
        logToConsole('success', 'Timeline Studio Demo èª­ã¿è¾¼ã¿å®Œäº†');
        logToConsole('info', 'ğŸš€ Initialize Systems ãƒœã‚¿ãƒ³ã§ã‚·ã‚¹ãƒ†ãƒ é–‹å§‹');
    </script>
</body>
</html>