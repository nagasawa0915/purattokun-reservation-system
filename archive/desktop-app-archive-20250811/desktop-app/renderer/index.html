<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spine Character Position Editor</title>
    
    <!-- åŸºæœ¬CSSï¼ˆã‚¤ãƒ³ãƒ©ã‚¤ãƒ³åŒ–ã§ãƒ‘ã‚¹å•é¡Œå›é¿ï¼‰ -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 14px;
            line-height: 1.4;
            color: #333;
            background: #f5f5f5;
            overflow: hidden;
        }
        
        #app {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #2c3e50;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        .loading-content {
            text-align: center;
            color: white;
        }
        
        .loading-content h2 {
            font-size: 24px;
            margin-bottom: 16px;
            font-weight: 300;
        }
        
        .loading-content p {
            font-size: 16px;
            opacity: 0.8;
        }
        
        .loading-spinner {
            width: 48px;
            height: 48px;
            margin: 0 auto 24px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ã‚¿ãƒ–ã‚¹ã‚¿ã‚¤ãƒ« */
        .tab-button {
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }
        
        .tab-button.active {
            background: rgba(255, 255, 255, 0.9);
            color: #34495e;
            border-color: rgba(255, 255, 255, 0.5);
        }
        
        .tab-button:hover:not(.active) {
            background: rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.9);
        }
        
        /* ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
        .view-content {
            width: 100%;
            height: 100%;
            overflow: hidden;
            display: none;  /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§éè¡¨ç¤º */
        }
        
        .view-content.active {
            display: flex;
            flex-direction: column;
        }
        
        /* HTMLãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ */
        .html-viewer-container {
            display: flex;
            flex-direction: column;
            width: 100%;
            height: 100%;
        }
        
        .webview-container {
            flex: 1;
            position: relative;
            background: white;
        }
        
        .main-content {
            display: flex;
            flex-direction: column;
            width: 100%;
            height: 100%;
            background: #ffffff;
        }
        
        .toolbar {
            height: 48px;
            background: #34495e;
            color: white;
            display: flex;
            align-items: center;
            padding: 0 16px;
            border-bottom: 1px solid #2c3e50;
            flex-shrink: 0;
        }
        
        .content-area {
            flex: 1;
            display: flex;
            overflow: hidden;
        }
        
        .default-view {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            background: linear-gradient(45deg, #f8f9fa 25%, transparent 25%),
                        linear-gradient(-45deg, #f8f9fa 25%, transparent 25%),
                        linear-gradient(45deg, transparent 75%, #f8f9fa 75%),
                        linear-gradient(-45deg, transparent 75%, #f8f9fa 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }
        
        .welcome-message {
            text-align: center;
            color: #34495e;
            background: rgba(255, 255, 255, 0.9);
            padding: 48px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            max-width: 500px;
        }
        
        .welcome-message h3 {
            font-size: 24px;
            margin-bottom: 16px;
        }
        
        .welcome-message p {
            font-size: 16px;
            line-height: 1.5;
            margin-bottom: 12px;
        }
        
        .success-indicator {
            background: #27ae60;
            color: white;
            padding: 12px 20px;
            border-radius: 6px;
            margin: 20px 0;
            font-weight: 500;
        }
        
        .status-bar {
            height: 32px;
            background: #2c3e50;
            color: #ecf0f1;
            display: flex;
            align-items: center;
            padding: 0 16px;
            font-size: 12px;
            flex-shrink: 0;
        }
        
        /* ãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ« */
        .btn {
            padding: 6px 12px;
            border: 1px solid transparent;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
            font-family: inherit;
        }
        
        .btn-sm {
            padding: 4px 8px;
            font-size: 11px;
        }
        
        .btn-outline-primary {
            color: #007acc;
            border-color: #007acc;
            background: white;
        }
        
        .btn-outline-primary:hover {
            background: #007acc;
            color: white;
        }
        
        .btn-outline-secondary {
            color: #6c757d;
            border-color: #6c757d;
            background: white;
        }
        
        .btn-outline-secondary:hover {
            background: #6c757d;
            color: white;
        }
        
        .btn-outline-info {
            color: #17a2b8;
            border-color: #17a2b8;
            background: white;
        }
        
        .btn-outline-info:hover {
            background: #17a2b8;
            color: white;
        }
        
        .btn-outline-success {
            color: #28a745;
            border-color: #28a745;
            background: white;
        }
        
        .btn-outline-success:hover {
            background: #28a745;
            color: white;
        }
    </style>
</head>
<body>
    <!-- ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒ†ãƒŠãƒ¼ -->
    <div id="app">
        <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ -->
        <div id="loading-screen" class="loading-screen">
            <div class="loading-content">
                <div class="loading-spinner"></div>
                <h2>Spine Character Position Editor</h2>
                <p id="loading-message">åˆæœŸåŒ–ä¸­...</p>
            </div>
        </div>
        
        <!-- ãƒ¡ã‚¤ãƒ³UI -->
        <div id="main-content" class="main-content" style="display: none;">
            <!-- ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ -->
            <div class="toolbar">
                <strong>ğŸ† Spine Character Position Editor</strong>
                
                <!-- ãƒ“ãƒ¥ãƒ¼åˆ‡ã‚Šæ›¿ãˆã‚¿ãƒ– -->
                <div class="view-tabs" style="margin-left: auto; margin-right: 20px; display: flex; gap: 8px;">
                    <button id="spine-editor-tab" class="tab-button active" data-view="spine-editor">
                        ğŸŒ¯ï¸ Spineç·¨é›†
                    </button>
                    <button id="html-viewer-tab" class="tab-button" data-view="html-viewer">
                        ğŸŒ HTMLãƒ“ãƒ¥ãƒ¼
                    </button>
                </div>
                
                <span style="font-size: 12px; opacity: 0.8;">ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ç‰ˆ v1.0</span>
            </div>
            
            <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ -->
            <div class="content-area">
                <!-- Spineç·¨é›†ãƒ“ãƒ¥ãƒ¼ -->
                <div id="spine-editor-view" class="view-content active">
                    <div class="default-view">
                        <div class="welcome-message">
                            <h3>âœ… Spine Character Position Editor</h3>
                            <div class="success-indicator">
                                ğŸš€ åŸºæœ¬ã‚·ã‚¹ãƒ†ãƒ ãŒæ­£å¸¸ã«åˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸ
                            </div>
                            <p><strong>ğŸ¯ ç¾åœ¨ã®çŠ¶æ³:</strong></p>
                            <p>â€¢ HTMLãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ: æ­£å¸¸å‹•ä½œ</p>
                            <p>â€¢ CSSã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°: é©ç”¨æ¸ˆã¿</p>
                            <p>â€¢ åŸºæœ¬JavaScript: å‹•ä½œä¸­</p>
                            <p>â€¢ ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ : å®Œäº†</p>
                            
                            <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 6px; text-align: left;">
                                <strong>ğŸ“‹ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:</strong>
                                <br>â€¢ Spineç·¨é›†æ©Ÿèƒ½ã®çµ±åˆ
                                <br>â€¢ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…
                                <br>â€¢ ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œAPIã®é€£æº
                                <br>â€¢ é«˜åº¦ãªUIæ©Ÿèƒ½ã®è¿½åŠ 
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- HTMLãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ -->
                <div id="html-viewer-view" class="view-content">
                    <!-- ãƒ‡ãƒãƒƒã‚°æƒ…å ± -->
                    <div id="htmlviewer-debug" style="padding: 10px; background: #e3f2fd; border: 1px solid #2196f3; margin: 10px; border-radius: 4px; font-size: 12px;">
                        <strong>ğŸ” HTMLãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ ãƒ‡ãƒãƒƒã‚°æƒ…å ±:</strong>
                        <div id="debug-info">åˆæœŸåŒ–ä¸­...</div>
                    </div>
                    
                    <div class="html-viewer-container">
                        <!-- HTMLé¸æŠãƒ‘ãƒãƒ« -->
                        <div class="html-controls" style="padding: 16px; background: #f8f9fa; border-bottom: 1px solid #ddd;">
                            <!-- URLãƒ—ãƒªã‚»ãƒƒãƒˆã‚³ãƒ³ãƒ†ãƒŠ -->
                            <div id="url-preset-container" style="margin-bottom: 10px;">
                                <div style="padding: 10px; background: #f5f5f5; border-radius: 4px;">
                                    <strong>ğŸ”— ã‚ˆãä½¿ã†URL:</strong>
                                    <div id="url-preset-buttons" style="margin-top: 5px;">
                                        <button class="btn btn-sm btn-outline-primary" style="margin-right: 5px; margin-bottom: 5px;" onclick="window.loadPresetUrl('http://localhost:8000/index.html')">ğŸŒŸ ãƒ¡ã‚¤ãƒ³ã‚µã‚¤ãƒˆ</button>
                                        <button class="btn btn-sm btn-outline-primary" style="margin-right: 5px; margin-bottom: 5px;" onclick="window.loadPresetUrl('http://localhost:8000/index.html?edit=true')">ğŸ”§ ç·¨é›†ãƒ¢ãƒ¼ãƒ‰</button>
                                        <button class="btn btn-sm btn-outline-primary" style="margin-right: 5px; margin-bottom: 5px;" onclick="window.loadPresetUrl('http://localhost:8000/timeline-experiment.html')">ğŸ¬ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</button>
                                        <button class="btn btn-sm btn-outline-primary" style="margin-right: 5px; margin-bottom: 5px;" onclick="window.loadPresetUrl('http://localhost:8000/spine-positioning-system-explanation.html')">ğŸ¯ Spineç·¨é›†</button>
                                        <button class="btn btn-sm btn-outline-primary" style="margin-right: 5px; margin-bottom: 5px;" onclick="window.loadPresetUrl('http://localhost:8000/test-minimal.html')">ğŸ”¬ ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ãƒ†ã‚¹ãƒˆ</button>
                                        <div style="width: 100%; margin-top: 10px;">
                                            <button class="btn btn-sm btn-outline-primary" style="margin-right: 5px;" onclick="window.htmlViewerManager?.selectLocalFile()">ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ</button>
                                            <button class="btn btn-sm btn-outline-info" style="margin-right: 5px;" onclick="window.htmlViewerManager?.checkServerStatus()">ğŸ” ã‚µãƒ¼ãƒãƒ¼çŠ¶æ³</button>
                                            <button class="btn btn-sm btn-outline-success" style="margin-right: 5px;" onclick="window.htmlViewerManager?.startServer()">ğŸš€ ã‚µãƒ¼ãƒãƒ¼èµ·å‹•</button>
                                            <button class="btn btn-sm btn-outline-secondary" style="margin-right: 5px;" onclick="window.clearElectronCache()">ğŸ§¹ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢</button>
                                            <button class="btn btn-sm btn-outline-secondary" onclick="window.hardReloadApp()">ğŸ”„ ãƒãƒ¼ãƒ‰ãƒªãƒ­ãƒ¼ãƒ‰</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã¨URLå…¥åŠ› -->
                            <div style="display: flex; gap: 12px; align-items: center;">
                                <label style="font-weight: bold; color: #555;">ğŸŒ è¡¨ç¤ºã™ã‚‹HTML:</label>
                                <select id="html-file-selector" style="flex: 1; padding: 8px; border: 1px solid #ccc; border-radius: 4px; background: white;">
                                    <option value="">-- HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ --</option>
                                </select>
                                <input type="text" id="custom-url-input" placeholder="ã‚«ã‚¹ã‚¿ãƒ URLå…¥åŠ›..." 
                                       style="flex: 1; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <button id="load-html-button" style="padding: 8px 16px; background: #007acc; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                    ğŸ”„ èª­ã¿è¾¼ã¿
                                </button>
                                <button id="refresh-html-button" style="padding: 8px 12px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                    ğŸ”„ æ›´æ–°
                                </button>
                            </div>
                        </div>
                        
                        <!-- Webviewã‚¨ãƒªã‚¢ -->
                        <div class="webview-container" style="flex: 1; position: relative; background: white;">
                            <webview id="html-webview" 
                                     src="about:blank" 
                                     style="width: 100%; height: 100%; border: none;"
                                     webpreferences="contextIsolation=true">
                            </webview>
                            
                            <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º -->
                            <div id="webview-loading" class="webview-loading" style="
                                position: absolute; top: 0; left: 0; width: 100%; height: 100%;
                                display: none; align-items: center; justify-content: center;
                                background: rgba(255,255,255,0.9); z-index: 10;
                            ">
                                <div style="text-align: center; color: #666;">
                                    <div class="loading-spinner" style="margin: 0 auto 12px;"></div>
                                    <p>HTMLãƒšãƒ¼ã‚¸ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</p>
                                </div>
                            </div>
                            
                            <!-- ã‚¨ãƒ©ãƒ¼è¡¨ç¤º -->
                            <div id="webview-error" class="webview-error" style="
                                position: absolute; top: 0; left: 0; width: 100%; height: 100%;
                                display: none; align-items: center; justify-content: center;
                                background: rgba(255,255,255,0.95); z-index: 10;
                            ">
                                <div style="text-align: center; color: #d32f2f; max-width: 400px;">
                                    <h3 style="margin-bottom: 12px;">âš ï¸ èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼</h3>
                                    <p id="error-message" style="margin-bottom: 20px;"></p>
                                    <button onclick="window.htmlViewerManager?.retryLoad()" 
                                            style="padding: 8px 16px; background: #007acc; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                        ğŸ”„ å†è©¦è¡Œ
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ -->
            <div class="status-bar">
                <span>æº–å‚™å®Œäº†</span>
                <span style="margin-left: auto;">
                    <span id="current-time"></span> | 
                    åŸºæœ¬ãƒ¢ãƒ¼ãƒ‰
                </span>
            </div>
        </div>
    </div>
    
    <!-- Spineç·¨é›†ã‚·ã‚¹ãƒ†ãƒ çµ±åˆ -->
    <script src="js/spine-edit-core.js"></script>
    <script src="js/spine-desktop-integration.js"></script>
    
    <!-- ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—UIãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ï¼ˆHTMLãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼å«ã‚€ï¼‰ -->
    <script src="js/desktop-ui-manager.js"></script>
    
    <!-- è¶…ã‚·ãƒ³ãƒ—ãƒ«JavaScript - ç¢ºå®Ÿå‹•ä½œä¿è¨¼ -->
    <script>
        console.log('ğŸš€ è¶…ã‚·ãƒ³ãƒ—ãƒ«åˆæœŸåŒ–ã‚·ã‚¹ãƒ†ãƒ é–‹å§‹');
        
        // ç¾åœ¨æ™‚åˆ»è¡¨ç¤º
        function updateTime() {
            const timeElement = document.getElementById('current-time');
            if (timeElement) {
                const now = new Date();
                timeElement.textContent = now.toLocaleTimeString('ja-JP');
            }
        }
        
        // Electron APIæº–å‚™å®Œäº†ã‚’å¾…æ©Ÿ
        window.addEventListener('electron-api-ready', (event) => {
            console.log('ğŸ”— Electron APIæº–å‚™å®Œäº†:', event.detail);
        });
        
        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ã‚’éš ã—ã¦ãƒ¡ã‚¤ãƒ³UIã‚’è¡¨ç¤º
        function showMainUI() {
            console.log('âœ… ãƒ¡ã‚¤ãƒ³UIè¡¨ç¤ºå‡¦ç†é–‹å§‹');
            
            const loadingScreen = document.getElementById('loading-screen');
            const mainContent = document.getElementById('main-content');
            
            if (loadingScreen && mainContent) {
                // ãƒ•ã‚§ãƒ¼ãƒ‰åŠ¹æœä»˜ãã§åˆ‡ã‚Šæ›¿ãˆ
                loadingScreen.style.opacity = '0';
                loadingScreen.style.transition = 'opacity 0.5s ease';
                
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                    mainContent.style.display = 'flex';
                    mainContent.style.opacity = '0';
                    mainContent.style.transition = 'opacity 0.5s ease';
                    
                    setTimeout(() => {
                        mainContent.style.opacity = '1';
                        console.log('âœ… ãƒ¡ã‚¤ãƒ³UIã®è¡¨ç¤ºãŒå®Œäº†ã—ã¾ã—ãŸ');
                        
                        // æ™‚åˆ»æ›´æ–°é–‹å§‹
                        updateTime();
                        setInterval(updateTime, 1000);
                        
                    }, 50);
                }, 500);
            }
        }
        
        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
        function initTabSwitcher() {
            const tabButtons = document.querySelectorAll('.tab-button');
            const viewContents = document.querySelectorAll('.view-content');
            
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetView = button.dataset.view;
                    
                    // ã™ã¹ã¦ã®ã‚¿ãƒ–ã¨ãƒ“ãƒ¥ãƒ¼ã® active ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    viewContents.forEach(view => {
                        view.classList.remove('active');
                        view.style.display = 'none';
                    });
                    
                    // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã‚¿ãƒ–ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
                    button.classList.add('active');
                    
                    // å¯¾å¿œã™ã‚‹ãƒ“ãƒ¥ãƒ¼ã‚’è¡¨ç¤º
                    const targetViewElement = document.getElementById(targetView + '-view');
                    if (targetViewElement) {
                        targetViewElement.classList.add('active');
                        targetViewElement.style.display = 'flex';
                        
                        // HTMLãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ã«åˆ‡ã‚Šæ›¿ãˆãŸå ´åˆã®ç‰¹åˆ¥å‡¦ç†
                        if (targetView === 'html-viewer') {
                            console.log('ğŸŒ HTMLãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ã«åˆ‡ã‚Šæ›¿ãˆ - ãƒ‡ãƒãƒƒã‚°é–‹å§‹...');
                            
                            // ğŸš€ ä¿®æ­£: setTimeoutä¾å­˜ã‚’æ¸›ã‚‰ã—ã¦ç¢ºå®Ÿã«å®Ÿè¡Œ
                            // ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’ã‚¯ãƒªã‚¢
                            const debugInfo = document.getElementById('debug-info');
                            if (debugInfo) {
                                debugInfo.innerHTML = '';
                            }
                            
                            if (window.updateDebugInfo) {
                                window.updateDebugInfo('ğŸŒ HTMLãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ã‚¿ãƒ–ã«åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸ');
                                window.updateDebugInfo(`â° ç¾åœ¨æ™‚åˆ»: ${new Date().toLocaleTimeString()}`);
                                
                                // è©³ç´°ãƒ‡ãƒãƒƒã‚°å®Ÿè¡Œï¼ˆå³åº§ã«å®Ÿè¡Œï¼‰
                                if (window.debugHtmlElements) {
                                    window.debugHtmlElements();
                                }
                                
                                // ãƒ—ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã®ç¢ºèªã¨ä¿®æ­£ï¼ˆå³åº§ã«å®Ÿè¡Œï¼‰
                                if (window.checkPresetButtons) {
                                    window.checkPresetButtons();
                                }
                                
                                // HTMLãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®åˆæœŸåŒ–ç¢ºèª
                                if (!window.htmlViewerManager) {
                                    window.updateDebugInfo('ğŸ”§ HTMLãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚’æ‰‹å‹•ä½œæˆä¸­...');
                                    try {
                                        // HtmlViewerManagerã‚¯ãƒ©ã‚¹ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
                                        if (typeof HtmlViewerManager !== 'undefined') {
                                            window.htmlViewerManager = new HtmlViewerManager();
                                            window.updateDebugInfo('âœ… HTMLãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ä½œæˆæˆåŠŸ');
                                            
                                            // ä½œæˆå¾Œã«å†åº¦ãƒ‡ãƒãƒƒã‚°ï¼ˆçŸ­ã„é…å»¶ã®ã¿ï¼‰
                                            setTimeout(() => {
                                                window.updateDebugInfo('ğŸ”„ åˆæœŸåŒ–å¾Œã®çŠ¶æ…‹ç¢ºèª...');
                                                if (window.debugHtmlElements) {
                                                    window.debugHtmlElements();
                                                }
                                            }, 200);
                                        } else {
                                            window.updateDebugInfo('âŒ HtmlViewerManagerã‚¯ãƒ©ã‚¹ãŒæœªå®šç¾©');
                                            window.updateDebugInfo('ğŸ’¡ desktop-ui-manager.js ã®èª­ã¿è¾¼ã¿ã‚’ç¢ºèªã—ã¦ãã ã•ã„');
                                        }
                                    } catch (error) {
                                        window.updateDebugInfo('âŒ HTMLãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ä½œæˆã‚¨ãƒ©ãƒ¼: ' + error.message);
                                        console.error('HTMLãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ä½œæˆã‚¨ãƒ©ãƒ¼:', error);
                                    }
                                } else {
                                    window.updateDebugInfo('âœ… HTMLãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã¯æ—¢ã«åˆæœŸåŒ–æ¸ˆã¿');
                                    
                                    // åˆæœŸåŒ–æ¸ˆã¿ã§ã‚‚çŠ¶æ…‹ç¢ºèªï¼ˆå³åº§ã«å®Ÿè¡Œï¼‰
                                    window.updateDebugInfo('ğŸ”„ æ—¢å­˜ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®çŠ¶æ…‹ç¢ºèª...');
                                    if (window.debugHtmlElements) {
                                        window.debugHtmlElements();
                                    }
                                }
                            } else {
                                // updateDebugInfoé–¢æ•°ãŒå­˜åœ¨ã—ãªã„å ´åˆã®å¯¾å‡¦
                                console.error('âŒ updateDebugInfoé–¢æ•°ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                                if (debugInfo) {
                                    debugInfo.innerHTML = '<br>âŒ ãƒ‡ãƒãƒƒã‚°é–¢æ•°ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ';
                                }
                            }
                        }
                    }
                    
                    console.log(`ğŸ”„ ãƒ“ãƒ¥ãƒ¼åˆ‡ã‚Šæ›¿ãˆ: ${targetView}`);
                });
            });
            
            console.log('âœ… ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½åˆæœŸåŒ–å®Œäº†');
        }

        // DOMèª­ã¿è¾¼ã¿å®Œäº†å¾Œã®å‡¦ç†
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ“„ DOMèª­ã¿è¾¼ã¿å®Œäº† - åˆæœŸåŒ–é–‹å§‹');
            
            // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ›´æ–°
            const loadingMessage = document.getElementById('loading-message');
            if (loadingMessage) {
                loadingMessage.textContent = 'UIæ©Ÿèƒ½ã‚’åˆæœŸåŒ–ä¸­...';
            }
            
            // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½åˆæœŸåŒ–
            initTabSwitcher();
            
            // Spine Desktop Integrationã®åˆæœŸåŒ–ã‚’å¾…ã¤
            setTimeout(() => {
                if (window.spineDesktopManager && window.spineDesktopManager.constructor.name === 'SpineDesktopIntegration') {
                    console.log('âœ… Spineç·¨é›†ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†');
                    if (loadingMessage) {
                        loadingMessage.textContent = 'UIã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™...';
                    }
                } else {
                    console.log('âš ï¸ Spineç·¨é›†ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ã‚’å¾…æ©Ÿä¸­...');
                    if (loadingMessage) {
                        loadingMessage.textContent = 'åŸºæœ¬UIã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™...';
                    }
                }
                
                showMainUI();
            }, 2000);
        });
        
        // windowèª­ã¿è¾¼ã¿å®Œäº†æ™‚ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å‡¦ç†
        window.addEventListener('load', () => {
            console.log('ğŸŒ Windowèª­ã¿è¾¼ã¿å®Œäº†');
            
            // DOMContentLoadedãŒå‹•ã‹ãªã‹ã£ãŸå ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
            setTimeout(() => {
                if (document.getElementById('main-content').style.display === 'none') {
                    console.log('âš ï¸ DOMContentLoadedãŒå‹•ä½œã—ãªã‹ã£ãŸãŸã‚ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè¡Œ');
                    showMainUI();
                }
            }, 5000);
        });
        
        // å¼·åˆ¶è¡¨ç¤ºã‚¿ã‚¤ãƒãƒ¼ï¼ˆæœ€çµ‚æ‰‹æ®µï¼‰
        setTimeout(() => {
            if (document.getElementById('main-content').style.display === 'none') {
                console.log('ğŸš¨ å¼·åˆ¶è¡¨ç¤ºã‚¿ã‚¤ãƒãƒ¼ç™ºå‹•');
                showMainUI();
            }
        }, 8000);
        
        // ãƒ‡ãƒãƒƒã‚°æƒ…å ±æ›´æ–°é–¢æ•°
        window.updateDebugInfo = function(message) {
            const debugInfo = document.getElementById('debug-info');
            if (debugInfo) {
                debugInfo.innerHTML += '<br>â€¢ ' + message;
                console.log('ğŸ” ãƒ‡ãƒãƒƒã‚°:', message);
            } else {
                console.log('ğŸ” ãƒ‡ãƒãƒƒã‚° (è¦ç´ ãªã—):', message);
            }
        };
        
        // HTMLè¦ç´ ã®è©³ç´°ç¢ºèªé–¢æ•°
        window.debugHtmlElements = function() {
            const elements = [
                'html-viewer-view',
                'html-file-selector', 
                'custom-url-input',
                'url-preset-container',
                'url-preset-buttons',
                'load-html-button',
                'refresh-html-button',
                'html-webview',
                'debug-info'
            ];
            
            // ğŸš€ é‡è¦: html-viewer-viewè¦ç´ ã®ç‰¹åˆ¥ãƒ‡ãƒãƒƒã‚°
            window.updateDebugInfo('=== html-viewer-viewè¦ç´ ã®ç‰¹åˆ¥è¨ºæ–­ ===');
            const htmlViewerViewDebug = document.getElementById('html-viewer-view');
            if (htmlViewerViewDebug) {
                const computedStyle = window.getComputedStyle(htmlViewerViewDebug);
                window.updateDebugInfo(`html-viewer-view display: ${computedStyle.display}`);
                window.updateDebugInfo(`html-viewer-view visibility: ${computedStyle.visibility}`);
                window.updateDebugInfo(`html-viewer-view opacity: ${computedStyle.opacity}`);
                window.updateDebugInfo(`html-viewer-view classList: ${htmlViewerViewDebug.className}`);
                window.updateDebugInfo(`html-viewer-view childElementCount: ${htmlViewerViewDebug.childElementCount}`);
                
                // å­è¦ç´ ã®è©³ç´°ç¢ºèª
                if (htmlViewerViewDebug.childElementCount > 0) {
                    window.updateDebugInfo('html-viewer-view ã®å­è¦ç´ :');
                    Array.from(htmlViewerViewDebug.children).forEach((child, index) => {
                        window.updateDebugInfo(`  â””â”€ å­${index+1}: ${child.tagName}#${child.id || '(no-id)'}.${child.className || '(no-class)'}`);
                    });
                }
            } else {
                // HTMLæ–‡å­—åˆ—å†…ã§ã®æ¤œç´¢
                const htmlContent = document.documentElement.outerHTML;
                const htmlViewerMatch = htmlContent.match(/<div[^>]*id\s*=\s*["']html-viewer-view["'][^>]*>/);
                if (htmlViewerMatch) {
                    window.updateDebugInfo('âŒ html-viewer-viewã¯HTMLã«å­˜åœ¨ã™ã‚‹ãŒJSã§å–å¾—ä¸å¯èƒ½');
                    window.updateDebugInfo(`HTMLå†…ã®å®šç¾©: ${htmlViewerMatch[0]}`);
                } else {
                    window.updateDebugInfo('âŒ html-viewer-viewãŒHTMLã‹ã‚‰å®Œå…¨ã«è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
            }
            
            // ğŸš€ ãƒ•ã‚¡ã‚¤ãƒ«å‚ç…§ç¢ºèªæƒ…å ±ã‚’è¿½åŠ 
            window.updateDebugInfo('=== ãƒ•ã‚¡ã‚¤ãƒ«å‚ç…§çŠ¶æ³ç¢ºèª ===');
            window.updateDebugInfo(`ç¾åœ¨ã®HTMLãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹: ${window.location.href}`);
            window.updateDebugInfo(`DOMè¦ç´ æ•°: ${document.all.length}å€‹`);
            window.updateDebugInfo(`Bodyå†…è¦ç´ æ•°: ${document.body?.children?.length || 0}å€‹`);
            
            // ğŸš€ content-areaã®æ­£ç¢ºãªå‚ç…§ã‚’å–å¾—
            const contentArea = document.querySelector('.content-area');
            if (contentArea) {
                window.updateDebugInfo(`content-areaå†…è¦ç´ : ${contentArea.children.length}å€‹`);
                // å­è¦ç´ ã®è©³ç´°æƒ…å ±ã‚‚è¡¨ç¤º
                for (let i = 0; i < contentArea.children.length; i++) {
                    const child = contentArea.children[i];
                    window.updateDebugInfo(`  â””â”€ å­è¦ç´ ${i+1}: ${child.id || child.className || child.tagName}`);
                }
            } else {
                window.updateDebugInfo('âŒ content-areaè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
            
            window.updateDebugInfo('=== HTMLè¦ç´ ãƒ‡ãƒãƒƒã‚°é–‹å§‹ ===');
            elements.forEach(id => {
                // è¤‡æ•°ã®æ¤œå‡ºæ–¹æ³•ã‚’è©¦è¡Œ
                const elementById = document.getElementById(id);
                const elementByQuery = document.querySelector(`#${id}`);
                const elementInDOM = document.documentElement.outerHTML.includes(id);
                
                let message = `${id}:`;
                message += ` getElementById=${elementById ? "âœ…" : "âŒ"}`;
                message += ` querySelector=${elementByQuery ? "âœ…" : "âŒ"}`;
                message += ` HTMLå†…=${elementInDOM ? "âœ…" : "âŒ"}`;
                
                const element = elementById || elementByQuery;
                if (element) {
                    // è¦ç´ ãŒå­˜åœ¨ã™ã‚‹å ´åˆã®è©³ç´°æƒ…å ±
                    const style = window.getComputedStyle(element);
                    const isVisible = style.display !== "none" && style.visibility !== "hidden";
                    message += ` è¡¨ç¤º=${isVisible ? "âœ…" : "âŒ"}`;
                    message += ` display=${style.display}`;
                    
                    // ãƒ—ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã®å ´åˆã¯å­è¦ç´ æ•°ã‚‚ãƒã‚§ãƒƒã‚¯
                    if (id === "url-preset-buttons") {
                        message += ` [å­è¦ç´ :${element.children.length}å€‹]`;
                    }
                } else if (elementInDOM) {
                    message += " âš ï¸HTMLå†…ã«ã¯å­˜åœ¨ã™ã‚‹ãŒJSã§æ¤œå‡ºä¸å¯";
                }
                
                window.updateDebugInfo(message);
            });
            
            // è¿½åŠ æƒ…å ±
            window.updateDebugInfo('=== ã‚·ã‚¹ãƒ†ãƒ æƒ…å ± ===');
            window.updateDebugInfo(`HtmlViewerManagerã‚¯ãƒ©ã‚¹: ${typeof HtmlViewerManager !== 'undefined' ? 'âœ…å®šç¾©æ¸ˆã¿' : 'âŒæœªå®šç¾©'}`);
            window.updateDebugInfo(`htmlViewerManagerã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹: ${window.htmlViewerManager ? 'âœ…å­˜åœ¨' : 'âŒãªã—'}`);
            
            // HTMLãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ã®è¦ªè¦ç´ ã®è¡¨ç¤ºçŠ¶æ…‹ç¢ºèª
            const htmlViewerViewStatus = document.getElementById('html-viewer-view');
            if (htmlViewerViewStatus) {
                const style = window.getComputedStyle(htmlViewerViewStatus);
                window.updateDebugInfo(`HTMLãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼è¡¨ç¤ºçŠ¶æ…‹: ${style.display}`);
                window.updateDebugInfo(`HTMLãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼å¯è¦–çŠ¶æ…‹: ${style.visibility}`);
            }
            
            // ç¾åœ¨ã®ã‚¿ãƒ–çŠ¶æ…‹ç¢ºèª
            const activeTab = document.querySelector('.tab-button.active');
            if (activeTab) {
                window.updateDebugInfo(`ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ãƒ–: ${activeTab.textContent.trim()}`);
                window.updateDebugInfo(`ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ãƒ–ã®data-view: ${activeTab.dataset.view}`);
            }
            
            // ğŸš€ ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹ç¢ºèª
            window.updateDebugInfo('=== ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹ç¢ºèª ===');
            const fileAccessTests = [
                { name: 'ãƒ¡ã‚¤ãƒ³ã‚µã‚¤ãƒˆ', url: 'http://localhost:8000/index.html' },
                { name: 'ç·¨é›†ãƒ¢ãƒ¼ãƒ‰', url: 'http://localhost:8000/index.html?edit=true' },
                { name: 'ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³', url: 'http://localhost:8000/timeline-experiment.html' }
            ];
            
            fileAccessTests.forEach(test => {
                // ç°¡å˜ãªã‚¢ã‚¯ã‚»ã‚¹ç¢ºèªï¼ˆå®Ÿéš›ã«ã¯ã“ã‚Œã¯éåŒæœŸã§å®Ÿè¡Œã•ã‚Œã‚‹ï¼‰
                window.updateDebugInfo(`â€¢ ${test.name}: ${test.url}`);
            });
            
            // ğŸš€ HTMLæ§‹æ–‡æ¤œè¨¼
            window.updateDebugInfo('=== HTMLæ§‹æ–‡æ¤œè¨¼ ===');
            const htmlContent = document.documentElement.outerHTML;
            
            // åŸºæœ¬çš„ãªæ§‹æ–‡ãƒã‚§ãƒƒã‚¯
            const tagMatches = htmlContent.match(/<[^>]+>/g) || [];
            const openTags = tagMatches.filter(tag => !tag.startsWith('</') && !tag.endsWith('/>')).length;
            const closeTags = tagMatches.filter(tag => tag.startsWith('</')).length;
            const selfClosingTags = tagMatches.filter(tag => tag.endsWith('/>')).length;
            
            window.updateDebugInfo(`é–‹å§‹ã‚¿ã‚°æ•°: ${openTags}`);
            window.updateDebugInfo(`çµ‚äº†ã‚¿ã‚°æ•°: ${closeTags}`);
            window.updateDebugInfo(`è‡ªå·±é–‰ã˜ã‚¿ã‚°æ•°: ${selfClosingTags}`);
            
            // é‡è¦è¦ç´ ã®å­˜åœ¨ç¢ºèª
            const criticalElements = [
                'html-viewer-view',
                'spine-editor-view',
                'url-preset-buttons'
            ];
            
            window.updateDebugInfo('é‡è¦è¦ç´ ã®HTMLå†…å­˜åœ¨ç¢ºèª:');
            criticalElements.forEach(id => {
                const exists = htmlContent.includes(`id="${id}"`);
                window.updateDebugInfo(`  â””â”€ ${id}: ${exists ? 'âœ…å­˜åœ¨' : 'âŒãªã—'}`);
            });
            
            window.updateDebugInfo('=== ãƒ‡ãƒãƒƒã‚°å®Œäº† ===');
        };
        
        // ãƒ—ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³è¡¨ç¤ºç¢ºèª
        window.checkPresetButtons = function() {
            const container = document.getElementById('url-preset-container');
            const buttons = document.getElementById('url-preset-buttons');
            
            updateDebugInfo(`ãƒ—ãƒªã‚»ãƒƒãƒˆã‚³ãƒ³ãƒ†ãƒŠ: ${container ? 'âœ…å­˜åœ¨' : 'âŒãªã—'}`);
            updateDebugInfo(`ãƒ—ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³: ${buttons ? 'âœ…å­˜åœ¨' : 'âŒãªã—'}`);
            
            if (buttons) {
                const buttonCount = buttons.children.length;
                updateDebugInfo(`ãƒœã‚¿ãƒ³æ•°: ${buttonCount}å€‹`);
                
                // ğŸš€ æ—¢å­˜ãƒœã‚¿ãƒ³ã®è©³ç´°æƒ…å ±ã‚‚è¡¨ç¤º
                if (buttonCount > 0) {
                    updateDebugInfo('æ—¢å­˜ãƒœã‚¿ãƒ³ãƒªã‚¹ãƒˆ:');
                    for (let i = 0; i < buttonCount; i++) {
                        const btn = buttons.children[i];
                        const onclick = btn.getAttribute('onclick');
                        updateDebugInfo(`  â””â”€ ãƒœã‚¿ãƒ³${i+1}: "${btn.textContent.trim()}" onclick="${onclick}"`);
                    }
                } else {
                    updateDebugInfo('ãƒœã‚¿ãƒ³ãŒè¦‹ã¤ã‹ã‚‰ãªã„ - æ‰‹å‹•ã§è¿½åŠ ã—ã¾ã™');
                    // ğŸš€ æ‰‹å‹•ã§ãƒ—ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã‚’è¿½åŠ ï¼ˆæ­£ã—ã„ãƒãƒ¼ãƒˆè¨­å®šï¼‰
                    buttons.innerHTML = `
                        <button class="btn btn-sm btn-outline-primary" style="margin-right: 5px; margin-bottom: 5px;" onclick="window.loadPresetUrl('http://localhost:8000/index.html')">ğŸŒŸ ãƒ¡ã‚¤ãƒ³ã‚µã‚¤ãƒˆ</button>
                        <button class="btn btn-sm btn-outline-primary" style="margin-right: 5px; margin-bottom: 5px;" onclick="window.loadPresetUrl('http://localhost:8000/index.html?edit=true')">ğŸ”§ ç·¨é›†ãƒ¢ãƒ¼ãƒ‰</button>
                        <button class="btn btn-sm btn-outline-primary" style="margin-right: 5px; margin-bottom: 5px;" onclick="window.loadPresetUrl('http://localhost:8000/timeline-experiment.html')">ğŸ¬ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</button>
                        <button class="btn btn-sm btn-outline-primary" style="margin-right: 5px; margin-bottom: 5px;" onclick="window.loadPresetUrl('http://localhost:8000/spine-positioning-system-explanation.html')">ğŸ¯ Spineç·¨é›†</button>
                        <button class="btn btn-sm btn-outline-primary" style="margin-right: 5px; margin-bottom: 5px;" onclick="window.loadPresetUrl('http://localhost:8000/test-minimal.html')">ğŸ”¬ ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ãƒ†ã‚¹ãƒˆ</button>
                        <div style="width: 100%; margin-top: 10px;">
                            <button class="btn btn-sm btn-outline-primary" style="margin-right: 5px;" onclick="window.htmlViewerManager?.selectLocalFile()">ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ</button>
                            <button class="btn btn-sm btn-outline-info" style="margin-right: 5px;" onclick="window.htmlViewerManager?.checkServerStatus()">ğŸ” ã‚µãƒ¼ãƒãƒ¼çŠ¶æ³</button>
                            <button class="btn btn-sm btn-outline-success" onclick="window.htmlViewerManager?.startServer()">ğŸš€ ã‚µãƒ¼ãƒãƒ¼èµ·å‹•</button>
                        </div>
                    `;
                    updateDebugInfo('ãƒ—ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã‚’æ‰‹å‹•è¿½åŠ ã—ã¾ã—ãŸ');
                    
                    // ğŸš€ è¿½åŠ å¾Œã®æ¤œè¨¼
                    setTimeout(() => {
                        const verifyCount = buttons.children.length;
                        updateDebugInfo(`è¿½åŠ æ¤œè¨¼: ãƒœã‚¿ãƒ³æ•°ã¯${verifyCount}å€‹ã«ãªã‚Šã¾ã—ãŸ`);
                    }, 100);
                }
            } else {
                updateDebugInfo('âŒ ãƒ—ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒ†ãƒŠãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                
                // ğŸš€ ç·Šæ€¥å¯¾å¿œ: html-viewer-viewå…¨ä½“ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã®ç¢ºèª
                const htmlViewerViewCheck = document.getElementById('html-viewer-view');
                if (!htmlViewerViewCheck) {
                    updateDebugInfo('ğŸš¨ é‡å¤§: html-viewer-viewè¦ç´ è‡ªä½“ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    updateDebugInfo('ğŸ’¡ åŸå› : HTMLãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ã¾ãŸã¯JavaScriptå®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®å•é¡Œ');
                    updateDebugInfo('ğŸ”§ å¯¾ç­–: HTMLãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ™‚ã«è¦ç´ çŠ¶æ…‹ã‚’å†ç¢ºèª');
                } else {
                    updateDebugInfo('html-viewer-viewã¯å­˜åœ¨ã™ã‚‹ãŒã€ãƒ—ãƒªã‚»ãƒƒãƒˆã‚³ãƒ³ãƒ†ãƒŠãŒè¦‹ã¤ã‹ã‚‰ãªã„');
                }
            }
        };
        
        // ãƒ—ãƒªã‚»ãƒƒãƒˆURLèª­ã¿è¾¼ã¿ç”¨ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°
        window.loadPresetUrl = function(url) {
            console.log('ğŸ”„ ãƒ—ãƒªã‚»ãƒƒãƒˆURLèª­ã¿è¾¼ã¿:', url);
            
            // ãƒ‡ãƒãƒƒã‚°æƒ…å ±æ›´æ–°
            if (window.updateDebugInfo) {
                window.updateDebugInfo(`ğŸ”— ãƒ—ãƒªã‚»ãƒƒãƒˆURLé¸æŠ: ${url}`);
            }
            
            const customUrlInput = document.getElementById('custom-url-input');
            const fileSelector = document.getElementById('html-file-selector');
            
            if (customUrlInput) {
                customUrlInput.value = url;
                window.updateDebugInfo('âœ… ã‚«ã‚¹ã‚¿ãƒ URLå…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«è¨­å®š');
            } else {
                window.updateDebugInfo('âŒ ã‚«ã‚¹ã‚¿ãƒ URLå…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
            
            if (fileSelector) {
                fileSelector.value = '';
                window.updateDebugInfo('âœ… ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã‚’ãƒªã‚»ãƒƒãƒˆ');
            } else {
                window.updateDebugInfo('âŒ ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
            
            // HTMLãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŒåˆ©ç”¨ã§ãã‚‹å ´åˆã¯è‡ªå‹•èª­ã¿è¾¼ã¿
            if (window.htmlViewerManager && typeof window.htmlViewerManager.loadSelectedPage === 'function') {
                window.updateDebugInfo('ğŸš€ HTMLãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼çµŒç”±ã§è‡ªå‹•èª­ã¿è¾¼ã¿å®Ÿè¡Œä¸­...');
                setTimeout(() => {
                    try {
                        window.htmlViewerManager.loadSelectedPage();
                        window.updateDebugInfo('âœ… è‡ªå‹•èª­ã¿è¾¼ã¿è¦æ±‚å®Œäº†');
                    } catch (error) {
                        window.updateDebugInfo('âŒ è‡ªå‹•èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ' + error.message);
                    }
                }, 200);
            } else {
                const reason = !window.htmlViewerManager ? 'HTMLãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŒæœªåˆæœŸåŒ–' : 
                              'loadSelectedPageé–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“';
                window.updateDebugInfo(`ğŸ’¡ ${reason} - URLã®ã¿è¨­å®šã—ã¾ã—ãŸ`);
                
                if (window.htmlViewerManager && typeof window.htmlViewerManager.showStatus === 'function') {
                    window.htmlViewerManager.showStatus(`URLè¨­å®š: ${url}`, 'info');
                }
            }
        };
        
        // ğŸš€ Electronã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢æ©Ÿèƒ½
        window.clearElectronCache = async function() {
            console.log('ğŸ§¹ Electronã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢é–‹å§‹...');
            
            if (window.updateDebugInfo) {
                window.updateDebugInfo('ğŸ§¹ Electronã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ä¸­...');
            }
            
            try {
                if (window.electronAPI && window.electronAPI.cache && window.electronAPI.cache.clear) {
                    const result = await window.electronAPI.cache.clear();
                    console.log('âœ… ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢çµæœ:', result);
                    
                    if (window.updateDebugInfo) {
                        if (result.success) {
                            window.updateDebugInfo(`âœ… ${result.message}`);
                        } else {
                            window.updateDebugInfo(`âŒ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢ã‚¨ãƒ©ãƒ¼: ${result.error}`);
                        }
                    }
                    
                    if (result.success) {
                        alert('âœ… ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢ãŒå®Œäº†ã—ã¾ã—ãŸ');
                    } else {
                        alert('âŒ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.error);
                    }
                } else {
                    console.error('âŒ electronAPI.cache.clear ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                    if (window.updateDebugInfo) {
                        window.updateDebugInfo('âŒ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢API ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                    }
                    alert('âŒ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢æ©Ÿèƒ½ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                }
            } catch (error) {
                console.error('âŒ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢å®Ÿè¡Œã‚¨ãƒ©ãƒ¼:', error);
                if (window.updateDebugInfo) {
                    window.updateDebugInfo(`âŒ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢å®Ÿè¡Œã‚¨ãƒ©ãƒ¼: ${error.message}`);
                }
                alert('âŒ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢å®Ÿè¡Œã‚¨ãƒ©ãƒ¼: ' + error.message);
            }
        };
        
        // ğŸ”„ Electronãƒãƒ¼ãƒ‰ãƒªãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½
        window.hardReloadApp = async function() {
            console.log('ğŸ”„ Electronãƒãƒ¼ãƒ‰ãƒªãƒ­ãƒ¼ãƒ‰é–‹å§‹...');
            
            if (window.updateDebugInfo) {
                window.updateDebugInfo('ğŸ”„ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã‚’ãƒãƒ¼ãƒ‰ãƒªãƒ­ãƒ¼ãƒ‰ä¸­...');
            }
            
            try {
                if (window.electronAPI && window.electronAPI.app && window.electronAPI.app.hardReload) {
                    // ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°
                    const confirmed = confirm('ğŸ”„ ãƒãƒ¼ãƒ‰ãƒªãƒ­ãƒ¼ãƒ‰ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢ï¼‰ã‚’å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿ\n\nç¾åœ¨ã®ä½œæ¥­å†…å®¹ã¯å¤±ã‚ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚');
                    if (!confirmed) {
                        console.log('ãƒãƒ¼ãƒ‰ãƒªãƒ­ãƒ¼ãƒ‰ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸ');
                        if (window.updateDebugInfo) {
                            window.updateDebugInfo('âš ï¸ ãƒãƒ¼ãƒ‰ãƒªãƒ­ãƒ¼ãƒ‰ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸ');
                        }
                        return;
                    }
                    
                    if (window.updateDebugInfo) {
                        window.updateDebugInfo('ğŸš€ ãƒãƒ¼ãƒ‰ãƒªãƒ­ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œä¸­ï¼ˆå°‘ã€…ãŠå¾…ã¡ãã ã•ã„ï¼‰...');
                    }
                    
                    // ãƒãƒ¼ãƒ‰ãƒªãƒ­ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œï¼ˆã“ã®å¾Œã¯ã‚¢ãƒ—ãƒªãŒå†èª­ã¿è¾¼ã¿ã•ã‚Œã‚‹ï¼‰
                    const result = await window.electronAPI.app.hardReload();
                    console.log('âœ… ãƒãƒ¼ãƒ‰ãƒªãƒ­ãƒ¼ãƒ‰çµæœ:', result);
                    
                    // é€šå¸¸ã€ã“ã®æ™‚ç‚¹ã§ã‚¢ãƒ—ãƒªã¯å†èª­ã¿è¾¼ã¿ã•ã‚Œã‚‹ãŸã‚ã€ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã¯å®Ÿè¡Œã•ã‚Œãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™
                    if (result.success) {
                        console.log('âœ… ãƒãƒ¼ãƒ‰ãƒªãƒ­ãƒ¼ãƒ‰å®Œäº†');
                    } else {
                        console.error('âŒ ãƒãƒ¼ãƒ‰ãƒªãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼:', result.error);
                        alert('âŒ ãƒãƒ¼ãƒ‰ãƒªãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.error);
                    }
                } else {
                    console.error('âŒ electronAPI.app.hardReload ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                    if (window.updateDebugInfo) {
                        window.updateDebugInfo('âŒ ãƒãƒ¼ãƒ‰ãƒªãƒ­ãƒ¼ãƒ‰API ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                    }
                    alert('âŒ ãƒãƒ¼ãƒ‰ãƒªãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                }
            } catch (error) {
                console.error('âŒ ãƒãƒ¼ãƒ‰ãƒªãƒ­ãƒ¼ãƒ‰å®Ÿè¡Œã‚¨ãƒ©ãƒ¼:', error);
                if (window.updateDebugInfo) {
                    window.updateDebugInfo(`âŒ ãƒãƒ¼ãƒ‰ãƒªãƒ­ãƒ¼ãƒ‰å®Ÿè¡Œã‚¨ãƒ©ãƒ¼: ${error.message}`);
                }
                alert('âŒ ãƒãƒ¼ãƒ‰ãƒªãƒ­ãƒ¼ãƒ‰å®Ÿè¡Œã‚¨ãƒ©ãƒ¼: ' + error.message);
            }
        };
        
        // ğŸš€ ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆè¨­å®š
        document.addEventListener('keydown', function(event) {
            // Ctrl+Shift+R or Cmd+Shift+R ã§ãƒãƒ¼ãƒ‰ãƒªãƒ­ãƒ¼ãƒ‰
            if ((event.ctrlKey || event.metaKey) && event.shiftKey && event.key === 'R') {
                event.preventDefault();
                console.log('âŒ¨ï¸ ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ: ãƒãƒ¼ãƒ‰ãƒªãƒ­ãƒ¼ãƒ‰å®Ÿè¡Œ');
                
                if (window.updateDebugInfo) {
                    window.updateDebugInfo('âŒ¨ï¸ Ctrl+Shift+R: ãƒãƒ¼ãƒ‰ãƒªãƒ­ãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ');
                }
                
                window.hardReloadApp();
                return false;
            }
            
            // F5ã§WebViewã®ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ï¼ˆHTMLãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªå ´åˆï¼‰
            if (event.key === 'F5') {
                const htmlViewerViewRefresh = document.getElementById('html-viewer-view');
                const webview = document.getElementById('html-webview');
                
                if (htmlViewerViewRefresh && htmlViewerViewRefresh.classList.contains('active') && webview) {
                    event.preventDefault();
                    console.log('âŒ¨ï¸ F5: WebViewãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥');
                    
                    if (window.updateDebugInfo) {
                        window.updateDebugInfo('âŒ¨ï¸ F5: WebViewãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥å®Ÿè¡Œ');
                    }
                    
                    try {
                        webview.reload();
                        if (window.updateDebugInfo) {
                            window.updateDebugInfo('âœ… WebViewãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥å®Œäº†');
                        }
                    } catch (error) {
                        console.error('âŒ WebViewãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã‚¨ãƒ©ãƒ¼:', error);
                        if (window.updateDebugInfo) {
                            window.updateDebugInfo(`âŒ WebViewãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                        }
                    }
                    return false;
                }
            }
        });
        
        console.log('âœ… è¶…ã‚·ãƒ³ãƒ—ãƒ«åˆæœŸåŒ–ã‚·ã‚¹ãƒ†ãƒ è¨­å®šå®Œäº†ï¼ˆã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆå«ã‚€ï¼‰');
    </script>
</body>
</html>