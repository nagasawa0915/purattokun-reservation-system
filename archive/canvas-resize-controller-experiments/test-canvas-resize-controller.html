<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ğŸ¯ CanvasResizeController ãƒã‚¤ã‚¯ãƒ­ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« ãƒ†ã‚¹ãƒˆ</title>
    <style>
      body {
        margin: 0;
        padding: 15px;
        font-family: Arial, sans-serif;
        background: #2c3e50;
        color: white;
        min-height: 100vh;
        font-size: 14px;
      }

      .container {
        width: 100%;
        margin: 0;
        padding: 0;
      }

      .header {
        text-align: center;
        margin-bottom: 30px;
      }

      .header h1 {
        font-size: 1.5em;
        margin: 0;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      }

      .subtitle {
        font-size: 0.9em;
        opacity: 0.9;
        margin-top: 5px;
      }

      .test-section {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        padding: 12px;
        margin: 10px 0;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .canvas-container {
        position: relative;
        width: 300px;
        height: 225px;
        margin: 10px auto;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        overflow: hidden;
      }

      #test-canvas {
        width: 100%;
        height: 100%;
        border-radius: 8px;
        background: rgba(0, 0, 0, 0.2);
      }

      .controls {
        display: grid;
        grid-template-columns: 1fr;
        gap: 10px;
        margin-top: 15px;
      }

      .control-group {
        background: rgba(255, 255, 255, 0.05);
        padding: 10px;
        border-radius: 6px;
      }

      .control-group h4 {
        margin: 0 0 8px 0;
        color: #ffd700;
        font-size: 14px;
      }

      .input-group {
        margin: 6px 0;
      }

      .input-group label {
        display: block;
        margin-bottom: 3px;
        font-size: 12px;
      }

      .input-group input {
        width: 100%;
        padding: 6px;
        border-radius: 4px;
        border: none;
        background: rgba(255, 255, 255, 0.9);
        color: #333;
        font-size: 12px;
        box-sizing: border-box;
      }

      .btn {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
        border: none;
        padding: 6px 10px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 11px;
        margin: 2px;
        transition: all 0.3s ease;
        display: inline-block;
        text-align: center;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      }

      .btn.primary {
        background: linear-gradient(45deg, #ff6b6b, #ee5a52);
      }

      .btn.success {
        background: linear-gradient(45deg, #51cf66, #40c057);
      }

      .info-display {
        background: rgba(0, 0, 0, 0.3);
        padding: 8px;
        border-radius: 4px;
        margin-top: 8px;
        font-family: monospace;
        font-size: 10px;
      }

      .log-area {
        background: rgba(0, 0, 0, 0.4);
        padding: 8px;
        border-radius: 4px;
        height: 120px;
        overflow-y: auto;
        font-family: monospace;
        font-size: 9px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        line-height: 1.2;
      }

      .status-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 6px;
        margin: 10px 0;
      }

      .status-item {
        background: rgba(255, 255, 255, 0.1);
        padding: 6px;
        border-radius: 4px;
        text-align: center;
      }

      .status-label {
        display: block;
        font-size: 10px;
        opacity: 0.8;
        margin-bottom: 3px;
      }

      .status-value {
        font-weight: bold;
        font-size: 11px;
      }

      /* ç¸¦æ¨ªæ¯”åˆ¶å¾¡UI */
      .aspect-ratio-controls {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
        margin: 10px 0;
      }

      .btn.aspect-locked {
        background: linear-gradient(45deg, #51cf66, #40c057);
        color: white;
      }

      .btn.aspect-unlocked {
        background: linear-gradient(45deg, #ff8c00, #ff7700);
        color: white;
      }

      #unified-scale-group {
        transition: opacity 0.3s ease;
      }

      #unified-scale-group.hidden {
        opacity: 0.3;
        pointer-events: none;
      }

      .scale-controls-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin: 15px 0 10px 0;
      }

      .scale-status {
        font-size: 0.9em;
        opacity: 0.8;
        font-style: italic;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
      <div class="header">
        <h1>ğŸ¯ CanvasResizeController ãƒã‚¤ã‚¯ãƒ­ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«</h1>
        <div class="subtitle">Canvas ã‚µã‚¤ã‚ºåˆ¶å¾¡å°‚ç”¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒ†ã‚¹ãƒˆç’°å¢ƒ</div>
      </div>

      <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º -->
      <div class="test-section">
        <h3>ğŸ“Š ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</h3>
        <div class="status-grid">
          <div class="status-item">
            <span class="status-label">ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«:</span>
            <span class="status-value" id="module-status">èª­ã¿è¾¼ã¿ä¸­</span>
          </div>
          <div class="status-item">
            <span class="status-label">Canvas ã‚µã‚¤ã‚º:</span>
            <span class="status-value" id="canvas-size">-</span>
          </div>
          <div class="status-item">
            <span class="status-label">è¡¨ç¤ºã‚µã‚¤ã‚º:</span>
            <span class="status-value" id="display-size">-</span>
          </div>
          <div class="status-item">
            <span class="status-label">æœ€å¾Œã®æ“ä½œ:</span>
            <span class="status-value" id="last-operation">æœªå®Ÿè¡Œ</span>
          </div>
        </div>
      </div>

      <!-- Canvasè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
      <div class="test-section">
        <h3>ğŸ¨ ãƒ†ã‚¹ãƒˆ Canvas</h3>
        <div class="canvas-container" id="canvas-container">
          <canvas id="test-canvas" width="300" height="225"></canvas>
        </div>
        
        <div class="info-display">
          <strong>ç¾åœ¨ã® Canvas æƒ…å ±:</strong>
          <div id="canvas-info">èª­ã¿è¾¼ã¿å¾…æ©Ÿä¸­...</div>
        </div>
      </div>

      <!-- æ“ä½œãƒ‘ãƒãƒ« -->
      <div class="test-section">
        <h3>ğŸ”§ æ“ä½œãƒ‘ãƒãƒ«</h3>
        <div class="controls">
          <!-- æ‰‹å‹•ãƒªã‚µã‚¤ã‚º -->
          <div class="control-group">
            <h4>ğŸ“ æ‰‹å‹•ãƒªã‚µã‚¤ã‚º</h4>
            <div class="input-group">
              <label>å¹… (px):</label>
              <input type="number" id="manual-width" value="400" min="100" max="1200">
            </div>
            <div class="input-group">
              <label>é«˜ã• (px):</label>
              <input type="number" id="manual-height" value="300" min="100" max="800">
            </div>
            <button class="btn primary" id="manual-resize">æ‰‹å‹•ãƒªã‚µã‚¤ã‚º</button>
            <button class="btn" id="reset-canvas">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™</button>
          </div>

          <!-- ãƒ—ãƒªã‚»ãƒƒãƒˆã‚µã‚¤ã‚º -->
          <div class="control-group">
            <h4>ğŸ“± ãƒ—ãƒªã‚»ãƒƒãƒˆã‚µã‚¤ã‚º</h4>
            <button class="btn" onclick="testResize(320, 240)">320x240</button>
            <button class="btn" onclick="testResize(640, 480)">640x480</button>
            <button class="btn" onclick="testResize(800, 600)">800x600</button>
            <button class="btn" onclick="testResize(1024, 768)">1024x768</button>
          </div>

          <!-- è¡¨ç¤ºã‚µã‚¤ã‚ºãƒ†ã‚¹ãƒˆ -->
          <div class="control-group">
            <h4>ğŸ¨ è¡¨ç¤ºã‚µã‚¤ã‚ºãƒ†ã‚¹ãƒˆ</h4>
            <div class="input-group">
              <label>è¡¨ç¤ºå¹… (px):</label>
              <input type="number" id="display-width" value="300" min="100" max="800">
            </div>
            <div class="input-group">
              <label>è¡¨ç¤ºé«˜ã• (px):</label>
              <input type="number" id="display-height" value="200" min="100" max="600">
            </div>
            <button class="btn success" id="change-display">è¡¨ç¤ºã‚µã‚¤ã‚ºå¤‰æ›´</button>
            <button class="btn" onclick="testDisplaySize(200, 150)">å° (200x150)</button>
            <button class="btn" onclick="testDisplaySize(500, 400)">å¤§ (500x400)</button>
          </div>

          <!-- ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åˆ¶å¾¡ãƒ†ã‚¹ãƒˆ -->
          <div class="control-group">
            <h4>âš–ï¸ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åˆ¶å¾¡ãƒ†ã‚¹ãƒˆ</h4>
            
            <!-- ç¸¦æ¨ªæ¯”åˆ¶å¾¡è¨­å®š -->
            <div class="input-group">
              <div class="aspect-ratio-controls">
                <button class="btn" id="aspect-lock-toggle" title="ç¸¦æ¨ªæ¯”ãƒ­ãƒƒã‚¯åˆ‡ã‚Šæ›¿ãˆ">ğŸ”— æ¯”ç‡ãƒ­ãƒƒã‚¯: ON</button>
                <button class="btn" id="reset-aspect" title="ç¸¦æ¨ªæ¯”ã‚’1:1ã«ãƒªã‚»ãƒƒãƒˆ">ğŸ“ æ¯”ç‡ãƒªã‚»ãƒƒãƒˆ</button>
              </div>
            </div>
            
            <!-- ã‚¹ã‚±ãƒ¼ãƒ«åˆ¶å¾¡ -->
            <div class="input-group">
              <label>Xè»¸ã‚¹ã‚±ãƒ¼ãƒ«: <span id="scale-x-display">1.0</span></label>
              <input type="range" id="character-scale-x" min="0.1" max="3.0" step="0.1" value="1.0">
            </div>
            <div class="input-group">
              <label>Yè»¸ã‚¹ã‚±ãƒ¼ãƒ«: <span id="scale-y-display">1.0</span></label>
              <input type="range" id="character-scale-y" min="0.1" max="3.0" step="0.1" value="1.0">
            </div>
            
            <!-- çµ±åˆã‚¹ã‚±ãƒ¼ãƒ«ï¼ˆç¸¦æ¨ªæ¯”ãƒ­ãƒƒã‚¯æ™‚ç”¨ï¼‰ -->
            <div class="input-group" id="unified-scale-group">
              <label>çµ±åˆã‚¹ã‚±ãƒ¼ãƒ«: <span id="scale-unified-display">1.0</span></label>
              <input type="range" id="character-scale-unified" min="0.1" max="3.0" step="0.1" value="1.0">
            </div>
            
            <!-- ä½ç½®åˆ¶å¾¡ -->
            <div class="input-group">
              <label>Xåº§æ¨™:</label>
              <input type="number" id="character-x" value="200" min="0" max="800" step="10">
            </div>
            <div class="input-group">
              <label>Yåº§æ¨™:</label>
              <input type="number" id="character-y" value="150" min="0" max="600" step="10">
            </div>
            
            <!-- æ“ä½œãƒœã‚¿ãƒ³ -->
            <div class="button-group">
              <button class="btn success" id="apply-character">ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šé©ç”¨</button>
              <button class="btn" id="center-character">ä¸­å¤®é…ç½®</button>
              <button class="btn" id="test-aspect-ratios">ç¸¦æ¨ªæ¯”ãƒ†ã‚¹ãƒˆ</button>
            </div>
          </div>

          <!-- ãƒ†ã‚¹ãƒˆæ©Ÿèƒ½ -->
          <div class="control-group">
            <h4>ğŸ§ª ãƒ†ã‚¹ãƒˆæ©Ÿèƒ½</h4>
            <button class="btn" id="test-webgl">WebGLå¯¾å¿œãƒ†ã‚¹ãƒˆ</button>
            <button class="btn" id="test-config">è¨­å®šå€¤ãƒ†ã‚¹ãƒˆ</button>
            <button class="btn" id="clear-log">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
            <button class="btn success" id="full-test">å…¨æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</button>
          </div>

          <!-- ğŸ¯ æ°¸ç¶šåŒ–æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ -->
          <div class="control-group">
            <h4>ğŸ’¾ SpineSettingsPersistence ãƒ†ã‚¹ãƒˆ</h4>
            <button class="btn" id="check-settings">ä¿å­˜è¨­å®šç¢ºèª</button>
            <button class="btn" id="clear-settings">ä¿å­˜è¨­å®šã‚¯ãƒªã‚¢</button>
            <button class="btn" id="restore-settings">è¨­å®šå¾©å…ƒãƒ†ã‚¹ãƒˆ</button>
          </div>
        </div>
      </div>

      <!-- ãƒ­ã‚°è¡¨ç¤º -->
      <div class="test-section">
        <h3>ğŸ“‹ å‹•ä½œãƒ­ã‚°</h3>
        <div class="log-area" id="log-area"></div>
      </div>
    </div>

    <!-- CanvasResizeController ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« -->
    <script src="micromodules/canvas-resize/CanvasResizeController.js"></script>
    
    <!-- SpineSettingsPersistence ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«çµ±åˆ -->
    <script src="micromodules/spine-settings-persistence/SpineSettingsPersistence.js"></script>

    <script>
      /**
       * ğŸ¯ CanvasResizeController ãƒã‚¤ã‚¯ãƒ­ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« ãƒ†ã‚¹ãƒˆç’°å¢ƒ
       * 
       * æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆé …ç›®:
       * 1. åŸºæœ¬ãƒªã‚µã‚¤ã‚ºæ©Ÿèƒ½
       * 2. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½  
       * 3. è¡¨ç¤ºã‚µã‚¤ã‚ºå¤‰æ›´æ©Ÿèƒ½
       * 4. WebGLå¯¾å¿œç¢ºèª
       * 5. è¨­å®šå€¤ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
       */
      class CanvasResizeControllerTest {
        constructor() {
          this.canvas = document.getElementById("test-canvas");
          this.logArea = document.getElementById("log-area");
          
          // CanvasResizeController ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
          this.resizer = new CanvasResizeController({
            canvas: this.canvas,
            spineRenderer: null, // ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯Spineãªã—
            onLog: (message) => this.addLog(message),
            onError: (message) => this.addLog(`ğŸ”´ ${message}`),
            enableLogging: true,
          });

          // ğŸ¯ SpineSettingsPersistence ãƒã‚¤ã‚¯ãƒ­ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«çµ±åˆ
          this.settingsPersistence = new SpineSettingsPersistence({
            debug: true, // ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°æœ‰åŠ¹
            version: '1.0'
          });
          this.testCharacterId = 'canvas-resize-test-character'; // ãƒ†ã‚¹ãƒˆç”¨ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ID

          // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åˆ¶å¾¡ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ¢ãƒƒã‚¯SpineRendererä½œæˆ
          this.createMockSpineRenderer();
          
          this.setupEventListeners();
          this.updateCanvasInfo();
          
          // ğŸ¯ åˆæœŸè¨­å®šå¾©å…ƒ
          this.restoreInitialSettings();
          
          this.addLog("ğŸš€ CanvasResizeController ãƒ†ã‚¹ãƒˆç’°å¢ƒ èµ·å‹•å®Œäº†");
          this.addLog("ğŸ¯ SpineSettingsPersistence çµ±åˆå®Œäº†");
          this.updateStatus("module-status", "æ­£å¸¸èª­ã¿è¾¼ã¿ + æ°¸ç¶šåŒ–å¯¾å¿œ");
        }

        setupEventListeners() {
          // æ‰‹å‹•ãƒªã‚µã‚¤ã‚º
          document.getElementById("manual-resize").addEventListener("click", () => {
            const width = parseInt(document.getElementById("manual-width").value);
            const height = parseInt(document.getElementById("manual-height").value);
            this.testManualResize(width, height);
          });

          // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒªã‚»ãƒƒãƒˆ
          document.getElementById("reset-canvas").addEventListener("click", () => {
            this.testReset();
          });

          // è¡¨ç¤ºã‚µã‚¤ã‚ºå¤‰æ›´
          document.getElementById("change-display").addEventListener("click", () => {
            const width = parseInt(document.getElementById("display-width").value);
            const height = parseInt(document.getElementById("display-height").value);
            this.testDisplaySizeChange(width, height);
          });

          // ãƒ†ã‚¹ãƒˆæ©Ÿèƒ½
          document.getElementById("test-webgl").addEventListener("click", () => {
            this.testWebGLSupport();
          });

          document.getElementById("test-config").addEventListener("click", () => {
            this.testConfiguration();
          });

          document.getElementById("clear-log").addEventListener("click", () => {
            this.clearLog();
          });

          document.getElementById("full-test").addEventListener("click", () => {
            this.runFullTest();
          });

          // ç¸¦æ¨ªæ¯”ãƒ­ãƒƒã‚¯åˆ¶å¾¡
          this.aspectRatioLocked = true;
          document.getElementById("aspect-lock-toggle").addEventListener("click", () => {
            this.toggleAspectRatioLock();
          });

          document.getElementById("reset-aspect").addEventListener("click", () => {
            this.resetAspectRatio();
          });

          // Xè»¸ã‚¹ã‚±ãƒ¼ãƒ«åˆ¶å¾¡
          document.getElementById("character-scale-x").addEventListener("input", (e) => {
            const value = parseFloat(e.target.value);
            document.getElementById("scale-x-display").textContent = value.toFixed(1);
            
            if (this.aspectRatioLocked) {
              // ç¸¦æ¨ªæ¯”ãƒ­ãƒƒã‚¯æ™‚ã¯Yè»¸ã‚‚åŒæœŸ
              document.getElementById("character-scale-y").value = value;
              document.getElementById("scale-y-display").textContent = value.toFixed(1);
              document.getElementById("character-scale-unified").value = value;
              document.getElementById("scale-unified-display").textContent = value.toFixed(1);
            }
            
            this.applyRealTimeScale();
          });

          // Yè»¸ã‚¹ã‚±ãƒ¼ãƒ«åˆ¶å¾¡
          document.getElementById("character-scale-y").addEventListener("input", (e) => {
            const value = parseFloat(e.target.value);
            document.getElementById("scale-y-display").textContent = value.toFixed(1);
            
            if (this.aspectRatioLocked) {
              // ç¸¦æ¨ªæ¯”ãƒ­ãƒƒã‚¯æ™‚ã¯Xè»¸ã‚‚åŒæœŸ
              document.getElementById("character-scale-x").value = value;
              document.getElementById("scale-x-display").textContent = value.toFixed(1);
              document.getElementById("character-scale-unified").value = value;
              document.getElementById("scale-unified-display").textContent = value.toFixed(1);
            }
            
            this.applyRealTimeScale();
          });

          // çµ±åˆã‚¹ã‚±ãƒ¼ãƒ«åˆ¶å¾¡ï¼ˆç¸¦æ¨ªæ¯”ãƒ­ãƒƒã‚¯æ™‚ï¼‰
          document.getElementById("character-scale-unified").addEventListener("input", (e) => {
            const value = parseFloat(e.target.value);
            document.getElementById("scale-unified-display").textContent = value.toFixed(1);
            
            if (this.aspectRatioLocked) {
              // ä¸¡è»¸ã‚’åŒæœŸ
              document.getElementById("character-scale-x").value = value;
              document.getElementById("scale-x-display").textContent = value.toFixed(1);
              document.getElementById("character-scale-y").value = value;
              document.getElementById("scale-y-display").textContent = value.toFixed(1);
            }
            
            this.applyRealTimeScale();
          });

          document.getElementById("apply-character").addEventListener("click", () => {
            const scaleX = parseFloat(document.getElementById("character-scale-x").value);
            const scaleY = parseFloat(document.getElementById("character-scale-y").value);
            const x = parseInt(document.getElementById("character-x").value);
            const y = parseInt(document.getElementById("character-y").value);
            this.testIndependentScaleControl(scaleX, scaleY, x, y);
          });

          document.getElementById("center-character").addEventListener("click", () => {
            this.testCharacterCenter();
          });

          document.getElementById("test-aspect-ratios").addEventListener("click", () => {
            this.testAspectRatioPresets();
          });

          // ğŸ¯ SpineSettingsPersistence ãƒ†ã‚¹ãƒˆæ©Ÿèƒ½
          document.getElementById("check-settings").addEventListener("click", () => {
            this.checkSavedSettings();
          });

          document.getElementById("clear-settings").addEventListener("click", () => {
            this.clearAllSettings();
          });

          document.getElementById("restore-settings").addEventListener("click", () => {
            this.restoreInitialSettings();
          });
        }

        // ğŸ”§ æ‰‹å‹•ãƒªã‚µã‚¤ã‚ºãƒ†ã‚¹ãƒˆ
        testManualResize(width, height) {
          this.addLog(`\nğŸ”„ æ‰‹å‹•ãƒªã‚µã‚¤ã‚ºãƒ†ã‚¹ãƒˆ: ${width}x${height}`);
          
          // v2.0ã§ã¯æ­£æ–¹å½¢ãƒªã‚µã‚¤ã‚ºã®ã¿ã‚µãƒãƒ¼ãƒˆ
          const size = Math.max(width, height);
          const result = this.resizer.resizeCanvas(size);
          
          if (result) {
            this.updateStatus("last-operation", `æ‰‹å‹•ãƒªã‚µã‚¤ã‚º ${size}x${size}`);
            this.addLog(`âœ… æ‰‹å‹•ãƒªã‚µã‚¤ã‚ºæˆåŠŸï¼ˆæ­£æ–¹å½¢: ${size}x${size}ï¼‰`);
            
            // ğŸ¯ Canvasè¨­å®šè‡ªå‹•ä¿å­˜
            this.saveCanvasSettings(size);
            
            // ãƒªã‚µã‚¤ã‚ºå¾Œã«ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’å†æç”»
            this.drawMockCharacter();
          } else {
            this.addLog(`âŒ æ‰‹å‹•ãƒªã‚µã‚¤ã‚ºå¤±æ•—`);
          }
          
          this.updateCanvasInfo();
        }

        // ğŸ”„ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒªã‚»ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
        testReset() {
          this.addLog(`\nğŸ”„ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒªã‚»ãƒƒãƒˆãƒ†ã‚¹ãƒˆ`);
          
          const result = this.resizer.resetCanvas();
          
          if (result) {
            this.updateStatus("last-operation", "ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒªã‚»ãƒƒãƒˆ");
            this.addLog(`âœ… ãƒªã‚»ãƒƒãƒˆæˆåŠŸ`);
            // ãƒªã‚»ãƒƒãƒˆå¾Œã«ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’å†æç”»
            this.drawMockCharacter();
          } else {
            this.addLog(`âŒ ãƒªã‚»ãƒƒãƒˆå¤±æ•—`);
          }
          
          this.updateCanvasInfo();
        }

        // ğŸ¨ è¡¨ç¤ºã‚µã‚¤ã‚ºå¤‰æ›´ãƒ†ã‚¹ãƒˆ
        testDisplaySizeChange(displayWidth, displayHeight) {
          this.addLog(`\nğŸ¨ è¡¨ç¤ºã‚µã‚¤ã‚ºå¤‰æ›´ãƒ†ã‚¹ãƒˆ: ${displayWidth}x${displayHeight}`);
          
          // v2.0ã§ã¯å›ºå®šè¡¨ç¤ºã‚µã‚¤ã‚ºã¨Canvasè§£åƒåº¦ã®çµ„ã¿åˆã‚ã›ã§åˆ¶å¾¡
          const size = Math.max(displayWidth, displayHeight);
          
          // Canvasè§£åƒåº¦å¤‰æ›´
          const resizeResult = this.resizer.resizeCanvas(size);
          
          if (resizeResult) {
            // è¡¨ç¤ºã‚µã‚¤ã‚ºè¨­å®šï¼ˆCanvas ManagerçµŒç”±ï¼‰
            if (this.resizer.canvasManager) {
              this.resizer.canvasManager.setFixedDisplaySize(size);
            }
            
            this.updateStatus("last-operation", `è¡¨ç¤ºã‚µã‚¤ã‚ºå¤‰æ›´ ${size}x${size}`);
            this.addLog(`âœ… è¡¨ç¤ºã‚µã‚¤ã‚ºå¤‰æ›´æˆåŠŸï¼ˆæ­£æ–¹å½¢: ${size}x${size}ï¼‰`);
            this.addLog(`ğŸ“ çµæœ: Canvasè§£åƒåº¦${size}x${size}, è¡¨ç¤ºã‚µã‚¤ã‚º${size}x${size}px`);
            
            // ğŸ¯ Canvasè¨­å®šè‡ªå‹•ä¿å­˜
            this.saveCanvasSettings(size);
            
            // ã‚µã‚¤ã‚ºå¤‰æ›´å¾Œã«ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’å†æç”»
            this.drawMockCharacter();
          } else {
            this.addLog(`âŒ è¡¨ç¤ºã‚µã‚¤ã‚ºå¤‰æ›´å¤±æ•—`);
          }
          
          this.updateCanvasInfo();
        }

        // ğŸ”§ WebGLå¯¾å¿œãƒ†ã‚¹ãƒˆ
        testWebGLSupport() {
          this.addLog(`\nğŸ”§ WebGLå¯¾å¿œãƒ†ã‚¹ãƒˆ`);
          
          // WebGLã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä½œæˆãƒ†ã‚¹ãƒˆ
          const gl = this.canvas.getContext("webgl", { premultipliedAlpha: true }) || 
                     this.canvas.getContext("webgl2", { premultipliedAlpha: true });
          
          if (gl) {
            this.addLog(`âœ… WebGLã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä½œæˆæˆåŠŸï¼ˆé€æ˜èƒŒæ™¯å¯¾å¿œï¼‰`);
            this.addLog(`ğŸ“ WebGLãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆ: ${gl.drawingBufferWidth}x${gl.drawingBufferHeight}`);
            
            // é€æ˜èƒŒæ™¯è¨­å®š
            gl.clearColor(0, 0, 0, 0);
            gl.clear(gl.COLOR_BUFFER_BIT);
            
            // ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆæ›´æ–°ãƒ†ã‚¹ãƒˆï¼ˆv2.0 APIä½¿ç”¨ï¼‰
            if (this.resizer && this.resizer.canvasManager) {
              this.resizer.canvasManager.updateWebGLViewport();
            }
            this.updateStatus("last-operation", "WebGLå¯¾å¿œãƒ†ã‚¹ãƒˆ");
          } else {
            this.addLog(`âŒ WebGLã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä½œæˆå¤±æ•—`);
          }
        }

        // âš™ï¸ è¨­å®šå€¤ãƒ†ã‚¹ãƒˆ
        testConfiguration() {
          this.addLog(`\nâš™ï¸ è¨­å®šå€¤ãƒ†ã‚¹ãƒˆ`);
          
          // ç¾åœ¨ã®è¨­å®šã‚’è¡¨ç¤ºï¼ˆv2.0 APIä½¿ç”¨ï¼‰
          const currentState = this.resizer.getState();
          this.addLog(`ğŸ“‹ ç¾åœ¨ã®è¨­å®š:`);
          this.addLog(`   ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚µã‚¤ã‚º: ${currentState.config.defaultSize}px`);
          this.addLog(`   å›ºå®šè¡¨ç¤ºã‚µã‚¤ã‚º: ${currentState.config.fixedDisplaySize}px`);
          this.addLog(`   é€æ˜èƒŒæ™¯: ${currentState.config.transparentBackground}`);
          this.addLog(`   BBçµ±åˆæ©Ÿèƒ½: ${currentState.config.enableBB}`);
          
          // è¨­å®šå€¤å¤‰æ›´ãƒ†ã‚¹ãƒˆ
          this.resizer.updateConfig({
            defaultSize: 300,
            fixedDisplaySize: 250,
          });
          
          const newState = this.resizer.getState();
          this.addLog(`ğŸ”„ è¨­å®šå¤‰æ›´å¾Œ:`);
          this.addLog(`   ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚µã‚¤ã‚º: ${newState.config.defaultSize}px`);
          this.addLog(`   å›ºå®šè¡¨ç¤ºã‚µã‚¤ã‚º: ${newState.config.fixedDisplaySize}px`);
          
          this.updateStatus("last-operation", "è¨­å®šå€¤ãƒ†ã‚¹ãƒˆ");
        }

        // âš–ï¸ ç‹¬ç«‹ã‚¹ã‚±ãƒ¼ãƒ«åˆ¶å¾¡ãƒ†ã‚¹ãƒˆ
        testIndependentScaleControl(scaleX, scaleY, x, y) {
          this.addLog(`\nâš–ï¸ ç‹¬ç«‹ã‚¹ã‚±ãƒ¼ãƒ«åˆ¶å¾¡ãƒ†ã‚¹ãƒˆ: Xè»¸${scaleX}, Yè»¸${scaleY}, ä½ç½®(${x}, ${y})`);
          
          let success = true;
          
          // ç‹¬ç«‹ã‚¹ã‚±ãƒ¼ãƒ«è¨­å®š
          if (scaleX !== undefined && scaleY !== undefined) {
            this.mockSkeleton.scaleX = scaleX;
            this.mockSkeleton.scaleY = scaleY;
            this.addLog(`âœ… ç‹¬ç«‹ã‚¹ã‚±ãƒ¼ãƒ«è¨­å®šæˆåŠŸ: Xè»¸${scaleX}, Yè»¸${scaleY}`);
            
            // ğŸ¯ ã‚¹ã‚±ãƒ¼ãƒ«è¨­å®šè‡ªå‹•ä¿å­˜
            this.saveScaleSettings(scaleX, scaleY);
            
            // ç¸¦æ¨ªæ¯”ã®è¨ˆç®—ã¨è¡¨ç¤º
            const aspectRatio = (scaleX / scaleY).toFixed(2);
            this.addLog(`ğŸ“ ç¾åœ¨ã®ç¸¦æ¨ªæ¯”: ${aspectRatio} (X:Y = ${scaleX}:${scaleY})`);
          }
          
          // ä½ç½®è¨­å®š
          if (x !== undefined && y !== undefined) {
            this.mockSkeleton.x = x;
            this.mockSkeleton.y = y;
            this.addLog(`âœ… ä½ç½®è¨­å®šæˆåŠŸ: (${x}, ${y})`);
            
            // ğŸ¯ ä½ç½®è¨­å®šè‡ªå‹•ä¿å­˜
            this.savePositionSettings(x, y);
          }
          
          if (success) {
            const statusText = `ç‹¬ç«‹ã‚¹ã‚±ãƒ¼ãƒ« X:${scaleX} Y:${scaleY}${x !== undefined ? ` ä½ç½®(${x},${y})` : ''}`;
            this.updateStatus("last-operation", statusText);
            // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å†æç”»
            this.drawMockCharacter();
          }
          
          this.updateCanvasInfo();
          return success;
        }

        // ğŸ”— ç¸¦æ¨ªæ¯”ãƒ­ãƒƒã‚¯åˆ‡ã‚Šæ›¿ãˆ
        toggleAspectRatioLock() {
          this.aspectRatioLocked = !this.aspectRatioLocked;
          const button = document.getElementById("aspect-lock-toggle");
          const unifiedGroup = document.getElementById("unified-scale-group");
          
          if (this.aspectRatioLocked) {
            button.textContent = "ğŸ”— æ¯”ç‡ãƒ­ãƒƒã‚¯: ON";
            button.classList.remove("aspect-unlocked");
            button.classList.add("aspect-locked");
            unifiedGroup.classList.remove("hidden");
            
            // ãƒ­ãƒƒã‚¯æ™‚ã¯ç¾åœ¨ã®Xè»¸å€¤ã§Yè»¸ã‚’åŒæœŸ
            const currentX = parseFloat(document.getElementById("character-scale-x").value);
            document.getElementById("character-scale-y").value = currentX;
            document.getElementById("scale-y-display").textContent = currentX.toFixed(1);
            document.getElementById("character-scale-unified").value = currentX;
            document.getElementById("scale-unified-display").textContent = currentX.toFixed(1);
            
            this.addLog("ğŸ”— ç¸¦æ¨ªæ¯”ãƒ­ãƒƒã‚¯: ON - Xè»¸ã®å€¤ã§Yè»¸ã‚’çµ±ä¸€ã—ã¾ã—ãŸ");
          } else {
            button.textContent = "ğŸ”“ æ¯”ç‡ãƒ­ãƒƒã‚¯: OFF";
            button.classList.remove("aspect-locked");
            button.classList.add("aspect-unlocked");
            unifiedGroup.classList.add("hidden");
            
            this.addLog("ğŸ”“ ç¸¦æ¨ªæ¯”ãƒ­ãƒƒã‚¯: OFF - Xè»¸ã¨Yè»¸ã‚’ç‹¬ç«‹åˆ¶å¾¡ã§ãã¾ã™");
          }
          
          this.applyRealTimeScale();
        }

        // ğŸ“ ç¸¦æ¨ªæ¯”ãƒªã‚»ãƒƒãƒˆ
        resetAspectRatio() {
          this.addLog("\nğŸ“ ç¸¦æ¨ªæ¯”ãƒªã‚»ãƒƒãƒˆ: 1:1ã«è¨­å®š");
          
          // ä¸¡è»¸ã‚’1.0ã«è¨­å®š
          document.getElementById("character-scale-x").value = 1.0;
          document.getElementById("scale-x-display").textContent = "1.0";
          document.getElementById("character-scale-y").value = 1.0;
          document.getElementById("scale-y-display").textContent = "1.0";
          document.getElementById("character-scale-unified").value = 1.0;
          document.getElementById("scale-unified-display").textContent = "1.0";
          
          this.mockSkeleton.scaleX = 1.0;
          this.mockSkeleton.scaleY = 1.0;
          
          this.addLog("âœ… ç¸¦æ¨ªæ¯”ãƒªã‚»ãƒƒãƒˆå®Œäº†: æ­£æ–¹å½¢ï¼ˆ1:1ï¼‰");
          this.drawMockCharacter();
          this.updateStatus("last-operation", "ç¸¦æ¨ªæ¯”ãƒªã‚»ãƒƒãƒˆ");
        }

        // âš¡ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¹ã‚±ãƒ¼ãƒ«é©ç”¨
        applyRealTimeScale() {
          const scaleX = parseFloat(document.getElementById("character-scale-x").value);
          const scaleY = parseFloat(document.getElementById("character-scale-y").value);
          
          this.mockSkeleton.scaleX = scaleX;
          this.mockSkeleton.scaleY = scaleY;
          
          // ğŸ¯ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¹ã‚±ãƒ¼ãƒ«è¨­å®šè‡ªå‹•ä¿å­˜
          this.saveScaleSettings(scaleX, scaleY);
          
          // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æç”»æ›´æ–°
          this.drawMockCharacter();
          
          // ç¸¦æ¨ªæ¯”æƒ…å ±ã‚’æ›´æ–°
          const aspectRatio = (scaleX / scaleY).toFixed(2);
          this.updateStatus("canvas-size", `${this.canvas.width}x${this.canvas.height} (æ¯”ç‡:${aspectRatio})`);
        }

        // ğŸ­ ç¸¦æ¨ªæ¯”ãƒ—ãƒªã‚»ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
        testAspectRatioPresets() {
          this.addLog("\nğŸ­ ç¸¦æ¨ªæ¯”ãƒ—ãƒªã‚»ãƒƒãƒˆãƒ†ã‚¹ãƒˆé–‹å§‹");
          
          const presets = [
            { name: "æ­£æ–¹å½¢", x: 1.0, y: 1.0 },
            { name: "æ¨ªé•· (16:9)", x: 1.6, y: 0.9 },
            { name: "ç¸¦é•· (9:16)", x: 0.9, y: 1.6 },
            { name: "è¶…æ¨ªé•· (21:9)", x: 2.1, y: 0.9 },
            { name: "è¶…ç¸¦é•·", x: 0.5, y: 2.0 },
          ];
          
          let currentIndex = 0;
          
          const testNextPreset = () => {
            if (currentIndex >= presets.length) {
              this.addLog("ğŸ‰ ç¸¦æ¨ªæ¯”ãƒ—ãƒªã‚»ãƒƒãƒˆãƒ†ã‚¹ãƒˆå®Œäº†");
              this.resetAspectRatio();
              return;
            }
            
            const preset = presets[currentIndex];
            this.addLog(`ğŸ“ ãƒ†ã‚¹ãƒˆ${currentIndex + 1}: ${preset.name} (${preset.x}:${preset.y})`);
            
            // ç¸¦æ¨ªæ¯”ãƒ­ãƒƒã‚¯ã‚’è§£é™¤
            if (this.aspectRatioLocked) {
              this.toggleAspectRatioLock();
            }
            
            // ãƒ—ãƒªã‚»ãƒƒãƒˆå€¤ã‚’è¨­å®š
            document.getElementById("character-scale-x").value = preset.x;
            document.getElementById("scale-x-display").textContent = preset.x.toFixed(1);
            document.getElementById("character-scale-y").value = preset.y;
            document.getElementById("scale-y-display").textContent = preset.y.toFixed(1);
            
            this.applyRealTimeScale();
            
            currentIndex++;
            setTimeout(testNextPreset, 1500); // 1.5ç§’é–“éš”ã§æ¬¡ã®ãƒ—ãƒªã‚»ãƒƒãƒˆ
          };
          
          testNextPreset();
          this.updateStatus("last-operation", "ç¸¦æ¨ªæ¯”ãƒ—ãƒªã‚»ãƒƒãƒˆãƒ†ã‚¹ãƒˆ");
        }

        // ğŸ¯ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ä¸­å¤®é…ç½®ãƒ†ã‚¹ãƒˆ
        testCharacterCenter() {
          this.addLog(`\nğŸ¯ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ä¸­å¤®é…ç½®ãƒ†ã‚¹ãƒˆ`);
          
          const result = this.resizer.centerCharacter();
          
          if (result) {
            this.updateStatus("last-operation", "ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ä¸­å¤®é…ç½®");
            this.addLog(`âœ… ä¸­å¤®é…ç½®æˆåŠŸ`);
            // ä¸­å¤®é…ç½®å¾Œã«ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’å†æç”»
            this.drawMockCharacter();
          } else {
            this.addLog(`âŒ ä¸­å¤®é…ç½®å¤±æ•—`);
          }
          
          this.updateCanvasInfo();
          return result;
        }

        // ğŸ§ª å…¨æ©Ÿèƒ½ç·åˆãƒ†ã‚¹ãƒˆ
        async runFullTest() {
          this.addLog(`\nğŸ§ª å…¨æ©Ÿèƒ½ç·åˆãƒ†ã‚¹ãƒˆé–‹å§‹ï¼ˆç‹¬ç«‹ã‚¹ã‚±ãƒ¼ãƒ«åˆ¶å¾¡å¯¾å¿œç‰ˆï¼‰`);
          
          // ãƒ†ã‚¹ãƒˆã‚·ãƒ¼ã‚±ãƒ³ã‚¹
          const tests = [
            () => this.testManualResize(320, 240),
            () => new Promise(r => setTimeout(r, 1000)),
            () => this.testIndependentScaleControl(0.5, 0.8, 100, 100),
            () => new Promise(r => setTimeout(r, 1500)),
            () => this.testManualResize(640, 480),
            () => new Promise(r => setTimeout(r, 1000)),
            () => this.testIndependentScaleControl(2.0, 1.2, 300, 200),
            () => new Promise(r => setTimeout(r, 1500)),
            () => this.toggleAspectRatioLock(), // ç¸¦æ¨ªæ¯”ãƒ­ãƒƒã‚¯è§£é™¤
            () => new Promise(r => setTimeout(r, 500)),
            () => this.testIndependentScaleControl(1.5, 0.7, 200, 150), // æ¨ªé•·ãƒ†ã‚¹ãƒˆ
            () => new Promise(r => setTimeout(r, 1500)),
            () => this.testIndependentScaleControl(0.6, 1.8, 200, 150), // ç¸¦é•·ãƒ†ã‚¹ãƒˆ
            () => new Promise(r => setTimeout(r, 1500)),
            () => this.testCharacterCenter(),
            () => new Promise(r => setTimeout(r, 1000)),
            () => this.resetAspectRatio(), // ç¸¦æ¨ªæ¯”ãƒªã‚»ãƒƒãƒˆ
            () => new Promise(r => setTimeout(r, 1000)),
            () => this.toggleAspectRatioLock(), // ç¸¦æ¨ªæ¯”ãƒ­ãƒƒã‚¯å†æœ‰åŠ¹åŒ–
            () => new Promise(r => setTimeout(r, 500)),
            () => this.testDisplaySizeChange(300, 200),
            () => new Promise(r => setTimeout(r, 1000)),
            () => this.testReset(),
            () => new Promise(r => setTimeout(r, 1000)),
            () => this.testWebGLSupport(),
            () => this.testConfiguration(),
          ];
          
          for (const test of tests) {
            await test();
          }
          
          this.addLog(`ğŸ‰ å…¨æ©Ÿèƒ½ç·åˆãƒ†ã‚¹ãƒˆå®Œäº†ï¼ˆç‹¬ç«‹ã‚¹ã‚±ãƒ¼ãƒ«åˆ¶å¾¡æ©Ÿèƒ½ã‚’å«ã‚€ï¼‰`);
          this.updateStatus("last-operation", "å…¨æ©Ÿèƒ½ç·åˆãƒ†ã‚¹ãƒˆï¼ˆç‹¬ç«‹ã‚¹ã‚±ãƒ¼ãƒ«ç‰ˆï¼‰");
        }

        // ğŸ“Š Canvasæƒ…å ±æ›´æ–°
        updateCanvasInfo() {
          const canvas = this.canvas;
          const container = document.getElementById("canvas-container");
          
          const info = `
Canvasç‰©ç†ã‚µã‚¤ã‚º: ${canvas.width} x ${canvas.height}px
Canvas CSS ã‚µã‚¤ã‚º: ${canvas.style.width || 'auto'} x ${canvas.style.height || 'auto'}
ã‚³ãƒ³ãƒ†ãƒŠã‚µã‚¤ã‚º: ${container.offsetWidth} x ${container.offsetHeight}px
          `.trim();
          
          document.getElementById("canvas-info").textContent = info;
          this.updateStatus("canvas-size", `${canvas.width}x${canvas.height}`);
          this.updateStatus("display-size", `${container.offsetWidth}x${container.offsetHeight}`);
        }

        // ğŸ“‹ ãƒ­ã‚°è¿½åŠ 
        addLog(message) {
          const timestamp = new Date().toLocaleTimeString();
          this.logArea.innerHTML += `[${timestamp}] ${message}\n`;
          this.logArea.scrollTop = this.logArea.scrollHeight;
        }

        // ğŸ—‘ï¸ ãƒ­ã‚°ã‚¯ãƒªã‚¢
        clearLog() {
          this.logArea.innerHTML = "";
          this.addLog("ğŸ“‹ ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ");
        }

        // ğŸ­ ãƒ¢ãƒƒã‚¯SpineRendererä½œæˆï¼ˆã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åˆ¶å¾¡ãƒ†ã‚¹ãƒˆç”¨ï¼‰
        createMockSpineRenderer() {
          this.mockSkeleton = {
            scaleX: 1.0,
            scaleY: 1.0,
            x: this.canvas.width / 2,
            y: this.canvas.height / 2
          };

          this.mockSpineRenderer = {
            skeleton: this.mockSkeleton
          };

          // CanvasResizeControllerã«ãƒ¢ãƒƒã‚¯SpineRendererã‚’è¨­å®š
          this.resizer.spineRenderer = this.mockSpineRenderer;
          this.resizer.characterController.spineRenderer = this.mockSpineRenderer;

          this.addLog("ğŸ­ ãƒ¢ãƒƒã‚¯SpineRendererä½œæˆå®Œäº†");
          this.drawMockCharacter();
        }

        // ğŸ¨ ãƒ¢ãƒƒã‚¯ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æç”»ï¼ˆç‹¬ç«‹ã‚¹ã‚±ãƒ¼ãƒ«å¯¾å¿œï¼‰
        drawMockCharacter() {
          const ctx = this.canvas.getContext('2d');
          if (!ctx) return;

          // Canvas ã‚’ã‚¯ãƒªã‚¢
          ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

          // èƒŒæ™¯ã«ã‚°ãƒªãƒƒãƒ‰æç”»ï¼ˆç¸¦æ¨ªæ¯”ã®ç¢ºèªç”¨ï¼‰
          this.drawGrid(ctx);

          // ãƒ¢ãƒƒã‚¯ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ï¼ˆæ¥•å††ï¼‰ã‚’æç”»
          ctx.save();
          
          // ã‚¹ã‚±ãƒ¼ãƒ«ã¨ä½ç½®ã‚’é©ç”¨
          const skeleton = this.mockSkeleton;
          const baseSize = 30; // åŸºæœ¬ã‚µã‚¤ã‚º30px
          const radiusX = baseSize * skeleton.scaleX;
          const radiusY = baseSize * skeleton.scaleY;
          
          ctx.fillStyle = '#ff6b6b';
          ctx.strokeStyle = '#ee5a52';
          ctx.lineWidth = 3;
          
          // æ¥•å††ã‚’æç”»ï¼ˆç‹¬ç«‹ã‚¹ã‚±ãƒ¼ãƒ«å¯¾å¿œï¼‰
          ctx.beginPath();
          ctx.ellipse(skeleton.x, skeleton.y, radiusX, radiusY, 0, 0, 2 * Math.PI);
          ctx.fill();
          ctx.stroke();
          
          // ç›®ã‚’æç”»ï¼ˆæ¥•å††å½¢ã«å¯¾å¿œï¼‰
          ctx.fillStyle = 'white';
          const eyeRadiusX = radiusX / 6;
          const eyeRadiusY = radiusY / 6;
          const eyeOffsetX = radiusX / 3;
          const eyeOffsetY = radiusY / 3;
          
          ctx.beginPath();
          ctx.ellipse(skeleton.x - eyeOffsetX, skeleton.y - eyeOffsetY, eyeRadiusX, eyeRadiusY, 0, 0, 2 * Math.PI);
          ctx.fill();
          ctx.beginPath();
          ctx.ellipse(skeleton.x + eyeOffsetX, skeleton.y - eyeOffsetY, eyeRadiusX, eyeRadiusY, 0, 0, 2 * Math.PI);
          ctx.fill();
          
          // ç³ã‚’æç”»
          ctx.fillStyle = 'black';
          const pupilRadiusX = radiusX / 12;
          const pupilRadiusY = radiusY / 12;
          
          ctx.beginPath();
          ctx.ellipse(skeleton.x - eyeOffsetX, skeleton.y - eyeOffsetY, pupilRadiusX, pupilRadiusY, 0, 0, 2 * Math.PI);
          ctx.fill();
          ctx.beginPath();
          ctx.ellipse(skeleton.x + eyeOffsetX, skeleton.y - eyeOffsetY, pupilRadiusX, pupilRadiusY, 0, 0, 2 * Math.PI);
          ctx.fill();

          // ã‚¹ã‚±ãƒ¼ãƒ«æƒ…å ±ã‚’è¡¨ç¤º
          ctx.fillStyle = 'white';
          ctx.font = '14px Arial';
          ctx.fillText(`X: ${skeleton.scaleX.toFixed(1)}`, skeleton.x - radiusX, skeleton.y + radiusY + 20);
          ctx.fillText(`Y: ${skeleton.scaleY.toFixed(1)}`, skeleton.x + radiusX - 40, skeleton.y + radiusY + 20);
          
          // ç¸¦æ¨ªæ¯”è¡¨ç¤º
          const aspectRatio = (skeleton.scaleX / skeleton.scaleY).toFixed(2);
          ctx.fillText(`æ¯”ç‡: ${aspectRatio}`, skeleton.x - 30, skeleton.y + radiusY + 40);

          ctx.restore();
        }

        // ğŸ“ ã‚°ãƒªãƒƒãƒ‰æç”»ï¼ˆç¸¦æ¨ªæ¯”ç¢ºèªç”¨ï¼‰
        drawGrid(ctx) {
          ctx.save();
          ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
          ctx.lineWidth = 1;
          
          const gridSize = 20;
          
          // ç¸¦ç·š
          for (let x = 0; x < this.canvas.width; x += gridSize) {
            ctx.beginPath();
            ctx.moveTo(x, 0);
            ctx.lineTo(x, this.canvas.height);
            ctx.stroke();
          }
          
          // æ¨ªç·š
          for (let y = 0; y < this.canvas.height; y += gridSize) {
            ctx.beginPath();
            ctx.moveTo(0, y);
            ctx.lineTo(this.canvas.width, y);
            ctx.stroke();
          }
          
          // ä¸­å¤®ç·šï¼ˆå¼·èª¿ï¼‰
          ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
          ctx.lineWidth = 2;
          
          ctx.beginPath();
          ctx.moveTo(this.canvas.width / 2, 0);
          ctx.lineTo(this.canvas.width / 2, this.canvas.height);
          ctx.stroke();
          
          ctx.beginPath();
          ctx.moveTo(0, this.canvas.height / 2);
          ctx.lineTo(this.canvas.width, this.canvas.height / 2);
          ctx.stroke();
          
          ctx.restore();
        }

        // ğŸ“Š ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
        updateStatus(elementId, value) {
          document.getElementById(elementId).textContent = value;
        }

        // ğŸ¯ SpineSettingsPersistenceçµ±åˆãƒ¡ã‚½ãƒƒãƒ‰

        // åˆæœŸè¨­å®šå¾©å…ƒ
        restoreInitialSettings() {
          try {
            const settings = this.settingsPersistence.restore(this.testCharacterId);
            
            if (settings) {
              this.addLog('ğŸ”„ ä¿å­˜ã•ã‚ŒãŸè¨­å®šã‚’å¾©å…ƒä¸­...');
              
              // Canvasã‚µã‚¤ã‚ºå¾©å…ƒ
              if (settings.canvasSize) {
                const result = this.resizer.resizeCanvas(settings.canvasSize);
                if (result) {
                  this.addLog(`âœ… Canvasã‚µã‚¤ã‚ºå¾©å…ƒ: ${settings.canvasSize}x${settings.canvasSize}`);
                }
              }
              
              // ã‚¹ã‚±ãƒ¼ãƒ«è¨­å®šå¾©å…ƒ
              if (settings.scaleX !== undefined && settings.scaleY !== undefined) {
                this.mockSkeleton.scaleX = settings.scaleX;
                this.mockSkeleton.scaleY = settings.scaleY;
                
                // UIè¦ç´ ã‚’æ›´æ–°
                document.getElementById("character-scale-x").value = settings.scaleX;
                document.getElementById("scale-x-display").textContent = settings.scaleX.toFixed(1);
                document.getElementById("character-scale-y").value = settings.scaleY;
                document.getElementById("scale-y-display").textContent = settings.scaleY.toFixed(1);
                document.getElementById("character-scale-unified").value = settings.scaleX;
                document.getElementById("scale-unified-display").textContent = settings.scaleX.toFixed(1);
                
                this.addLog(`âœ… ã‚¹ã‚±ãƒ¼ãƒ«è¨­å®šå¾©å…ƒ: X=${settings.scaleX}, Y=${settings.scaleY}`);
              }
              
              // ä½ç½®è¨­å®šå¾©å…ƒ
              if (settings.x !== undefined && settings.y !== undefined) {
                this.mockSkeleton.x = settings.x;
                this.mockSkeleton.y = settings.y;
                
                // UIè¦ç´ ã‚’æ›´æ–°
                document.getElementById("character-x").value = settings.x;
                document.getElementById("character-y").value = settings.y;
                
                this.addLog(`âœ… ä½ç½®è¨­å®šå¾©å…ƒ: X=${settings.x}, Y=${settings.y}`);
              }
              
              // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å†æç”»
              this.drawMockCharacter();
              this.updateCanvasInfo();
              
            } else {
              this.addLog('ğŸ“ ä¿å­˜ã•ã‚ŒãŸè¨­å®šãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼ˆåˆå›èµ·å‹•ï¼‰');
            }
          } catch (error) {
            this.addLog(`âŒ è¨­å®šå¾©å…ƒã‚¨ãƒ©ãƒ¼: ${error.message}`);
          }
        }

        // Canvasè¨­å®šä¿å­˜
        saveCanvasSettings(canvasSize) {
          try {
            this.settingsPersistence.save(this.testCharacterId, {
              canvasSize: canvasSize,
              timestamp: Date.now()
            });
            this.addLog(`ğŸ’¾ Canvasè¨­å®šä¿å­˜: ã‚µã‚¤ã‚º${canvasSize}x${canvasSize}`);
          } catch (error) {
            this.addLog(`âŒ Canvasè¨­å®šä¿å­˜ã‚¨ãƒ©ãƒ¼: ${error.message}`);
          }
        }

        // ã‚¹ã‚±ãƒ¼ãƒ«è¨­å®šä¿å­˜
        saveScaleSettings(scaleX, scaleY) {
          try {
            this.settingsPersistence.save(this.testCharacterId, {
              scaleX: scaleX,
              scaleY: scaleY,
              timestamp: Date.now()
            });
            this.addLog(`ğŸ’¾ ã‚¹ã‚±ãƒ¼ãƒ«è¨­å®šä¿å­˜: X=${scaleX}, Y=${scaleY}`);
          } catch (error) {
            this.addLog(`âŒ ã‚¹ã‚±ãƒ¼ãƒ«è¨­å®šä¿å­˜ã‚¨ãƒ©ãƒ¼: ${error.message}`);
          }
        }

        // ä½ç½®è¨­å®šä¿å­˜
        savePositionSettings(x, y) {
          try {
            this.settingsPersistence.save(this.testCharacterId, {
              x: x,
              y: y,
              timestamp: Date.now()
            });
            this.addLog(`ğŸ’¾ ä½ç½®è¨­å®šä¿å­˜: X=${x}, Y=${y}`);
          } catch (error) {
            this.addLog(`âŒ ä½ç½®è¨­å®šä¿å­˜ã‚¨ãƒ©ãƒ¼: ${error.message}`);
          }
        }

        // å…¨è¨­å®šã‚¯ãƒªã‚¢
        clearAllSettings() {
          try {
            this.settingsPersistence.clear(this.testCharacterId);
            this.addLog('ğŸ—‘ï¸ ä¿å­˜ã•ã‚ŒãŸè¨­å®šã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
          } catch (error) {
            this.addLog(`âŒ è¨­å®šã‚¯ãƒªã‚¢ã‚¨ãƒ©ãƒ¼: ${error.message}`);
          }
        }

        // ä¿å­˜è¨­å®šç¢ºèª
        checkSavedSettings() {
          try {
            const settings = this.settingsPersistence.restore(this.testCharacterId);
            
            if (settings) {
              this.addLog('\nğŸ“‹ ä¿å­˜ã•ã‚Œã¦ã„ã‚‹è¨­å®š:');
              this.addLog(`   ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ID: ${this.testCharacterId}`);
              
              if (settings.canvasSize) {
                this.addLog(`   Canvasã‚µã‚¤ã‚º: ${settings.canvasSize}x${settings.canvasSize}px`);
              }
              
              if (settings.scaleX !== undefined && settings.scaleY !== undefined) {
                const aspectRatio = (settings.scaleX / settings.scaleY).toFixed(2);
                this.addLog(`   ã‚¹ã‚±ãƒ¼ãƒ«è¨­å®š: X=${settings.scaleX}, Y=${settings.scaleY} (æ¯”ç‡:${aspectRatio})`);
              }
              
              if (settings.x !== undefined && settings.y !== undefined) {
                this.addLog(`   ä½ç½®è¨­å®š: X=${settings.x}, Y=${settings.y}`);
              }
              
              if (settings.timestamp) {
                const date = new Date(settings.timestamp);
                this.addLog(`   æœ€çµ‚ä¿å­˜: ${date.toLocaleString()}`);
              }
              
              this.addLog(`ğŸ“Š è¨­å®šé …ç›®æ•°: ${Object.keys(settings).length}`);
              
            } else {
              this.addLog('ğŸ“ ä¿å­˜ã•ã‚ŒãŸè¨­å®šãŒã‚ã‚Šã¾ã›ã‚“');
            }
          } catch (error) {
            this.addLog(`âŒ è¨­å®šç¢ºèªã‚¨ãƒ©ãƒ¼: ${error.message}`);
          }
        }
      }

      // ğŸŒ ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ï¼ˆãƒœã‚¿ãƒ³ã‹ã‚‰å‘¼ã³å‡ºã—ç”¨ï¼‰
      function testResize(width, height) {
        window.testController.testManualResize(width, height);
      }

      function testDisplaySize(width, height) {
        window.testController.testDisplaySizeChange(width, height);
      }

      // ğŸš€ åˆæœŸåŒ–
      document.addEventListener("DOMContentLoaded", () => {
        window.testController = new CanvasResizeControllerTest();
      });
    </script>
  </body>
</html>