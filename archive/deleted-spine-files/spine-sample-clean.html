<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spine ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é…ç½® - ã‚·ã‚¹ãƒ†ãƒ çµ±åˆå‰</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Noto Sans JP', sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            background: white;
            padding: 30px 20px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .header h1 {
            color: #ff6b6b;
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .header .subtitle {
            color: #666;
            font-size: 1.1rem;
        }

        .main-scene {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 30px;
        }

        .scene-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            overflow: hidden;
        }

        .background-image {
            width: 100%;
            height: auto;
            display: block;
        }

        /* å…±é€šã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šï¼ˆCanvasãƒ»ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”»åƒ ä¸¡å¯¾å¿œï¼‰ */
        .spine-character,
        .fallback-character {
            position: absolute !important;
            left: 35% !important;
            top: 75% !important;
            transform: translate(-50%, -50%) !important;
            width: 160px;  /* â† ã“ã“ã‚’å¤‰æ›´ã™ã‚‹ã¨ä¸¡æ–¹ã«åæ˜  */
            height: 160px; /* â† ã“ã“ã‚’å¤‰æ›´ã™ã‚‹ã¨ä¸¡æ–¹ã«åæ˜  */
            z-index: 10 !important;
        }

        /* ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”»åƒå°‚ç”¨è¨­å®š */
        .fallback-character {
            object-fit: contain;
            display: block;
        }

        .info-panel {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .info-panel h2 {
            color: #ff6b6b;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .status-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .status-icon {
            margin-right: 10px;
            font-size: 1.2rem;
        }

        .comparison-note {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-top: 20px;
        }

        .comparison-note h3 {
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .demo-button {
            display: inline-block;
            background: #ff6b6b;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            margin: 10px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .demo-button:hover {
            background: #ff5252;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 1.6rem;
            }
            
            .spine-character,
            .fallback-character {
                width: 140px;  /* ãƒ¢ãƒã‚¤ãƒ«ã§ã¯å°‘ã—å°ã•ã */
                height: 140px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="header">
            <h1>ğŸ® Spine ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é…ç½®ã‚µãƒ³ãƒ—ãƒ«</h1>
            <p class="subtitle">Positioning System çµ±åˆå‰ - å›ºå®šé…ç½®ç‰ˆ</p>
        </div>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚·ãƒ¼ãƒ³ -->
        <div class="main-scene">
            <div class="scene-container">
                <!-- èƒŒæ™¯ç”»åƒ -->
                <img src="assets/images/ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼TOP.png" 
                     alt="èƒŒæ™¯ç”»åƒ" 
                     class="background-image">
                
                <!-- Spineã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ï¼ˆCanvasï¼‰ -->
                <canvas id="spine-character-canvas" 
                        class="spine-character"
                        style="display: none;">
                </canvas>
                
                <!-- ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”»åƒ -->
                <img src="assets/images/purattokunn.png" 
                     alt="ã·ã‚‰ã£ã¨ãã‚“" 
                     class="fallback-character"
                     id="fallback-character"
                     style="display: block;"
                     onload="console.log('âœ… ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”»åƒèª­ã¿è¾¼ã¿æˆåŠŸ')"
                     onerror="console.error('âŒ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”»åƒèª­ã¿è¾¼ã¿å¤±æ•—')">
            </div>
        </div>

        <!-- ç¾åœ¨ã®çŠ¶æ…‹ãƒ‘ãƒãƒ« -->
        <div class="info-panel">
            <h2>ğŸ“Š ç¾åœ¨ã®çŠ¶æ…‹</h2>
            
            <div class="status-item">
                <span class="status-icon">âŒ</span>
                <div>
                    <strong>Positioning System:</strong> æœªçµ±åˆ<br>
                    <small>ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã¯å›ºå®šä½ç½®ï¼ˆ35%, 75%ï¼‰ã«é…ç½®ã•ã‚Œã¦ã„ã¾ã™</small>
                </div>
            </div>
            
            <div class="status-item">
                <span class="status-icon">âŒ</span>
                <div>
                    <strong>ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—:</strong> åˆ©ç”¨ä¸å¯<br>
                    <small>ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®ä½ç½®ã‚’å¤‰æ›´ã™ã‚‹ã«ã¯CSSã‚’ç›´æ¥ç·¨é›†ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™</small>
                </div>
            </div>
            
            <div class="status-item">
                <span class="status-icon">âŒ</span>
                <div>
                    <strong>ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–åº§æ¨™:</strong> åŸºæœ¬çš„ãªCSS%ã®ã¿<br>
                    <small>ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºæ™‚ã®è©³ç´°èª¿æ•´æ©Ÿèƒ½ã¯ã‚ã‚Šã¾ã›ã‚“</small>
                </div>
            </div>
            
            <div class="status-item">
                <span class="status-icon">âŒ</span>
                <div>
                    <strong>è¨­å®šç®¡ç†:</strong> æ‰‹å‹•ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°<br>
                    <small>ä½ç½®å¤‰æ›´ã«ã¯ç›´æ¥HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™</small>
                </div>
            </div>
        </div>

        <!-- æ¯”è¼ƒç”¨ãƒªãƒ³ã‚¯ -->
        <div class="comparison-note">
            <h3>ğŸš€ Positioning System ã®åŠ¹æœã‚’ç¢ºèª</h3>
            <p>ã“ã®ãƒšãƒ¼ã‚¸ã¨åŒã˜å†…å®¹ã§ã€ã‚·ã‚¹ãƒ†ãƒ çµ±åˆå¾Œã®é•ã„ã‚’ä½“é¨“ã—ã¦ãã ã•ã„</p>
            <a href="spine-sample-with-positioning.html" class="demo-button">
                çµ±åˆç‰ˆãƒ‡ãƒ¢ã‚’è¦‹ã‚‹ â†’
            </a>
        </div>
    </div>

    <!-- Spine WebGL Runtime -->
    <script src="https://unpkg.com/@esotericsoftware/spine-webgl@4.1.*/dist/iife/spine-webgl.js"></script>
    
    <script>
        // index.htmlã¨åŒã˜æˆåŠŸãƒ‘ã‚¿ãƒ¼ãƒ³ã®SpineåˆæœŸåŒ–
        async function initBasicSpineCharacter() {
            try {
                const canvas = document.getElementById('spine-character-canvas');
                const fallback = document.getElementById('fallback-character');
                
                const gl = canvas.getContext('webgl', { alpha: true });
                
                if (!gl) {
                    throw new Error('WebGLã‚µãƒãƒ¼ãƒˆãªã—');
                }
                
                // Canvas ã‚µã‚¤ã‚ºè¨­å®šï¼ˆåŸºæœ¬è¨­å®šï¼‰
                // æ³¨æ„ï¼šCSSå´ã®å…±é€šè¨­å®š(.spine-character, .fallback-character)ã¨åŒæœŸ
                canvas.width = 160;
                canvas.height = 160;
                
                console.log('ğŸ“ Spineãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ä¸­...');
                
                // ã‚¢ã‚»ãƒƒãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ï¼ˆindex.htmlã¨åŒã˜ãƒ‘ã‚¹ï¼‰
                const basePath = 'assets/spine/characters/purattokun/';
                const assetManager = new spine.AssetManager(gl, basePath);
                assetManager.loadTextureAtlas('purattokun.atlas');
                assetManager.loadJson('purattokun.json');
                
                // ã‚¢ã‚»ãƒƒãƒˆèª­ã¿è¾¼ã¿å®Œäº†å¾…ã¡ï¼ˆindex.htmlã¨åŒã˜æ–¹å¼ï¼‰
                await new Promise((resolve, reject) => {
                    let checkCount = 0;
                    const maxChecks = 100;
                    
                    const checkAssets = () => {
                        checkCount++;
                        if (assetManager.isLoadingComplete()) {
                            resolve();
                        } else if (checkCount >= maxChecks) {
                            reject(new Error('ã‚¢ã‚»ãƒƒãƒˆèª­ã¿è¾¼ã¿ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ'));
                        } else {
                            setTimeout(checkAssets, 100);
                        }
                    };
                    
                    checkAssets();
                });
                
                console.log('ğŸ¬ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹...');
                
                // Atlaså–å¾—ï¼ˆindex.htmlã¨åŒã˜ï¼‰
                const atlas = assetManager.get('purattokun.atlas');
                const atlasLoader = new spine.AtlasAttachmentLoader(atlas);
                
                // SkeletonDataèª­ã¿è¾¼ã¿
                const skeletonJson = new spine.SkeletonJson(atlasLoader);
                const skeletonData = skeletonJson.readSkeletonData(assetManager.get('purattokun.json'));
                
                // Skeletonä½œæˆ
                const skeleton = new spine.Skeleton(skeletonData);
                skeleton.x = 0;  // å·¦ä¸‹åŸç‚¹
                skeleton.y = 0;  // å·¦ä¸‹åŸç‚¹
                skeleton.scaleX = skeleton.scaleY = 0.5;
                
                // AnimationStateä½œæˆ
                const animationStateData = new spine.AnimationStateData(skeleton.data);
                const animationState = new spine.AnimationState(animationStateData);
                
                // taikiã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
                if (skeleton.data.findAnimation('taiki')) {
                    animationState.setAnimation(0, 'taiki', true);
                    console.log('ğŸ­ taikiã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šå®Œäº†');
                }
                
                // ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ä½œæˆ
                const renderer = new spine.SceneRenderer(canvas, gl);
                let lastTime = Date.now() / 1000;
                
                // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ«ãƒ¼ãƒ—
                function render() {
                    const now = Date.now() / 1000;
                    const delta = now - lastTime;
                    lastTime = now;
                    
                    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ›´æ–°
                    animationState.update(delta);
                    animationState.apply(skeleton);
                    skeleton.updateWorldTransform();
                    
                    // æç”»
                    gl.clearColor(0, 0, 0, 0);
                    gl.clear(gl.COLOR_BUFFER_BIT);
                    gl.viewport(0, 0, canvas.width, canvas.height);
                    
                    renderer.begin();
                    renderer.drawSkeleton(skeleton, true);
                    renderer.end();
                    
                    requestAnimationFrame(render);
                }
                
                render();
                
                // æˆåŠŸæ™‚ã®è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
                canvas.style.display = 'block';
                fallback.style.display = 'none';
                console.log('âœ… SpineåˆæœŸåŒ–æˆåŠŸï¼ˆindex.htmlãƒ‘ã‚¿ãƒ¼ãƒ³ä½¿ç”¨ï¼‰');
                
            } catch (error) {
                console.error('SpineåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”»åƒã‚’è¡¨ç¤º
                const fallback = document.getElementById('fallback-character');
                const canvas = document.getElementById('spine-character-canvas');
                if (fallback && canvas) {
                    fallback.style.display = 'block';
                    canvas.style.display = 'none';
                    console.log('âš ï¸ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”»åƒã«åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸ');
                }
            }
        }

        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”»åƒã‚’ç¢ºå®Ÿã«è¡¨ç¤ºã™ã‚‹é–¢æ•°
        function showFallback() {
            const canvas = document.getElementById('spine-character-canvas');
            const fallback = document.getElementById('fallback-character');
            
            if (canvas) canvas.style.display = 'none';
            if (fallback) {
                fallback.style.display = 'block';
                console.log('âœ… ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”»åƒã‚’è¡¨ç¤ºä¸­');
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸåŒ–
        window.addEventListener('load', () => {
            console.log('ğŸ“„ ã‚¯ãƒªãƒ¼ãƒ³ã‚µãƒ³ãƒ—ãƒ«ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†');
            
            // åˆæœŸçŠ¶æ…‹ã§ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”»åƒã‚’è¡¨ç¤º
            showFallback();
            
            // SpineåˆæœŸåŒ–ã‚’è©¦è¡Œï¼ˆæˆåŠŸã™ã‚Œã°ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã€å¤±æ•—ã™ã‚Œã°ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
            console.log('ğŸ® SpineåˆæœŸåŒ–ã‚’é–‹å§‹...');
            setTimeout(initBasicSpineCharacter, 1000);
        });

        // ç·Šæ€¥æ™‚ã®æ‰‹å‹•ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è¡¨ç¤ºæ©Ÿèƒ½
        function forceShowFallback() {
            showFallback();
            console.log('ğŸ”§ æ‰‹å‹•ã§ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”»åƒã‚’è¡¨ç¤ºã—ã¾ã—ãŸ');
        }
    </script>
</body>
</html>