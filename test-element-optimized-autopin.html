<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“‹ è¦ç´ åˆ¥æœ€é©åŒ–AutoPinçµ±åˆãƒ†ã‚¹ãƒˆ</title>
    <style>
        /* ãƒ™ãƒ¼ã‚¹ã‚¹ã‚¿ã‚¤ãƒ« */
        body {
            font-family: 'Noto Sans JP', Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px 0;
            border-bottom: 2px solid #eee;
        }

        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.2em;
        }

        .header .subtitle {
            color: #7f8c8d;
            font-size: 1.1em;
        }

        /* æ“ä½œã‚¬ã‚¤ãƒ‰è¿½åŠ  */
        .operation-guide {
            background: linear-gradient(135deg, #ff6b6b, #feca57);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        .guide-step {
            display: inline-block;
            margin: 10px 15px;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            font-weight: bold;
        }

        /* ãƒ†ã‚¹ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .test-section {
            margin: 40px 0;
            padding: 30px;
            border: 2px dashed #bdc3c7;
            border-radius: 10px;
            background: rgba(52, 152, 219, 0.05);
        }

        .test-section h2 {
            color: #2980b9;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-left: 4px solid #3498db;
            padding-left: 15px;
        }

        .test-section .description {
            background: rgba(241, 196, 15, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #f39c12;
        }

        /* ã‚¯ãƒªãƒƒã‚¯å¯èƒ½è¦ç´ ã®å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
        .clickable-element {
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer !important;
            border: 2px solid transparent;
        }

        .clickable-element:hover {
            outline: 3px dashed #3498db;
            outline-offset: 5px;
            transform: scale(1.02);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.3);
        }

        .clickable-element::before {
            content: 'ğŸ¯ ã‚¯ãƒªãƒƒã‚¯ã§UIè¡¨ç¤º';
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: #3498db;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            opacity: 0;
            transition: opacity 0.3s ease;
            white-space: nowrap;
            z-index: 100;
        }

        .clickable-element:hover::before {
            opacity: 1;
        }

        /* ãƒ†ã‚­ã‚¹ãƒˆè¦ç´ ãƒ†ã‚¹ãƒˆ */
        .text-elements h3 {
            color: #27ae60;
            font-size: 1.8em;
            margin: 20px 0;
        }

        .text-elements p {
            font-size: 1.1em;
            color: #34495e;
            margin: 15px 0;
            padding: 10px;
            background: rgba(46, 204, 113, 0.1);
            border-radius: 5px;
        }

        .text-elements .highlight {
            background: linear-gradient(120deg, #a8edea 0%, #fed6e3 100%);
            padding: 8px 12px;
            border-radius: 20px;
            display: inline-block;
            margin: 10px;
            font-weight: bold;
            color: #2c3e50;
        }

        /* ç”»åƒè¦ç´ ãƒ†ã‚¹ãƒˆ */
        .image-elements img {
            max-width: 300px;
            height: 200px;
            object-fit: cover;
            border-radius: 10px;
            margin: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }

        .image-elements img:hover {
            transform: translateY(-5px);
        }

        /* ãƒªã‚¹ãƒˆè¦ç´ ãƒ†ã‚¹ãƒˆ */
        .list-elements ul {
            background: rgba(155, 89, 182, 0.1);
            padding: 25px;
            border-radius: 10px;
            border-left: 5px solid #9b59b6;
        }

        .list-elements li {
            margin: 12px 0;
            padding: 8px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 5px;
            font-size: 1.1em;
        }

        .list-elements .priority-high {
            border-left: 4px solid #e74c3c;
        }

        .list-elements .priority-medium {
            border-left: 4px solid #f39c12;
        }

        .list-elements .priority-low {
            border-left: 4px solid #27ae60;
        }

        /* æ±ç”¨è¦ç´ ãƒ†ã‚¹ãƒˆ */
        .generic-elements .card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px;
            display: inline-block;
            width: 250px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .generic-elements .button {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.1em;
            margin: 10px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .generic-elements .button:hover {
            transform: scale(1.05);
        }

        /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºã‚¨ãƒªã‚¢ */
        .status-area {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 20px;
            border-radius: 15px;
            font-family: 'Arial', sans-serif;
            font-size: 0.9em;
            max-width: 350px;
            z-index: 1000;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border: 2px solid #3498db;
        }

        .status-area h4 {
            margin: 0 0 15px 0;
            color: #3498db;
            font-size: 1.1em;
            text-align: center;
            border-bottom: 1px solid #3498db;
            padding-bottom: 8px;
        }

        .status-item {
            margin: 8px 0;
            padding: 5px 0;
            border-left: 3px solid #27ae60;
            padding-left: 10px;
        }

        .status-item strong {
            color: #ecf0f1;
        }

        /* RTLè¨€èªãƒ†ã‚¹ãƒˆ */
        .rtl-test {
            direction: rtl;
            text-align: right;
            background: rgba(230, 126, 34, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“‹ è¦ç´ åˆ¥æœ€é©åŒ–AutoPinçµ±åˆãƒ†ã‚¹ãƒˆ</h1>
            <div class="subtitle">Element-Optimized AutoPin Integration Test Environment</div>
            
            <!-- æ“ä½œã‚¬ã‚¤ãƒ‰ -->
            <div class="operation-guide">
                <div style="font-size: 1.3em; margin-bottom: 15px;">ğŸš€ ç°¡å˜3ã‚¹ãƒ†ãƒƒãƒ—æ“ä½œã‚¬ã‚¤ãƒ‰</div>
                <div class="guide-step">1ï¸âƒ£ ä¸‹ã®è¦ç´ ã‚’ã‚¯ãƒªãƒƒã‚¯</div>
                <div class="guide-step">2ï¸âƒ£ è¦ç´ åˆ¥UIãŒè‡ªå‹•è¡¨ç¤º</div>
                <div class="guide-step">3ï¸âƒ£ è¨­å®šã‚’é¸ã‚“ã§ã€Œé©ç”¨ã€</div>
                <div style="margin-top: 15px; font-size: 0.95em;">
                    ğŸ’¡ å„è¦ç´ ã‚¿ã‚¤ãƒ—ã§ç•°ãªã‚‹æœ€é©åŒ–UIãŒè¡¨ç¤ºã•ã‚Œã¾ã™
                </div>
            </div>
        </div>

        <!-- ãƒ†ã‚­ã‚¹ãƒˆè¦ç´ ãƒ†ã‚¹ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="test-section text-elements">
            <h2>ğŸ“ ãƒ†ã‚­ã‚¹ãƒˆè¦ç´  (Text Elements)</h2>
            <div class="description">
                <strong>æœŸå¾…ã•ã‚Œã‚‹UI:</strong> text-start, text-end, text-center ã‚¢ãƒ³ã‚«ãƒ¼ / typography ScaleMode / ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºé€£å‹•
            </div>
            
            <h3 id="test-heading">ãƒ†ã‚¹ãƒˆè¦‹å‡ºã— (H3è¦ç´ )</h3>
            <p id="test-paragraph">ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆç”¨ã®æ®µè½è¦ç´ ã§ã™ã€‚AutoPinè¦ç´ åˆ¥æœ€é©åŒ–ã‚·ã‚¹ãƒ†ãƒ ãŒãƒ†ã‚­ã‚¹ãƒˆè¦ç´ ã¨ã—ã¦èªè­˜ã—ã€ãƒ†ã‚­ã‚¹ãƒˆå°‚ç”¨ã®ã‚¢ãƒ³ã‚«ãƒ¼ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆtext-start, text-end, text-centerï¼‰ã‚’æä¾›ã™ã‚‹ã‹ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚</p>
            
            <span class="highlight" id="test-span">ãƒã‚¤ãƒ©ã‚¤ãƒˆSpanè¦ç´ </span>
            <span class="highlight" id="test-span2">ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³è¦ç´ ãƒ†ã‚¹ãƒˆ</span>
            
            <!-- RTLè¨€èªãƒ†ã‚¹ãƒˆ -->
            <div class="rtl-test" id="test-rtl">
                <p>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Øµ Ø§Ù„Ø¹Ø±Ø¨ÙŠ - RTLè¨€èªæ–¹å‘ãƒ†ã‚¹ãƒˆ</p>
            </div>
        </div>

        <!-- ç”»åƒè¦ç´ ãƒ†ã‚¹ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="test-section image-elements">
            <h2>ğŸ–¼ï¸ ç”»åƒè¦ç´  (Image Elements)</h2>
            <div class="description">
                <strong>æœŸå¾…ã•ã‚Œã‚‹UI:</strong> 9ã‚¢ãƒ³ã‚«ãƒ¼ / element-linked ScaleMode / ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ç¶­æŒ
            </div>
            
            <img id="test-image1" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGRlZnM+CjxsaW5lYXJHcmFkaWVudCBpZD0iZ3JhZGllbnQiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPgo8c3RvcCBvZmZzZXQ9IjAlIiBzdHlsZT0ic3RvcC1jb2xvcjojZmY2YjZiO3N0b3Atb3BhY2l0eToxIiAvPgo8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiM0ZWNkYzQ7c3RvcC1vcGFjaXR5OjEiIC8+CjwvbGluZWFyR3JhZGllbnQ+CjwvZGVmcz4KPHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0idXJsKCNncmFkaWVudCkiIC8+Cjx0ZXh0IHg9IjE1MCIgeT0iMTAwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSJ3aGl0ZSIgZm9udC1zaXplPSIxOCIgZm9udC13ZWlnaHQ9ImJvbGQiPuODhuOCueODiOeUu+WDjzE8L3RleHQ+Cjwvc3ZnPg==" alt="ãƒ†ã‚¹ãƒˆç”»åƒ1">
            
            <img id="test-image2" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGRlZnM+CjxsaW5lYXJHcmFkaWVudCBpZD0iZ3JhZGllbnQyIiB4MT0iMCUiIHkxPSIwJSIgeDI9IjEwMCUiIHkyPSIxMDAlIj4KPHN0b3Agb2Zmc2V0PSIwJSIgc3R5bGU9InN0b3AtY29sb3I6IzY2N2VlYTtzdG9wLW9wYWNpdHk6MSIgLz4KPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdHlsZT0ic3RvcC1jb2xvcjojNzY0YmEyO3N0b3Atb3BhY2l0eToxIiAvPgo8L2xpbmVhckdyYWRpZW50Pgo8L2RlZnM+CjxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9InVybCgjZ3JhZGllbnQyKSIgLz4KPHRleHQgeD0iMTUwIiB5PSIxMDAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IndoaXRlIiBmb250LXNpemU9IjE4IiBmb250LXdlaWdodD0iYm9sZCI+44OG44K544OI55S75YOP77yiPC90ZXh0Pgo8L3N2Zz4=" alt="ãƒ†ã‚¹ãƒˆç”»åƒ2">
        </div>

        <!-- ãƒªã‚¹ãƒˆè¦ç´ ãƒ†ã‚¹ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="test-section list-elements">
            <h2>ğŸ“‹ ãƒªã‚¹ãƒˆè¦ç´  (List Elements)</h2>
            <div class="description">
                <strong>æœŸå¾…ã•ã‚Œã‚‹UI:</strong> marker ã‚¢ãƒ³ã‚«ãƒ¼ / element-linked ScaleMode / ãƒãƒ¼ã‚«ãƒ¼ä½ç½®åŸºæº–
            </div>
            
            <ul>
                <li id="test-li1" class="priority-high">é«˜å„ªå…ˆåº¦ã‚¿ã‚¹ã‚¯ - AutoPinè¦ç´ åˆ¥æœ€é©åŒ–UIå®Ÿè£…</li>
                <li id="test-li2" class="priority-medium">ä¸­å„ªå…ˆåº¦ã‚¿ã‚¹ã‚¯ - ãƒ†ã‚¹ãƒˆç’°å¢ƒæ§‹ç¯‰</li>
                <li id="test-li3" class="priority-low">ä½å„ªå…ˆåº¦ã‚¿ã‚¹ã‚¯ - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°</li>
                <li id="test-li4">é€šå¸¸ã®ãƒªã‚¹ãƒˆé …ç›® - marker ã‚¢ãƒ³ã‚«ãƒ¼ãƒ†ã‚¹ãƒˆ</li>
            </ul>
        </div>

        <!-- æ±ç”¨è¦ç´ ãƒ†ã‚¹ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="test-section generic-elements">
            <h2>ğŸ”§ æ±ç”¨è¦ç´  (Generic Elements)</h2>
            <div class="description">
                <strong>æœŸå¾…ã•ã‚Œã‚‹UI:</strong> 9ã‚¢ãƒ³ã‚«ãƒ¼ / element-linked ScaleMode / æ¨™æº–çš„ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³
            </div>
            
            <div class="card" id="test-div">
                <h3>DIVè¦ç´ ãƒ†ã‚¹ãƒˆ</h3>
                <p>æ±ç”¨è¦ç´ ã¨ã—ã¦èªè­˜ã•ã‚Œã‚‹ã‹ãƒ†ã‚¹ãƒˆ</p>
            </div>
            
            <button class="button" id="test-button">ãƒœã‚¿ãƒ³è¦ç´ ãƒ†ã‚¹ãƒˆ</button>
            <button class="button" id="test-button2">æ±ç”¨UIç¢ºèª</button>
        </div>

        <!-- æ··åœ¨è¦ç´ ãƒ†ã‚¹ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="test-section">
            <h2>ğŸ”€ æ··åœ¨è¦ç´  (Mixed Content Elements)</h2>
            <div class="description">
                <strong>æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ:</strong> ãƒ†ã‚­ã‚¹ãƒˆ+ç”»åƒãªã©è¤‡é›‘ãªå†…å®¹ â†’ æ±ç”¨è¦ç´ ã¨ã—ã¦å‡¦ç†
            </div>
            
            <div id="test-mixed" style="padding: 20px; border: 2px solid #3498db; border-radius: 10px; background: rgba(52, 152, 219, 0.1);">
                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI1MCIgaGVpZ2h0PSI1MCIgZmlsbD0iIzI3YWU2MCIgcng9IjUiLz4KPHN0b3AgY29sb3I9IiNmZmYiIC8+Cjwvc3ZnPg==" alt="å°ã‚¢ã‚¤ã‚³ãƒ³" style="width: 30px; height: 30px; vertical-align: middle; margin-right: 10px;">
                <span>ç”»åƒã¨ãƒ†ã‚­ã‚¹ãƒˆãŒæ··åœ¨ã™ã‚‹è¦ç´  - æ±ç”¨UIãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‹ãƒ†ã‚¹ãƒˆ</span>
            </div>
        </div>
    </div>

    <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
    <div class="status-area" id="status-display">
        <h4>ğŸ“Š AutoPin ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çŠ¶æ³</h4>
        <div id="status-content">
            <div class="status-item"><strong>çŠ¶æ…‹:</strong> å¾…æ©Ÿä¸­</div>
            <div class="status-item"><strong>æœ€çµ‚é¸æŠ:</strong> ãªã—</div>
            <div class="status-item"><strong>è¦ç´ ã‚¿ã‚¤ãƒ—:</strong> --</div>
            <div class="status-item"><strong>æ™‚åˆ»:</strong> åˆæœŸåŒ–ä¸­</div>
        </div>
    </div>

    <!-- ãƒ†ã‚¹ãƒˆåˆ¶å¾¡ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å½¢å¼ï¼‰ -->
    <script type="module">
        class ElementOptimizedAutoPinTest {
            constructor() {
                this.autopin = null;
                this.statusDisplay = document.getElementById('status-display');
                this.statusContent = document.getElementById('status-content');
                this.lastSelectedElement = null;
                this.init();
            }

            async init() {
                try {
                    console.log('ğŸš€ è¦ç´ åˆ¥æœ€é©åŒ–AutoPinãƒ†ã‚¹ãƒˆç’°å¢ƒåˆæœŸåŒ–é–‹å§‹');
                    
                    // ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ†ã‚¹ãƒˆç’°å¢ƒã¨ã—ã¦ã€AutoPinSelectorã®æ©Ÿèƒ½ã‚’ãƒ¢ãƒƒã‚¯å®Ÿè£…
                    // è¦ç´ åˆ¥UIæœ€é©åŒ–ã®ãƒ­ã‚¸ãƒƒã‚¯ã®ã¿ã‚’ãƒ†ã‚¹ãƒˆ
                    this.autopin = {
                        selectElement: this.mockAutoPinSelect.bind(this)
                    };
                    
                    console.log('âœ… AutoPinæ©Ÿèƒ½ï¼ˆãƒ†ã‚¹ãƒˆç‰ˆï¼‰åˆæœŸåŒ–å®Œäº†');
                    this.updateStatus('ãƒ†ã‚¹ãƒˆç’°å¢ƒåˆæœŸåŒ–å®Œäº†', 'å¾…æ©Ÿä¸­', '--');
                    
                    // ãƒ†ã‚¹ãƒˆç”¨ã‚¤ãƒ™ãƒ³ãƒˆç›£è¦–
                    this.setupEventListeners();
                    
                } catch (error) {
                    console.error('âŒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                    this.updateStatus('åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼', error.message, '--');
                }
            }

            // AutoPinSelectorã®è¦ç´ åˆ¥æœ€é©åŒ–UIãƒ­ã‚¸ãƒƒã‚¯ã‚’ãƒ†ã‚¹ãƒˆç”¨ã«ãƒ¢ãƒƒã‚¯å®Ÿè£…
            async mockAutoPinSelect(element) {
                console.log('ğŸ¯ è¦ç´ åˆ¥æœ€é©åŒ–UIãƒ†ã‚¹ãƒˆé–‹å§‹:', element.tagName, element.id);
                
                // è¦ç´ ã‚¿ã‚¤ãƒ—æ¤œå‡º
                const elementType = this.detectElementType(element);
                console.log('ğŸ“‹ æ¤œå‡ºã•ã‚ŒãŸè¦ç´ ã‚¿ã‚¤ãƒ—:', elementType);
                
                // è¦ç´ åˆ¥æœ€é©åŒ–UIã‚’è¡¨ç¤ºï¼ˆãƒ¢ãƒƒã‚¯ï¼‰
                this.showOptimizedUIDialog(element, elementType);
            }

            // è¦ç´ åˆ¥æœ€é©åŒ–UIè¡¨ç¤ºï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
            showOptimizedUIDialog(element, elementType) {
                // æ—¢å­˜ã®ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒã‚ã‚Œã°å‰Šé™¤
                const existingDialog = document.querySelector('.autopin-dialog');
                if (existingDialog) {
                    existingDialog.remove();
                }

                // è¦ç´ ã‚¿ã‚¤ãƒ—åˆ¥ã®UIä½œæˆ
                let dialogContent = '';
                
                switch (elementType) {
                    case 'text':
                        dialogContent = this.createTextElementDialog(element);
                        break;
                    case 'image':
                        dialogContent = this.createImageElementDialog(element);
                        break;
                    case 'list':
                        dialogContent = this.createListElementDialog(element);
                        break;
                    case 'generic':
                    default:
                        dialogContent = this.createGenericElementDialog(element);
                        break;
                }

                // ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º
                document.body.appendChild(dialogContent);
                
                console.log('âœ… è¦ç´ åˆ¥æœ€é©åŒ–UIè¡¨ç¤ºå®Œäº†:', elementType);
            }

            // ãƒ†ã‚­ã‚¹ãƒˆè¦ç´ å°‚ç”¨ãƒ€ã‚¤ã‚¢ãƒ­ã‚°
            createTextElementDialog(element) {
                const dialog = document.createElement('div');
                dialog.className = 'autopin-dialog';
                dialog.innerHTML = `
                    <div class="dialog-overlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000;">
                        <div class="dialog-content" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; min-width: 450px; max-width: 500px; box-shadow: 0 20px 40px rgba(0,0,0,0.3);">
                            <h3 style="margin-top: 0; color: #27ae60; text-align: center;">ğŸ“ æ–‡å­—è¦ç´ ã®è¨­å®š</h3>
                            <div style="background: rgba(46, 204, 113, 0.1); padding: 15px; border-radius: 8px; margin: 15px 0; text-align: center;">
                                <strong>é¸æŠã—ãŸè¦ç´ :</strong> ã€Œ${element.textContent.substring(0, 30)}${element.textContent.length > 30 ? '...' : ''}ã€
                            </div>
                            
                            <div style="margin: 25px 0;">
                                <h4 style="margin-bottom: 15px; color: #2c3e50;">ğŸ¯ ã©ã“ã‚’åŸºæº–ã«é…ç½®ã—ã¾ã™ã‹ï¼Ÿ</h4>
                                <div style="display: grid; grid-template-columns: 1fr; gap: 10px;">
                                    <label style="display: flex; align-items: center; padding: 12px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; transition: all 0.3s ease;">
                                        <input type="radio" name="text-position" value="text-start" style="margin-right: 10px;">
                                        <div>
                                            <strong>ğŸ“ æ–‡å­—ã®å§‹ã¾ã‚Š</strong><br>
                                            <small style="color: #7f8c8d;">æ–‡ç« ã®æœ€åˆã®æ–‡å­—ã‚’åŸºæº–ã«ã—ã¾ã™</small>
                                        </div>
                                    </label>
                                    <label style="display: flex; align-items: center; padding: 12px; border: 2px solid #27ae60; border-radius: 8px; cursor: pointer; background: rgba(46, 204, 113, 0.1);">
                                        <input type="radio" name="text-position" value="text-center" checked style="margin-right: 10px;">
                                        <div>
                                            <strong>ğŸ“ æ–‡å­—ã®ä¸­å¤®</strong> <span style="color: #27ae60;">ï¼ˆãŠã™ã™ã‚ï¼‰</span><br>
                                            <small style="color: #7f8c8d;">æ–‡ç« ã®çœŸã‚“ä¸­ã‚’åŸºæº–ã«ã—ã¾ã™</small>
                                        </div>
                                    </label>
                                    <label style="display: flex; align-items: center; padding: 12px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; transition: all 0.3s ease;">
                                        <input type="radio" name="text-position" value="text-end" style="margin-right: 10px;">
                                        <div>
                                            <strong>ğŸ“ æ–‡å­—ã®çµ‚ã‚ã‚Š</strong><br>
                                            <small style="color: #7f8c8d;">æ–‡ç« ã®æœ€å¾Œã®æ–‡å­—ã‚’åŸºæº–ã«ã—ã¾ã™</small>
                                        </div>
                                    </label>
                                </div>
                            </div>
                            
                            <div style="margin: 25px 0;">
                                <h4 style="margin-bottom: 15px; color: #2c3e50;">âš–ï¸ ã‚µã‚¤ã‚ºã¯ã©ã†ã—ã¾ã™ã‹ï¼Ÿ</h4>
                                <div style="display: grid; grid-template-columns: 1fr; gap: 10px;">
                                    <label style="display: flex; align-items: center; padding: 12px; border: 2px solid #27ae60; border-radius: 8px; cursor: pointer; background: rgba(46, 204, 113, 0.1);">
                                        <input type="radio" name="size-mode" value="typography" checked style="margin-right: 10px;">
                                        <div>
                                            <strong>ğŸ“ æ–‡å­—ã‚µã‚¤ã‚ºã¨é€£å‹•</strong> <span style="color: #27ae60;">ï¼ˆãŠã™ã™ã‚ï¼‰</span><br>
                                            <small style="color: #7f8c8d;">æ–‡å­—ãŒå¤§ãããªã‚‹ã¨ãƒ”ãƒ³ã‚‚å¤§ãããªã‚Šã¾ã™</small>
                                        </div>
                                    </label>
                                    <label style="display: flex; align-items: center; padding: 12px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; transition: all 0.3s ease;">
                                        <input type="radio" name="size-mode" value="element-linked" style="margin-right: 10px;">
                                        <div>
                                            <strong>ğŸ”— è¦ç´ ã‚µã‚¤ã‚ºã¨é€£å‹•</strong><br>
                                            <small style="color: #7f8c8d;">è¦ç´ å…¨ä½“ã®ã‚µã‚¤ã‚ºã«åˆã‚ã›ã¾ã™</small>
                                        </div>
                                    </label>
                                    <label style="display: flex; align-items: center; padding: 12px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; transition: all 0.3s ease;">
                                        <input type="radio" name="size-mode" value="fixed-size" style="margin-right: 10px;">
                                        <div>
                                            <strong>ğŸ“ å›ºå®šã‚µã‚¤ã‚º</strong><br>
                                            <small style="color: #7f8c8d;">å¸¸ã«åŒã˜ã‚µã‚¤ã‚ºã‚’ä¿ã¡ã¾ã™</small>
                                        </div>
                                    </label>
                                </div>
                            </div>

                            <div style="margin: 25px 0;">
                                <h4 style="margin-bottom: 10px; color: #2c3e50;">ğŸ“ åŸºæº–ã¨ãªã‚‹æ–‡å­—ã‚µã‚¤ã‚º</h4>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <input type="range" id="base-font" min="8" max="32" value="16" style="flex: 1;" oninput="document.getElementById('font-display').textContent = this.value + 'px'">
                                    <span id="font-display" style="min-width: 50px; font-weight: bold; color: #27ae60;">16px</span>
                                </div>
                            </div>
                            
                            <div style="display: flex; gap: 10px; margin-top: 30px;">
                                <button onclick="this.closest('.dialog-overlay').remove()" style="flex: 1; padding: 12px; background: #95a5a6; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                                <button onclick="autoPinTest.handleDialogApply('text'); this.closest('.dialog-overlay').remove()" style="flex: 1; padding: 12px; background: #27ae60; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px;">ã“ã®è¨­å®šã§æ±ºå®š</button>
                            </div>
                        </div>
                    </div>
                `;
                return dialog;
            }

            // ç”»åƒè¦ç´ å°‚ç”¨ãƒ€ã‚¤ã‚¢ãƒ­ã‚°
            createImageElementDialog(element) {
                const dialog = document.createElement('div');
                dialog.className = 'autopin-dialog';
                dialog.innerHTML = `
                    <div class="dialog-overlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000;">
                        <div class="dialog-content" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; min-width: 400px; box-shadow: 0 20px 40px rgba(0,0,0,0.3);">
                            <h3 style="margin-top: 0; color: #3498db;">ğŸ–¼ï¸ ç”»åƒè¦ç´ æœ€é©åŒ–UI</h3>
                            <div style="background: rgba(52, 152, 219, 0.1); padding: 15px; border-radius: 8px; margin: 15px 0;">
                                <strong>è¦ç´ :</strong> ${element.tagName}${element.id ? '#' + element.id : ''}<br>
                                <strong>æ¤œå‡ºã‚¿ã‚¤ãƒ—:</strong> ç”»åƒè¦ç´ <br>
                                <strong>ã‚µã‚¤ã‚º:</strong> ${element.offsetWidth} x ${element.offsetHeight}px
                            </div>
                            
                            <div style="margin: 20px 0;">
                                <label style="display: block; margin-bottom: 10px;"><strong>ğŸ¯ 9ã‚¢ãƒ³ã‚«ãƒ¼ãƒã‚¤ãƒ³ãƒˆ:</strong></label>
                                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px;">
                                    <button class="anchor-btn" data-anchor="LT" style="padding: 8px; border: 1px solid #ddd; background: #f8f9fa; cursor: pointer;">LT</button>
                                    <button class="anchor-btn" data-anchor="TC" style="padding: 8px; border: 1px solid #ddd; background: #f8f9fa; cursor: pointer;">TC</button>
                                    <button class="anchor-btn" data-anchor="RT" style="padding: 8px; border: 1px solid #ddd; background: #f8f9fa; cursor: pointer;">RT</button>
                                    <button class="anchor-btn" data-anchor="LC" style="padding: 8px; border: 1px solid #ddd; background: #f8f9fa; cursor: pointer;">LC</button>
                                    <button class="anchor-btn selected" data-anchor="CC" style="padding: 8px; border: 1px solid #3498db; background: #3498db; color: white; cursor: pointer;">CC</button>
                                    <button class="anchor-btn" data-anchor="RC" style="padding: 8px; border: 1px solid #ddd; background: #f8f9fa; cursor: pointer;">RC</button>
                                    <button class="anchor-btn" data-anchor="LB" style="padding: 8px; border: 1px solid #ddd; background: #f8f9fa; cursor: pointer;">LB</button>
                                    <button class="anchor-btn" data-anchor="BC" style="padding: 8px; border: 1px solid #ddd; background: #f8f9fa; cursor: pointer;">BC</button>
                                    <button class="anchor-btn" data-anchor="RB" style="padding: 8px; border: 1px solid #ddd; background: #f8f9fa; cursor: pointer;">RB</button>
                                </div>
                            </div>
                            
                            <div style="margin: 20px 0;">
                                <label style="display: block; margin-bottom: 10px;"><strong>âš–ï¸ ã‚¹ã‚±ãƒ¼ãƒ«ãƒ¢ãƒ¼ãƒ‰:</strong></label>
                                <select id="scale-mode" style="width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #ddd;">
                                    <option value="element-linked" selected>ğŸ”— element-linked - è¦ç´ ã‚µã‚¤ã‚ºé€£å‹•</option>
                                    <option value="fixed-size">ğŸ“ fixed-size - å›ºå®šã‚µã‚¤ã‚º</option>
                                    <option value="typography">ğŸ“ typography - ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºé€£å‹•</option>
                                </select>
                            </div>
                            
                            <div style="display: flex; gap: 10px; margin-top: 20px;">
                                <button onclick="this.closest('.dialog-overlay').remove()" style="flex: 1; padding: 10px; background: #95a5a6; color: white; border: none; border-radius: 5px; cursor: pointer;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                                <button onclick="autoPinTest.handleDialogApply('image'); this.closest('.dialog-overlay').remove()" style="flex: 1; padding: 10px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer;">é©ç”¨</button>
                            </div>
                        </div>
                    </div>
                `;

                // ã‚¢ãƒ³ã‚«ãƒ¼ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯å‡¦ç†
                dialog.addEventListener('click', (e) => {
                    if (e.target.classList.contains('anchor-btn')) {
                        dialog.querySelectorAll('.anchor-btn').forEach(btn => {
                            btn.classList.remove('selected');
                            btn.style.background = '#f8f9fa';
                            btn.style.color = 'black';
                            btn.style.border = '1px solid #ddd';
                        });
                        e.target.classList.add('selected');
                        e.target.style.background = '#3498db';
                        e.target.style.color = 'white';
                        e.target.style.border = '1px solid #3498db';
                    }
                });

                return dialog;
            }

            // ãƒªã‚¹ãƒˆè¦ç´ å°‚ç”¨ãƒ€ã‚¤ã‚¢ãƒ­ã‚°
            createListElementDialog(element) {
                const dialog = document.createElement('div');
                dialog.className = 'autopin-dialog';
                dialog.innerHTML = `
                    <div class="dialog-overlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000;">
                        <div class="dialog-content" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; min-width: 400px; box-shadow: 0 20px 40px rgba(0,0,0,0.3);">
                            <h3 style="margin-top: 0; color: #9b59b6;">ğŸ“‹ ãƒªã‚¹ãƒˆè¦ç´ æœ€é©åŒ–UI</h3>
                            <div style="background: rgba(155, 89, 182, 0.1); padding: 15px; border-radius: 8px; margin: 15px 0;">
                                <strong>è¦ç´ :</strong> ${element.tagName}${element.id ? '#' + element.id : ''}<br>
                                <strong>æ¤œå‡ºã‚¿ã‚¤ãƒ—:</strong> ãƒªã‚¹ãƒˆè¦ç´ <br>
                                <strong>å†…å®¹:</strong> ${element.textContent.substring(0, 50)}...
                            </div>
                            
                            <div style="margin: 20px 0;">
                                <label style="display: block; margin-bottom: 10px;"><strong>ğŸ¯ ãƒªã‚¹ãƒˆå°‚ç”¨ã‚¢ãƒ³ã‚«ãƒ¼:</strong></label>
                                <select id="list-anchor" style="width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #ddd;">
                                    <option value="marker" selected>ğŸ“ marker - ãƒªã‚¹ãƒˆãƒãƒ¼ã‚«ãƒ¼åŸºæº–</option>
                                    <option value="text-start">ğŸ“ text-start - ãƒ†ã‚­ã‚¹ãƒˆé–‹å§‹ä½ç½®</option>
                                    <option value="CC">ğŸ“ CC - ä¸­å¤®</option>
                                </select>
                            </div>
                            
                            <div style="margin: 20px 0;">
                                <label style="display: block; margin-bottom: 10px;"><strong>âš–ï¸ ã‚¹ã‚±ãƒ¼ãƒ«ãƒ¢ãƒ¼ãƒ‰:</strong></label>
                                <select id="scale-mode" style="width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #ddd;">
                                    <option value="element-linked" selected>ğŸ”— element-linked - è¦ç´ ã‚µã‚¤ã‚ºé€£å‹•</option>
                                    <option value="fixed-size">ğŸ“ fixed-size - å›ºå®šã‚µã‚¤ã‚º</option>
                                    <option value="typography">ğŸ“ typography - ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºé€£å‹•</option>
                                </select>
                            </div>
                            
                            <div style="display: flex; gap: 10px; margin-top: 20px;">
                                <button onclick="this.closest('.dialog-overlay').remove()" style="flex: 1; padding: 10px; background: #95a5a6; color: white; border: none; border-radius: 5px; cursor: pointer;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                                <button onclick="autoPinTest.handleDialogApply('list'); this.closest('.dialog-overlay').remove()" style="flex: 1; padding: 10px; background: #9b59b6; color: white; border: none; border-radius: 5px; cursor: pointer;">é©ç”¨</button>
                            </div>
                        </div>
                    </div>
                `;
                return dialog;
            }

            // æ±ç”¨è¦ç´ ãƒ€ã‚¤ã‚¢ãƒ­ã‚°
            createGenericElementDialog(element) {
                const dialog = document.createElement('div');
                dialog.className = 'autopin-dialog';
                dialog.innerHTML = `
                    <div class="dialog-overlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000;">
                        <div class="dialog-content" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; min-width: 400px; box-shadow: 0 20px 40px rgba(0,0,0,0.3);">
                            <h3 style="margin-top: 0; color: #7f8c8d;">ğŸ”§ æ±ç”¨è¦ç´ æœ€é©åŒ–UI</h3>
                            <div style="background: rgba(127, 140, 141, 0.1); padding: 15px; border-radius: 8px; margin: 15px 0;">
                                <strong>è¦ç´ :</strong> ${element.tagName}${element.id ? '#' + element.id : ''}<br>
                                <strong>æ¤œå‡ºã‚¿ã‚¤ãƒ—:</strong> æ±ç”¨è¦ç´ <br>
                                <strong>å†…å®¹:</strong> ${element.textContent ? element.textContent.substring(0, 50) + '...' : 'ç”»åƒãƒ»æ··åœ¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„'}
                            </div>
                            
                            <div style="margin: 20px 0;">
                                <label style="display: block; margin-bottom: 10px;"><strong>ğŸ¯ 9ã‚¢ãƒ³ã‚«ãƒ¼ãƒã‚¤ãƒ³ãƒˆ:</strong></label>
                                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px;">
                                    <button class="anchor-btn" data-anchor="LT" style="padding: 8px; border: 1px solid #ddd; background: #f8f9fa; cursor: pointer;">LT</button>
                                    <button class="anchor-btn" data-anchor="TC" style="padding: 8px; border: 1px solid #ddd; background: #f8f9fa; cursor: pointer;">TC</button>
                                    <button class="anchor-btn" data-anchor="RT" style="padding: 8px; border: 1px solid #ddd; background: #f8f9fa; cursor: pointer;">RT</button>
                                    <button class="anchor-btn" data-anchor="LC" style="padding: 8px; border: 1px solid #ddd; background: #f8f9fa; cursor: pointer;">LC</button>
                                    <button class="anchor-btn selected" data-anchor="CC" style="padding: 8px; border: 1px solid #7f8c8d; background: #7f8c8d; color: white; cursor: pointer;">CC</button>
                                    <button class="anchor-btn" data-anchor="RC" style="padding: 8px; border: 1px solid #ddd; background: #f8f9fa; cursor: pointer;">RC</button>
                                    <button class="anchor-btn" data-anchor="LB" style="padding: 8px; border: 1px solid #ddd; background: #f8f9fa; cursor: pointer;">LB</button>
                                    <button class="anchor-btn" data-anchor="BC" style="padding: 8px; border: 1px solid #ddd; background: #f8f9fa; cursor: pointer;">BC</button>
                                    <button class="anchor-btn" data-anchor="RB" style="padding: 8px; border: 1px solid #ddd; background: #f8f9fa; cursor: pointer;">RB</button>
                                </div>
                            </div>
                            
                            <div style="margin: 20px 0;">
                                <label style="display: block; margin-bottom: 10px;"><strong>âš–ï¸ ã‚¹ã‚±ãƒ¼ãƒ«ãƒ¢ãƒ¼ãƒ‰:</strong></label>
                                <select id="scale-mode" style="width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #ddd;">
                                    <option value="element-linked" selected>ğŸ”— element-linked - è¦ç´ ã‚µã‚¤ã‚ºé€£å‹•</option>
                                    <option value="fixed-size">ğŸ“ fixed-size - å›ºå®šã‚µã‚¤ã‚º</option>
                                    <option value="typography">ğŸ“ typography - ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºé€£å‹•</option>
                                </select>
                            </div>
                            
                            <div style="display: flex; gap: 10px; margin-top: 20px;">
                                <button onclick="this.closest('.dialog-overlay').remove()" style="flex: 1; padding: 10px; background: #95a5a6; color: white; border: none; border-radius: 5px; cursor: pointer;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                                <button onclick="autoPinTest.handleDialogApply('generic'); this.closest('.dialog-overlay').remove()" style="flex: 1; padding: 10px; background: #7f8c8d; color: white; border: none; border-radius: 5px; cursor: pointer;">é©ç”¨</button>
                            </div>
                        </div>
                    </div>
                `;

                // ã‚¢ãƒ³ã‚«ãƒ¼ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯å‡¦ç†
                dialog.addEventListener('click', (e) => {
                    if (e.target.classList.contains('anchor-btn')) {
                        dialog.querySelectorAll('.anchor-btn').forEach(btn => {
                            btn.classList.remove('selected');
                            btn.style.background = '#f8f9fa';
                            btn.style.color = 'black';
                            btn.style.border = '1px solid #ddd';
                        });
                        e.target.classList.add('selected');
                        e.target.style.background = '#7f8c8d';
                        e.target.style.color = 'white';
                        e.target.style.border = '1px solid #7f8c8d';
                    }
                });

                return dialog;
            }

            // ãƒ€ã‚¤ã‚¢ãƒ­ã‚°é©ç”¨å‡¦ç†
            handleDialogApply(elementType) {
                const dialog = document.querySelector('.autopin-dialog');
                if (!dialog) return;

                console.log('ğŸ“‹ ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¨­å®šé©ç”¨:', elementType);

                // è¨­å®šå€¤åé›†
                const settings = {};
                
                switch (elementType) {
                    case 'text':
                        settings.anchor = dialog.querySelector('#text-anchor').value;
                        settings.anchorKind = 'text-center';
                        settings.scaleMode = dialog.querySelector('#scale-mode').value;
                        settings.baseFontPx = parseInt(dialog.querySelector('#base-font').value);
                        break;
                        
                    case 'image':
                        const selectedAnchor = dialog.querySelector('.anchor-btn.selected');
                        settings.anchor = selectedAnchor ? selectedAnchor.dataset.anchor : 'CC';
                        settings.anchorKind = 'block';
                        settings.scaleMode = dialog.querySelector('#scale-mode').value;
                        break;
                        
                    case 'list':
                        settings.anchor = dialog.querySelector('#list-anchor').value;
                        settings.anchorKind = 'marker';
                        settings.scaleMode = dialog.querySelector('#scale-mode').value;
                        break;
                        
                    case 'generic':
                        const selectedGenericAnchor = dialog.querySelector('.anchor-btn.selected');
                        settings.anchor = selectedGenericAnchor ? selectedGenericAnchor.dataset.anchor : 'CC';
                        settings.anchorKind = 'block';
                        settings.scaleMode = dialog.querySelector('#scale-mode').value;
                        break;
                }

                console.log('âœ… åé›†ã•ã‚ŒãŸè¨­å®š:', settings);
                
                // PinContractç”Ÿæˆï¼ˆãƒ¢ãƒƒã‚¯ï¼‰
                const mockContract = {
                    refElement: this.lastSelectedElement,
                    logicalSize: { w: 600, h: 400 },
                    anchorKind: settings.anchorKind,
                    align: settings.anchor,
                    fit: 'contain',
                    scaleMode: settings.scaleMode,
                    baseFontPx: settings.baseFontPx || 16
                };
                
                console.log('ğŸ“‹ ç”Ÿæˆã•ã‚ŒãŸPinContractï¼ˆãƒ¢ãƒƒã‚¯ï¼‰:', mockContract);
                this.updateStatus('è¨­å®šé©ç”¨å®Œäº†', `${elementType}:${settings.anchor}`, settings.scaleMode);
            }

            setupEventListeners() {
                // å…¨ã¦ã®ãƒ†ã‚¹ãƒˆè¦ç´ ã«ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ 
                const testElements = [
                    // ãƒ†ã‚­ã‚¹ãƒˆè¦ç´ 
                    '#test-heading', '#test-paragraph', '#test-span', '#test-span2', '#test-rtl',
                    // ç”»åƒè¦ç´   
                    '#test-image1', '#test-image2',
                    // ãƒªã‚¹ãƒˆè¦ç´ 
                    '#test-li1', '#test-li2', '#test-li3', '#test-li4',
                    // æ±ç”¨è¦ç´ 
                    '#test-div', '#test-button', '#test-button2', '#test-mixed'
                ];

                testElements.forEach(selector => {
                    const element = document.querySelector(selector);
                    if (element) {
                        // ã‚¯ãƒªãƒƒã‚¯å¯èƒ½è¦ç´ ã®ã‚¯ãƒ©ã‚¹è¿½åŠ 
                        element.classList.add('clickable-element');
                        
                        element.addEventListener('click', (event) => {
                            event.preventDefault();
                            this.handleElementClick(element);
                        });
                    }
                });

                console.log(`âœ… ${testElements.length}å€‹ã®ãƒ†ã‚¹ãƒˆè¦ç´ ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®šå®Œäº†`);
            }

            async handleElementClick(element) {
                try {
                    console.log('ğŸ¯ è¦ç´ ã‚¯ãƒªãƒƒã‚¯:', element.tagName, element.id || element.className);
                    
                    this.lastSelectedElement = element;
                    
                    // è¦ç´ ã‚¿ã‚¤ãƒ—æ¤œå‡ºï¼ˆAutoPinSelectorã®å†…éƒ¨ãƒ¡ã‚½ãƒƒãƒ‰ã‚’åˆ©ç”¨ï¼‰
                    const elementType = this.detectElementType(element);
                    console.log('ğŸ“‹ æ¤œå‡ºã•ã‚ŒãŸè¦ç´ ã‚¿ã‚¤ãƒ—:', elementType);
                    
                    this.updateStatus('è¦ç´ ã‚¯ãƒªãƒƒã‚¯æ¤œå‡º', element.tagName + (element.id ? '#' + element.id : ''), elementType);
                    
                    // AutoPinSelectorå‘¼ã³å‡ºã—
                    if (this.autopin && typeof this.autopin.selectElement === 'function') {
                        await this.autopin.selectElement(element);
                        console.log('âœ… AutoPinè¦ç´ é¸æŠå®Œäº†');
                    } else {
                        console.warn('âš ï¸ AutoPinSelector.selectElement()ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                    }
                    
                } catch (error) {
                    console.error('âŒ è¦ç´ ã‚¯ãƒªãƒƒã‚¯å‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);
                    this.updateStatus('å‡¦ç†ã‚¨ãƒ©ãƒ¼', error.message, 'ã‚¨ãƒ©ãƒ¼');
                }
            }

            // AutoPinSelectorã®è¦ç´ ã‚¿ã‚¤ãƒ—æ¤œå‡ºãƒ­ã‚¸ãƒƒã‚¯ã‚’è¤‡è£½ï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
            detectElementType(element) {
                const tagName = element.tagName.toLowerCase();
                
                // ç”»åƒè¦ç´ 
                if (tagName === 'img') {
                    return 'image';
                }
                
                // ãƒªã‚¹ãƒˆè¦ç´ 
                if (tagName === 'li') {
                    return 'list';
                }
                
                // ãƒ†ã‚­ã‚¹ãƒˆè¦ç´ 
                const textTags = ['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'p', 'span'];
                if (textTags.includes(tagName)) {
                    return 'text';
                }
                
                // DIVãƒ»BUTTONãªã©ã®æ±ç”¨è¦ç´  - å†…å®¹ã«å¿œã˜ã¦åˆ¤å®š
                if (tagName === 'div' || tagName === 'button' || tagName === 'section') {
                    // ãƒ†ã‚­ã‚¹ãƒˆå«æœ‰ãƒã‚§ãƒƒã‚¯
                    if (element.textContent.trim().length > 0) {
                        // ç”»åƒã‚‚å«æœ‰ã—ã¦ã„ã‚‹å ´åˆ
                        if (element.querySelector('img')) {
                            return 'generic'; // æ··åœ¨ â†’ æ±ç”¨UI
                        }
                        return 'text'; // ãƒ†ã‚­ã‚¹ãƒˆã®ã¿
                    }
                    // ç”»åƒå«æœ‰ãƒã‚§ãƒƒã‚¯
                    if (element.querySelector('img')) {
                        return 'image';
                    }
                }
                
                return 'generic';
            }

            updateStatus(state, element, elementType) {
                const timestamp = new Date().toLocaleTimeString();
                this.statusContent.innerHTML = `
                    <div class="status-item"><strong>çŠ¶æ…‹:</strong> ${state}</div>
                    <div class="status-item"><strong>æœ€çµ‚é¸æŠ:</strong> ${element}</div>
                    <div class="status-item"><strong>è¦ç´ ã‚¿ã‚¤ãƒ—:</strong> ${elementType}</div>
                    <div class="status-item"><strong>æ™‚åˆ»:</strong> ${timestamp}</div>
                `;
            }

            // ãƒ‡ãƒãƒƒã‚°ç”¨ãƒ¡ã‚½ãƒƒãƒ‰
            getTestResults() {
                return {
                    autopin: this.autopin,
                    lastSelected: this.lastSelectedElement,
                    autoPinStatus: this.autopin ? 'initialized' : 'not_initialized'
                };
            }
        }

        // ãƒ†ã‚¹ãƒˆç’°å¢ƒåˆæœŸåŒ–
        let autoPinTest;
        
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸŒŸ è¦ç´ åˆ¥æœ€é©åŒ–AutoPinãƒ†ã‚¹ãƒˆç’°å¢ƒé–‹å§‹');
            autoPinTest = new ElementOptimizedAutoPinTest();
            
            // ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ‡ãƒãƒƒã‚°ã‚¢ã‚¯ã‚»ã‚¹
            window.autoPinTest = autoPinTest;
        });

        // ãƒ‡ãƒãƒƒã‚°ç”¨ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°
        window.debugAutoPin = function() {
            console.log('ğŸ” AutoPin Debug Info:');
            console.log(autoPinTest.getTestResults());
            return autoPinTest.getTestResults();
        };
    </script>
</body>
</html>