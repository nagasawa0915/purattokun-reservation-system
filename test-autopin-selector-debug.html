<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoPinSelector ãƒ‡ãƒãƒƒã‚°ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        
        .controls {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .controls button {
            background: #007acc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        .controls button:hover {
            background: #0056b3;
        }
        
        .test-elements {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin: 20px 0;
        }
        
        .test-element {
            background: white;
            border: 2px solid #ccc;
            border-radius: 8px;
            padding: 20px;
            min-width: 100px;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .test-element:hover {
            border-color: #007acc;
            background: #f0f8ff;
        }
        
        .small-element {
            width: 30px;   /* æœ€å°ã‚µã‚¤ã‚º10pxã‚ˆã‚Šå¤§ãã„ï¼ˆé¸æŠå¯èƒ½ï¼‰ */
            height: 25px;
            background: #ff6b6b;
            min-width: unset;  /* è¦ªã® min-width ã‚’ä¸Šæ›¸ã */
            min-height: unset; /* è¦ªã® min-height ã‚’ä¸Šæ›¸ã */
        }
        
        .medium-element {
            width: 120px;  /* ä¸­ã‚µã‚¤ã‚ºè¦ç´  */
            height: 80px;
            background: #4ecdc4;
        }
        
        .large-element {
            width: 200px;
            height: 100px;
            background: #45b7d1;
        }
        
        .status {
            background: #f8f9fa;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid #28a745;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .error {
            border-left-color: #dc3545;
            background: #fff5f5;
        }
        
        .debug-info {
            background: rgba(0, 0, 0, 0.9);
            color: #00ff00;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª AutoPinSelector ãƒ‡ãƒãƒƒã‚°ãƒ†ã‚¹ãƒˆ</h1>
    <p>ä¿®æ­£ã•ã‚ŒãŸAutoPinSelectorã®å‹•ä½œç¢ºèªç”¨ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸</p>
    <div class="controls">
        <p><strong>ğŸ“ ä»•æ§˜æ›¸ç¢ºèªæ¸ˆã¿é¸æŠå¯¾è±¡:</strong></p>
        <ul style="margin: 5px 0; padding-left: 20px;">
            <li>è¦‹å‡ºã—ï¼ˆH1-H6ï¼‰: ã€Œè¦‹å‡ºã—H2ã®å³è‚©ã€</li>
            <li>æ®µè½ï¼ˆPï¼‰: ã€Œæ®µè½æœ«å°¾è¿½å¾“ã€</li>
            <li>ãƒ†ã‚­ã‚¹ãƒˆï¼ˆSPANï¼‰: ã€ŒåŸºæº–è¦ç´ ï¼ˆspanç­‰ï¼‰ã€</li>
            <li>ç”»åƒãƒ»DIV: ã€ŒåŸºæº–è¦ç´ ï¼ˆimg/divç­‰ï¼‰ã€</li>
        </ul>
    </div>
    
    <div class="controls">
        <h3>ğŸ¯ ãƒ†ã‚¹ãƒˆåˆ¶å¾¡</h3>
        <button onclick="testElementSelection()">ğŸ“ è¦ç´ é¸æŠãƒ†ã‚¹ãƒˆ</button>
        <button onclick="testSmallElementValidation()">ğŸ” æœ€å°ã‚µã‚¤ã‚ºæ¤œè¨¼ãƒ†ã‚¹ãƒˆ</button>
        <button onclick="testDialogButtons()">ğŸ–±ï¸ ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãƒœã‚¿ãƒ³ãƒ†ã‚¹ãƒˆ</button>
        <button onclick="showElementSizes()">ğŸ“ è¦ç´ ã‚µã‚¤ã‚ºè¡¨ç¤º</button>
        <button onclick="clearStatus()">ğŸ—‘ï¸ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å‰Šé™¤</button>
    </div>
    
    <div id="status-area"></div>
    
    <h3>ğŸ“¦ ãƒ†ã‚¹ãƒˆç”¨è¦ç´ ï¼ˆminElementSize: 10pxã«å¤‰æ›´æ¸ˆã¿ï¼‰</h3>
    <div class="test-elements">
        <div class="test-element small-element" id="small-test" title="å°ã•ã„è¦ç´ ï¼ˆ30x25pxï¼‰">
            å°ã•ã„è¦ç´ 
        </div>
        <div class="test-element medium-element" id="medium-test" title="ä¸­ã‚µã‚¤ã‚ºè¦ç´ ï¼ˆ120x80pxï¼‰">
            ä¸­ã‚µã‚¤ã‚ºè¦ç´ 
        </div>
        <div class="test-element large-element" id="large-test" title="å¤§ããªè¦ç´ ï¼ˆ200x100pxï¼‰">
            å¤§ããªè¦ç´ 
        </div>
        <h2 id="heading-test" title="è¦‹å‡ºã—è¦ç´ ï¼ˆä»•æ§˜æ›¸ã§æ˜è¨˜ï¼‰">
            ğŸ“ è¦‹å‡ºã—H2è¦ç´ ãƒ†ã‚¹ãƒˆ
        </h2>
        <p id="paragraph-test" title="æ®µè½è¦ç´ ï¼ˆä»•æ§˜æ›¸ã§æ˜è¨˜ï¼‰">
            ã“ã®æ®µè½è¦ç´ ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ†ã‚¹ãƒˆã€‚ä»•æ§˜æ›¸ã§ã¯ã€Œæ®µè½æœ«å°¾è¿½å¾“ã€ã¨æ˜è¨˜ã•ã‚Œã¦ã„ã¾ã™ã€‚
        </p>
        <span id="span-test" title="ãƒ†ã‚­ã‚¹ãƒˆè¦ç´ ï¼ˆä»•æ§˜æ›¸ã§æ˜è¨˜ï¼‰">
            ğŸ·ï¸ spanãƒ†ã‚­ã‚¹ãƒˆè¦ç´ 
        </span>
        <div class="test-element" id="text-element" title="divãƒ†ã‚­ã‚¹ãƒˆè¦ç´ ">
            <p>divãƒ†ã‚­ã‚¹ãƒˆè¦ç´ ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ†ã‚¹ãƒˆ</p>
        </div>
        <div id="tiny-element" title="æ¥µå°è£…é£¾è¦ç´ ï¼ˆ3x3px - é™¤å¤–å¯¾è±¡ï¼‰" style="width: 3px; height: 3px; background: #ffd700; margin: 10px; display: inline-block;">
        </div>
        <div id="micro-element" title="æ¥µå°è£…é£¾è¦ç´ ï¼ˆ5x5px - é™¤å¤–å¯¾è±¡ï¼‰" style="width: 5px; height: 5px; background: #ff69b4; margin: 10px; display: inline-block;">
        </div>
    </div>
    
    <div id="debug-info" class="debug-info" style="display: none;">
        <h4>ğŸ” Debug Information</h4>
        <div id="debug-content">ãƒ‡ãƒãƒƒã‚°æƒ…å ±ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</div>
    </div>
    
    <script type="module">
        import { AutoPinSelector } from './micromodules/autopin/AutoPinSelector.js';
        
        let autoSelector = null;
        let testInProgress = false;
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            autoSelector = new AutoPinSelector();
            updateStatus('âœ… AutoPinSelectoråˆæœŸåŒ–å®Œäº†');
            console.log('ğŸš€ AutoPinSelector debug test initialized');
        });
        
        /**
         * è¦ç´ é¸æŠãƒ†ã‚¹ãƒˆ
         */
        window.testElementSelection = async function() {
            if (!autoSelector || testInProgress) {
                updateStatus('âŒ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã§ãã¾ã›ã‚“ï¼ˆåˆæœŸåŒ–æœªå®Œäº†ã¾ãŸã¯ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­ï¼‰', true);
                return;
            }
            
            testInProgress = true;
            
            try {
                updateStatus('ğŸ¯ è¦ç´ é¸æŠãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¾ã™ã€‚ãƒ†ã‚¹ãƒˆç”¨è¦ç´ ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚');
                
                const contract = await autoSelector.selectElement({
                    logicalSize: { w: 300, h: 200 },
                    fit: 'contain',
                    scaleMode: 'container'
                });
                
                updateStatus('âœ… è¦ç´ é¸æŠãƒ†ã‚¹ãƒˆæˆåŠŸï¼');
                updateStatus(`ğŸ“‹ Contractç”Ÿæˆ: ${JSON.stringify(contract, null, 2)}`);
                console.log('âœ… Test Success - Contract:', contract);
                
            } catch (error) {
                if (error.message === 'Selection cancelled') {
                    updateStatus('âš ï¸ ãƒ†ã‚¹ãƒˆã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸ');
                } else {
                    updateStatus(`âŒ ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`, true);
                    console.error('âŒ Test Failed:', error);
                }
            } finally {
                testInProgress = false;
            }
        };
        
        /**
         * æœ€å°ã‚µã‚¤ã‚ºæ¤œè¨¼ãƒ†ã‚¹ãƒˆ
         */
        window.testSmallElementValidation = function() {
            updateStatus('ğŸ” æœ€å°ã‚µã‚¤ã‚ºæ¤œè¨¼ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œä¸­...');
            
            const elements = [
                { id: 'small-test', expectedValid: true },   // 30x25px > 10px ãªã®ã§é¸æŠå¯èƒ½
                { id: 'medium-test', expectedValid: true },  // 120x80px
                { id: 'large-test', expectedValid: true },  // 200x100px
                { id: 'heading-test', expectedValid: true }, // è¦‹å‡ºã—è¦ç´ ï¼ˆä»•æ§˜æ›¸ã§æ˜è¨˜ï¼‰
                { id: 'paragraph-test', expectedValid: true }, // æ®µè½è¦ç´ ï¼ˆä»•æ§˜æ›¸ã§æ˜è¨˜ï¼‰
                { id: 'span-test', expectedValid: true },     // spanè¦ç´ ï¼ˆä»•æ§˜æ›¸ã§æ˜è¨˜ï¼‰
                { id: 'tiny-element', expectedValid: false }, // 3x3px < 10px ãªã®ã§é™¤å¤–
                { id: 'micro-element', expectedValid: false } // 5x5px < 10px ãªã®ã§é™¤å¤–
            ];
            
            elements.forEach(({ id, expectedValid }) => {
                const element = document.getElementById(id);
                const rect = element.getBoundingClientRect();
                const isValid = autoSelector._isValidElement(element);
                
                const status = isValid === expectedValid ? 'âœ…' : 'âŒ';
                updateStatus(`${status} ${id}: ${rect.width}x${rect.height}px - Valid: ${isValid} (Expected: ${expectedValid})`);
            });
            
            updateStatus('ğŸ” æœ€å°ã‚µã‚¤ã‚ºæ¤œè¨¼ãƒ†ã‚¹ãƒˆå®Œäº†');
        };
        
        /**
         * ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãƒœã‚¿ãƒ³ãƒ†ã‚¹ãƒˆ
         */
        window.testDialogButtons = async function() {
            updateStatus('ğŸ–±ï¸ ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãƒœã‚¿ãƒ³ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...');
            
            // æ‰‹å‹•ã§ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤ºã‚’ãƒ†ã‚¹ãƒˆ
            const testElement = document.getElementById('large-test');
            
            autoSelector._createAnchorSelectorDialog(
                testElement,
                (align, anchorKind) => {
                    updateStatus(`âœ… Confirm clicked! Align: ${align}, AnchorKind: ${anchorKind}`);
                    console.log('âœ… Confirm callback executed:', { align, anchorKind });
                },
                (error) => {
                    updateStatus('âŒ Cancel clicked or error occurred');
                    console.log('âŒ Cancel callback executed:', error);
                }
            );
            
            updateStatus('ğŸ–±ï¸ ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸã€‚Confirmã¾ãŸã¯Cancelãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚');
        };
        
        /**
         * è¦ç´ ã‚µã‚¤ã‚ºè¡¨ç¤º
         */
        window.showElementSizes = function() {
            updateStatus('ğŸ“ è¦ç´ ã‚µã‚¤ã‚ºã‚’è¡¨ç¤ºä¸­...');
            
            const elements = document.querySelectorAll('.test-element');
            elements.forEach(element => {
                const rect = element.getBoundingClientRect();
                const id = element.id || element.className;
                updateStatus(`ğŸ“ ${id}: ${rect.width.toFixed(1)}x${rect.height.toFixed(1)}px`);
            });
            
            updateStatus('ğŸ“ è¦ç´ ã‚µã‚¤ã‚ºè¡¨ç¤ºå®Œäº†');
        };
        
        /**
         * ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
         */
        function updateStatus(message, isError = false) {
            const statusArea = document.getElementById('status-area');
            const statusDiv = document.createElement('div');
            statusDiv.className = isError ? 'status error' : 'status';
            statusDiv.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            
            statusArea.appendChild(statusDiv);
            
            // è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            statusDiv.scrollIntoView({ behavior: 'smooth' });
            
            // å¤ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å‰Šé™¤ï¼ˆ15å€‹ã¾ã§ä¿æŒï¼‰
            while (statusArea.children.length > 15) {
                statusArea.removeChild(statusArea.firstChild);
            }
        }
        
        /**
         * ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å‰Šé™¤
         */
        window.clearStatus = function() {
            const statusArea = document.getElementById('status-area');
            statusArea.innerHTML = '';
            updateStatus('ğŸ—‘ï¸ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
        };
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        window.autoSelector = autoSelector;
    </script>
</body>
</html>