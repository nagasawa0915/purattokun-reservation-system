<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¯ ã‚·ãƒ³ãƒ—ãƒ«ãƒ”ãƒ³ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        /* ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚¤ãƒ¡ãƒ¼ã‚¸ */
        .hero-section {
            position: relative;
            width: 100%;
            height: 400px;
            background: linear-gradient(135deg, rgba(0,0,0,0.4), rgba(0,0,0,0.2)), 
                        url('https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80') no-repeat center;
            background-size: cover;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
        }
        
        .hero-section::after {
            content: "ğŸ¯ ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¨ãƒªã‚¢\A(èƒŒæ™¯ç”»åƒ: background-size: cover)";
            white-space: pre;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
            background: rgba(0,0,0,0.3);
            padding: 16px;
            border-radius: 8px;
        }
        
        /* ç”»åƒã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .image-section {
            position: relative;
            width: 300px;
            height: 200px;
            margin: 30px auto;
            background: url('https://images.unsplash.com/photo-1516026672322-bc52d61a55d5?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80') no-repeat center;
            background-size: cover;
            border-radius: 8px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
        }
        
        .image-section::after {
            content: "ğŸ“¸ ãƒ†ã‚¹ãƒˆç”»åƒ\A(300px Ã— 200px)";
            white-space: pre;
            position: absolute;
            bottom: 10px;
            left: 10px;
            color: white;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
            font-size: 14px;
        }
        
        /* ãƒ†ã‚­ã‚¹ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .text-section {
            padding: 40px;
        }
        
        .text-section h1 {
            font-size: 28px;
            color: #333;
            margin-bottom: 16px;
            border-bottom: 3px solid #ff6b35;
            padding-bottom: 8px;
        }
        
        .text-section p {
            font-size: 16px;
            line-height: 1.6;
            color: #666;
            margin-bottom: 16px;
        }
        
        /* Spineã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ */
        #spine-canvas {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            border-radius: 4px;
        }
        
        /* ãƒ†ã‚¹ãƒˆç”¨ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« */
        .controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.95);
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
            z-index: 2000;
        }
        
        .control-button {
            display: block;
            width: 100%;
            margin: 4px 0;
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            background: #ff6b35;
            color: white;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }
        
        .control-button:hover {
            background: #e55a2d;
            transform: translateY(-1px);
        }
        
        .control-button.secondary {
            background: #6c757d;
        }
        
        .control-button.secondary:hover {
            background: #5a6268;
        }
        
        /* ãƒ­ã‚°ãƒ‘ãƒãƒ« */
        .log-panel {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 400px;
            max-height: 200px;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 16px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            overflow-y: auto;
            z-index: 2000;
        }
        
        .log-entry {
            margin: 2px 0;
        }
        
        .log-success { color: #28a745; }
        .log-warning { color: #ffc107; }
        .log-error { color: #dc3545; }
        .log-info { color: #17a2b8; }
    </style>
</head>
<body>
    <div class="container">
        <!-- ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚¤ãƒ¡ãƒ¼ã‚¸ -->
        <div class="hero-section" id="hero-section">
            <!-- Spineã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã¯ã“ã“ã«é…ç½® -->
            <canvas id="spine-canvas" width="400" height="400"></canvas>
        </div>
        
        <!-- ç”»åƒã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="image-section" id="image-section">
            <!-- èƒŒæ™¯ç”»åƒã¯CSSã§è¡¨ç¤º -->
        </div>
        
        <!-- ãƒ†ã‚­ã‚¹ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="text-section">
            <h1 id="main-heading">ğŸ¯ ã‚·ãƒ³ãƒ—ãƒ«ãƒ”ãƒ³ãƒ†ã‚¹ãƒˆ</h1>
            <p id="article-text">
                ã“ã®ãƒšãƒ¼ã‚¸ã¯ã€PureBoundingBoxAutoPinã‚·ã‚¹ãƒ†ãƒ ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ãŸã‚ã®ã‚·ãƒ³ãƒ—ãƒ«ãªç’°å¢ƒã§ã™ã€‚
                ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚¤ãƒ¡ãƒ¼ã‚¸ã€ç”»åƒã€ãƒ†ã‚­ã‚¹ãƒˆè¦ç´ ãŒã‚ã‚Šã€ãã‚Œãã‚Œã«ãƒ”ãƒ³ã‚’è¨­å®šã—ã¦ãƒ†ã‚¹ãƒˆã§ãã¾ã™ã€‚
            </p>
            <p>
                å³ä¸Šã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«ã‹ã‚‰å„æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„ã€‚
                å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€å·¦ä¸‹ã®ãƒ­ã‚°ãƒ‘ãƒãƒ«ã§ã‚¨ãƒ©ãƒ¼è©³ç´°ã‚’ç¢ºèªã§ãã¾ã™ã€‚
            </p>
        </div>
    </div>
    
    <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« -->
    <div class="controls">
        <h4 style="margin: 0 0 12px 0; font-size: 14px;">ğŸ® ãƒ†ã‚¹ãƒˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«</h4>
        <button class="control-button" onclick="initializeSpineCharacter()">
            ğŸ¨ Spineã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åˆæœŸåŒ–
        </button>
        <button class="control-button" onclick="startBoundingBoxEdit()">
            ğŸ“¦ BBç·¨é›†é–‹å§‹
        </button>
        <button class="control-button" onclick="startPinSetting()">
            ğŸ“ ãƒ”ãƒ³è¨­å®šé–‹å§‹
        </button>
        <button class="control-button secondary" onclick="showAllPins()">
            ğŸ‘ï¸ å…¨ãƒ”ãƒ³è¡¨ç¤º
        </button>
        <button class="control-button secondary" onclick="hideAllPins()">
            ğŸš« å…¨ãƒ”ãƒ³éè¡¨ç¤º
        </button>
        <button class="control-button secondary" onclick="cleanupAll()">
            ğŸ§¹ å…¨ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
        </button>
        <button class="control-button secondary" onclick="diagnoseSystem()">
            ğŸ” ã‚·ã‚¹ãƒ†ãƒ è¨ºæ–­
        </button>
        <button class="control-button secondary" onclick="checkAspectRatio()">
            ğŸ“ ç¸¦æ¨ªæ¯”ãƒã‚§ãƒƒã‚¯
        </button>
    </div>
    
    <!-- ãƒ­ã‚°ãƒ‘ãƒãƒ« -->
    <div class="log-panel" id="log-panel">
        <div class="log-entry log-info">ğŸ¯ ã‚·ãƒ³ãƒ—ãƒ«ãƒ”ãƒ³ãƒ†ã‚¹ãƒˆé–‹å§‹æº–å‚™å®Œäº†</div>
    </div>

    <!-- å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªèª­ã¿è¾¼ã¿ -->
    <!-- Spine WebGL -->
    <script src="https://unpkg.com/@esotericsoftware/spine-webgl@4.1.24/dist/iife/spine-webgl.js"></script>
    
    <!-- StableSpineRenderer -->
    <script src="micromodules/spine-renderer/StableSpineRenderer.js"></script>
    
    <!-- ğŸ”§ ElementObserver Phase 1ï¼ˆAutoPinå¿…é ˆä¾å­˜ï¼‰ -->
    <script src="micromodules/element-observer/ElementObserverCore.js"></script>
    <script src="micromodules/element-observer/ElementObserver.js"></script>
    
    <!-- PureBoundingBoxï¼ˆãƒãƒ‹ãƒ¥ã‚¢ãƒ«é€šã‚Šã«å…¨ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ï¼‰ -->
    <script src="micromodules/bounding-box/PureBoundingBoxCore.js"></script>
    <script src="micromodules/bounding-box/PureBoundingBoxBounds.js"></script>
    <script src="micromodules/bounding-box/PureBoundingBoxUI.js"></script>
    <script src="micromodules/bounding-box/PureBoundingBoxEvents.js"></script>
    <script src="micromodules/bounding-box/PureBoundingBox.js"></script>
    
    <!-- AutoPinæ©Ÿèƒ½ï¼ˆElementObserverä¾å­˜ï¼‰ -->
    <script src="micromodules/bounding-box/PureBoundingBoxAutoPin.js"></script>
    
    <!-- TwoStageSelector -->
    <script src="micromodules/element-selector/ElementHighlighter.js"></script>
    <script src="micromodules/element-selector/ElementSelector.js"></script>
    <script src="micromodules/element-selector/TwoStageSelector.js"></script>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let spineRenderer = null;
        let boundingBox = null;
        let autoPin = null;
        
        // ãƒ­ã‚°æ©Ÿèƒ½
        function log(message, type = 'info') {
            const logPanel = document.getElementById('log-panel');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = new Date().toLocaleTimeString() + ' - ' + message;
            logPanel.appendChild(entry);
            logPanel.scrollTop = logPanel.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        // 1. Spineã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åˆæœŸåŒ–ï¼ˆStableSpineRendererãƒãƒ‹ãƒ¥ã‚¢ãƒ«é€šã‚Šï¼‰
        async function initializeSpineCharacter() {
            try {
                log('ğŸ¨ Spineã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åˆæœŸåŒ–é–‹å§‹', 'info');
                
                // StableSpineRendererã‚’ä½¿ç”¨ï¼ˆãƒãƒ‹ãƒ¥ã‚¢ãƒ«é€šã‚Šï¼‰
                spineRenderer = StableSpineRenderer.createForCharacter('purattokun');
                await spineRenderer.initialize();
                
                // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å†ç”Ÿ
                spineRenderer.playAnimation('taiki');
                
                log('âœ… Spineã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åˆæœŸåŒ–å®Œäº†', 'success');
                
            } catch (error) {
                log(`âŒ Spineã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        // 2. ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ç·¨é›†é–‹å§‹ï¼ˆPureBoundingBoxãƒãƒ‹ãƒ¥ã‚¢ãƒ«é€šã‚Šï¼‰
        async function startBoundingBoxEdit() {
            try {
                log('ğŸ“¦ ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ç·¨é›†é–‹å§‹', 'info');
                
                const targetElement = document.getElementById('spine-canvas');
                if (!targetElement) {
                    throw new Error('spine-canvasè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
                
                // PureBoundingBoxä½œæˆï¼ˆãƒãƒ‹ãƒ¥ã‚¢ãƒ«é€šã‚Šï¼‰
                boundingBox = new PureBoundingBox({
                    targetElement: targetElement
                });
                
                // ç·¨é›†é–‹å§‹
                const result = await boundingBox.execute();
                
                if (result.success) {
                    log('âœ… ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ç·¨é›†ãƒ¢ãƒ¼ãƒ‰é–‹å§‹æˆåŠŸ', 'success');
                } else {
                    throw new Error(result.error);
                }
                
            } catch (error) {
                log(`âŒ ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ç·¨é›†ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        // 3. ãƒ”ãƒ³è¨­å®šé–‹å§‹ï¼ˆTwoStageSelectorä½¿ç”¨ï¼‰
        async function startPinSetting() {
            try {
                log('ğŸ“ ãƒ”ãƒ³è¨­å®šé–‹å§‹', 'info');
                
                if (!boundingBox) {
                    log('âš ï¸ å…ˆã«ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ç·¨é›†ã‚’é–‹å§‹ã—ã¦ãã ã•ã„', 'warning');
                    return;
                }
                
                // å³ã‚¯ãƒªãƒƒã‚¯ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ãƒ”ãƒ³è¨­å®šã‚’é–‹å§‹
                // PureBoundingBoxUIã®å³ã‚¯ãƒªãƒƒã‚¯ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ©Ÿèƒ½ã‚’ä½¿ç”¨
                log('ğŸ’¡ Spineã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€Œãƒ”ãƒ³è¨­å®šã€ã‚’é¸æŠã—ã¦ãã ã•ã„', 'info');
                
            } catch (error) {
                log(`âŒ ãƒ”ãƒ³è¨­å®šã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        // 4. å…¨ãƒ”ãƒ³è¡¨ç¤º
        function showAllPins() {
            try {
                log('ğŸ‘ï¸ å…¨ãƒ”ãƒ³è¡¨ç¤ºé–‹å§‹', 'info');
                
                // AutoPinã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’åˆæœŸåŒ–ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
                initializeAutoPin();
                
                // åˆ©ç”¨å¯èƒ½ãªãƒ”ãƒ³è¡¨ç¤ºæ©Ÿèƒ½ã‚’å®Ÿè¡Œ
                const nodeId = 'spine-canvas';
                
                if (window.currentAutoPin) {
                    window.currentAutoPin.showAnchorPoint(nodeId);
                    window.currentAutoPin.showUserPin(nodeId);
                    log('âœ… ã‚¢ãƒ³ã‚«ãƒ¼ãƒã‚¤ãƒ³ãƒˆã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ”ãƒ³ã‚’è¡¨ç¤ºã—ã¾ã—ãŸ', 'success');
                } else {
                    log('âš ï¸ AutoPinã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒã‚ã‚Šã¾ã›ã‚“', 'warning');
                }
                
            } catch (error) {
                log(`âŒ ãƒ”ãƒ³è¡¨ç¤ºã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        // AutoPinåˆæœŸåŒ–ãƒ˜ãƒ«ãƒ‘ãƒ¼
        function initializeAutoPin() {
            if (!window.currentAutoPin && boundingBox) {
                try {
                    log('ğŸ”§ AutoPinåˆæœŸåŒ–é–‹å§‹', 'info');
                    
                    // ElementObserverã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
                    let elementObserver = null;
                    if (window.ElementObserver) {
                        try {
                            elementObserver = new window.ElementObserver();
                            log('âœ… ElementObserver ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆæˆåŠŸ', 'success');
                        } catch (error) {
                            log(`âš ï¸ ElementObserver ä½œæˆå¤±æ•—: ${error.message}`, 'warning');
                        }
                    }
                    
                    // AutoPinã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
                    const targetElement = document.getElementById('spine-canvas');
                    if (targetElement) {
                        window.currentAutoPin = new window.PureBoundingBoxAutoPin({
                            targetElement: targetElement,
                            nodeId: 'spine-canvas'
                        }, elementObserver);
                        
                        log('âœ… AutoPinåˆæœŸåŒ–å®Œäº†', 'success');
                    } else {
                        log('âŒ spine-canvasè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
                    }
                    
                } catch (error) {
                    log(`âŒ AutoPinåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                }
            }
        }
        
        // 5. å…¨ãƒ”ãƒ³éè¡¨ç¤º
        function hideAllPins() {
            try {
                log('ğŸš« å…¨ãƒ”ãƒ³éè¡¨ç¤ºé–‹å§‹', 'info');
                
                // å…¨ã¦ã®è¦–è¦šçš„ãƒ”ãƒ³ãƒãƒ¼ã‚«ãƒ¼ã‚’å‰Šé™¤
                const pins = document.querySelectorAll('[id*="marker"], [class*="pin"], [class*="anchor"]');
                pins.forEach(pin => pin.remove());
                
                log(`âœ… ${pins.length}å€‹ã®ãƒ”ãƒ³ãƒãƒ¼ã‚«ãƒ¼ã‚’éè¡¨ç¤ºã«ã—ã¾ã—ãŸ`, 'success');
                
            } catch (error) {
                log(`âŒ ãƒ”ãƒ³éè¡¨ç¤ºã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        // 6. å…¨ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
        function cleanupAll() {
            try {
                log('ğŸ§¹ å…¨ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–‹å§‹', 'warning');
                
                // ãƒã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒœãƒƒã‚¯ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
                if (boundingBox) {
                    boundingBox.cleanup();
                    boundingBox = null;
                }
                
                // Spineãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
                if (spineRenderer) {
                    spineRenderer.cleanup();
                    spineRenderer = null;
                }
                
                // ãƒ”ãƒ³ãƒãƒ¼ã‚«ãƒ¼å‰Šé™¤
                const pins = document.querySelectorAll('[id*="marker"], [class*="pin"], [class*="anchor"]');
                pins.forEach(pin => pin.remove());
                
                // LocalStorageã‚¯ãƒªã‚¢ï¼ˆãƒ”ãƒ³é–¢é€£ã®ã¿ï¼‰
                const storageKeys = Object.keys(localStorage);
                const pinKeys = storageKeys.filter(key => key.includes('pin') || key.includes('autopin'));
                pinKeys.forEach(key => localStorage.removeItem(key));
                
                log(`âœ… å…¨ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†ï¼ˆãƒ”ãƒ³${pins.length}å€‹ã€ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸${pinKeys.length}å€‹å‰Šé™¤ï¼‰`, 'success');
                
            } catch (error) {
                log(`âŒ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        // ã‚·ã‚¹ãƒ†ãƒ è¨ºæ–­
        function diagnoseSystem() {
            try {
                log('ğŸ” ã‚·ã‚¹ãƒ†ãƒ è¨ºæ–­é–‹å§‹', 'info');
                
                // åŸºæœ¬ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç¢ºèª
                const modules = {
                    'Spine WebGL': typeof spine !== 'undefined',
                    'StableSpineRenderer': typeof window.StableSpineRenderer !== 'undefined',
                    'ElementObserver': typeof window.ElementObserver !== 'undefined',
                    'ElementObserverCore': typeof window.ElementObserverCore !== 'undefined',
                    'PureBoundingBox': typeof window.PureBoundingBox !== 'undefined',
                    'PureBoundingBoxAutoPin': typeof window.PureBoundingBoxAutoPin !== 'undefined',
                    'TwoStageSelector': typeof window.TwoStageSelector !== 'undefined'
                };
                
                log('ğŸ“‹ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«çŠ¶æ³:', 'info');
                Object.entries(modules).forEach(([name, available]) => {
                    log(`  ${available ? 'âœ…' : 'âŒ'} ${name}: ${available ? 'Available' : 'Missing'}`, available ? 'success' : 'error');
                });
                
                // ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç¢ºèª
                log('ğŸ¯ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹çŠ¶æ³:', 'info');
                log(`  SpineRenderer: ${spineRenderer ? 'âœ… åˆæœŸåŒ–æ¸ˆã¿' : 'âŒ æœªåˆæœŸåŒ–'}`, spineRenderer ? 'success' : 'warning');
                log(`  BoundingBox: ${boundingBox ? 'âœ… åˆæœŸåŒ–æ¸ˆã¿' : 'âŒ æœªåˆæœŸåŒ–'}`, boundingBox ? 'success' : 'warning');
                log(`  AutoPin: ${window.currentAutoPin ? 'âœ… åˆæœŸåŒ–æ¸ˆã¿' : 'âŒ æœªåˆæœŸåŒ–'}`, window.currentAutoPin ? 'success' : 'warning');
                
                // è¦ç´ ç¢ºèª
                const elements = {
                    'spine-canvas': document.getElementById('spine-canvas'),
                    'hero-section': document.getElementById('hero-section'),
                    'image-section': document.getElementById('image-section'),
                    'main-heading': document.getElementById('main-heading')
                };
                
                log('ğŸ­ è¦ç´ çŠ¶æ³:', 'info');
                Object.entries(elements).forEach(([name, element]) => {
                    if (element) {
                        const rect = element.getBoundingClientRect();
                        log(`  âœ… ${name}: ${rect.width.toFixed(0)}Ã—${rect.height.toFixed(0)}px`, 'success');
                    } else {
                        log(`  âŒ ${name}: è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`, 'error');
                    }
                });
                
                log('âœ… ã‚·ã‚¹ãƒ†ãƒ è¨ºæ–­å®Œäº†', 'success');
                
            } catch (error) {
                log(`âŒ ã‚·ã‚¹ãƒ†ãƒ è¨ºæ–­ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        // ç¸¦æ¨ªæ¯”ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½
        function checkAspectRatio() {
            try {
                log('ğŸ“ ç¸¦æ¨ªæ¯”ãƒã‚§ãƒƒã‚¯é–‹å§‹', 'info');
                
                const heroSection = document.getElementById('hero-section');
                const spineCanvas = document.getElementById('spine-canvas');
                
                if (!heroSection || !spineCanvas) {
                    log('âŒ è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
                    return;
                }
                
                // åˆæœŸè¨ˆæ¸¬
                const heroRect = heroSection.getBoundingClientRect();
                const canvasRect = spineCanvas.getBoundingClientRect();
                
                const heroAspectRatio = heroRect.width / heroRect.height;
                const canvasAspectRatio = canvasRect.width / canvasRect.height;
                
                log('ğŸ“Š ç¾åœ¨ã®ã‚µã‚¤ã‚º:', 'info');
                log(`  ğŸ¯ ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³: ${heroRect.width.toFixed(1)}Ã—${heroRect.height.toFixed(1)}px (æ¯”ç‡: ${heroAspectRatio.toFixed(3)})`, 'info');
                log(`  ğŸ¨ Spineã‚­ãƒ£ãƒ³ãƒã‚¹: ${canvasRect.width.toFixed(1)}Ã—${canvasRect.height.toFixed(1)}px (æ¯”ç‡: ${canvasAspectRatio.toFixed(3)})`, 'info');
                
                // ResizeObserverã§å‹•çš„ç›£è¦–
                if (window.aspectRatioObserver) {
                    window.aspectRatioObserver.disconnect();
                }
                
                window.aspectRatioObserver = new ResizeObserver((entries) => {
                    for (let entry of entries) {
                        const { width, height } = entry.contentRect;
                        const newAspectRatio = width / height;
                        const element = entry.target;
                        
                        if (element.id === 'hero-section') {
                            log(`ğŸ“ ãƒ’ãƒ¼ãƒ­ãƒ¼ç¸¦æ¨ªæ¯”å¤‰åŒ–: ${width.toFixed(1)}Ã—${height.toFixed(1)}px â†’ æ¯”ç‡: ${newAspectRatio.toFixed(3)}`, 'warning');
                        } else if (element.id === 'spine-canvas') {
                            log(`ğŸ¨ ã‚­ãƒ£ãƒ³ãƒã‚¹ç¸¦æ¨ªæ¯”å¤‰åŒ–: ${width.toFixed(1)}Ã—${height.toFixed(1)}px â†’ æ¯”ç‡: ${newAspectRatio.toFixed(3)}`, 'warning');
                        }
                    }
                });
                
                // ä¸¡æ–¹ã®è¦ç´ ã‚’ç›£è¦–
                window.aspectRatioObserver.observe(heroSection);
                window.aspectRatioObserver.observe(spineCanvas);
                
                log('âœ… ç¸¦æ¨ªæ¯”ç›£è¦–é–‹å§‹ - ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’ãƒªã‚µã‚¤ã‚ºã—ã¦ç¢ºèªã—ã¦ãã ã•ã„', 'success');
                log('ğŸ’¡ ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºã‚’å¤‰æ›´ã™ã‚‹ã¨ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ç¸¦æ¨ªæ¯”ã®å¤‰åŒ–ã‚’ãƒ­ã‚°ã«è¡¨ç¤ºã—ã¾ã™', 'info');
                
                // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºæƒ…å ±ã‚‚è¡¨ç¤º
                log(`ğŸ–¥ï¸ ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚º: ${window.innerWidth}Ã—${window.innerHeight}px`, 'info');
                
            } catch (error) {
                log(`âŒ ç¸¦æ¨ªæ¯”ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            }
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†æ™‚
        window.addEventListener('load', () => {
            log('ğŸš€ ã‚·ãƒ³ãƒ—ãƒ«ãƒ”ãƒ³ãƒ†ã‚¹ãƒˆç’°å¢ƒæº–å‚™å®Œäº†', 'success');
            log('ğŸ’¡ å³ä¸Šã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‹ã‚‰å„æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„', 'info');
        });
        
        // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
        window.addEventListener('error', (event) => {
            log(`âŒ ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼: ${event.error?.message || event.message}`, 'error');
        });
        
    </script>
</body>
</html>