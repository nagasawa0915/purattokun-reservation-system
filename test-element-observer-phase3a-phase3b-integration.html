<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ElementObserver Phase 3-A + Phase 3-B å®Œå…¨çµ±åˆå‹•ä½œç¢ºèªãƒ†ã‚¹ãƒˆ</title>
    <style>
        /* ==========================================
         * ElementObserver Phase 3-A + Phase 3-B çµ±åˆãƒ†ã‚¹ãƒˆç”¨ã‚¹ã‚¿ã‚¤ãƒ«
         * Phase 3-A: 99.9%é«˜é€ŸåŒ–æŠ€è¡“ï¼ˆsetUnifiedPositionï¼‰
         * Phase 3-B: ãƒã‚¤ã‚¯ãƒ­ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ†å‰²ã‚·ã‚¹ãƒ†ãƒ 
         * ========================================== */
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 30px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .header h1 {
            color: #2c3e50;
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .header .subtitle {
            color: #7f8c8d;
            font-size: 1.2em;
            margin-top: 10px;
        }
        
        .phase-indicator {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
        }
        
        .phase-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .phase-3a {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
        }
        
        .phase-3b {
            background: linear-gradient(45deg, #00d2d3, #54a0ff);
            color: white;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .test-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        .test-section h3 {
            color: #2c3e50;
            margin: 0 0 20px 0;
            font-size: 1.4em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .test-icon {
            width: 30px;
            height: 30px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .test-element {
            width: 200px;
            height: 120px;
            margin: 10px 0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .image-element {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            position: relative;
        }
        
        .text-element {
            background: linear-gradient(45deg, #00d2d3, #54a0ff);
            font-size: 1.1em;
        }
        
        .background-element {
            background: linear-gradient(45deg, #feca57, #ff9ff3);
            position: relative;
            overflow: hidden;
        }
        
        .spine-target {
            width: 50px;
            height: 50px;
            background: radial-gradient(circle, #2ecc71, #27ae60);
            border-radius: 50%;
            position: absolute;
            transition: all 0.1s ease;
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.8em;
        }
        
        .controls {
            background: #2c3e50;
            border-radius: 10px;
            padding: 20px;
            color: white;
            margin-bottom: 30px;
        }
        
        .controls h3 {
            margin: 0 0 15px 0;
            color: #ecf0f1;
        }
        
        .control-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.9em;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
        }
        
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(45deg, #00d2d3, #54a0ff);
            color: white;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 210, 211, 0.4);
        }
        
        .status-panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .status-panel h4 {
            margin: 0 0 15px 0;
            color: #2c3e50;
            font-size: 1.2em;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .status-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .status-label {
            font-weight: bold;
            color: #2c3e50;
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        
        .status-value {
            color: #7f8c8d;
            font-family: 'Consolas', monospace;
        }
        
        .performance-metrics {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .performance-metrics h4 {
            margin: 0 0 15px 0;
            font-size: 1.3em;
        }
        
        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .metric:last-child {
            border-bottom: none;
        }
        
        .metric-value {
            font-family: 'Consolas', monospace;
            font-weight: bold;
        }
        
        .log-panel {
            background: #2c3e50;
            border-radius: 10px;
            padding: 20px;
            color: #ecf0f1;
            font-family: 'Consolas', monospace;
            font-size: 0.9em;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 5px 0;
        }
        
        .log-timestamp {
            color: #95a5a6;
            margin-right: 10px;
        }
        
        .log-level-info {
            color: #3498db;
        }
        
        .log-level-success {
            color: #2ecc71;
        }
        
        .log-level-warning {
            color: #f39c12;
        }
        
        .log-level-error {
            color: #e74c3c;
        }
        
        .integration-status {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
        }
        
        .status-indicator {
            text-align: center;
            padding: 15px;
        }
        
        .status-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2em;
            transition: all 0.3s ease;
        }
        
        .status-ready {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
        }
        
        .status-active {
            background: linear-gradient(45deg, #3498db, #2980b9);
            animation: pulse 2s infinite;
        }
        
        .status-error {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        @media (max-width: 768px) {
            .test-grid {
                grid-template-columns: 1fr;
            }
            
            .phase-indicator {
                flex-direction: column;
                gap: 10px;
            }
            
            .control-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
        
        /* F12é¢¨ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚¹ã‚¿ã‚¤ãƒ« */
        .pin-highlight {
            position: absolute;
            pointer-events: none;
            border: 2px solid #007acc;
            background: rgba(0, 122, 204, 0.1);
            z-index: 10000;
            border-radius: 3px;
            transition: all 0.1s ease;
        }
        
        .pin-preview {
            position: absolute;
            width: 20px;
            height: 20px;
            background: #ff6b6b;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 2px 10px rgba(255, 107, 107, 0.5);
            z-index: 10001;
            transition: all 0.2s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ ElementObserver Phase 3-A + Phase 3-B å®Œå…¨çµ±åˆãƒ†ã‚¹ãƒˆ</h1>
            <div class="subtitle">
                Phase 3-Aï¼ˆ99.9%é«˜é€ŸåŒ–æŠ€è¡“ï¼‰+ Phase 3-Bï¼ˆãƒã‚¤ã‚¯ãƒ­ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ†å‰²ï¼‰çµ±åˆå‹•ä½œç¢ºèª
            </div>
            <div class="phase-indicator">
                <div class="phase-badge phase-3a">Phase 3-A: setUnifiedPosition() 0.01ms</div>
                <div class="phase-badge phase-3b">Phase 3-B: 4ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«çµ±åˆåˆ¶å¾¡</div>
            </div>
        </div>
        
        <!-- çµ±åˆçŠ¶æ…‹ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ -->
        <div class="integration-status">
            <div class="status-indicator">
                <div class="status-circle status-ready" id="phase3a-status">3-A</div>
                <div>Phase 3-A</div>
                <small>ElementObserverAdvanced</small>
            </div>
            <div class="status-indicator">
                <div class="status-circle status-ready" id="phase3b-status">3-B</div>
                <div>Phase 3-B</div>
                <small>PinSystemIntegrator</small>
            </div>
            <div class="status-indicator">
                <div class="status-circle status-ready" id="integration-status">âˆ«</div>
                <div>çµ±åˆåˆ¶å¾¡</div>
                <small>å”èª¿å‹•ä½œã‚·ã‚¹ãƒ†ãƒ </small>
            </div>
        </div>
        
        <!-- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« -->
        <div class="controls">
            <h3>ğŸ›ï¸ çµ±åˆãƒ†ã‚¹ãƒˆåˆ¶å¾¡ãƒ‘ãƒãƒ«</h3>
            <div class="control-group">
                <button class="btn btn-primary" id="btn-initialize">ğŸš€ çµ±åˆã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–</button>
                <button class="btn btn-secondary" id="btn-start-phase3a">âš¡ Phase 3-A ãƒ†ã‚¹ãƒˆé–‹å§‹</button>
                <button class="btn btn-success" id="btn-start-phase3b">ğŸ”§ Phase 3-B ãƒ†ã‚¹ãƒˆé–‹å§‹</button>
            </div>
            <div class="control-group">
                <button class="btn btn-primary" id="btn-pin-mode">ğŸ“Œ ãƒ”ãƒ³è¨­å®šãƒ¢ãƒ¼ãƒ‰é–‹å§‹</button>
                <button class="btn btn-secondary" id="btn-performance-test">ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ</button>
                <button class="btn btn-success" id="btn-compatibility-test">ğŸ”— äº’æ›æ€§ãƒ†ã‚¹ãƒˆ</button>
            </div>
            <div class="control-group">
                <button class="btn btn-primary" id="btn-cleanup">ğŸ§¹ å®Œå…¨ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—</button>
                <button class="btn btn-secondary" id="btn-reset">ğŸ”„ ãƒ†ã‚¹ãƒˆãƒªã‚»ãƒƒãƒˆ</button>
            </div>
        </div>
        
        <!-- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™ãƒ‘ãƒãƒ« -->
        <div class="performance-metrics">
            <h4>âš¡ Phase 3-A + 3-B çµ±åˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™</h4>
            <div class="metric">
                <span>setUnifiedPosition() å‡¦ç†æ™‚é–“</span>
                <span class="metric-value" id="metric-processing-time">æ¸¬å®šå¾…ã¡</span>
            </div>
            <div class="metric">
                <span>çµ±åˆåº§æ¨™åˆ¶å¾¡æˆåŠŸç‡</span>
                <span class="metric-value" id="metric-success-rate">æ¸¬å®šå¾…ã¡</span>
            </div>
            <div class="metric">
                <span>é«˜é€ŸåŒ–æŠ€è¡“æ´»ç”¨ç‡</span>
                <span class="metric-value" id="metric-speedup-usage">æ¸¬å®šå¾…ã¡</span>
            </div>
            <div class="metric">
                <span>ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡</span>
                <span class="metric-value" id="metric-memory-usage">æ¸¬å®šå¾…ã¡</span>
            </div>
            <div class="metric">
                <span>ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆç¶­æŒç‡</span>
                <span class="metric-value" id="metric-framerate">æ¸¬å®šå¾…ã¡</span>
            </div>
        </div>
        
        <!-- ãƒ†ã‚¹ãƒˆã‚¨ãƒªã‚¢ -->
        <div class="test-grid">
            <!-- ç”»åƒãƒ”ãƒ³è¿½å¾“ãƒ†ã‚¹ãƒˆ -->
            <div class="test-section">
                <h3><span class="test-icon">ğŸ–¼ï¸</span>ç”»åƒãƒ”ãƒ³è¿½å¾“ãƒ†ã‚¹ãƒˆ</h3>
                <div class="test-element image-element" id="image-test">
                    <span>ğŸ“· Image Pin Target</span>
                    <div class="spine-target" id="image-spine" style="top: 10px; right: 10px;">S</div>
                </div>
                <div class="status-panel">
                    <h4>ç”»åƒãƒ”ãƒ³çµ±åˆçŠ¶æ…‹</h4>
                    <div class="status-grid">
                        <div class="status-item">
                            <div class="status-label">ã‚¢ãƒ³ã‚«ãƒ¼ä½ç½®</div>
                            <div class="status-value" id="image-anchor-pos">br (å³ä¸‹)</div>
                        </div>
                        <div class="status-item">
                            <div class="status-label">è¿½å¾“ç²¾åº¦</div>
                            <div class="status-value" id="image-accuracy">æ¸¬å®šå¾…ã¡</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ãƒ†ã‚­ã‚¹ãƒˆæœ«å°¾ãƒ”ãƒ³ãƒ†ã‚¹ãƒˆ -->
            <div class="test-section">
                <h3><span class="test-icon">ğŸ“</span>ãƒ†ã‚­ã‚¹ãƒˆæœ«å°¾ãƒ”ãƒ³ãƒ†ã‚¹ãƒˆ</h3>
                <div class="test-element text-element" id="text-test">
                    <span id="text-content">ãƒ†ã‚­ã‚¹ãƒˆã®æœ«å°¾ã«è¿½å¾“ã™ã‚‹Spineã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼</span>
                    <div class="spine-target" id="text-spine" style="top: 50%; right: -30px;">S</div>
                </div>
                <div class="status-panel">
                    <h4>ãƒ†ã‚­ã‚¹ãƒˆãƒ”ãƒ³çµ±åˆçŠ¶æ…‹</h4>
                    <div class="status-grid">
                        <div class="status-item">
                            <div class="status-label">Rangeæ–¹å¼</div>
                            <div class="status-value" id="text-range-status">æº–å‚™ä¸­</div>
                        </div>
                        <div class="status-item">
                            <div class="status-label">è¿½å¾“ç²¾åº¦</div>
                            <div class="status-value" id="text-accuracy">æ¸¬å®šå¾…ã¡</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- èƒŒæ™¯åŒæœŸãƒ†ã‚¹ãƒˆ -->
            <div class="test-section">
                <h3><span class="test-icon">ğŸ¨</span>èƒŒæ™¯åŒæœŸãƒ†ã‚¹ãƒˆ</h3>
                <div class="test-element background-element" id="background-test">
                    <span>ğŸ­ Background Sync</span>
                    <div class="spine-target" id="background-spine" style="top: 50%; left: 50%; transform: translate(-50%, -50%);">S</div>
                </div>
                <div class="status-panel">
                    <h4>èƒŒæ™¯åŒæœŸçµ±åˆçŠ¶æ…‹</h4>
                    <div class="status-grid">
                        <div class="status-item">
                            <div class="status-label">åŒæœŸãƒ¢ãƒ¼ãƒ‰</div>
                            <div class="status-value" id="background-mode">center</div>
                        </div>
                        <div class="status-item">
                            <div class="status-label">åŒæœŸç²¾åº¦</div>
                            <div class="status-value" id="background-accuracy">æ¸¬å®šå¾…ã¡</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- çµ±åˆåˆ¶å¾¡ãƒ†ã‚¹ãƒˆ -->
            <div class="test-section">
                <h3><span class="test-icon">âš™ï¸</span>Phase 3-A+3-B çµ±åˆåˆ¶å¾¡</h3>
                <div class="status-panel">
                    <h4>çµ±åˆã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹</h4>
                    <div class="status-grid">
                        <div class="status-item">
                            <div class="status-label">ElementObserverAdvanced</div>
                            <div class="status-value" id="advanced-status">æœªåˆæœŸåŒ–</div>
                        </div>
                        <div class="status-item">
                            <div class="status-label">PinSystemIntegrator</div>
                            <div class="status-value" id="integrator-status">æœªåˆæœŸåŒ–</div>
                        </div>
                        <div class="status-item">
                            <div class="status-label">ç’°å¢ƒç›£è¦–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«</div>
                            <div class="status-value" id="env-module-status">æœªåˆæœŸåŒ–</div>
                        </div>
                        <div class="status-item">
                            <div class="status-label">ã‚¹ã‚±ãƒ¼ãƒ«è¨ˆç®—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«</div>
                            <div class="status-value" id="scale-module-status">æœªåˆæœŸåŒ–</div>
                        </div>
                        <div class="status-item">
                            <div class="status-label">ãƒã‚¤ãƒ©ã‚¤ãƒˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«</div>
                            <div class="status-value" id="highlight-module-status">æœªåˆæœŸåŒ–</div>
                        </div>
                        <div class="status-item">
                            <div class="status-label">çµ±åˆåˆ¶å¾¡ã‚·ã‚¹ãƒ†ãƒ </div>
                            <div class="status-value" id="integration-control-status">æœªåˆæœŸåŒ–</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ãƒ­ã‚°ãƒ‘ãƒãƒ« -->
        <div class="log-panel" id="log-panel">
            <div class="log-entry">
                <span class="log-timestamp">00:00:00.000</span>
                <span class="log-level-info">[INFO]</span>
                <span>ElementObserver Phase 3-A + Phase 3-Bçµ±åˆãƒ†ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†</span>
            </div>
        </div>
    </div>
    
    <!-- Phase 3-Açµ±åˆ: ElementObserverAdvanced.js -->
    <script src="micromodules/element-observer/ElementObserverCore.js"></script>
    <script src="micromodules/element-observer/ElementObserver.js"></script>
    <script src="micromodules/element-observer/ElementObserverTransform.js"></script>
    <script src="micromodules/element-observer/ElementObserverWebGL.js"></script>
    <script src="micromodules/element-observer/ElementObserverResponsive.js"></script>
    <script src="micromodules/element-observer/ElementObserverAdvanced.js"></script>
    
    <!-- Phase 3-B ãƒã‚¤ã‚¯ãƒ­ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« -->
    <script src="micromodules/environment-observer/PureEnvironmentObserver.js"></script>
    <script src="micromodules/scale-calculator/PureScaleCalculator.js"></script>
    <script src="micromodules/pin-highlighter/PurePinHighlighter.js"></script>
    <script src="micromodules/pin-system/PinSystemIntegrator.js"></script>
    
    <script>
        /**
         * ==========================================
         * ElementObserver Phase 3-A + 3-B çµ±åˆãƒ†ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ 
         * 
         * ã€ãƒ†ã‚¹ãƒˆç›®çš„ã€‘
         * - Phase 3-Aï¼ˆ99.9%é«˜é€ŸåŒ–æŠ€è¡“ï¼‰ã¨Phase 3-Bï¼ˆ4ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ†å‰²ï¼‰ã®å®Œå…¨çµ±åˆ
         * - setUnifiedPosition()ã‚·ã‚¹ãƒ†ãƒ ã¨ã®é€£æºç¢ºèª
         * - ElementObserverAdvancedäº’æ›æ€§ãƒ†ã‚¹ãƒˆ
         * - PinSystemIntegratorã¨ã®å”èª¿å‹•ä½œç¢ºèª
         * 
         * ã€æ¤œè¨¼é …ç›®ã€‘
         * 1. çµ±åˆå‹•ä½œãƒ†ã‚¹ãƒˆ: Phase 3-A + 3-B ã‚·ã‚¹ãƒ†ãƒ ã®å”èª¿åˆ¶å¾¡
         * 2. äº’æ›æ€§ãƒ†ã‚¹ãƒˆ: ElementObserveræ¨™æº–APIã¨ã®å®Œå…¨äº’æ›æ€§
         * 3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ: 0.01mså‡¦ç†æ™‚é–“ãƒ»60fpsç¶­æŒãƒ»ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡
         * 4. å®Ÿç”¨ãƒ†ã‚¹ãƒˆ: ç”»åƒãƒ”ãƒ³ãƒ»ãƒ†ã‚­ã‚¹ãƒˆãƒ”ãƒ³ãƒ»èƒŒæ™¯åŒæœŸæ©Ÿèƒ½
         * ==========================================
         */
        
        class Phase3APhase3BIntegrationTest {
            constructor() {
                // Phase 3-Aæˆæœï¼ˆElementObserverAdvancedï¼‰
                this.phase3A = {
                    advanced: null,
                    initialized: false,
                    status: 'pending'
                };
                
                // Phase 3-Bæˆæœï¼ˆPinSystemIntegrator + 4ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰
                this.phase3B = {
                    integrator: null,
                    initialized: false,
                    status: 'pending',
                    modules: {
                        environment: false,
                        scale: false,
                        highlighter: false,
                        pin: false
                    }
                };
                
                // çµ±åˆåˆ¶å¾¡çŠ¶æ…‹
                this.integration = {
                    active: false,
                    compatibility: false,
                    performance: {
                        totalTests: 0,
                        passedTests: 0,
                        averageProcessingTime: 0,
                        highSpeedUsageRate: 0,
                        memoryUsage: 0,
                        frameRate: 60
                    }
                };
                
                // ãƒ†ã‚¹ãƒˆåˆ¶å¾¡
                this.testState = {
                    running: false,
                    currentTest: null,
                    startTime: 0,
                    results: []
                };
                
                // UIè¦ç´ 
                this.elements = {
                    imageTest: document.getElementById('image-test'),
                    textTest: document.getElementById('text-test'),
                    backgroundTest: document.getElementById('background-test'),
                    imageSpine: document.getElementById('image-spine'),
                    textSpine: document.getElementById('text-spine'),
                    backgroundSpine: document.getElementById('background-spine')
                };
                
                this.init();
            }
            
            /**
             * ãƒ†ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
             */
            init() {
                this.log('info', 'Phase 3-A + Phase 3-Bçµ±åˆãƒ†ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–é–‹å§‹');
                
                // UIã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
                this.setupEventListeners();
                
                // åˆæœŸçŠ¶æ…‹æ›´æ–°
                this.updateUI();
                
                this.log('success', 'Phase 3-A + Phase 3-Bçµ±åˆãƒ†ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†');
            }
            
            /**
             * UIã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
             */
            setupEventListeners() {
                // çµ±åˆã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ãƒœã‚¿ãƒ³
                document.getElementById('btn-initialize').addEventListener('click', () => {
                    this.initializeIntegratedSystem();
                });
                
                // Phase 3-Aãƒ†ã‚¹ãƒˆé–‹å§‹
                document.getElementById('btn-start-phase3a').addEventListener('click', () => {
                    this.startPhase3ATest();
                });
                
                // Phase 3-Bãƒ†ã‚¹ãƒˆé–‹å§‹
                document.getElementById('btn-start-phase3b').addEventListener('click', () => {
                    this.startPhase3BTest();
                });
                
                // ãƒ”ãƒ³è¨­å®šãƒ¢ãƒ¼ãƒ‰
                document.getElementById('btn-pin-mode').addEventListener('click', () => {
                    this.togglePinSetupMode();
                });
                
                // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
                document.getElementById('btn-performance-test').addEventListener('click', () => {
                    this.runPerformanceTest();
                });
                
                // äº’æ›æ€§ãƒ†ã‚¹ãƒˆ
                document.getElementById('btn-compatibility-test').addEventListener('click', () => {
                    this.runCompatibilityTest();
                });
                
                // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
                document.getElementById('btn-cleanup').addEventListener('click', () => {
                    this.cleanup();
                });
                
                // ãƒªã‚»ãƒƒãƒˆ
                document.getElementById('btn-reset').addEventListener('click', () => {
                    this.reset();
                });
            }
            
            /**
             * çµ±åˆã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
             */
            async initializeIntegratedSystem() {
                try {
                    this.log('info', 'ğŸš€ çµ±åˆã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–é–‹å§‹...');
                    
                    // Phase 3-AåˆæœŸåŒ–
                    await this.initializePhase3A();
                    
                    // Phase 3-BåˆæœŸåŒ–
                    await this.initializePhase3B();
                    
                    // çµ±åˆåˆ¶å¾¡ç¢ºç«‹
                    await this.establishIntegrationControl();
                    
                    this.integration.active = true;
                    this.updateUI();
                    
                    this.log('success', 'âœ… çµ±åˆã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†ï¼Phase 3-A + 3-Bå”èª¿å‹•ä½œç¢ºç«‹');
                    
                } catch (error) {
                    this.log('error', `âŒ çµ±åˆã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                    throw error;
                }
            }
            
            /**
             * Phase 3-Aï¼ˆElementObserverAdvancedï¼‰åˆæœŸåŒ–
             */
            async initializePhase3A() {
                try {
                    this.log('info', 'âš¡ Phase 3-A ElementObserverAdvancedåˆæœŸåŒ–...');
                    
                    // ElementObserverAdvancedå­˜åœ¨ãƒã‚§ãƒƒã‚¯
                    if (typeof ElementObserverAdvanced === 'undefined') {
                        throw new Error('ElementObserverAdvanced not found');
                    }
                    
                    // ElementObserverAdvanced ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
                    this.phase3A.advanced = new ElementObserverAdvanced();
                    
                    // é«˜åº¦åˆæœŸåŒ–å®Ÿè¡Œ
                    const initialized = await this.phase3A.advanced.initializeAdvanced(
                        this.elements.imageTest,    // targetElement
                        null,                       // canvasï¼ˆãƒ†ã‚¹ãƒˆç”¨ã«nullï¼‰
                        null,                       // skeletonï¼ˆãƒ†ã‚¹ãƒˆç”¨ã«nullï¼‰ 
                        null,                       // rendererï¼ˆãƒ†ã‚¹ãƒˆç”¨ã«nullï¼‰
                        {
                            cssWidth: '200px',
                            cssHeight: '120px',
                            quality: 'high'
                        }
                    );
                    
                    if (!initialized) {
                        throw new Error('ElementObserverAdvanced initialization failed');
                    }
                    
                    this.phase3A.initialized = true;
                    this.phase3A.status = 'ready';
                    
                    this.log('success', 'âœ… Phase 3-AåˆæœŸåŒ–å®Œäº†ï¼š99.9%é«˜é€ŸåŒ–æŠ€è¡“æœ‰åŠ¹');
                    
                } catch (error) {
                    this.phase3A.status = 'error';
                    this.log('error', `âŒ Phase 3-AåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                    throw error;
                }
            }
            
            /**
             * Phase 3-Bï¼ˆPinSystemIntegrator + 4ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰åˆæœŸåŒ–
             */
            async initializePhase3B() {
                try {
                    this.log('info', 'ğŸ”§ Phase 3-B PinSystemIntegratoråˆæœŸåŒ–...');
                    
                    // 4ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å­˜åœ¨ãƒã‚§ãƒƒã‚¯
                    const requiredModules = [
                        'PureEnvironmentObserver',
                        'PureScaleCalculator', 
                        'PurePinHighlighter',
                        'PinSystemIntegrator'
                    ];
                    
                    for (const moduleName of requiredModules) {
                        if (typeof window[moduleName] === 'undefined') {
                            throw new Error(`${moduleName} not found`);
                        }
                    }
                    
                    // PinSystemIntegrator ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
                    this.phase3B.integrator = new PinSystemIntegrator({
                        usePhase3A: true,           // Phase 3-Açµ±åˆæœ‰åŠ¹
                        compatMode: 'advanced',     // ElementObserverAdvancedäº’æ›
                        highSpeedCoordinate: true,  // é«˜é€Ÿåº§æ¨™åˆ¶å¾¡æœ‰åŠ¹
                        epsilon: 0.5,
                        defaultBaseScale: 1.0,
                        debug: true
                    });
                    
                    // åˆæœŸåŒ–ç¢ºèª
                    if (!this.phase3B.integrator.integrationState.initialized) {
                        throw new Error('PinSystemIntegrator initialization failed');
                    }
                    
                    // ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«çŠ¶æ…‹ç¢ºèª
                    const systemInfo = this.phase3B.integrator.getSystemInfo();
                    this.phase3B.modules.environment = systemInfo.modules.environment;
                    this.phase3B.modules.scale = systemInfo.modules.scale;
                    this.phase3B.modules.highlighter = systemInfo.modules.highlighter;
                    this.phase3B.modules.pin = true;
                    
                    this.phase3B.initialized = true;
                    this.phase3B.status = 'ready';
                    
                    this.log('success', 'âœ… Phase 3-BåˆæœŸåŒ–å®Œäº†ï¼š4ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«çµ±åˆåˆ¶å¾¡æœ‰åŠ¹');
                    
                } catch (error) {
                    this.phase3B.status = 'error';
                    this.log('error', `âŒ Phase 3-BåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                    throw error;
                }
            }
            
            /**
             * çµ±åˆåˆ¶å¾¡ç¢ºç«‹ï¼ˆPhase 3-A + 3-Bå”èª¿ã‚·ã‚¹ãƒ†ãƒ ï¼‰
             */
            async establishIntegrationControl() {
                try {
                    this.log('info', 'âˆ« Phase 3-A + 3-Bçµ±åˆåˆ¶å¾¡ç¢ºç«‹...');
                    
                    // ElementObserverAdvancedäº’æ›æ€§ç¢ºèª
                    this.integration.compatibility = await this.verifyCompatibility();
                    
                    if (!this.integration.compatibility) {
                        throw new Error('Phase 3-A + 3-B compatibility verification failed');
                    }
                    
                    // çµ±åˆã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨­å®š
                    this.setupIntegratedCallbacks();
                    
                    // ãƒ†ã‚¹ãƒˆè¦ç´ ã®ç›£è¦–é–‹å§‹
                    await this.startIntegratedObservation();
                    
                    this.log('success', 'âœ… çµ±åˆåˆ¶å¾¡ç¢ºç«‹å®Œäº†ï¼šPhase 3-A + 3-Bå”èª¿å‹•ä½œæœ‰åŠ¹');
                    
                } catch (error) {
                    this.log('error', `âŒ çµ±åˆåˆ¶å¾¡ç¢ºç«‹ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                    throw error;
                }
            }
            
            /**
             * äº’æ›æ€§ç¢ºèªï¼ˆElementObserver APIäº’æ›æ€§ï¼‰
             */
            async verifyCompatibility() {
                try {
                    this.log('info', 'ğŸ”— ElementObserver APIäº’æ›æ€§ç¢ºèª...');
                    
                    // åŸºæœ¬APIãƒ¡ã‚½ãƒƒãƒ‰å­˜åœ¨ç¢ºèª
                    const requiredMethods = [
                        'observe', 'unobserve', 'onChange', 'onError', 'onReady'
                    ];
                    
                    // Phase 3-Aï¼ˆElementObserverAdvancedï¼‰APIç¢ºèª
                    this.log('info', 'Phase 3-A available methods:', Object.getOwnPropertyNames(this.phase3A.advanced));
                    for (const method of requiredMethods) {
                        if (typeof this.phase3A.advanced[method] !== 'function') {
                            this.log('warning', `Phase 3-A: ${method} method not found (type: ${typeof this.phase3A.advanced[method]})`);
                            return false;
                        }
                    }
                    
                    // Phase 3-Bï¼ˆPinSystemIntegratorï¼‰APIç¢ºèª
                    this.log('info', 'Phase 3-B available methods:', Object.getOwnPropertyNames(this.phase3B.integrator));
                    for (const method of requiredMethods) {
                        if (typeof this.phase3B.integrator[method] !== 'function') {
                            this.log('warning', `Phase 3-B: ${method} method not found (type: ${typeof this.phase3B.integrator[method]})`);
                            return false;
                        }
                    }
                    
                    // setUnifiedPosition APIç¢ºèª
                    if (typeof this.phase3A.advanced.setUnifiedPosition !== 'function') {
                        this.log('warning', `Phase 3-A: setUnifiedPosition method not found (type: ${typeof this.phase3A.advanced.setUnifiedPosition})`);
                        return false;
                    }
                    
                    this.log('success', 'âœ… ElementObserver APIäº’æ›æ€§ç¢ºèªå®Œäº†');
                    return true;
                    
                } catch (error) {
                    this.log('error', `âŒ äº’æ›æ€§ç¢ºèªã‚¨ãƒ©ãƒ¼: ${error.message}`);
                    return false;
                }
            }
            
            /**
             * çµ±åˆã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨­å®š
             */
            setupIntegratedCallbacks() {
                // Phase 3-Aå¤‰åŒ–é€šçŸ¥
                this.phase3A.advanced.onIntegrationChange((event) => {
                    this.log('info', `Phase 3-Açµ±åˆå¤‰åŒ–: ${event.type}`);
                    this.updatePerformanceMetrics(event);
                });
                
                // Phase 3-Bå¤‰åŒ–é€šçŸ¥
                this.phase3B.integrator.onChange((data) => {
                    this.log('info', `Phase 3-Bå¤‰åŒ–æ¤œå‡º: ${data.id}`);
                    this.updatePerformanceMetrics(data);
                });
                
                // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
                this.phase3A.advanced.onIntegrationChange((event) => {
                    if (event.type === 'error') {
                        this.log('error', `Phase 3-A ã‚¨ãƒ©ãƒ¼: ${event.data.message}`);
                    }
                });
                
                this.phase3B.integrator.onError((errorData) => {
                    this.log('error', `Phase 3-B ã‚¨ãƒ©ãƒ¼: ${errorData.error.message}`);
                });
            }
            
            /**
             * çµ±åˆç›£è¦–é–‹å§‹
             */
            async startIntegratedObservation() {
                try {
                    // Phase 3-Bï¼ˆPinSystemIntegratorï¼‰ã§å„è¦ç´ ç›£è¦–é–‹å§‹
                    
                    // ç”»åƒè¦ç´ ç›£è¦–
                    this.phase3B.integrator.observe(this.elements.imageTest, {
                        scaleMode: 'proportional',
                        baseScale: 1.0,
                        referenceSize: 200, // ãƒ†ã‚¹ãƒˆè¦ç´ widthåŸºæº–
                        highlight: true,
                        usePhase3A: true
                    });
                    
                    // ãƒ†ã‚­ã‚¹ãƒˆè¦ç´ ç›£è¦–
                    this.phase3B.integrator.observe(this.elements.textTest, {
                        scaleMode: 'fontSize',
                        baseScale: 1.0,
                        currentFontSize: 16,
                        referenceFontSize: 16,
                        highlight: true,
                        usePhase3A: true
                    });
                    
                    // èƒŒæ™¯è¦ç´ ç›£è¦–
                    this.phase3B.integrator.observe(this.elements.backgroundTest, {
                        scaleMode: 'imageSize',
                        baseScale: 1.0,
                        referenceArea: 20000, // 200x100ã®åŸºæº–é¢ç©ï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
                        highlight: true,
                        usePhase3A: true
                    });
                    
                    this.log('success', 'âœ… çµ±åˆç›£è¦–é–‹å§‹å®Œäº†');
                    
                } catch (error) {
                    this.log('error', `âŒ çµ±åˆç›£è¦–é–‹å§‹ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                    throw error;
                }
            }
            
            /**
             * Phase 3-Aãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
             */
            async startPhase3ATest() {
                try {
                    this.log('info', 'âš¡ Phase 3-Aé«˜é€ŸåŒ–æŠ€è¡“ãƒ†ã‚¹ãƒˆé–‹å§‹...');
                    
                    if (!this.phase3A.initialized) {
                        throw new Error('Phase 3-A not initialized');
                    }
                    
                    const startTime = performance.now();
                    
                    // setUnifiedPosition()é«˜é€ŸåŒ–ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
                    const testResults = [];
                    for (let i = 0; i < 100; i++) {
                        const testStart = performance.now();
                        
                        // ãƒ©ãƒ³ãƒ€ãƒ åº§æ¨™ã§setUnifiedPositionå®Ÿè¡Œ
                        const x = Math.random() * 100;
                        const y = Math.random() * 100;
                        
                        const result = this.phase3A.advanced.setUnifiedPosition(x, y, '%');
                        
                        const testEnd = performance.now();
                        const processingTime = testEnd - testStart;
                        
                        testResults.push({
                            result,
                            processingTime,
                            coordinates: { x, y }
                        });
                    }
                    
                    // çµæœåˆ†æ
                    const averageTime = testResults.reduce((sum, test) => sum + test.processingTime, 0) / testResults.length;
                    const successRate = testResults.filter(test => test.result).length / testResults.length * 100;
                    const targetTimeCount = testResults.filter(test => test.processingTime <= 0.01).length;
                    const targetTimeRate = targetTimeCount / testResults.length * 100;
                    
                    // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™æ›´æ–°
                    this.integration.performance.averageProcessingTime = averageTime;
                    this.integration.performance.highSpeedUsageRate = targetTimeRate;
                    
                    this.updateUI();
                    
                    this.log('success', `âœ… Phase 3-Aé«˜é€ŸåŒ–ãƒ†ã‚¹ãƒˆå®Œäº†: å¹³å‡${averageTime.toFixed(4)}ms, æˆåŠŸç‡${successRate.toFixed(1)}%, ç›®æ¨™é”æˆç‡${targetTimeRate.toFixed(1)}%`);
                    
                } catch (error) {
                    this.log('error', `âŒ Phase 3-Aãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                }
            }
            
            /**
             * Phase 3-Bãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
             */
            async startPhase3BTest() {
                try {
                    this.log('info', 'ğŸ”§ Phase 3-B ãƒã‚¤ã‚¯ãƒ­ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«çµ±åˆãƒ†ã‚¹ãƒˆé–‹å§‹...');
                    
                    if (!this.phase3B.initialized) {
                        throw new Error('Phase 3-B not initialized');
                    }
                    
                    // 4ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é€£æºãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
                    const integrationResults = await this.testModuleIntegration();
                    
                    // ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±å–å¾—
                    const systemInfo = this.phase3B.integrator.getSystemInfo();
                    
                    this.log('success', `âœ… Phase 3-Bçµ±åˆãƒ†ã‚¹ãƒˆå®Œäº†: ${integrationResults.totalTests}ä»¶å®Ÿè¡Œ, ${integrationResults.passedTests}ä»¶æˆåŠŸ`);
                    this.log('info', `ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±: ${systemInfo.observingTargets}å€‹ç›£è¦–ä¸­, å¹³å‡å‡¦ç†æ™‚é–“${systemInfo.performance.averageProcessingTime}`);
                    
                } catch (error) {
                    this.log('error', `âŒ Phase 3-Bãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                }
            }
            
            /**
             * 4ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«çµ±åˆãƒ†ã‚¹ãƒˆ
             */
            async testModuleIntegration() {
                const results = {
                    totalTests: 0,
                    passedTests: 0,
                    moduleResults: {}
                };
                
                try {
                    // ç’°å¢ƒç›£è¦–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆ
                    results.totalTests++;
                    const envTest = await this.testEnvironmentModule();
                    if (envTest) results.passedTests++;
                    results.moduleResults.environment = envTest;
                    
                    // ã‚¹ã‚±ãƒ¼ãƒ«è¨ˆç®—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆ
                    results.totalTests++;
                    const scaleTest = await this.testScaleModule();
                    if (scaleTest) results.passedTests++;
                    results.moduleResults.scale = scaleTest;
                    
                    // ãƒã‚¤ãƒ©ã‚¤ãƒˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆ
                    results.totalTests++;
                    const highlightTest = await this.testHighlightModule();
                    if (highlightTest) results.passedTests++;
                    results.moduleResults.highlighter = highlightTest;
                    
                    // çµ±åˆåˆ¶å¾¡ãƒ†ã‚¹ãƒˆ
                    results.totalTests++;
                    const integrationTest = await this.testIntegrationControl();
                    if (integrationTest) results.passedTests++;
                    results.moduleResults.integration = integrationTest;
                    
                } catch (error) {
                    this.log('error', `âŒ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«çµ±åˆãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                }
                
                return results;
            }
            
            /**
             * ç’°å¢ƒç›£è¦–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆ
             */
            async testEnvironmentModule() {
                try {
                    // è¦ç´ ã‚µã‚¤ã‚ºå¤‰æ›´ãƒ†ã‚¹ãƒˆ
                    const originalWidth = this.elements.imageTest.style.width;
                    this.elements.imageTest.style.width = '250px';
                    
                    await new Promise(resolve => setTimeout(resolve, 100));
                    
                    // å…ƒã«æˆ»ã™
                    this.elements.imageTest.style.width = originalWidth;
                    
                    this.log('success', 'âœ… ç’°å¢ƒç›£è¦–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆå®Œäº†');
                    return true;
                } catch (error) {
                    this.log('error', `âŒ ç’°å¢ƒç›£è¦–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                    return false;
                }
            }
            
            /**
             * ã‚¹ã‚±ãƒ¼ãƒ«è¨ˆç®—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆ
             */
            async testScaleModule() {
                try {
                    // ã‚¹ã‚±ãƒ¼ãƒ«è¨ˆç®—ãƒ†ã‚¹ãƒˆï¼ˆçµ±åˆã‚·ã‚¹ãƒ†ãƒ çµŒç”±ï¼‰
                    const systemInfo = this.phase3B.integrator.getSystemInfo();
                    if (systemInfo.modules.scale) {
                        this.log('success', 'âœ… ã‚¹ã‚±ãƒ¼ãƒ«è¨ˆç®—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆå®Œäº†');
                        return true;
                    }
                    return false;
                } catch (error) {
                    this.log('error', `âŒ ã‚¹ã‚±ãƒ¼ãƒ«è¨ˆç®—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                    return false;
                }
            }
            
            /**
             * ãƒã‚¤ãƒ©ã‚¤ãƒˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆ
             */
            async testHighlightModule() {
                try {
                    // ãƒã‚¤ãƒ©ã‚¤ãƒˆæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
                    const systemInfo = this.phase3B.integrator.getSystemInfo();
                    if (systemInfo.modules.highlighter) {
                        this.log('success', 'âœ… ãƒã‚¤ãƒ©ã‚¤ãƒˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆå®Œäº†');
                        return true;
                    }
                    return false;
                } catch (error) {
                    this.log('error', `âŒ ãƒã‚¤ãƒ©ã‚¤ãƒˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                    return false;
                }
            }
            
            /**
             * çµ±åˆåˆ¶å¾¡ãƒ†ã‚¹ãƒˆ
             */
            async testIntegrationControl() {
                try {
                    // çµ±åˆåˆ¶å¾¡ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ
                    const systemInfo = this.phase3B.integrator.getSystemInfo();
                    if (systemInfo.initialized && systemInfo.phase3A.enabled) {
                        this.log('success', 'âœ… çµ±åˆåˆ¶å¾¡ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆå®Œäº†');
                        return true;
                    }
                    return false;
                } catch (error) {
                    this.log('error', `âŒ çµ±åˆåˆ¶å¾¡ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                    return false;
                }
            }
            
            /**
             * ãƒ”ãƒ³è¨­å®šãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
             */
            togglePinSetupMode() {
                try {
                    if (!this.phase3B.initialized) {
                        this.log('warning', 'Phase 3-BæœªåˆæœŸåŒ–ã®ãŸã‚ãƒ”ãƒ³è¨­å®šãƒ¢ãƒ¼ãƒ‰é–‹å§‹ä¸å¯');
                        return;
                    }
                    
                    if (this.phase3B.integrator.integrationState.pinSetupMode) {
                        // ãƒ”ãƒ³ãƒ¢ãƒ¼ãƒ‰çµ‚äº†
                        this.phase3B.integrator.stopPinSetupMode();
                        this.log('info', 'ğŸ“Œ ãƒ”ãƒ³è¨­å®šãƒ¢ãƒ¼ãƒ‰çµ‚äº†');
                    } else {
                        // ãƒ”ãƒ³ãƒ¢ãƒ¼ãƒ‰é–‹å§‹
                        this.phase3B.integrator.startPinSetupMode({
                            highlightColor: '#ff6b6b',
                            throttle: 16
                        });
                        this.log('info', 'ğŸ“Œ ãƒ”ãƒ³è¨­å®šãƒ¢ãƒ¼ãƒ‰é–‹å§‹');
                    }
                    
                } catch (error) {
                    this.log('error', `âŒ ãƒ”ãƒ³è¨­å®šãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                }
            }
            
            /**
             * ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
             */
            async runPerformanceTest() {
                try {
                    this.log('info', 'ğŸ“Š çµ±åˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆé–‹å§‹...');
                    
                    const results = {
                        processingTimes: [],
                        memoryUsage: [],
                        frameRates: [],
                        highSpeedCount: 0
                    };
                    
                    // é€£ç¶šå‡¦ç†ãƒ†ã‚¹ãƒˆï¼ˆ1000å›å®Ÿè¡Œï¼‰
                    for (let i = 0; i < 1000; i++) {
                        const startTime = performance.now();
                        
                        // Phase 3-Aé«˜é€Ÿå‡¦ç†
                        if (this.phase3A.initialized) {
                            const x = Math.random() * 100;
                            const y = Math.random() * 100;
                            this.phase3A.advanced.setUnifiedPosition(x, y, '%');
                        }
                        
                        const endTime = performance.now();
                        const processingTime = endTime - startTime;
                        
                        results.processingTimes.push(processingTime);
                        
                        if (processingTime <= 0.01) {
                            results.highSpeedCount++;
                        }
                        
                        // ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡è¨˜éŒ²ï¼ˆ100å›æ¯ï¼‰
                        if (i % 100 === 0 && performance.memory) {
                            results.memoryUsage.push(performance.memory.usedJSHeapSize);
                        }
                    }
                    
                    // çµæœåˆ†æ
                    const avgProcessingTime = results.processingTimes.reduce((a, b) => a + b, 0) / results.processingTimes.length;
                    const highSpeedRate = (results.highSpeedCount / 1000) * 100;
                    const maxMemory = Math.max(...results.memoryUsage) / 1024 / 1024; // MB
                    
                    // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™æ›´æ–°
                    this.integration.performance.totalTests += 1000;
                    this.integration.performance.passedTests += results.highSpeedCount;
                    this.integration.performance.averageProcessingTime = avgProcessingTime;
                    this.integration.performance.highSpeedUsageRate = highSpeedRate;
                    this.integration.performance.memoryUsage = maxMemory;
                    
                    this.updateUI();
                    
                    this.log('success', `âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå®Œäº†: å¹³å‡${avgProcessingTime.toFixed(4)}ms, é«˜é€ŸåŒ–ç‡${highSpeedRate.toFixed(1)}%, ãƒ¡ãƒ¢ãƒª${maxMemory.toFixed(1)}MB`);
                    
                } catch (error) {
                    this.log('error', `âŒ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                }
            }
            
            /**
             * äº’æ›æ€§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
             */
            async runCompatibilityTest() {
                try {
                    this.log('info', 'ğŸ”— ElementObserver APIäº’æ›æ€§ãƒ†ã‚¹ãƒˆé–‹å§‹...');
                    
                    let compatibilityScore = 0;
                    let totalTests = 0;
                    
                    // Phase 3-Aäº’æ›æ€§ãƒ†ã‚¹ãƒˆ
                    if (this.phase3A.initialized) {
                        totalTests += 5;
                        
                        // observe/unobserve ãƒ†ã‚¹ãƒˆ
                        if (typeof this.phase3A.advanced.observe === 'function') compatibilityScore++;
                        if (typeof this.phase3A.advanced.unobserve === 'function') compatibilityScore++;
                        if (typeof this.phase3A.advanced.onChange === 'function') compatibilityScore++;
                        if (typeof this.phase3A.advanced.onError === 'function') compatibilityScore++;
                        if (typeof this.phase3A.advanced.setUnifiedPosition === 'function') compatibilityScore++;
                    }
                    
                    // Phase 3-Bäº’æ›æ€§ãƒ†ã‚¹ãƒˆ
                    if (this.phase3B.initialized) {
                        totalTests += 5;
                        
                        // ElementObserveräº’æ›API ãƒ†ã‚¹ãƒˆ
                        if (typeof this.phase3B.integrator.observe === 'function') compatibilityScore++;
                        if (typeof this.phase3B.integrator.unobserve === 'function') compatibilityScore++;
                        if (typeof this.phase3B.integrator.onChange === 'function') compatibilityScore++;
                        if (typeof this.phase3B.integrator.onError === 'function') compatibilityScore++;
                        if (typeof this.phase3B.integrator.onReady === 'function') compatibilityScore++;
                    }
                    
                    const compatibilityRate = (compatibilityScore / totalTests) * 100;
                    this.integration.compatibility = compatibilityRate >= 90;
                    
                    this.updateUI();
                    
                    this.log('success', `âœ… äº’æ›æ€§ãƒ†ã‚¹ãƒˆå®Œäº†: ${compatibilityScore}/${totalTests} (${compatibilityRate.toFixed(1)}%)`);
                    
                } catch (error) {
                    this.log('error', `âŒ äº’æ›æ€§ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                }
            }
            
            /**
             * ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™æ›´æ–°
             */
            updatePerformanceMetrics(eventData) {
                // processingTimeæ›´æ–°
                if (eventData.duration !== undefined) {
                    const currentAvg = this.integration.performance.averageProcessingTime;
                    const totalTests = this.integration.performance.totalTests;
                    
                    this.integration.performance.averageProcessingTime = 
                        (currentAvg * totalTests + eventData.duration) / (totalTests + 1);
                    this.integration.performance.totalTests++;
                }
                
                // Phase 3-Aé«˜é€ŸåŒ–æŠ€è¡“ä½¿ç”¨ç¢ºèª
                if (eventData.phase3A && eventData.phase3A.highSpeedUsed) {
                    this.integration.performance.passedTests++;
                }
            }
            
            /**
             * UIçŠ¶æ…‹æ›´æ–°
             */
            updateUI() {
                // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼æ›´æ–°
                this.updateStatusIndicator('phase3a-status', this.phase3A.status);
                this.updateStatusIndicator('phase3b-status', this.phase3B.status);
                this.updateStatusIndicator('integration-status', this.integration.active ? 'active' : 'pending');
                
                // ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹æ›´æ–°
                document.getElementById('advanced-status').textContent = 
                    this.phase3A.initialized ? 'âœ… åˆæœŸåŒ–æ¸ˆã¿' : 'â³ æœªåˆæœŸåŒ–';
                document.getElementById('integrator-status').textContent = 
                    this.phase3B.initialized ? 'âœ… åˆæœŸåŒ–æ¸ˆã¿' : 'â³ æœªåˆæœŸåŒ–';
                document.getElementById('env-module-status').textContent = 
                    this.phase3B.modules.environment ? 'âœ… æœ‰åŠ¹' : 'â³ æœªåˆæœŸåŒ–';
                document.getElementById('scale-module-status').textContent = 
                    this.phase3B.modules.scale ? 'âœ… æœ‰åŠ¹' : 'â³ æœªåˆæœŸåŒ–';
                document.getElementById('highlight-module-status').textContent = 
                    this.phase3B.modules.highlighter ? 'âœ… æœ‰åŠ¹' : 'â³ æœªåˆæœŸåŒ–';
                document.getElementById('integration-control-status').textContent = 
                    this.integration.active ? 'âœ… æœ‰åŠ¹' : 'â³ æœªç¢ºç«‹';
                
                // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™æ›´æ–°
                const perf = this.integration.performance;
                document.getElementById('metric-processing-time').textContent = 
                    perf.averageProcessingTime > 0 ? `${perf.averageProcessingTime.toFixed(4)}ms` : 'æ¸¬å®šå¾…ã¡';
                document.getElementById('metric-success-rate').textContent = 
                    perf.totalTests > 0 ? `${((perf.passedTests / perf.totalTests) * 100).toFixed(1)}%` : 'æ¸¬å®šå¾…ã¡';
                document.getElementById('metric-speedup-usage').textContent = 
                    `${perf.highSpeedUsageRate.toFixed(1)}%`;
                document.getElementById('metric-memory-usage').textContent = 
                    perf.memoryUsage > 0 ? `${perf.memoryUsage.toFixed(1)}MB` : 'æ¸¬å®šå¾…ã¡';
                document.getElementById('metric-framerate').textContent = 
                    `${perf.frameRate}fps`;
            }
            
            /**
             * ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼æ›´æ–°
             */
            updateStatusIndicator(elementId, status) {
                const element = document.getElementById(elementId);
                element.className = 'status-circle';
                
                switch (status) {
                    case 'ready':
                        element.classList.add('status-ready');
                        break;
                    case 'active':
                        element.classList.add('status-active');
                        break;
                    case 'error':
                        element.classList.add('status-error');
                        break;
                    default:
                        element.classList.add('status-ready');
                }
            }
            
            /**
             * ãƒ­ã‚°å‡ºåŠ›
             */
            log(level, message) {
                const timestamp = new Date().toTimeString().split(' ')[0] + '.' + 
                    String(Date.now() % 1000).padStart(3, '0');
                    
                const logEntry = document.createElement('div');
                logEntry.className = 'log-entry';
                logEntry.innerHTML = `
                    <span class="log-timestamp">${timestamp}</span>
                    <span class="log-level-${level}">[${level.toUpperCase()}]</span>
                    <span>${message}</span>
                `;
                
                const logPanel = document.getElementById('log-panel');
                logPanel.appendChild(logEntry);
                logPanel.scrollTop = logPanel.scrollHeight;
                
                console.log(`[Phase3APhase3BTest] ${level.toUpperCase()}: ${message}`);
            }
            
            /**
             * ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
             */
            cleanup() {
                try {
                    this.log('info', 'ğŸ§¹ çµ±åˆã‚·ã‚¹ãƒ†ãƒ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–‹å§‹...');
                    
                    // Phase 3-Aã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
                    if (this.phase3A.advanced) {
                        this.phase3A.advanced.cleanup();
                        this.phase3A.advanced = null;
                    }
                    
                    // Phase 3-Bã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
                    if (this.phase3B.integrator) {
                        this.phase3B.integrator.cleanup();
                        this.phase3B.integrator = null;
                    }
                    
                    // çŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆ
                    this.phase3A.initialized = false;
                    this.phase3A.status = 'pending';
                    this.phase3B.initialized = false;
                    this.phase3B.status = 'pending';
                    this.integration.active = false;
                    
                    this.updateUI();
                    
                    this.log('success', 'âœ… çµ±åˆã‚·ã‚¹ãƒ†ãƒ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†');
                    
                } catch (error) {
                    this.log('error', `âŒ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                }
            }
            
            /**
             * ãƒ†ã‚¹ãƒˆãƒªã‚»ãƒƒãƒˆ
             */
            reset() {
                try {
                    this.log('info', 'ğŸ”„ ãƒ†ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ ãƒªã‚»ãƒƒãƒˆ...');
                    
                    // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Ÿè¡Œ
                    this.cleanup();
                    
                    // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™ãƒªã‚»ãƒƒãƒˆ
                    this.integration.performance = {
                        totalTests: 0,
                        passedTests: 0,
                        averageProcessingTime: 0,
                        highSpeedUsageRate: 0,
                        memoryUsage: 0,
                        frameRate: 60
                    };
                    
                    // ãƒ­ã‚°ã‚¯ãƒªã‚¢
                    const logPanel = document.getElementById('log-panel');
                    logPanel.innerHTML = `
                        <div class="log-entry">
                            <span class="log-timestamp">00:00:00.000</span>
                            <span class="log-level-info">[INFO]</span>
                            <span>ElementObserver Phase 3-A + Phase 3-Bçµ±åˆãƒ†ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ ãƒªã‚»ãƒƒãƒˆå®Œäº†</span>
                        </div>
                    `;
                    
                    this.updateUI();
                    
                    this.log('success', 'âœ… ãƒ†ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ ãƒªã‚»ãƒƒãƒˆå®Œäº†');
                    
                } catch (error) {
                    this.log('error', `âŒ ãƒªã‚»ãƒƒãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                }
            }
        }
        
        // ãƒ†ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ãƒ»èµ·å‹•
        let integrationTest;
        
        document.addEventListener('DOMContentLoaded', () => {
            integrationTest = new Phase3APhase3BIntegrationTest();
        });
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ‡ãƒãƒƒã‚°ç”¨
        window.Phase3APhase3BIntegrationTest = Phase3APhase3BIntegrationTest;
        window.integrationTest = integrationTest;
        
    </script>
</body>
</html>