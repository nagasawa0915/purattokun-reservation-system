<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spineé…ç½®ã‚·ã‚¹ãƒ†ãƒ  - ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ–¹å¼</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Noto Sans JP', sans-serif;
            line-height: 1.8;
            color: #333;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            background: white;
            padding: 40px 20px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 40px;
        }

        .header h1 {
            color: #ff6b6b;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header .subtitle {
            color: #666;
            font-size: 1.2rem;
        }

        .section {
            background: white;
            margin-bottom: 30px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        }

        .section-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .section-content {
            padding: 30px;
        }

        .highlight-box {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8a80 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .code-box {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
        }

        .code-box.before {
            border-color: #dc3545;
            background: #f8d7da;
        }

        .code-box.after {
            border-color: #28a745;
            background: #d4edda;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .comparison-item {
            padding: 20px;
            border-radius: 10px;
        }

        .comparison-item.before {
            background: #ffe5e5;
            border-left: 4px solid #ff6b6b;
        }

        .comparison-item.after {
            background: #e8f5e8;
            border-left: 4px solid #4caf50;
        }

        .demo-screen {
            width: 100%;
            max-width: 800px;
            height: 400px;
            border: 2px solid #ddd;
            border-radius: 10px;
            margin: 20px auto;
            position: relative;
            overflow: hidden;
            background-image: url('assets/images/ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼TOP.png');
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            background-color: #e8f4fd;
        }

        /* ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¡¨ç¤ºç¯„å›²ï¼ˆCanvasï¼‰ */
        .character-canvas {
            position: absolute;
            left: 25%;
            top: 65%;
            transform: translate(-50%, -50%);
            width: 120px;
            height: 120px;
            border: 2px solid #4caf50;
            background: rgba(76, 175, 80, 0.1);
            overflow: hidden;
            z-index: 8;
            cursor: move;
        }

        .character-canvas.dragging {
            cursor: grabbing;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.4);
        }

        .demo-character {
            position: absolute;
            width: 80px;
            height: 80px;
            z-index: 10;
            cursor: move;
            border: 2px dashed rgba(255, 107, 107, 0.3);
            border-radius: 50%;
            transition: border-color 0.3s;
        }

        .demo-character:hover {
            border-color: rgba(255, 107, 107, 0.8);
        }

        .demo-character.dragging {
            border-color: #ff6b6b;
            box-shadow: 0 4px 8px rgba(255, 107, 107, 0.3);
        }

        /* ãƒªã‚µã‚¤ã‚ºãƒãƒ³ãƒ‰ãƒ« */
        .resize-handle {
            position: absolute;
            width: 12px;
            height: 12px;
            background: #ff6b6b;
            border: 2px solid white;
            border-radius: 50%;
            display: none;
            z-index: 15;
        }

        .demo-character.edit-mode .resize-handle {
            display: block;
        }

        .resize-handle.se {
            bottom: -6px;
            right: -6px;
            cursor: se-resize;
        }

        .resize-handle.sw {
            bottom: -6px;
            left: -6px;
            cursor: sw-resize;
        }

        .resize-handle.ne {
            top: -6px;
            right: -6px;
            cursor: ne-resize;
        }

        .resize-handle.nw {
            top: -6px;
            left: -6px;
            cursor: nw-resize;
        }

        /* è¡¨ç¤ºç¯„å›²ï¼ˆCanvasï¼‰æ ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .character-canvas.canvas-edit-mode {
            border: 3px solid #ff9800;
            background: rgba(255, 152, 0, 0.2);
            box-shadow: 0 0 15px rgba(255, 152, 0, 0.4);
        }

        .character-canvas.canvas-edit-mode::before {
            content: 'ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¡¨ç¤ºç¯„å›²';
            position: absolute;
            top: -25px;
            left: 0;
            background: #ff9800;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            z-index: 15;
        }

        /* è¡¨ç¤ºç¯„å›²ãƒªã‚µã‚¤ã‚ºãƒãƒ³ãƒ‰ãƒ« */
        .canvas-resize-handle {
            position: absolute;
            width: 15px;
            height: 15px;
            background: #4caf50;
            border: 2px solid white;
            border-radius: 3px;
            display: none;
            z-index: 20;
        }

        .character-canvas.canvas-edit-mode .canvas-resize-handle {
            display: block;
        }

        .canvas-resize-handle.se {
            bottom: -8px;
            right: -8px;
            cursor: se-resize;
        }

        .canvas-resize-handle.sw {
            bottom: -8px;
            left: -8px;
            cursor: sw-resize;
        }

        .canvas-resize-handle.ne {
            top: -8px;
            right: -8px;
            cursor: ne-resize;
        }

        .canvas-resize-handle.nw {
            top: -8px;
            left: -8px;
            cursor: nw-resize;
        }

        .demo-controls {
            text-align: center;
            margin: 20px 0;
        }

        .demo-button {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            margin: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.3s;
        }

        .demo-button:hover {
            background: #ff5252;
        }

        .demo-button.active {
            background: #4caf50;
        }

        .coordinate-display {
            text-align: center;
            margin: 10px 0;
            font-weight: bold;
            color: #666;
            min-height: 20px;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .feature-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
        }

        .feature-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .usage-flow {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .flow-step {
            flex: 1;
            text-align: center;
            position: relative;
        }

        .flow-step::after {
            content: 'â†’';
            position: absolute;
            right: -20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 2rem;
            color: #ccc;
        }

        .flow-step:last-child::after {
            display: none;
        }

        .flow-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .comparison-grid {
                grid-template-columns: 1fr;
            }

            .usage-flow {
                flex-direction: column;
            }

            .flow-step::after {
                content: 'â†“';
                right: auto;
                bottom: -15px;
                top: auto;
            }

            .demo-screen {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="header">
            <h1>ğŸ¯ Spineé…ç½®ã‚·ã‚¹ãƒ†ãƒ </h1>
            <p class="subtitle">ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ–¹å¼ã«ã‚ˆã‚‹ç°¡å˜å°å…¥ã‚·ã‚¹ãƒ†ãƒ </p>
        </div>

        <!-- ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦ -->
        <div class="section">
            <div class="section-header">
                ğŸ“‹ æ–°ã—ã„é…ç½®ã‚·ã‚¹ãƒ†ãƒ ã®æ¦‚è¦
            </div>
            <div class="section-content">
                <div class="highlight-box">
                    <h3>ğŸ¯ æœ€çµ‚ç›®æ¨™</h3>
                    <p>æ—¢å­˜ãƒšãƒ¼ã‚¸ã«1è¡Œè¿½åŠ ã™ã‚‹ã ã‘ã§ã€è¦–è¦šçš„ãªã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é…ç½®ãŒã§ãã‚‹ã‚·ã‚¹ãƒ†ãƒ </p>
                </div>

                <h3>ğŸ”§ å¾“æ¥ã®å•é¡Œç‚¹</h3>
                <ul style="margin: 15px 0; padding-left: 20px;">
                    <li>ä½ç½®èª¿æ•´ã«HTMLã‚³ãƒ¼ãƒ‰ã®ç›´æ¥ç·¨é›†ãŒå¿…è¦</li>
                    <li>æ•°å€¤å¤‰æ›´â†’ãƒ–ãƒ©ã‚¦ã‚¶ç¢ºèªã®è©¦è¡ŒéŒ¯èª¤ãŒå¿…è¦</li>
                    <li>è¤‡æ•°ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®ç®¡ç†ãŒç…©é›‘</li>
                    <li>æ–°ã—ã„ãƒšãƒ¼ã‚¸ã§ã®å†è¨­å®šãŒé¢å€’</li>
                </ul>

                <h3>âœ¨ æ–°ã‚·ã‚¹ãƒ†ãƒ ã®ç‰¹å¾´</h3>
                <ul style="margin: 15px 0; padding-left: 20px;">
                    <li><strong>1è¡Œè¿½åŠ </strong>ã§å°å…¥å®Œäº†</li>
                    <li><strong>ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—</strong>ã§ç›´æ„Ÿçš„é…ç½®</li>
                    <li><strong>è¤‡æ•°ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼</strong>å¯¾å¿œ</li>
                    <li><strong>è¨­å®šä¿å­˜ãƒ»å†åˆ©ç”¨</strong>å¯èƒ½</li>
                    <li><strong>ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹é‡è¦–</strong>ã®è»½é‡è¨­è¨ˆ</li>
                </ul>
            </div>
        </div>

        <!-- ä½¿ç”¨æ–¹æ³•ã®æ¯”è¼ƒ -->
        <div class="section">
            <div class="section-header">
                ğŸ”„ ä½¿ç”¨æ–¹æ³•ã®æ¯”è¼ƒ
            </div>
            <div class="section-content">
                <div class="comparison-grid">
                    <div class="comparison-item before">
                        <h4>ğŸ“ å¾“æ¥ã®æ–¹æ³•</h4>
                        <div class="code-box before">
&lt;div id="purattokun-config" style="display: none;"
     data-x="18" data-y="49" data-scale="0.55"&gt;
&lt;/div&gt;
&lt;canvas id="hero-purattokun"&gt;&lt;/canvas&gt;
&lt;script src="assets/spine/spine-character-manager.js"&gt;&lt;/script&gt;
&lt;script&gt;
  initSpineCharacter('hero-purattokun', {...});
&lt;/script&gt;
                        </div>
                        <p><strong>èª²é¡Œï¼š</strong> è¤‡é›‘ãªè¨­å®šã€ä½ç½®èª¿æ•´ãŒå›°é›£</p>
                    </div>

                    <div class="comparison-item after">
                        <h4>âœ¨ æ–°ã‚·ã‚¹ãƒ†ãƒ </h4>
                        <div class="code-box after">
&lt;!-- 1è¡Œè¿½åŠ ã™ã‚‹ã ã‘ --&gt;
&lt;script src="assets/spine/spine-easy.js"&gt;&lt;/script&gt;

&lt;!-- ã‚·ãƒ³ãƒ—ãƒ«ãªè¨­å®š --&gt;
&lt;div class="spine-character" 
     data-character="purattokun"
     data-x="18" data-y="49" data-scale="0.55"&gt;
&lt;/div&gt;
                        </div>
                        <p><strong>åˆ©ç‚¹ï¼š</strong> ã‚·ãƒ³ãƒ—ãƒ«ã€è¦–è¦šçš„èª¿æ•´å¯èƒ½</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- å®Ÿéš›ã®ä½¿ç”¨æ‰‹é † -->
        <div class="section">
            <div class="section-header">
                ğŸ“± å®Ÿéš›ã®ä½¿ç”¨æ‰‹é †
            </div>
            <div class="section-content">
                <div class="usage-flow">
                    <div class="flow-step">
                        <div class="flow-number">1</div>
                        <div><strong>ãƒšãƒ¼ã‚¸ã‚’é–‹ã</strong></div>
                        <div style="font-size: 0.9rem; color: #666;">é€šå¸¸é€šã‚Šã‚¢ã‚¯ã‚»ã‚¹</div>
                    </div>
                    <div class="flow-step">
                        <div class="flow-number">2</div>
                        <div><strong>ç·¨é›†ãƒ¢ãƒ¼ãƒ‰æœ‰åŠ¹</strong></div>
                        <div style="font-size: 0.9rem; color: #666;">?spine-edit=true</div>
                    </div>
                    <div class="flow-step">
                        <div class="flow-number">3</div>
                        <div><strong>ãƒ‰ãƒ©ãƒƒã‚°ã§é…ç½®</strong></div>
                        <div style="font-size: 0.9rem; color: #666;">ãƒã‚¦ã‚¹æ“ä½œã®ã¿</div>
                    </div>
                    <div class="flow-step">
                        <div class="flow-number">4</div>
                        <div><strong>ä¿å­˜å®Œäº†</strong></div>
                        <div style="font-size: 0.9rem; color: #666;">è¨­å®šè‡ªå‹•ä¿å­˜</div>
                    </div>
                </div>

                <h3>ğŸ”§ å…·ä½“çš„ãªæ“ä½œä¾‹</h3>
                <div style="background: #f0f8ff; padding: 20px; border-radius: 10px; margin: 20px 0;">
                    <h4>ğŸ“ ç·¨é›†æ™‚ã®ç”»é¢</h4>
                    <pre style="background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto;">
URL: http://localhost:8000/index.html?spine-edit=true

ç”»é¢è¡¨ç¤º:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ç·¨é›†ãƒ¢ãƒ¼ãƒ‰] ä¿å­˜ | çµ‚äº†        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  èƒŒæ™¯ç”»åƒ                       â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”                     â”‚
â”‚    â”‚ã·ã‚‰ã£ã¨â”‚ â† ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½     â”‚
â”‚    â”‚  ãã‚“ â”‚   ã‚µã‚¤ã‚ºå¤‰æ›´å¯èƒ½   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                 â”‚
â”‚ ä½ç½®: X=20vw, Y=45vh           â”‚
â”‚ ã‚µã‚¤ã‚º: 0.6å€                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</pre>
                </div>

                <h3>ğŸ’¾ ç”Ÿæˆã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰</h3>
                <div class="code-box after">
&lt;!-- ä¿å­˜å¾Œã€ã“ã®ã‚³ãƒ¼ãƒ‰ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹ --&gt;
&lt;div class="spine-character" 
     data-character="purattokun"
     data-x="20" data-y="45" data-scale="0.6"&gt;
&lt;/div&gt;

&lt;!-- ä»–ã®ãƒšãƒ¼ã‚¸ã§ã‚‚åŒã˜è¨­å®šã§å†åˆ©ç”¨å¯èƒ½ --&gt;
                </div>
            </div>
        </div>

        <!-- è¤‡æ•°ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å¯¾å¿œ -->
        <div class="section">
            <div class="section-header">
                ğŸ­ è¤‡æ•°ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å¯¾å¿œ
            </div>
            <div class="section-content">
                <h3>ğŸ“ è¤‡æ•°é…ç½®ã®ä¾‹</h3>
                <div class="code-box after">
&lt;script src="assets/spine/spine-easy.js"&gt;&lt;/script&gt;

&lt;!-- ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼1: ã·ã‚‰ã£ã¨ãã‚“ --&gt;
&lt;div class="spine-character" 
     data-character="purattokun"
     data-x="18" data-y="49" data-scale="0.55"&gt;
&lt;/div&gt;

&lt;!-- ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼2: çŒ« --&gt;
&lt;div class="spine-character" 
     data-character="neko"
     data-x="70" data-y="30" data-scale="0.4"&gt;
&lt;/div&gt;

&lt;!-- ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼3: çŠ¬ --&gt;
&lt;div class="spine-character" 
     data-character="inu"
     data-x="50" data-y="80" data-scale="0.6"&gt;
&lt;/div&gt;
                </div>

                <h3>ğŸ–¼ï¸ ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã§ã®ç®¡ç†</h3>
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                    <pre>
ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ç”»é¢:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ç·¨é›†ãƒ¢ãƒ¼ãƒ‰] ä¿å­˜ | å…¨é¸æŠ | çµ‚äº†   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  èƒŒæ™¯ç”»åƒ                           â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”            â”‚
â”‚    â”‚ã·ã‚‰ã£ã¨â”‚ â‘     â”‚ çŒ«  â”‚ â‘¡          â”‚
â”‚    â”‚  ãã‚“ â”‚      â”‚     â”‚            â”‚
â”‚    â””â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                     â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”                  â”‚
â”‚           â”‚ çŠ¬  â”‚ â‘¢                â”‚
â”‚           â””â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                     â”‚
â”‚ é¸æŠä¸­: ã·ã‚‰ã£ã¨ãã‚“                â”‚
â”‚ ä½ç½®: X=18vw, Y=49vh               â”‚
â”‚ ã‚µã‚¤ã‚º: 0.55å€                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    </pre>
                </div>
            </div>
        </div>

        <!-- Canvasåˆ¶å¾¡æ©Ÿèƒ½ -->
        <div class="section">
            <div class="section-header">
                ğŸ¨ Canvasåˆ¶å¾¡æ©Ÿèƒ½
            </div>
            <div class="section-content">
                <h3>ğŸ“ Canvasã‚µã‚¤ã‚ºãƒ»ä½ç½®ã®èª¿æ•´</h3>
                <div class="code-box after">
&lt;!-- Canvasè©³ç´°è¨­å®š --&gt;
&lt;div class="spine-character" 
     data-character="purattokun"
     data-x="18" data-y="49" data-scale="0.55"
     data-canvas-width="200"    &lt;!-- Canvaså¹… --&gt;
     data-canvas-height="200"   &lt;!-- Canvasé«˜ã• --&gt;
     data-canvas-visible="true"&gt; &lt;!-- Canvasæ è¡¨ç¤º --&gt;
&lt;/div&gt;
                </div>

                <h3>ğŸ”§ ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã§ã®æ“ä½œæ–¹æ³•</h3>
                <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; margin: 20px 0;">
                    <h4>ğŸ­ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç·¨é›†ãƒ¢ãƒ¼ãƒ‰</h4>
                    <ul style="padding-left: 20px;">
                        <li><strong>ç§»å‹•</strong>ï¼šã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æœ¬ä½“ã‚’ãƒ‰ãƒ©ãƒƒã‚°</li>
                        <li><strong>ã‚µã‚¤ã‚ºå¤‰æ›´</strong>ï¼š4ã¤è§’ã®ãƒãƒ³ãƒ‰ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°</li>
                        <li><strong>å›ºå®šç‚¹ãƒªã‚µã‚¤ã‚º</strong>ï¼šå¯¾è§’ã®è§’ãŒå›ºå®šç‚¹ã¨ã—ã¦ç¶­æŒã•ã‚Œã‚‹</li>
                        <li><strong>åœ°é¢å›ºå®š</strong>ï¼šå·¦ä¸Šãƒãƒ³ãƒ‰ãƒ« = å³ä¸‹ï¼ˆåœ°é¢ï¼‰å›ºå®šã§ä¾¿åˆ©</li>
                    </ul>
                    
                    <h4>ğŸ¨ è¡¨ç¤ºç¯„å›²ï¼ˆCanvasï¼‰ç·¨é›†ãƒ¢ãƒ¼ãƒ‰</h4>
                    <ul style="padding-left: 20px;">
                        <li><strong>ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¡¨ç¤ºç¯„å›²</strong>ï¼šè¦‹ãˆã‚‹é ˜åŸŸã®ã‚µã‚¤ã‚ºã‚’èª¿æ•´</li>
                        <li><strong>ã‚¯ãƒªãƒƒãƒ”ãƒ³ã‚°åˆ¶å¾¡</strong>ï¼šç¯„å›²å¤–ã¯éè¡¨ç¤ºã«</li>
                        <li><strong>å†…éƒ¨è§£åƒåº¦é€£å‹•</strong>ï¼šSpine WebGLã®æç”»å“è³ªã‚‚èª¿æ•´</li>
                        <li><strong>æœ€å°ã‚µã‚¤ã‚º</strong>ï¼š40Ã—40pxä»¥ä¸Šã§åˆ¶é™</li>
                    </ul>
                </div>

                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #ffc107;">
                    <h4 style="color: #856404; margin-bottom: 8px;">ğŸ’¡ å®Ÿç”¨çš„ãªä½¿ç”¨ä¾‹</h4>
                    <ul style="color: #856404; margin: 0; padding-left: 20px;">
                        <li><strong>åœ°é¢ã«ç«‹ãŸã›ã‚‹</strong>ï¼šã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’åœ°é¢ã«é…ç½®å¾Œã€å·¦ä¸Šãƒãƒ³ãƒ‰ãƒ«ã§åœ°é¢ã‚’å›ºå®šã—ãŸã¾ã¾ã‚µã‚¤ã‚ºèª¿æ•´</li>
                        <li><strong>å¤©äº•ã«åŠã‚‹ã™</strong>ï¼šå³ä¸‹ãƒãƒ³ãƒ‰ãƒ«ã§å¤©äº•ä½ç½®ã‚’å›ºå®šã—ãŸã¾ã¾ã‚µã‚¤ã‚ºå¤‰æ›´</li>
                        <li><strong>å·¦å³ã®åŸºæº–ç·š</strong>ï¼šå·¦ä¸‹/å³ä¸‹ãƒãƒ³ãƒ‰ãƒ«ã§æ¨ªã®åŸºæº–ç·šã‚’å›ºå®š</li>
                        <li><strong>ä¸­å¿ƒç‚¹å›ºå®š</strong>ï¼šä»»æ„ã®è§’ã‚’ä¸­å¿ƒã¨ã—ã¦æ”¾å°„çŠ¶ã«ã‚µã‚¤ã‚ºå¤‰æ›´</li>
                    </ul>
                </div>

                <div class="demo-screen" id="canvasDemo">
                    <!-- ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¡¨ç¤ºç¯„å›²ï¼ˆCanvasï¼‰ -->
                    <div class="character-canvas" id="characterCanvas">
                        <!-- è¡¨ç¤ºç¯„å›²ãƒªã‚µã‚¤ã‚ºãƒãƒ³ãƒ‰ãƒ« -->
                        <div class="canvas-resize-handle nw" data-direction="nw"></div>
                        <div class="canvas-resize-handle ne" data-direction="ne"></div>
                        <div class="canvas-resize-handle sw" data-direction="sw"></div>
                        <div class="canvas-resize-handle se" data-direction="se"></div>
                        
                        <div class="demo-character" id="demoCharacter" style="left: 60px; top: 60px; transform: translate(-50%, -50%);">
                            <img src="assets/images/purattokunn.png" alt="ã·ã‚‰ã£ã¨ãã‚“" style="width: 100%; height: 100%; object-fit: contain;">
                            <!-- ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ ãƒªã‚µã‚¤ã‚ºãƒãƒ³ãƒ‰ãƒ« -->
                            <div class="resize-handle nw" data-direction="nw"></div>
                            <div class="resize-handle ne" data-direction="ne"></div>
                            <div class="resize-handle sw" data-direction="sw"></div>
                            <div class="resize-handle se" data-direction="se"></div>
                        </div>
                    </div>
                </div>

                <div class="demo-controls">
                    <button class="demo-button" onclick="toggleEditMode()">ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç·¨é›†</button>
                    <button class="demo-button" onclick="toggleCanvasEditMode()">è¡¨ç¤ºç¯„å›²ç·¨é›†</button>
                    <button class="demo-button" onclick="resetPosition()">ä½ç½®ãƒªã‚»ãƒƒãƒˆ</button>
                    <button class="demo-button" onclick="resetSize()">ã‚µã‚¤ã‚ºãƒªã‚»ãƒƒãƒˆ</button>
                </div>
                
                <!-- ç·¨é›†ç¢ºå®šãƒœã‚¿ãƒ³ï¼ˆç·¨é›†ä¸­ã®ã¿è¡¨ç¤ºï¼‰ -->
                <div class="edit-confirm-panel" id="editConfirmPanel" style="display: none;">
                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #ffc107;">
                        <div style="text-align: center; margin-bottom: 10px;">
                            <strong>ğŸ“ ç·¨é›†ä¸­</strong> - å¤‰æ›´ã‚’ç¢ºå®šã—ã¾ã™ã‹ï¼Ÿ
                        </div>
                        <div style="text-align: center;">
                            <button class="demo-button" onclick="confirmEdit()" style="background: #28a745; margin-right: 10px;">ğŸ’¾ ä¿å­˜</button>
                            <button class="demo-button" onclick="cancelEdit()" style="background: #6c757d;">âŒ ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                        </div>
                    </div>
                </div>
                <div class="coordinate-display" id="coordinateDisplay"></div>
            </div>
        </div>

        <!-- ä¸»è¦æ©Ÿèƒ½ -->
        <div class="section">
            <div class="section-header">
                â­ ä¸»è¦æ©Ÿèƒ½ä¸€è¦§
            </div>
            <div class="section-content">
                <div class="feature-grid">
                    <div class="feature-card">
                        <div class="feature-icon">ğŸ–±ï¸</div>
                        <div style="font-size: 1.3rem; font-weight: bold; margin-bottom: 10px;">ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—</div>
                        <p>ãƒã‚¦ã‚¹ã§ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’ç›´æ„Ÿçš„ã«ç§»å‹•</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">ğŸ­</div>
                        <div style="font-size: 1.3rem; font-weight: bold; margin-bottom: 10px;">è¤‡æ•°ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼</div>
                        <p>è¤‡æ•°ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’åŒæ™‚ç®¡ç†</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">ğŸ¨</div>
                        <div style="font-size: 1.3rem; font-weight: bold; margin-bottom: 10px;">Canvasåˆ¶å¾¡</div>
                        <p>è¡¨ç¤ºé ˜åŸŸã®ã‚µã‚¤ã‚ºãƒ»ä½ç½®èª¿æ•´</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">ğŸ’¾</div>
                        <div style="font-size: 1.3rem; font-weight: bold; margin-bottom: 10px;">è‡ªå‹•ä¿å­˜</div>
                        <p>è¨­å®šã®è‡ªå‹•ä¿å­˜ãƒ»ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">âš¡</div>
                        <div style="font-size: 1.3rem; font-weight: bold; margin-bottom: 10px;">é«˜é€Ÿå‹•ä½œ</div>
                        <p>ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹é‡è¦–ã®è»½é‡è¨­è¨ˆ</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">ğŸ”—</div>
                        <div style="font-size: 1.3rem; font-weight: bold; margin-bottom: 10px;">ç°¡å˜å°å…¥</div>
                        <p>æ—¢å­˜ãƒšãƒ¼ã‚¸ã«1è¡Œè¿½åŠ ã™ã‚‹ã ã‘</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- å®Ÿè£…è¨ˆç”» -->
        <div class="section">
            <div class="section-header">
                ğŸ“… æ®µéšçš„å®Ÿè£…è¨ˆç”»
            </div>
            <div class="section-content">
                <div class="usage-flow">
                    <div class="flow-step">
                        <div class="flow-number">1</div>
                        <div><strong>åŸºæœ¬ãƒ©ã‚¤ãƒ–ãƒ©ãƒª</strong></div>
                        <div style="font-size: 0.9rem; color: #666;">spine-easy.jsä½œæˆ</div>
                    </div>
                    <div class="flow-step">
                        <div class="flow-number">2</div>
                        <div><strong>ç·¨é›†ãƒ¢ãƒ¼ãƒ‰</strong></div>
                        <div style="font-size: 0.9rem; color: #666;">ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—</div>
                    </div>
                    <div class="flow-step">
                        <div class="flow-number">3</div>
                        <div><strong>é«˜åº¦æ©Ÿèƒ½</strong></div>
                        <div style="font-size: 0.9rem; color: #666;">è¤‡æ•°ã‚­ãƒ£ãƒ©å¯¾å¿œ</div>
                    </div>
                </div>

                <h3>ğŸ“‹ å„æ®µéšã®è©³ç´°</h3>
                <div style="margin: 20px 0;">
                    <div style="border-left: 4px solid #4caf50; padding-left: 20px; margin-bottom: 20px;">
                        <h4>Phase 1: åŸºæœ¬ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆ1é€±é–“ï¼‰</h4>
                        <ul style="padding-left: 20px;">
                            <li>spine-easy.js ã®åŸºæœ¬æ©Ÿèƒ½</li>
                            <li>dataå±æ€§ã«ã‚ˆã‚‹ç°¡å˜è¨­å®š</li>
                            <li>æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã¨ã®äº’æ›æ€§ç¢ºä¿</li>
                            <li>ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–</li>
                        </ul>
                    </div>
                    
                    <div style="border-left: 4px solid #ff9800; padding-left: 20px; margin-bottom: 20px;">
                        <h4>Phase 2: ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ï¼ˆ2é€±é–“ç›®ï¼‰</h4>
                        <ul style="padding-left: 20px;">
                            <li>URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ã‚ˆã‚‹ç·¨é›†ãƒ¢ãƒ¼ãƒ‰æœ‰åŠ¹åŒ–</li>
                            <li>ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½</li>
                            <li>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</li>
                            <li>è¨­å®šä¿å­˜æ©Ÿèƒ½</li>
                        </ul>
                    </div>
                    
                    <div style="border-left: 4px solid #9c27b0; padding-left: 20px;">
                        <h4>Phase 3: é«˜åº¦æ©Ÿèƒ½ï¼ˆ3é€±é–“ç›®ï¼‰</h4>
                        <ul style="padding-left: 20px;">
                            <li>è¤‡æ•°ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç®¡ç†</li>
                            <li>Canvasåˆ¶å¾¡æ©Ÿèƒ½</li>
                            <li>è¨­å®šå…±æœ‰URLç”Ÿæˆ</li>
                            <li>ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œå¼·åŒ–</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- ã¾ã¨ã‚ -->
        <div class="section">
            <div class="section-header">
                ğŸ“ ã¾ã¨ã‚
            </div>
            <div class="section-content">
                <div class="highlight-box">
                    <h3>ğŸ¯ æ–°ã‚·ã‚¹ãƒ†ãƒ ã®ä¾¡å€¤</h3>
                    <p>æ—¢å­˜ãƒšãƒ¼ã‚¸ã«<strong>1è¡Œè¿½åŠ </strong>ã™ã‚‹ã ã‘ã§ã€<strong>è¦–è¦šçš„ãªã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é…ç½®</strong>ãŒå¯èƒ½ã«ãªã‚Šã¾ã™</p>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px 0;">
                    <div style="text-align: center; padding: 20px;">
                        <div style="font-size: 3rem; margin-bottom: 10px;">âš¡</div>
                        <h4>é«˜é€Ÿ</h4>
                        <p>ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹é‡è¦–è¨­è¨ˆ</p>
                    </div>
                    <div style="text-align: center; padding: 20px;">
                        <div style="font-size: 3rem; margin-bottom: 10px;">ğŸ¨</div>
                        <h4>ç›´æ„Ÿçš„</h4>
                        <p>ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—æ“ä½œ</p>
                    </div>
                    <div style="text-align: center; padding: 20px;">
                        <div style="font-size: 3rem; margin-bottom: 10px;">ğŸ”—</div>
                        <h4>ç°¡å˜å°å…¥</h4>
                        <p>1è¡Œè¿½åŠ ã§å®Œäº†</p>
                    </div>
                    <div style="text-align: center; padding: 20px;">
                        <div style="font-size: 3rem; margin-bottom: 10px;">ğŸ›¡ï¸</div>
                        <h4>å®‰å…¨</h4>
                        <p>æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã«å½±éŸ¿ãªã—</p>
                    </div>
                </div>

                <p style="text-align: center; font-size: 1.2rem; margin-top: 30px;">
                    <strong>æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼š</strong> Phase 1ï¼ˆåŸºæœ¬ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼‰ã®å®Ÿè£…é–‹å§‹
                </p>
            </div>
        </div>
    </div>

    <script>
        // ãƒ‡ãƒ¢ç”¨ã®å¤‰æ•°
        let isCharacterEditMode = false;
        let isCanvasEditMode = false;
        let isDragging = false;
        let isResizing = false;
        let resizeType = ''; // 'character' or 'canvas'
        let resizeDirection = '';
        let startMousePos = { x: 0, y: 0 };
        let startElementPos = { x: 0, y: 0, width: 0, height: 0 };

        // DOMè¦ç´ 
        const character = document.getElementById('demoCharacter');
        const characterCanvas = document.getElementById('characterCanvas');
        const demoScreen = document.getElementById('canvasDemo');
        const coordinateDisplay = document.getElementById('coordinateDisplay');
        const editConfirmPanel = document.getElementById('editConfirmPanel');

        // åˆæœŸè¨­å®š
        window.addEventListener('load', () => {
            // localStorageã‹ã‚‰ä¿å­˜ã•ã‚ŒãŸçŠ¶æ…‹ã‚’èª­ã¿è¾¼ã¿
            try {
                const saved = localStorage.getItem('spine-positioning-state');
                if (saved) {
                    const loadedState = JSON.parse(saved);
                    console.log('âœ… localStorageã‹ã‚‰çŠ¶æ…‹ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ:', loadedState);
                    
                    // èª­ã¿è¾¼ã‚“ã çŠ¶æ…‹ã‚’é©ç”¨
                    character.style.left = loadedState.character.left;
                    character.style.top = loadedState.character.top;
                    character.style.width = loadedState.character.width;
                    character.style.height = loadedState.character.height;
                    
                    characterCanvas.style.left = loadedState.canvas.left;
                    characterCanvas.style.top = loadedState.canvas.top;
                    characterCanvas.style.width = loadedState.canvas.width;
                    characterCanvas.style.height = loadedState.canvas.height;
                    
                    // savedStateã‚‚æ›´æ–°
                    savedState = loadedState;
                    
                    coordinateDisplay.textContent = 'ğŸ“¥ å‰å›ä¿å­˜ã—ãŸä½ç½®ã‚’å¾©å…ƒã—ã¾ã—ãŸ';
                    setTimeout(() => {
                        coordinateDisplay.textContent = '';
                    }, 2000);
                } else {
                    // ä¿å­˜ã•ã‚ŒãŸçŠ¶æ…‹ãŒãªã„å ´åˆã¯åˆæœŸåŒ–
                    initializeSavedState();
                }
            } catch (e) {
                console.error('âŒ localStorageèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', e);
                // ã‚¨ãƒ©ãƒ¼æ™‚ã¯åˆæœŸåŒ–
                initializeSavedState();
            }
            
            setupResizeHandlers();
        });

        // åˆæœŸçŠ¶æ…‹ã®ä¿å­˜
        function initializeSavedState() {
            console.log('ğŸ”§ åˆæœŸåŒ–å‰ã®çŠ¶æ…‹:', {
                charLeft: character.style.left,
                charTop: character.style.top,
                canvasWidth: characterCanvas.style.width,
                canvasHeight: characterCanvas.style.height
            });
            
            // çœŸã®åˆæœŸçŠ¶æ…‹ã«å¼·åˆ¶ãƒªã‚»ãƒƒãƒˆï¼ˆCanvasä¸­å¿ƒã«ãƒ”ã‚¯ã‚»ãƒ«æŒ‡å®šï¼‰
            character.style.left = '60px';
            character.style.top = '60px';
            character.style.transform = 'translate(-50%, -50%)';
            character.style.width = '80px';
            character.style.height = '80px';
            
            characterCanvas.style.left = '25%';
            characterCanvas.style.top = '65%';
            characterCanvas.style.width = '120px';
            characterCanvas.style.height = '120px';
            
            console.log('ğŸ”§ ãƒªã‚»ãƒƒãƒˆå¾Œã®çŠ¶æ…‹:', {
                charLeft: character.style.left,
                charTop: character.style.top,
                canvasWidth: characterCanvas.style.width,
                canvasHeight: characterCanvas.style.height
            });
            
            // å¼·åˆ¶ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ç¢ºå®ŸåŒ–
            character.offsetHeight; // å¼·åˆ¶ãƒªãƒ•ãƒ­ãƒ¼
            characterCanvas.offsetHeight;
            
            // ãƒªã‚»ãƒƒãƒˆå¾Œã®çŠ¶æ…‹ã‚’å³åº§ã«ä¿å­˜ï¼ˆsetTimeoutã¯ä½¿ã‚ãªã„ï¼‰
            savedState.character.left = character.style.left;
            savedState.character.top = character.style.top;
            savedState.character.width = character.style.width;
            savedState.character.height = character.style.height;
            
            savedState.canvas.left = characterCanvas.style.left;
            savedState.canvas.top = characterCanvas.style.top;
            savedState.canvas.width = characterCanvas.style.width;
            savedState.canvas.height = characterCanvas.style.height;
            
            console.log('âœ… åˆæœŸçŠ¶æ…‹ã‚’å¼·åˆ¶ãƒªã‚»ãƒƒãƒˆãƒ»ä¿å­˜ã—ã¾ã—ãŸ:', savedState);
        }

        // å›ºå®šç‚¹ã®åå‰ã‚’å–å¾—
        function getFixedPointName(resizeDirection) {
            switch (resizeDirection) {
                case 'se': return 'å·¦ä¸Š';     // SE(å³ä¸‹)ãƒãƒ³ãƒ‰ãƒ« â†’ NW(å·¦ä¸Š)å›ºå®š
                case 'sw': return 'å³ä¸Š';     // SW(å·¦ä¸‹)ãƒãƒ³ãƒ‰ãƒ« â†’ NE(å³ä¸Š)å›ºå®š  
                case 'ne': return 'å·¦ä¸‹';     // NE(å³ä¸Š)ãƒãƒ³ãƒ‰ãƒ« â†’ SW(å·¦ä¸‹)å›ºå®š
                case 'nw': return 'å³ä¸‹';     // NW(å·¦ä¸Š)ãƒãƒ³ãƒ‰ãƒ« â†’ SE(å³ä¸‹)å›ºå®š
                default: return '';
            }
        }

        // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç·¨é›†ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
        function toggleEditMode() {
            const button = event.target;
            
            // ç·¨é›†ä¸­ã§ç¢ºå®šãƒ‘ãƒãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å ´åˆã¯çŠ¶æ…‹å¤‰æ›´ã—ãªã„
            if (isCharacterEditMode && editConfirmPanel.style.display === 'block') {
                // ç¢ºå®šã‚’ä¿ƒã™ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã¿è¡¨ç¤ºï¼ˆçŠ¶æ…‹ã¯å¤‰æ›´ã—ãªã„ï¼‰
            } else {
                isCharacterEditMode = !isCharacterEditMode;
            }
            
            // è¡¨ç¤ºç¯„å›²ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã‚’ç„¡åŠ¹åŒ–ï¼ˆæ’ä»–åˆ¶å¾¡ï¼‰
            if (isCanvasEditMode) {
                isCanvasEditMode = false;
                const canvasButton = document.querySelector('button[onclick="toggleCanvasEditMode()"]');
                if (canvasButton) {
                    canvasButton.textContent = 'è¡¨ç¤ºç¯„å›²ç·¨é›†';
                    canvasButton.classList.remove('active');
                }
                characterCanvas.classList.remove('canvas-edit-mode');
                removeCanvasDragEvents();
                coordinateDisplay.textContent = 'ğŸ”„ è¡¨ç¤ºç¯„å›²ç·¨é›†ã‚’è‡ªå‹•çµ‚äº†ã—ã¾ã—ãŸ';
            }
            
            if (isCharacterEditMode) {
                // ç·¨é›†é–‹å§‹æ™‚ã«ç¾åœ¨ã®çŠ¶æ…‹ã‚’æ­£ç¢ºã«ä¿å­˜
                const computedStyle = window.getComputedStyle(character);
                const currentLeft = character.style.left || computedStyle.left || '60px';
                const currentTop = character.style.top || computedStyle.top || '60px';
                const currentWidth = character.style.width || computedStyle.width || '80px';
                const currentHeight = character.style.height || computedStyle.height || '80px';
                
                console.log('ğŸ”§ ç·¨é›†é–‹å§‹æ™‚ã®ä½ç½®ä¿å­˜:', {
                    ç¾åœ¨ã®styleå€¤: {
                        left: character.style.left,
                        top: character.style.top,
                        width: character.style.width,
                        height: character.style.height
                    },
                    computedå€¤: {
                        left: computedStyle.left,
                        top: computedStyle.top,
                        width: computedStyle.width,
                        height: computedStyle.height
                    },
                    ä¿å­˜ã™ã‚‹å€¤: {
                        left: currentLeft,
                        top: currentTop,
                        width: currentWidth,
                        height: currentHeight
                    }
                });
                
                savedState.character.left = currentLeft;
                savedState.character.top = currentTop;
                savedState.character.width = currentWidth;
                savedState.character.height = currentHeight;
                
                button.textContent = 'ç·¨é›†ä¸­...ä¿å­˜ãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã§ç¢ºå®š';
                button.classList.add('active');
                character.classList.add('edit-mode');
                character.style.cursor = 'grab';
                coordinateDisplay.textContent = 'ğŸ”§ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ - ãƒ‰ãƒ©ãƒƒã‚°ã§ç§»å‹•ã€è§’ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã§ã‚µã‚¤ã‚ºå¤‰æ›´ï¼ˆå¯¾è§’ãŒå›ºå®šç‚¹ï¼‰';
                editConfirmPanel.style.display = 'block';
                setupCharacterDragEvents();
            } else {
                // ç·¨é›†ä¸­ã®å ´åˆã¯ç¢ºå®šã‚’ä¿ƒã™ï¼ˆç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã¯ç¶™ç¶šï¼‰
                if (editConfirmPanel.style.display === 'block') {
                    coordinateDisplay.textContent = 'âš ï¸ ä¿å­˜ã¾ãŸã¯ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„';
                    setTimeout(() => {
                        if (isCharacterEditMode) {
                            coordinateDisplay.textContent = 'ğŸ”§ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ - ãƒ‰ãƒ©ãƒƒã‚°ã§ç§»å‹•ã€è§’ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã§ã‚µã‚¤ã‚ºå¤‰æ›´ï¼ˆå¯¾è§’ãŒå›ºå®šç‚¹ï¼‰';
                        }
                    }, 3000);
                    return; // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã‚’ç¶™ç¶š
                }
                
                button.textContent = 'ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç·¨é›†';
                button.classList.remove('active');
                character.classList.remove('edit-mode');
                character.style.cursor = 'default';
                coordinateDisplay.textContent = '';
                editConfirmPanel.style.display = 'none';
                removeCharacterDragEvents();
            }
        }

        // è¡¨ç¤ºç¯„å›²ç·¨é›†ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
        function toggleCanvasEditMode() {
            const button = event.target;
            
            // ç·¨é›†ä¸­ã§ç¢ºå®šãƒ‘ãƒãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å ´åˆã¯çŠ¶æ…‹å¤‰æ›´ã—ãªã„
            if (isCanvasEditMode && editConfirmPanel.style.display === 'block') {
                // ç¢ºå®šã‚’ä¿ƒã™ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã¿è¡¨ç¤ºï¼ˆçŠ¶æ…‹ã¯å¤‰æ›´ã—ãªã„ï¼‰
            } else {
                isCanvasEditMode = !isCanvasEditMode;
            }
            
            // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã‚’ç„¡åŠ¹åŒ–ï¼ˆæ’ä»–åˆ¶å¾¡ï¼‰
            if (isCharacterEditMode) {
                isCharacterEditMode = false;
                const characterButton = document.querySelector('button[onclick="toggleEditMode()"]');
                if (characterButton) {
                    characterButton.textContent = 'ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç·¨é›†';
                    characterButton.classList.remove('active');
                }
                character.classList.remove('edit-mode');
                removeCharacterDragEvents();
                coordinateDisplay.textContent = 'ğŸ”„ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç·¨é›†ã‚’è‡ªå‹•çµ‚äº†ã—ã¾ã—ãŸ';
            }
            
            if (isCanvasEditMode) {
                // ç·¨é›†é–‹å§‹æ™‚ã«ç¾åœ¨ã®çŠ¶æ…‹ã‚’ä¿å­˜
                savedState.canvas.left = characterCanvas.style.left || '25%';
                savedState.canvas.top = characterCanvas.style.top || '65%';
                savedState.canvas.width = characterCanvas.style.width || '120px';
                savedState.canvas.height = characterCanvas.style.height || '120px';
                
                button.textContent = 'ç·¨é›†ä¸­...ä¿å­˜ãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã§ç¢ºå®š';
                button.classList.add('active');
                characterCanvas.classList.add('canvas-edit-mode');
                coordinateDisplay.textContent = 'ğŸ¨ è¡¨ç¤ºç¯„å›²ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ - ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®è¦‹ãˆã‚‹ç¯„å›²ã‚’ãƒªã‚µã‚¤ã‚º';
                editConfirmPanel.style.display = 'block';
                setupCanvasDragEvents();
            } else {
                // ç·¨é›†ä¸­ã®å ´åˆã¯ç¢ºå®šã‚’ä¿ƒã™ï¼ˆç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã¯ç¶™ç¶šï¼‰
                if (editConfirmPanel.style.display === 'block') {
                    coordinateDisplay.textContent = 'âš ï¸ ä¿å­˜ã¾ãŸã¯ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„';
                    setTimeout(() => {
                        if (isCanvasEditMode) {
                            coordinateDisplay.textContent = 'ğŸ¨ è¡¨ç¤ºç¯„å›²ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ - ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®è¦‹ãˆã‚‹ç¯„å›²ã‚’ãƒªã‚µã‚¤ã‚º';
                        }
                    }, 3000);
                    return; // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã‚’ç¶™ç¶š
                }
                
                button.textContent = 'è¡¨ç¤ºç¯„å›²ç·¨é›†';
                button.classList.remove('active');
                characterCanvas.classList.remove('canvas-edit-mode');
                coordinateDisplay.textContent = '';
                editConfirmPanel.style.display = 'none';
                removeCanvasDragEvents();
            }
        }

        // ä½ç½®ãƒªã‚»ãƒƒãƒˆ
        function resetPosition() {
            character.style.left = '20px';
            character.style.top = '20px';
            characterCanvas.style.left = '25%';
            characterCanvas.style.top = '65%';
            coordinateDisplay.textContent = 'ğŸ”„ ä½ç½®ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ (ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼: 20px,20px / Canvas: 25%,65%)';
            
            setTimeout(() => {
                if (!isCharacterEditMode && !isCanvasEditMode) coordinateDisplay.textContent = '';
            }, 2000);
        }

        // ã‚µã‚¤ã‚ºãƒªã‚»ãƒƒãƒˆ
        function resetSize() {
            character.style.width = '80px';
            character.style.height = '80px';
            characterCanvas.style.width = '120px';
            characterCanvas.style.height = '120px';
            coordinateDisplay.textContent = 'ğŸ“ ã‚µã‚¤ã‚ºã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ (ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼: 80Ã—80px / Canvas: 120Ã—120px)';
            
            setTimeout(() => {
                if (!isCharacterEditMode && !isCanvasEditMode) coordinateDisplay.textContent = '';
            }, 2000);
        }

        // ç·¨é›†çŠ¶æ…‹ã®ä¿å­˜ç”¨å¤‰æ•°
        let savedState = {
            character: {
                left: '60px',  // Canvasä¸­å¿ƒï¼ˆ120px / 2ï¼‰
                top: '60px',   // Canvasä¸­å¿ƒï¼ˆ120px / 2ï¼‰
                width: '80px',
                height: '80px'
            },
            canvas: {
                left: '25%',
                top: '65%',
                width: '120px',
                height: '120px'
            }
        };

        // ç·¨é›†ç¢ºå®š
        function confirmEdit() {
            // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãŒCanvasç¯„å›²å†…ã«åã¾ã‚‹ã‚ˆã†ã«èª¿æ•´
            ensureCharacterWithinCanvas();
            
            // ç¾åœ¨ã®çŠ¶æ…‹ã‚’ä¿å­˜çŠ¶æ…‹ã«åæ˜ 
            savedState.character.left = character.style.left;
            savedState.character.top = character.style.top;
            savedState.character.width = character.style.width;
            savedState.character.height = character.style.height;
            
            savedState.canvas.left = characterCanvas.style.left;
            savedState.canvas.top = characterCanvas.style.top;
            savedState.canvas.width = characterCanvas.style.width;
            savedState.canvas.height = characterCanvas.style.height;
            
            // localStorageã«æ°¸ç¶šä¿å­˜
            try {
                localStorage.setItem('spine-positioning-state', JSON.stringify(savedState));
                console.log('âœ… çŠ¶æ…‹ã‚’localStorageã«ä¿å­˜ã—ã¾ã—ãŸ:', savedState);
            } catch (e) {
                console.error('âŒ localStorageä¿å­˜ã‚¨ãƒ©ãƒ¼:', e);
            }
            
            // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰å®Œå…¨çµ‚äº†
            endEditMode();
            
            coordinateDisplay.textContent = 'ğŸ’¾ å¤‰æ›´ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼ˆæ°¸ç¶šä¿å­˜ï¼‰';
            setTimeout(() => {
                coordinateDisplay.textContent = '';
            }, 2000);
        }

        // ç·¨é›†ã‚­ãƒ£ãƒ³ã‚»ãƒ«
        function cancelEdit() {
            console.log('ğŸ”„ ã‚­ãƒ£ãƒ³ã‚»ãƒ«é–‹å§‹ - å¾©å…ƒå‰ã®çŠ¶æ…‹:', {
                ç¾åœ¨ã®ä½ç½®: {
                    left: character.style.left,
                    top: character.style.top,
                    width: character.style.width,
                    height: character.style.height
                },
                ä¿å­˜ã•ã‚Œã¦ã„ãŸä½ç½®: savedState.character,
                å¾©å…ƒäºˆå®šã®å€¤: {
                    left: savedState.character.left,
                    top: savedState.character.top,
                    width: savedState.character.width,
                    height: savedState.character.height
                }
            });
            
            // ä¿å­˜ã•ã‚ŒãŸåˆæœŸçŠ¶æ…‹ã«å®Œå…¨ã«æˆ»ã™
            character.style.left = savedState.character.left;
            character.style.top = savedState.character.top;
            character.style.width = savedState.character.width;
            character.style.height = savedState.character.height;
            
            characterCanvas.style.left = savedState.canvas.left;
            characterCanvas.style.top = savedState.canvas.top;
            characterCanvas.style.width = savedState.canvas.width;
            characterCanvas.style.height = savedState.canvas.height;
            
            console.log('ğŸ”„ å¾©å…ƒå®Ÿè¡Œå¾Œã®å®Ÿéš›ã®å€¤:', {
                å¾©å…ƒå¾Œã®style: {
                    left: character.style.left,
                    top: character.style.top,
                    width: character.style.width,
                    height: character.style.height
                }
            });
            
            // å¾©å…ƒå¾Œã®è©³ç´°ãªå¯è¦–æ€§ç¢ºèª
            const characterLeft = parseFloat(character.style.left) || 0;
            const characterTop = parseFloat(character.style.top) || 0;
            const characterWidth = character.offsetWidth;
            const characterHeight = character.offsetHeight;
            const canvasWidth = characterCanvas.offsetWidth;
            const canvasHeight = characterCanvas.offsetHeight;
            
            // transform: translate(-50%, -50%)ã‚’è€ƒæ…®ã—ãŸå®Ÿéš›ã®ä½ç½®è¨ˆç®—
            const actualLeft = characterLeft - characterWidth / 2;
            const actualTop = characterTop - characterHeight / 2;
            const actualRight = actualLeft + characterWidth;
            const actualBottom = actualTop + characterHeight;
            
            // Canvasç¯„å›²å†…ã«ã‚ã‚‹ã‹ã©ã†ã‹ã®æ­£ç¢ºãªåˆ¤å®š
            const isWithinCanvas = actualLeft >= 0 && actualTop >= 0 && 
                                   actualRight <= canvasWidth && actualBottom <= canvasHeight;
            const hasValidSize = characterWidth > 0 && characterHeight > 0;
            
            console.log('âœ… ã‚­ãƒ£ãƒ³ã‚»ãƒ«å®Œäº† - è©³ç´°çŠ¶æ…‹ç¢ºèª:', {
                å¾©å…ƒã•ã‚ŒãŸä½ç½®: savedState.character,
                ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åŸºæœ¬æƒ…å ±: {
                    è¨­å®šä½ç½®: { left: characterLeft, top: characterTop },
                    ã‚µã‚¤ã‚º: { width: characterWidth, height: characterHeight },
                    æœ‰åŠ¹ã‚µã‚¤ã‚º: hasValidSize
                },
                Canvasæƒ…å ±: {
                    ã‚µã‚¤ã‚º: { width: canvasWidth, height: canvasHeight }
                },
                ä½ç½®è¨ˆç®—è©³ç´°: {
                    transformè€ƒæ…®å¾Œ: { left: actualLeft, top: actualTop, right: actualRight, bottom: actualBottom },
                    Canvasç¯„å›²å†…: isWithinCanvas
                }
            });
            
            // ç·Šæ€¥æ™‚ï¼šã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãŒç¯„å›²å¤–ã«ã‚ã‚‹å ´åˆã¯å®‰å…¨ä½ç½®ã«ç§»å‹•
            if (!hasValidSize || !isWithinCanvas) {
                console.log('âš ï¸ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãŒç¯„å›²å¤–ã§ã™ - ç·Šæ€¥ä¿®æ­£');
                character.style.left = '40px';  // ä¸­å¿ƒä½ç½®ã‚’è€ƒæ…®ã—ãŸå®‰å…¨ãªä½ç½®
                character.style.top = '40px';
                character.style.display = 'block';
                character.style.visibility = 'visible';
            }
            
            // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰å®Œå…¨çµ‚äº†
            endEditMode();
            
            // ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰ã«å¤‰æ›´
            console.log('ğŸ”„ ã‚­ãƒ£ãƒ³ã‚»ãƒ« - ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦å‰å›ä¿å­˜ã—ãŸçŠ¶æ…‹ã«æˆ»ã—ã¾ã™');
            coordinateDisplay.textContent = 'ğŸ”„ å‰å›ä¿å­˜ã—ãŸçŠ¶æ…‹ã«æˆ»ã—ã¦ã„ã¾ã™...';
            
            // å°‘ã—å¾…ã£ã¦ã‹ã‚‰ãƒªãƒ­ãƒ¼ãƒ‰ï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¦‹ã›ã‚‹ãŸã‚ï¼‰
            setTimeout(() => {
                location.reload();
            }, 500);
        }

        // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰å®Œå…¨çµ‚äº†ï¼ˆå…±é€šå‡¦ç†ï¼‰
        function endEditMode() {
            // ç¢ºå®šãƒ‘ãƒãƒ«éè¡¨ç¤º
            editConfirmPanel.style.display = 'none';
            
            // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç·¨é›†çµ‚äº†
            if (isCharacterEditMode) {
                isCharacterEditMode = false;
                const characterButton = document.querySelector('button[onclick="toggleEditMode()"]');
                if (characterButton) {
                    characterButton.textContent = 'ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç·¨é›†';
                    characterButton.classList.remove('active');
                }
                character.classList.remove('edit-mode');
                character.style.cursor = 'default';
                removeCharacterDragEvents();
            }
            
            // Canvasç·¨é›†çµ‚äº†
            if (isCanvasEditMode) {
                isCanvasEditMode = false;
                const canvasButton = document.querySelector('button[onclick="toggleCanvasEditMode()"]');
                if (canvasButton) {
                    canvasButton.textContent = 'è¡¨ç¤ºç¯„å›²ç·¨é›†';
                    canvasButton.classList.remove('active');
                }
                characterCanvas.classList.remove('canvas-edit-mode');
                removeCanvasDragEvents();
            }
        }

        // Canvasãƒªã‚µã‚¤ã‚ºå¾Œã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ä½ç½®èª¿æ•´
        function adjustCharacterPositionAfterCanvasResize() {
            if (!startElementPos.charAbsoluteX || !startElementPos.charAbsoluteY) return;
            
            // ç¾åœ¨ã®Canvasä½ç½®ã‚’å–å¾—
            const canvasRect = characterCanvas.getBoundingClientRect();
            const demoRect = demoScreen.getBoundingClientRect();
            
            // Canvaså·¦ä¸Šã®èƒŒæ™¯ç”»åƒåŸºæº–ä½ç½®
            const canvasLeft = canvasRect.left - demoRect.left;
            const canvasTop = canvasRect.top - demoRect.top;
            
            // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®èƒŒæ™¯ç”»åƒåŸºæº–çµ¶å¯¾ä½ç½®ã‹ã‚‰Canvaså†…ã®ä¸­å¿ƒç‚¹ä½ç½®ã‚’è¨ˆç®—
            const targetCharCenterX = startElementPos.charAbsoluteX - canvasLeft;
            const targetCharCenterY = startElementPos.charAbsoluteY - canvasTop;
            
            // Canvaså¢ƒç•Œå†…ã«åˆ¶é™ï¼ˆä¸­å¿ƒç‚¹åŸºæº–ï¼‰
            const charWidth = character.offsetWidth;
            const charHeight = character.offsetHeight;
            const minX = charWidth / 2;
            const maxX = canvasRect.width - charWidth / 2;
            const minY = charHeight / 2;
            const maxY = canvasRect.height - charHeight / 2;
            
            const newCharCenterX = Math.max(minX, Math.min(maxX, targetCharCenterX));
            const newCharCenterY = Math.max(minY, Math.min(maxY, targetCharCenterY));
            
            // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ä½ç½®ã‚’æ›´æ–°ï¼ˆä¸­å¿ƒç‚¹åŸºæº–ï¼‰
            character.style.left = newCharCenterX + 'px';
            character.style.top = newCharCenterY + 'px';
        }

        // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãŒCanvasç¯„å›²å†…ã«åã¾ã‚‹ã‚ˆã†ã«èª¿æ•´
        function ensureCharacterWithinCanvas() {
            // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®ç¾åœ¨ä¸­å¿ƒç‚¹ä½ç½®ã‚’å–å¾—
            const charCenterX = parseFloat(character.style.left) || 60;
            const charCenterY = parseFloat(character.style.top) || 60;
            const charWidth = character.offsetWidth;
            const charHeight = character.offsetHeight;
            
            // Canvasã‚µã‚¤ã‚ºã‚’å–å¾—
            const canvasWidth = characterCanvas.offsetWidth;
            const canvasHeight = characterCanvas.offsetHeight;
            
            // Canvasç¯„å›²å†…ã«åˆ¶é™ï¼ˆä¸­å¿ƒç‚¹åŸºæº–ï¼‰
            const minX = charWidth / 2;
            const maxX = canvasWidth - charWidth / 2;
            const minY = charHeight / 2;
            const maxY = canvasHeight - charHeight / 2;
            
            let newCenterX = Math.max(minX, Math.min(maxX, charCenterX));
            let newCenterY = Math.max(minY, Math.min(maxY, charCenterY));
            
            // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãŒCanvasç¯„å›²å¤–ã«ã‚ã‚‹å ´åˆã¯ç¯„å›²å†…ã«ç§»å‹•
            if (charCenterX < minX || charCenterX > maxX || 
                charCenterY < minY || charCenterY > maxY) {
                
                character.style.left = newCenterX + 'px';
                character.style.top = newCenterY + 'px';
                
                console.log(`ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ä½ç½®ã‚’Canvasç¯„å›²å†…ã«èª¿æ•´: ${newCenterX}px, ${newCenterY}px (ä¸­å¿ƒç‚¹åŸºæº–)`);
            }
        }

        // ãƒªã‚µã‚¤ã‚ºãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®è¨­å®š
        function setupResizeHandlers() {
            // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒªã‚µã‚¤ã‚ºãƒãƒ³ãƒ‰ãƒ«
            const characterHandles = character.querySelectorAll('.resize-handle');
            characterHandles.forEach(handle => {
                handle.addEventListener('mousedown', (e) => {
                    if (!isCharacterEditMode) return;
                    startResize(e, 'character', handle.dataset.direction);
                });
            });

            // è¡¨ç¤ºç¯„å›²ãƒªã‚µã‚¤ã‚ºãƒãƒ³ãƒ‰ãƒ«
            const canvasHandles = characterCanvas.querySelectorAll('.canvas-resize-handle');
            canvasHandles.forEach(handle => {
                handle.addEventListener('mousedown', (e) => {
                    if (!isCanvasEditMode) return;
                    startResize(e, 'canvas', handle.dataset.direction);
                });
            });

            // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ™ãƒ³ãƒˆ
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', handleMouseUp);
        }

        // ãƒªã‚µã‚¤ã‚ºé–‹å§‹
        function startResize(e, type, direction) {
            isResizing = true;
            resizeType = type;
            resizeDirection = direction;
            
            startMousePos = { x: e.clientX, y: e.clientY };
            
            if (type === 'character') {
                const rect = character.getBoundingClientRect();
                startElementPos = {
                    // ä¸­å¿ƒç‚¹åŸºæº–ã®ä½ç½®ã‚’è¨˜éŒ²ï¼ˆtransformå¯¾å¿œï¼‰
                    centerX: parseFloat(character.style.left) || 60,
                    centerY: parseFloat(character.style.top) || 60,
                    width: rect.width,
                    height: rect.height
                };
            } else if (type === 'canvas') {
                const rect = characterCanvas.getBoundingClientRect();
                const demoRect = demoScreen.getBoundingClientRect();
                
                // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®èƒŒæ™¯ç”»åƒã«å¯¾ã™ã‚‹çµ¶å¯¾ä½ç½®ã‚’è¨˜éŒ²
                const charRect = character.getBoundingClientRect();
                const charAbsoluteX = charRect.left + charRect.width/2 - demoRect.left;
                const charAbsoluteY = charRect.top + charRect.height/2 - demoRect.top;
                
                startElementPos = {
                    width: rect.width,
                    height: rect.height,
                    // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®èƒŒæ™¯åŸºæº–çµ¶å¯¾ä½ç½®ã‚’ä¿å­˜
                    charAbsoluteX: charAbsoluteX,
                    charAbsoluteY: charAbsoluteY,
                    // Canvaså†…ã§ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç›¸å¯¾ä½ç½®ã‚‚ä¿å­˜
                    charRelativeX: parseFloat(character.style.left) || 60,
                    charRelativeY: parseFloat(character.style.top) || 60
                };
            }
            
            e.preventDefault();
            e.stopPropagation();
        }

        // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ‰ãƒ©ãƒƒã‚°ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
        function setupCharacterDragEvents() {
            character.addEventListener('mousedown', startCharacterDrag);
        }

        function removeCharacterDragEvents() {
            character.removeEventListener('mousedown', startCharacterDrag);
        }

        // è¡¨ç¤ºç¯„å›²ãƒ‰ãƒ©ãƒƒã‚°ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
        function setupCanvasDragEvents() {
            characterCanvas.addEventListener('mousedown', startCanvasDrag);
        }

        function removeCanvasDragEvents() {
            characterCanvas.removeEventListener('mousedown', startCanvasDrag);
        }

        function startCharacterDrag(e) {
            if (!isCharacterEditMode || e.target.classList.contains('resize-handle')) return;
            isDragging = true;
            character.style.cursor = 'grabbing';
            character.classList.add('dragging');
            
            startMousePos = { x: e.clientX, y: e.clientY };
            
            // ç¾åœ¨ã®å®Ÿéš›ã®ä½ç½®ã‚’å–å¾—ï¼ˆtransformã‚’è€ƒæ…®ï¼‰
            const rect = character.getBoundingClientRect();
            const canvasRect = characterCanvas.getBoundingClientRect();
            
            // Canvaså†…ã§ã®ç›¸å¯¾ä½ç½®ã‚’è¨ˆç®—
            const currentX = rect.left + rect.width/2 - canvasRect.left;
            const currentY = rect.top + rect.height/2 - canvasRect.top;
            
            startElementPos = {
                x: currentX,
                y: currentY
            };
            
            // ãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆæŒ‡å®šã‚’ãƒ”ã‚¯ã‚»ãƒ«ã«å¤‰æ›ã—ã¦ä¿å­˜
            character.style.left = currentX + 'px';
            character.style.top = currentY + 'px';
            
            e.preventDefault();
        }

        function startCanvasDrag(e) {
            if (!isCanvasEditMode || e.target.classList.contains('canvas-resize-handle')) return;
            
            isDragging = true;
            characterCanvas.classList.add('dragging');
            
            startMousePos = { x: e.clientX, y: e.clientY };
            const rect = demoScreen.getBoundingClientRect();
            const canvasRect = characterCanvas.getBoundingClientRect();
            
            // Canvasã®ä¸­å¿ƒä½ç½®ã‚’è¨˜éŒ²
            startElementPos = {
                centerX: ((canvasRect.left + canvasRect.width/2 - rect.left) / rect.width) * 100,
                centerY: ((canvasRect.top + canvasRect.height/2 - rect.top) / rect.height) * 100
            };
            
            e.preventDefault();
        }

        // ãƒã‚¦ã‚¹ç§»å‹•å‡¦ç†
        function handleMouseMove(e) {
            if (isResizing) {
                handleResize(e);
            } else if (isDragging && isCharacterEditMode) {
                handleCharacterDrag(e);
            } else if (isDragging && isCanvasEditMode) {
                handleCanvasDrag(e);
            }
        }

        // ãƒªã‚µã‚¤ã‚ºå‡¦ç†
        function handleResize(e) {
            const deltaX = e.clientX - startMousePos.x;
            const deltaY = e.clientY - startMousePos.y;

            if (resizeType === 'character') {
                let newWidth = startElementPos.width;
                let newHeight = startElementPos.height;

                // å¯¾è§’ãƒãƒ³ãƒ‰ãƒ«ã‚’åŸºæº–ã«ã—ãŸå›ºå®šç‚¹ãƒªã‚µã‚¤ã‚º
                switch (resizeDirection) {
                    case 'se': // å³ä¸‹ãƒãƒ³ãƒ‰ãƒ«: å·¦ä¸Š(NW)ãŒå›ºå®šç‚¹
                        newWidth = Math.max(40, startElementPos.width + deltaX);
                        newHeight = Math.max(40, startElementPos.height + deltaY);
                        break;
                        
                    case 'sw': // å·¦ä¸‹ãƒãƒ³ãƒ‰ãƒ«: å³ä¸Š(NE)ãŒå›ºå®šç‚¹
                        newWidth = Math.max(40, startElementPos.width - deltaX);
                        newHeight = Math.max(40, startElementPos.height + deltaY);
                        break;
                        
                    case 'ne': // å³ä¸Šãƒãƒ³ãƒ‰ãƒ«: å·¦ä¸‹(SW)ãŒå›ºå®šç‚¹
                        newWidth = Math.max(40, startElementPos.width + deltaX);
                        newHeight = Math.max(40, startElementPos.height - deltaY);
                        break;
                        
                    case 'nw': // å·¦ä¸Šãƒãƒ³ãƒ‰ãƒ«: å³ä¸‹(SE)ãŒå›ºå®šç‚¹ï¼ˆåœ°é¢å›ºå®šã§ä¾¿åˆ©ï¼‰
                        newWidth = Math.max(40, startElementPos.width - deltaX);
                        newHeight = Math.max(40, startElementPos.height - deltaY);
                        break;
                }

                // ã‚µã‚¤ã‚ºé©ç”¨
                character.style.width = newWidth + 'px';
                character.style.height = newHeight + 'px';
                
                // å¯¾è§’å›ºå®šç‚¹ã‚’ç¶­æŒã™ã‚‹ãŸã‚ã®ä¸­å¿ƒç‚¹ä½ç½®èª¿æ•´
                const widthDiff = newWidth - startElementPos.width;
                const heightDiff = newHeight - startElementPos.height;
                
                let newCenterX = startElementPos.centerX;
                let newCenterY = startElementPos.centerY;
                
                // å„æ–¹å‘ã«ãŠã‘ã‚‹ä¸­å¿ƒç‚¹ã®èª¿æ•´ï¼ˆå¯¾è§’å›ºå®šç‚¹ç¶­æŒï¼‰
                switch (resizeDirection) {
                    case 'se': // å³ä¸‹ãƒãƒ³ãƒ‰ãƒ«: å·¦ä¸Šå›ºå®š â†’ ä¸­å¿ƒç‚¹ã¯å³ä¸‹ã«ç§»å‹•
                        newCenterX = startElementPos.centerX + widthDiff / 2;
                        newCenterY = startElementPos.centerY + heightDiff / 2;
                        break;
                        
                    case 'sw': // å·¦ä¸‹ãƒãƒ³ãƒ‰ãƒ«: å³ä¸Šå›ºå®š â†’ ä¸­å¿ƒç‚¹ã¯å·¦ä¸‹ã«ç§»å‹•
                        newCenterX = startElementPos.centerX - widthDiff / 2;
                        newCenterY = startElementPos.centerY + heightDiff / 2;
                        break;
                        
                    case 'ne': // å³ä¸Šãƒãƒ³ãƒ‰ãƒ«: å·¦ä¸‹å›ºå®š â†’ ä¸­å¿ƒç‚¹ã¯å³ä¸Šã«ç§»å‹•
                        newCenterX = startElementPos.centerX + widthDiff / 2;
                        newCenterY = startElementPos.centerY - heightDiff / 2;
                        break;
                        
                    case 'nw': // å·¦ä¸Šãƒãƒ³ãƒ‰ãƒ«: å³ä¸‹å›ºå®š â†’ ä¸­å¿ƒç‚¹ã¯å·¦ä¸Šã«ç§»å‹•
                        newCenterX = startElementPos.centerX - widthDiff / 2;
                        newCenterY = startElementPos.centerY - heightDiff / 2;
                        break;
                }
                
                // Canvaså†…ã§ã®å¢ƒç•Œåˆ¶é™ï¼ˆä¸­å¿ƒç‚¹åŸºæº–ï¼‰
                const canvasRect = characterCanvas.getBoundingClientRect();
                const minCenterX = newWidth / 2;
                const maxCenterX = canvasRect.width - newWidth / 2;
                const minCenterY = newHeight / 2;
                const maxCenterY = canvasRect.height - newHeight / 2;
                
                newCenterX = Math.max(minCenterX, Math.min(maxCenterX, newCenterX));
                newCenterY = Math.max(minCenterY, Math.min(maxCenterY, newCenterY));
                
                character.style.left = newCenterX + 'px';
                character.style.top = newCenterY + 'px';
                
                const scale = (newWidth / 80).toFixed(2);
                const fixedPoint = getFixedPointName(resizeDirection);
                coordinateDisplay.textContent = `ğŸ“ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚µã‚¤ã‚º: ${newWidth.toFixed(0)}Ã—${newHeight.toFixed(0)}px (ã‚¹ã‚±ãƒ¼ãƒ«: ${scale}) [${fixedPoint}å›ºå®š]`;

            } else if (resizeType === 'canvas') {
                let newWidth = startElementPos.width;
                let newHeight = startElementPos.height;

                switch (resizeDirection) {
                    case 'se':
                        newWidth = Math.max(60, startElementPos.width + deltaX);
                        newHeight = Math.max(60, startElementPos.height + deltaY);
                        break;
                    case 'sw':
                        newWidth = Math.max(60, startElementPos.width - deltaX);
                        newHeight = Math.max(60, startElementPos.height + deltaY);
                        break;
                    case 'ne':
                        newWidth = Math.max(60, startElementPos.width + deltaX);
                        newHeight = Math.max(60, startElementPos.height - deltaY);
                        break;
                    case 'nw':
                        newWidth = Math.max(60, startElementPos.width - deltaX);
                        newHeight = Math.max(60, startElementPos.height - deltaY);
                        break;
                }

                characterCanvas.style.width = newWidth + 'px';
                characterCanvas.style.height = newHeight + 'px';
                
                // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®èƒŒæ™¯ç”»åƒåŸºæº–ã®çµ¶å¯¾ä½ç½®ã‚’ä¿æŒ
                adjustCharacterPositionAfterCanvasResize();
                
                coordinateDisplay.textContent = `ğŸ¨ è¡¨ç¤ºç¯„å›²ã‚µã‚¤ã‚º: ${newWidth.toFixed(0)}Ã—${newHeight.toFixed(0)}px (ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¡¨ç¤ºé ˜åŸŸ)`;
            }
        }

        // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ‰ãƒ©ãƒƒã‚°å‡¦ç†
        function handleCharacterDrag(e) {
            const deltaX = e.clientX - startMousePos.x;
            const deltaY = e.clientY - startMousePos.y;
            
            let newX = startElementPos.x + deltaX;
            let newY = startElementPos.y + deltaY;
            
            // Canvaså†…ã§ã®å¢ƒç•Œåˆ¶é™ï¼ˆä¸­å¿ƒç‚¹åŸºæº–ï¼‰
            const canvasRect = characterCanvas.getBoundingClientRect();
            const charWidth = character.offsetWidth;
            const charHeight = character.offsetHeight;
            
            // transformã‚’è€ƒæ…®ã—ãŸå¢ƒç•Œè¨ˆç®—
            const minX = charWidth / 2;
            const maxX = canvasRect.width - charWidth / 2;
            const minY = charHeight / 2;
            const maxY = canvasRect.height - charHeight / 2;
            
            newX = Math.max(minX, Math.min(maxX, newX));
            newY = Math.max(minY, Math.min(maxY, newY));
            
            character.style.left = newX + 'px';
            character.style.top = newY + 'px';
            
            coordinateDisplay.textContent = `ğŸ“ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ä½ç½®: ${newX.toFixed(0)}px, ${newY.toFixed(0)}px (Canvaså†…ãƒ»ä¸­å¿ƒç‚¹)`;
        }

        // Canvasç§»å‹•å‡¦ç†
        function handleCanvasDrag(e) {
            const deltaX = e.clientX - startMousePos.x;
            const deltaY = e.clientY - startMousePos.y;
            
            const rect = demoScreen.getBoundingClientRect();
            const deltaPercentX = (deltaX / rect.width) * 100;
            const deltaPercentY = (deltaY / rect.height) * 100;
            
            let newX = startElementPos.centerX + deltaPercentX;
            let newY = startElementPos.centerY + deltaPercentY;
            
            // å¢ƒç•Œåˆ¶é™ï¼ˆCanvasãŒèƒŒæ™¯ã‹ã‚‰å‡ºãªã„ã‚ˆã†ã«ï¼‰
            newX = Math.max(10, Math.min(90, newX));
            newY = Math.max(10, Math.min(90, newY));
            
            characterCanvas.style.left = newX + '%';
            characterCanvas.style.top = newY + '%';
            
            coordinateDisplay.textContent = `ğŸ“± Canvasä½ç½®: ${newX.toFixed(1)}%, ${newY.toFixed(1)}%`;
        }

        // ãƒã‚¦ã‚¹ã‚¢ãƒƒãƒ—å‡¦ç†
        function handleMouseUp() {
            if (isDragging) {
                isDragging = false;
                character.style.cursor = 'grab';
                character.classList.remove('dragging');
                characterCanvas.classList.remove('dragging');
                
                if (isCharacterEditMode) {
                    setTimeout(() => {
                        const rect = demoScreen.getBoundingClientRect();
                        const charRect = character.getBoundingClientRect();
                        const centerX = ((charRect.left + charRect.width/2 - rect.left) / rect.width * 100).toFixed(1);
                        const centerY = ((charRect.top + charRect.height/2 - rect.top) / rect.height * 100).toFixed(1);
                        const scale = (charRect.width / 80).toFixed(2);
                        
                        coordinateDisplay.innerHTML = `
                            ğŸ“‹ ç”Ÿæˆã‚³ãƒ¼ãƒ‰: 
                            &lt;div data-character="purattokun" data-x="${centerX}" data-y="${centerY}" data-scale="${scale}"&gt;&lt;/div&gt;
                        `;
                    }, 100);
                }
            }
            
            if (isResizing) {
                isResizing = false;
                resizeType = '';
                resizeDirection = '';
                
                setTimeout(() => {
                    if (isCharacterEditMode) {
                        const rect = demoScreen.getBoundingClientRect();
                        const charRect = character.getBoundingClientRect();
                        const centerX = ((charRect.left + charRect.width/2 - rect.left) / rect.width * 100).toFixed(1);
                        const centerY = ((charRect.top + charRect.height/2 - rect.top) / rect.height * 100).toFixed(1);
                        const scale = (charRect.width / 80).toFixed(2);
                        
                        coordinateDisplay.innerHTML = `
                            ğŸ“‹ ç”Ÿæˆã‚³ãƒ¼ãƒ‰: 
                            &lt;div data-character="purattokun" data-x="${centerX}" data-y="${centerY}" data-scale="${scale}" data-canvas-width="${demoScreen.offsetWidth}" data-canvas-height="${demoScreen.offsetHeight}"&gt;&lt;/div&gt;
                        `;
                    } else if (isCanvasEditMode) {
                        coordinateDisplay.innerHTML = `
                            ğŸ“‹ Canvasè¨­å®š: 
                            width="${demoScreen.offsetWidth}px" height="${demoScreen.offsetHeight}px"
                        `;
                    }
                }, 100);
            }
        }
    </script>
</body>
</html>