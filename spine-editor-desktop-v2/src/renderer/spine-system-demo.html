<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spine System v2.0 çµ±åˆãƒ‡ãƒ¢</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            min-height: 100vh;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            color: #00ff88;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.8;
            font-size: 1.1em;
        }
        
        .demo-container {
            display: flex;
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .control-panel {
            width: 300px;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
        
        .preview-area {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            min-height: 600px;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(5px);
        }
        
        .control-section {
            margin-bottom: 25px;
        }
        
        .control-section h3 {
            margin: 0 0 15px 0;
            color: #00ff88;
            font-size: 1.2em;
        }
        
        .button {
            display: block;
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            background: linear-gradient(45deg, #00ff88, #00cc66);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 255, 136, 0.4);
        }
        
        .button.secondary {
            background: linear-gradient(45deg, #4a90e2, #357abd);
        }
        
        .button.danger {
            background: linear-gradient(45deg, #ff6b6b, #e74c3c);
        }
        
        .status-display {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 0.9em;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .info-box {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid rgba(0, 255, 136, 0.3);
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        
        .info-box h4 {
            margin: 0 0 10px 0;
            color: #00ff88;
        }
        
        .module-status {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
        }
        
        .status-indicator {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .status-ok { background: #00ff88; color: black; }
        .status-error { background: #ff6b6b; color: white; }
        .status-loading { background: #ffa500; color: black; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ¯ Spine System v2.0</h1>
        <p>è»½é‡Spine WebGLã‚·ã‚¹ãƒ†ãƒ çµ±åˆãƒ‡ãƒ¢ - 3ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«çµ±åˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£</p>
    </div>
    
    <div class="demo-container">
        <div class="control-panel">
            <div class="info-box">
                <h4>ğŸš€ ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ</h4>
                <p><strong>spine-core.js</strong> (300è¡Œ)<br>WebGLåˆæœŸåŒ–ãƒ»Canvasç®¡ç†</p>
                <p><strong>spine-renderer.js</strong> (200è¡Œ)<br>ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æç”»ãƒ»Animation</p>
                <p><strong>spine-utils.js</strong> (100è¡Œ)<br>Assetèª­ã¿è¾¼ã¿ãƒ»ã‚¨ãƒ©ãƒ¼å‡¦ç†</p>
            </div>
            
            <div class="control-section">
                <h3>ğŸ“‹ ã‚·ã‚¹ãƒ†ãƒ åˆ¶å¾¡</h3>
                <button class="button" onclick="initializeSystem()">ğŸš€ ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–</button>
                <button class="button secondary" onclick="addTestCharacter()">ğŸ­ ãƒ†ã‚¹ãƒˆã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¿½åŠ </button>
                <button class="button secondary" onclick="showSystemStatus()">ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ç¢ºèª</button>
                <button class="button danger" onclick="cleanupSystem()">ğŸ§¹ ã‚·ã‚¹ãƒ†ãƒ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—</button>
            </div>
            
            <div class="control-section">
                <h3>ğŸ® ãƒ‡ãƒ¢æ©Ÿèƒ½</h3>
                <button class="button secondary" onclick="addMultipleCharacters()">ğŸ‘¥ è¤‡æ•°ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼</button>
                <button class="button secondary" onclick="testAssetLoading()">ğŸ“¦ Assetèª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ</button>
                <button class="button secondary" onclick="triggerErrorTest()">âš ï¸ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°</button>
            </div>
            
            <div class="control-section">
                <h3>ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹</h3>
                <div id="systemStatus" class="status-display">
                    ã‚·ã‚¹ãƒ†ãƒ æœªåˆæœŸåŒ–
                </div>
            </div>
        </div>
        
        <div class="preview-area" id="previewArea">
            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; opacity: 0.5;">
                <h2>ğŸ­ Spine System v2.0 Preview Area</h2>
                <p>ã€ŒğŸš€ ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ã€ãƒœã‚¿ãƒ³ã§ã‚¹ã‚¿ãƒ¼ãƒˆ</p>
            </div>
        </div>
    </div>

    <!-- Spine System v2.0 Modules -->
    <script src="js/spine-core.js"></script>
    <script src="js/spine-renderer.js"></script>
    <script src="js/spine-utils.js"></script>
    <script src="js/spine-system.js"></script>

    <script>
        // Global variables
        let spineSystem = null;
        let characterCount = 0;

        // ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
        async function initializeSystem() {
            try {
                updateStatus('ğŸš€ ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ä¸­...');
                
                spineSystem = new SpineSystem();
                const success = await spineSystem.initialize();
                
                if (success) {
                    updateStatus('âœ… ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†\nğŸ® ãƒ‡ãƒ¢æ©Ÿèƒ½ãŒåˆ©ç”¨å¯èƒ½ã«ãªã‚Šã¾ã—ãŸ');
                    clearPreviewArea();
                } else {
                    updateStatus('âŒ ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å¤±æ•—');
                }
                
            } catch (error) {
                updateStatus(`âŒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }

        // ãƒ†ã‚¹ãƒˆã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¿½åŠ 
        async function addTestCharacter() {
            if (!spineSystem || !spineSystem.initialized) {
                updateStatus('âŒ ã‚·ã‚¹ãƒ†ãƒ æœªåˆæœŸåŒ–');
                return;
            }

            try {
                characterCount++;
                const characterId = `test-character-${characterCount}`;
                const position = {
                    x: 100 + (characterCount * 50),
                    y: 100 + (characterCount * 30)
                };

                updateStatus(`ğŸ­ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼${characterCount}é…ç½®ä¸­...`);
                
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è¡¨ç¤ºã§ã®é…ç½®ï¼ˆå®Ÿéš›ã®Spineãƒ•ã‚¡ã‚¤ãƒ«ãªã—ã§ã®ãƒ†ã‚¹ãƒˆï¼‰
                const success = spineSystem.renderer.createFallbackDisplay(
                    characterId,
                    { name: `TestChar${characterCount}` },
                    position,
                    document.getElementById('previewArea')
                );
                
                if (success) {
                    updateStatus(`âœ… ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼${characterCount}é…ç½®å®Œäº†`);
                } else {
                    updateStatus(`âŒ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼${characterCount}é…ç½®å¤±æ•—`);
                }
                
            } catch (error) {
                updateStatus(`âŒ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é…ç½®ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }

        // è¤‡æ•°ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¿½åŠ 
        async function addMultipleCharacters() {
            for (let i = 0; i < 3; i++) {
                await addTestCharacter();
                await new Promise(resolve => setTimeout(resolve, 500));
            }
        }

        // ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ç¢ºèª
        function showSystemStatus() {
            if (!spineSystem) {
                updateStatus('âŒ ã‚·ã‚¹ãƒ†ãƒ æœªåˆæœŸåŒ–');
                return;
            }

            try {
                const status = spineSystem.getSystemStatus();
                const statusText = JSON.stringify(status, null, 2);
                updateStatus(`ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹:\n${statusText}`);
                
                // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã‚‚è©³ç´°å‡ºåŠ›
                spineSystem.debugSystemInfo();
                
            } catch (error) {
                updateStatus(`âŒ çŠ¶æ…‹å–å¾—ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }

        // Assetèª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
        async function testAssetLoading() {
            if (!spineSystem || !spineSystem.initialized) {
                updateStatus('âŒ ã‚·ã‚¹ãƒ†ãƒ æœªåˆæœŸåŒ–');
                return;
            }

            try {
                updateStatus('ğŸ“¦ Assetèª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...');
                
                // å­˜åœ¨ã—ãªã„ã‚¢ã‚»ãƒƒãƒˆã§æ„å›³çš„ã«ã‚¨ãƒ©ãƒ¼ã‚’ç™ºç”Ÿ
                await spineSystem.utils.loadSpineAssets('/test/path', 'nonexistent');
                
            } catch (error) {
                updateStatus(`âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å‹•ä½œç¢ºèª:\n${error.message}`);
                
                // ã‚¨ãƒ©ãƒ¼è§£æ±ºç­–è¡¨ç¤º
                if (error.solutions) {
                    updateStatus(`ğŸ’¡ è§£æ±ºç­–: ${error.solutions.join(', ')}`);
                }
            }
        }

        // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆ
        function triggerErrorTest() {
            if (!spineSystem) {
                updateStatus('âŒ ã‚·ã‚¹ãƒ†ãƒ æœªåˆæœŸåŒ–');
                return;
            }

            try {
                updateStatus('âš ï¸ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ');
                
                // ç„¡åŠ¹ãªã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æ“ä½œã§ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ
                spineSystem.renderer.removeCharacter('invalid-character-id');
                
                updateStatus('âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æ­£å¸¸å‹•ä½œ');
                
            } catch (error) {
                updateStatus(`âŒ äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }

        // ã‚·ã‚¹ãƒ†ãƒ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
        function cleanupSystem() {
            if (spineSystem) {
                spineSystem.cleanup();
                updateStatus('âœ… ã‚·ã‚¹ãƒ†ãƒ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†');
            }
            
            clearPreviewArea();
            characterCount = 0;
            spineSystem = null;
        }

        // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ã‚¯ãƒªã‚¢
        function clearPreviewArea() {
            const previewArea = document.getElementById('previewArea');
            previewArea.innerHTML = `
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; opacity: 0.3;">
                    <h2>ğŸ® Spine System v2.0 Ready</h2>
                    <p>ãƒ‡ãƒ¢æ©Ÿèƒ½ã§ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’é…ç½®ã—ã¦ãã ã•ã„</p>
                </div>
            `;
        }

        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
        function updateStatus(text) {
            const statusDiv = document.getElementById('systemStatus');
            const timestamp = new Date().toLocaleTimeString();
            statusDiv.textContent = `[${timestamp}] ${text}`;
            statusDiv.scrollTop = statusDiv.scrollHeight;
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            updateStatus('ğŸ¯ Spine System v2.0 ãƒ‡ãƒ¢æº–å‚™å®Œäº†');
        });
    </script>
</body>
</html>