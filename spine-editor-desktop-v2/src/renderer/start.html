<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spine Editor v2.0 - Demo</title>
    <style>
        /* ÊúÄÂ∞è4„Éë„Éç„É´„É¨„Ç§„Ç¢„Ç¶„Éà */
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: #f5f5f5;
            height: 100vh;
            overflow: hidden;
        }

        .demo-container {
            display: grid;
            grid-template-columns: 250px 1fr 250px;
            grid-template-rows: 60px 1fr;
            height: 100vh;
            gap: 1px;
            background-color: #ddd;
        }

        .demo-header {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .demo-title {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
        }

        .demo-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            background-color: rgba(255,255,255,0.2);
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }

        .btn:hover {
            background-color: rgba(255,255,255,0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background-color: #4CAF50;
        }

        .btn-primary:hover {
            background-color: #45a049;
        }

        /* Â∑¶„Éë„Éç„É´: „Éó„É≠„Ç∏„Çß„ÇØ„Éà„É≠„Éº„ÉÄ„Éº */
        .project-panel {
            background-color: white;
            border-right: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
        }

        .panel-header {
            background-color: #f8f9fa;
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
            font-weight: 600;
            font-size: 14px;
            color: #333;
        }

        .panel-content {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
        }

        /* ‰∏≠Â§Æ„Éë„Éç„É´: HTML„Éó„É¨„Éì„É•„Éº */
        .preview-panel {
            background-color: white;
            display: flex;
            flex-direction: column;
        }

        .preview-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f9f9f9;
            position: relative;
            transition: all 0.2s ease;
        }
        
        .preview-content.drag-over {
            background-color: #e3f2fd;
            border: 2px dashed #007ACC;
        }

        .preview-placeholder {
            color: #888;
            font-size: 16px;
            text-align: center;
        }

        .preview-iframe {
            width: 100%;
            height: 100%;
            border: none;
            background-color: white;
        }

        /* Âè≥„Éë„Éç„É´: „Éö„Éº„Ç∏„Çª„É¨„ÇØ„Çø„Éº + SpineÂà∂Âæ° */
        .control-panel {
            background-color: white;
            border-left: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
        }

        .control-section {
            border-bottom: 1px solid #e0e0e0;
        }

        .control-section:last-child {
            border-bottom: none;
            flex: 1;
        }

        /* „Éï„Ç°„Ç§„É´„É™„Çπ„Éà */
        .file-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .file-item {
            padding: 8px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            font-size: 13px;
        }

        .file-item:hover {
            background-color: #f5f5f5;
        }

        .file-item.selected {
            background-color: #e3f2fd;
            color: #1976d2;
        }

        /* SpineÂà∂Âæ°„Ç®„É™„Ç¢ */
        .spine-controls {
            padding: 15px;
        }

        .spine-position {
            margin-bottom: 15px;
        }

        .position-input {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            align-items: center;
        }

        .position-input label {
            font-size: 12px;
            color: #666;
            width: 30px;
        }

        .position-input input {
            width: 80px;
            padding: 4px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
        }

        /* „É≠„Éº„Éá„Ç£„É≥„Ç∞Ë°®Á§∫ */
        .loading {
            color: #666;
            font-size: 14px;
            text-align: center;
            padding: 20px;
        }

        /* „Çπ„ÉÜ„Éº„Çø„ÇπË°®Á§∫ */
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-left: 8px;
        }

        .status-ready { background-color: #4CAF50; }
        .status-loading { background-color: #FF9800; }
        .status-error { background-color: #F44336; }

        /* „Ç¢„Ç¶„Éà„É©„Ç§„Éä„ÉºÊñπÂºè„Çπ„Çø„Ç§„É´ */
        .file-section {
            margin-bottom: 2px;
        }

        .file-section-header {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            color: #495057;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .file-section-header:hover {
            background-color: #e9ecef;
        }

        .section-toggle {
            width: 16px;
            text-align: center;
            margin-right: 8px;
            font-size: 12px;
            transition: transform 0.2s;
        }

        .section-title {
            flex: 1;
        }

        .section-count {
            color: #6c757d;
            font-size: 11px;
            font-weight: normal;
        }

        .file-section-content {
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            border-left: 2px solid #dee2e6;
            margin-left: 8px;
        }

        .file-section-content.expanded {
            max-height: 1000px;
        }

        .file-section-content.collapsed {
            max-height: 0;
        }

        .file-section .file-item {
            padding: 6px 20px;
            cursor: pointer;
            border-bottom: 1px solid #f8f9fa;
            font-size: 12px;
            margin: 0;
            background-color: white;
        }

        .file-section .file-item:hover {
            background-color: #f8f9fa;
        }

        .file-section .file-item.selected {
            background-color: #e3f2fd;
            color: #1976d2;
            border-left: 3px solid #2196f3;
        }

        /* Spine„Ç≠„É£„É©„ÇØ„Çø„Éº„Ç¢„Ç§„ÉÜ„É† */
        .spine-character-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            cursor: grab;
            border-bottom: 1px solid #f0f0f0;
            transition: all 0.2s ease;
            background: white;
        }

        .spine-character-item:hover {
            background-color: #f8f9ff;
            transform: translateX(2px);
        }

        .spine-character-item.dragging {
            opacity: 0.7;
            background-color: #e8f5e8;
            cursor: grabbing;
        }

        .character-icon {
            font-size: 20px;
            margin-right: 10px;
            flex-shrink: 0;
        }

        .character-info {
            flex: 1;
            min-width: 0;
        }

        .character-name {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .character-path {
            font-size: 11px;
            color: #666;
            margin-top: 2px;
        }

        /* „Çª„ÇØ„Ç∑„Éß„É≥„Ç∞„É´„Éº„Éó */
        .section-group {
            border-bottom: 1px solid #e0e0e0;
        }

        .section-group:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <!-- „Éò„ÉÉ„ÉÄ„Éº -->
        <header class="demo-header">
            <div>
                <h1 class="demo-title">Spine Editor v2.0 Demo</h1>
            </div>
            <div class="demo-actions">
                <button id="btn-open-folder" class="btn btn-primary">üìÅ „Éï„Ç©„É´„ÉÄ„ÇíÈñã„Åè</button>
                <button id="btn-load-spine-folder" class="btn">üé≠ Spine„Éï„Ç©„É´„ÉÄÈÅ∏Êäû</button>
                <button id="btn-export-package" class="btn" disabled>üì¶ „Éë„ÉÉ„Ç±„Éº„Ç∏Âá∫Âäõ</button>
                <button id="btn-preview-package" class="btn" disabled>üëÅÔ∏è „Éó„É¨„Éì„É•„Éº</button>
                <span id="status-indicator" class="status-indicator status-ready"></span>
            </div>
        </header>

        <!-- Â∑¶„Éë„Éç„É´: „Éó„É≠„Ç∏„Çß„ÇØ„Éà„É≠„Éº„ÉÄ„Éº -->
        <div class="project-panel">
            <!-- HTML„Éï„Ç°„Ç§„É´„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div class="section-group">
                <div class="panel-header">Project Files</div>
                <div class="panel-content">
                    <div id="project-status" class="loading">„Éï„Ç©„É´„ÉÄ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
                    <div id="file-list" class="file-list" style="display: none;"></div>
                </div>
            </div>
            
            <!-- Spine„Ç≠„É£„É©„ÇØ„Çø„Éº„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div class="section-group">
                <div class="panel-header">üé≠ Spine Characters</div>
                <div class="panel-content">
                    <div id="spine-character-status" class="loading">Spine„Éï„Ç©„É´„ÉÄ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
                    <div id="spine-character-list" class="file-list" style="display: none;"></div>
                </div>
            </div>
        </div>

        <!-- ‰∏≠Â§Æ„Éë„Éç„É´: HTML„Éó„É¨„Éì„É•„Éº -->
        <div class="preview-panel">
            <div class="panel-header">HTML Preview</div>
            <div class="preview-content" id="preview-content">
                <div id="preview-placeholder" class="preview-placeholder">
                    HTML„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû„Åô„Çã„Å®<br>„Éó„É¨„Éì„É•„Éº„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô<br><br>
                    <small style="color: #888;">üí° Â∑¶„Åã„ÇâSpine„Ç≠„É£„É©„ÇØ„Çø„Éº„Çí„Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„Éó„Åó„Å¶ËøΩÂä†„Åß„Åç„Åæ„Åô</small>
                </div>
                <iframe id="preview-iframe" class="preview-iframe" style="display: none;"></iframe>
                <!-- Spine„Ç≠„É£„É©„ÇØ„Çø„ÉºË°®Á§∫„Ç®„É™„Ç¢ -->
                <div id="spine-character-container" class="spine-character-container" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;">
                    <!-- Spine„Ç≠„É£„É©„ÇØ„Çø„Éº„Åå„Åì„Åì„Å´ÂãïÁöÑËøΩÂä†„Åï„Çå„Çã -->
                </div>
            </div>
        </div>

        <!-- Âè≥„Éë„Éç„É´: „Éö„Éº„Ç∏„Çª„É¨„ÇØ„Çø„Éº + SpineÂà∂Âæ° -->
        <div class="control-panel">
            <!-- „Éï„Ç°„Ç§„É´ÈÅ∏Êäû„Ç®„É™„Ç¢ -->
            <div class="control-section">
                <div class="panel-header">Page Selector</div>
                <div class="panel-content">
                    <div id="page-list" class="file-list">
                        <div class="loading">HTML„Éï„Ç°„Ç§„É´„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>
                    </div>
                </div>
            </div>

            <!-- SpineÂà∂Âæ°„Ç®„É™„Ç¢ -->
            <div class="control-section">
                <div class="panel-header">Spine Control</div>
                <div class="spine-controls">
                    <div class="spine-position">
                        <div class="position-input">
                            <label>X:</label>
                            <input id="spine-x" type="number" step="1" value="0">
                        </div>
                        <div class="position-input">
                            <label>Y:</label>
                            <input id="spine-y" type="number" step="1" value="0">
                        </div>
                    </div>
                    <button id="btn-add-spine" class="btn" style="width: 100%; margin-bottom: 10px;" disabled>
                        üé≠ Spine„Ç≠„É£„É©„ÇØ„Çø„ÉºËøΩÂä†
                    </button>
                    <button id="btn-save-position" class="btn" style="width: 100%;" disabled>
                        üíæ ‰ΩçÁΩÆ„Çí‰øùÂ≠ò
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="js/demo-modules.js"></script>
    <script src="js/spine-core.js"></script>
    <script src="js/spine-renderer.js"></script>
    
    <script>
        // „Éá„É¢„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥ÂàùÊúüÂåñ
        class DemoApp {
            constructor() {
                this.currentProject = null;
                this.currentPage = null;
                this.spinePosition = { x: 100, y: 100 };
                this.spineCharacter = null;
                
                // „Éï„Ç©„É´„ÉÄ„Éë„ÇπË®òÊÜ∂Ê©üËÉΩ
                this.savedPaths = {
                    project: localStorage.getItem('spine-editor-project-path'),
                    spine: localStorage.getItem('spine-editor-spine-path')
                };
                
                // Spine SystemÂàùÊúüÂåñ
                this.spineCore = new SpineCore();
                this.spineRenderer = null;
                
                this.initializeUI();
                this.bindEvents();
                this.initializeSpineSystem();
            }

            initializeUI() {
                this.statusIndicator = document.getElementById('status-indicator');
                this.projectStatus = document.getElementById('project-status');
                this.fileList = document.getElementById('file-list');
                this.pageList = document.getElementById('page-list');
                this.previewPlaceholder = document.getElementById('preview-placeholder');
                this.previewIframe = document.getElementById('preview-iframe');
                
                // SpineÈñ¢ÈÄ£Ë¶ÅÁ¥†
                this.spineCharacterStatus = document.getElementById('spine-character-status');
                this.spineCharacterList = document.getElementById('spine-character-list');
                
                this.btnOpenFolder = document.getElementById('btn-open-folder');
                this.btnLoadSpineFolder = document.getElementById('btn-load-spine-folder');
                this.btnExportPackage = document.getElementById('btn-export-package');
                this.btnPreviewPackage = document.getElementById('btn-preview-package');
                this.btnAddSpine = document.getElementById('btn-add-spine');
                this.btnSavePosition = document.getElementById('btn-save-position');
                
                this.spineXInput = document.getElementById('spine-x');
                this.spineYInput = document.getElementById('spine-y');
                
                // ‰øùÂ≠ò„Åï„Çå„Åü„Éë„Çπ„Åå„ÅÇ„Çå„Å∞Ëá™ÂãïË™≠„ÅøËæº„Åø
                this.loadSavedPaths();
                
                // „Éâ„É≠„ÉÉ„Éó„Çæ„Éº„É≥Ë®≠ÂÆö
                this.setupDropZone();
            }

            // ‰øùÂ≠ò„Åï„Çå„Åü„Éë„ÇπËá™ÂãïË™≠„ÅøËæº„Åø
            async loadSavedPaths() {
                console.log('üîß localStorageÁä∂ÊÖãÁ¢∫Ë™ç:');
                console.log('  - project:', localStorage.getItem('spine-editor-project-path'));
                console.log('  - spine:', localStorage.getItem('spine-editor-spine-path'));
                console.log('üîß this.savedPaths:', this.savedPaths);
                
                if (this.savedPaths.project) {
                    console.log('üîÑ Auto-loading saved project path:', this.savedPaths.project);
                    // „Éó„É≠„Ç∏„Çß„ÇØ„Éà„Éë„Çπ„ÇíËá™ÂãïË®≠ÂÆöÔºà„Éï„Ç°„Ç§„É´‰∏ÄË¶ß„ÅØË°®Á§∫„Åó„Å™„ÅÑÔºâ
                    this.currentProject = this.savedPaths.project;
                }
                
                if (this.savedPaths.spine) {
                    console.log('üîÑ Auto-loading saved spine path:', this.savedPaths.spine);
                    // Spine„Éë„Çπ„Åã„ÇâËá™ÂãïÊ§úÂá∫ÔºàUIÊõ¥Êñ∞„ÅØË°å„Çè„Å™„ÅÑ„ÄÅÊ¨°Âõû„ÅÆ„Éú„Çø„É≥„ÇØ„É™„ÉÉ„ÇØÊôÇ„Å´‰ΩøÁî®Ôºâ
                }
            }

            /**
             * „Éâ„É≠„ÉÉ„Éó„Çæ„Éº„É≥Ë®≠ÂÆöÔºà„Éó„É¨„Éì„É•„Éº„Ç®„É™„Ç¢„ÅßSpine„Ç≠„É£„É©„ÇØ„Çø„ÉºÂèó„ÅëÂÖ•„ÇåÔºâ
             */
            setupDropZone() {
                const previewContent = document.getElementById('preview-content');
                const spineContainer = document.getElementById('spine-character-container');
                
                if (!previewContent || !spineContainer) {
                    console.warn('‚ö†Ô∏è „Éâ„É≠„ÉÉ„Éó„Çæ„Éº„É≥Ë¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                    return;
                }
                
                // „Éâ„É©„ÉÉ„Ç∞„Ç™„Éº„Éê„ÉºÔºà„Éâ„É≠„ÉÉ„ÉóÂèØËÉΩÈ†òÂüü„ÅÆË¶ñË¶öÁöÑ„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØÔºâ
                previewContent.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'copy';
                    previewContent.classList.add('drag-over');
                });
                
                // „Éâ„É©„ÉÉ„Ç∞„É™„Éº„ÉñÔºà„Éâ„É≠„ÉÉ„ÉóÂèØËÉΩÈ†òÂüü„ÇíÈõ¢„Çå„ÅüÊôÇÔºâ
                previewContent.addEventListener('dragleave', (e) => {
                    // Â≠êË¶ÅÁ¥†„Å∏„ÅÆÁßªÂãï„ÅØÁÑ°Ë¶ñÔºà„Éê„Éñ„É™„É≥„Ç∞ÂØæÁ≠ñÔºâ
                    if (!previewContent.contains(e.relatedTarget)) {
                        previewContent.classList.remove('drag-over');
                    }
                });
                
                // „Éâ„É≠„ÉÉ„ÉóÔºàÂÆüÈöõ„Å´Spine„Ç≠„É£„É©„ÇØ„Çø„Éº„ÇíÈÖçÁΩÆÔºâ
                previewContent.addEventListener('drop', (e) => {
                    e.preventDefault();
                    previewContent.classList.remove('drag-over');
                    
                    try {
                        // „Éâ„É©„ÉÉ„Ç∞„Åï„Çå„Åü„Ç≠„É£„É©„ÇØ„Çø„Éº„Éá„Éº„Çø„ÇíÂèñÂæó
                        const characterDataStr = e.dataTransfer.getData('application/json');
                        if (!characterDataStr) {
                            console.warn('‚ö†Ô∏è „Éâ„É≠„ÉÉ„Éó„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                            return;
                        }
                        
                        const characterData = JSON.parse(characterDataStr);
                        console.log('üé≠ Dropped character:', characterData);
                        
                        // „Éâ„É≠„ÉÉ„Éó‰ΩçÁΩÆ„ÇíË®àÁÆóÔºà„Éó„É¨„Éì„É•„Éº„Ç®„É™„Ç¢ÂÜÖ„ÅÆÁõ∏ÂØæ‰ΩçÁΩÆÔºâ
                        const rect = previewContent.getBoundingClientRect();
                        const dropX = e.clientX - rect.left;
                        const dropY = e.clientY - rect.top;
                        
                        // Spine„Ç≠„É£„É©„ÇØ„Çø„Éº„Çí„Éó„É¨„Éì„É•„Éº„Å´ËøΩÂä†
                        this.addSpineCharacterToPreview(characterData, dropX, dropY);
                        
                    } catch (error) {
                        console.error('‚ùå „Éâ„É≠„ÉÉ„ÉóÂá¶ÁêÜ„Ç®„É©„Éº:', error);
                        this.updateStatus('error', `„Ç≠„É£„É©„ÇØ„Çø„ÉºËøΩÂä†Â§±Êïó: ${error.message}`);
                    }
                });
                
                console.log('‚úÖ „Éâ„É≠„ÉÉ„Éó„Çæ„Éº„É≥Ë®≠ÂÆöÂÆå‰∫Ü');
            }

            /**
             * „Éó„É¨„Éì„É•„Éº„Ç®„É™„Ç¢„Å´Spine„Ç≠„É£„É©„ÇØ„Çø„Éº„ÇíËøΩÂä†
             */
            async addSpineCharacterToPreview(characterData, x, y) {
                try {
                    this.updateStatus('loading', 'Spine„Ç≠„É£„É©„ÇØ„Çø„Éº„ÇíË™≠„ÅøËæº„Åø‰∏≠...');
                    
                    const spineContainer = document.getElementById('spine-character-container');
                    
                    // ‰∏ÄÊÑè„ÅÆID„ÇíÁîüÊàê
                    const characterId = `spine-character-${Date.now()}`;
                    
                    // Spine„Ç≠„É£„É©„ÇØ„Çø„ÉºË¶ÅÁ¥†„Çí‰ΩúÊàê
                    const characterElement = document.createElement('div');
                    characterElement.id = characterId;
                    characterElement.className = 'spine-character-element';
                    characterElement.style.cssText = `
                        position: absolute;
                        left: ${x}px;
                        top: ${y}px;
                        width: 200px;
                        height: 200px;
                        border: 2px dashed #007ACC;
                        background: rgba(0, 122, 204, 0.1);
                        border-radius: 8px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        cursor: move;
                        pointer-events: auto;
                        user-select: none;
                    `;
                    
                    // „Ç≠„É£„É©„ÇØ„Çø„ÉºÊÉÖÂ†±„ÇíË°®Á§∫
                    characterElement.innerHTML = `
                        <div style="text-align: center; color: #007ACC;">
                            <div style="font-size: 24px;">üé≠</div>
                            <div style="font-size: 14px; font-weight: bold;">${characterData.name}</div>
                            <div style="font-size: 12px; opacity: 0.7;">Spine Character</div>
                        </div>
                    `;
                    
                    // „Ç≠„É£„É©„ÇØ„Çø„ÉºË¶ÅÁ¥†„Å´„Éâ„É©„ÉÉ„Ç∞Ê©üËÉΩ„ÇíËøΩÂä†
                    this.setupCharacterDrag(characterElement, characterData);
                    
                    // „Ç≥„É≥„ÉÜ„Éä„Å´ËøΩÂä†
                    spineContainer.appendChild(characterElement);
                    
                    // „Ç≠„É£„É©„ÇØ„Çø„Éº„É™„Çπ„Éà„Å´ÁôªÈå≤
                    if (!this.spineCharacters) {
                        this.spineCharacters = [];
                    }
                    this.spineCharacters.push({
                        id: characterId,
                        element: characterElement,
                        data: characterData,
                        position: { x, y }
                    });
                    
                    this.updateStatus('ready', `„Ç≠„É£„É©„ÇØ„Çø„Éº„Äå${characterData.name}„Äç„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü`);
                    console.log(`‚úÖ Spine„Ç≠„É£„É©„ÇØ„Çø„Éº„Äå${characterData.name}„Äç„Çí„Éó„É¨„Éì„É•„Éº„Å´ËøΩÂä†ÂÆå‰∫Ü`);
                    
                } catch (error) {
                    console.error('‚ùå Spine„Ç≠„É£„É©„ÇØ„Çø„ÉºËøΩÂä†„Ç®„É©„Éº:', error);
                    this.updateStatus('error', `„Ç≠„É£„É©„ÇØ„Çø„ÉºËøΩÂä†Â§±Êïó: ${error.message}`);
                }
            }

            /**
             * „Ç≠„É£„É©„ÇØ„Çø„ÉºË¶ÅÁ¥†„ÅÆ„Éâ„É©„ÉÉ„Ç∞Ê©üËÉΩË®≠ÂÆöÔºà„Éó„É¨„Éì„É•„ÉºÂÜÖ„Åß„ÅÆÁßªÂãïÔºâ
             */
            setupCharacterDrag(element, characterData) {
                let isDragging = false;
                let dragStartX = 0;
                let dragStartY = 0;
                let elementStartX = 0;
                let elementStartY = 0;
                
                element.addEventListener('mousedown', (e) => {
                    isDragging = true;
                    dragStartX = e.clientX;
                    dragStartY = e.clientY;
                    elementStartX = parseInt(element.style.left) || 0;
                    elementStartY = parseInt(element.style.top) || 0;
                    
                    element.style.opacity = '0.8';
                    element.style.transform = 'scale(1.05)';
                    element.style.zIndex = '1000';
                    
                    e.preventDefault();
                    e.stopPropagation();
                });
                
                document.addEventListener('mousemove', (e) => {
                    if (!isDragging) return;
                    
                    const deltaX = e.clientX - dragStartX;
                    const deltaY = e.clientY - dragStartY;
                    
                    const newX = elementStartX + deltaX;
                    const newY = elementStartY + deltaY;
                    
                    element.style.left = `${newX}px`;
                    element.style.top = `${newY}px`;
                });
                
                document.addEventListener('mouseup', () => {
                    if (isDragging) {
                        isDragging = false;
                        element.style.opacity = '1';
                        element.style.transform = 'scale(1)';
                        element.style.zIndex = '';
                        
                        // ‰ΩçÁΩÆ„Çí‰øùÂ≠ò
                        const characterEntry = this.spineCharacters?.find(c => c.element === element);
                        if (characterEntry) {
                            characterEntry.position.x = parseInt(element.style.left) || 0;
                            characterEntry.position.y = parseInt(element.style.top) || 0;
                            console.log(`üìç „Ç≠„É£„É©„ÇØ„Çø„Éº„Äå${characterData.name}„Äç‰ΩçÁΩÆÊõ¥Êñ∞:`, characterEntry.position);
                        }
                    }
                });
            }

            bindEvents() {
                console.log('üîß Setting up event handlers...');
                console.log('üîß btnLoadSpineFolder element:', this.btnLoadSpineFolder);
                
                this.btnOpenFolder.addEventListener('click', () => this.openFolder());
                this.btnLoadSpineFolder.addEventListener('click', () => {
                    console.log('üé≠ Spine folder button clicked!');
                    this.loadSpineFolder();
                });
                this.btnExportPackage.addEventListener('click', () => this.exportPackage());
                this.btnPreviewPackage.addEventListener('click', () => this.previewPackage());
                this.btnAddSpine.addEventListener('click', () => this.addSpineCharacter());
                this.btnSavePosition.addEventListener('click', () => this.savePosition());
                
                this.spineXInput.addEventListener('change', (e) => {
                    this.spinePosition.x = parseInt(e.target.value) || 0;
                    this.updateSpinePosition();
                });
                
                this.spineYInput.addEventListener('change', (e) => {
                    this.spinePosition.y = parseInt(e.target.value) || 0;
                    this.updateSpinePosition();
                });
            }

            /**
             * Spine„Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñ
             */
            initializeSpineSystem() {
                try {
                    // SpineCoreÂàùÊúüÂåñ
                    const success = this.spineCore.initialize();
                    if (!success) {
                        console.error('‚ùå SpineCoreÂàùÊúüÂåñÂ§±Êïó');
                        return;
                    }
                    
                    // SpineRendererÂàùÊúüÂåñ
                    this.spineRenderer = new SpineRenderer(this.spineCore);
                    
                    // ‰øùÂ≠ò„Åï„Çå„Åü‰ΩçÁΩÆ„ÇíÂæ©ÂÖÉ
                    this.restorePosition();
                    
                    console.log('‚úÖ Spine SystemÂàùÊúüÂåñÂÆå‰∫Ü');
                    
                } catch (error) {
                    console.error('‚ùå Spine„Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñ„Ç®„É©„Éº:', error);
                }
            }

            updateStatus(status, message) {
                this.statusIndicator.className = `status-indicator status-${status}`;
                this.projectStatus.textContent = message;
            }

            async openFolder() {
                this.updateStatus('loading', '„Éï„Ç©„É´„ÉÄ„ÇíÈÅ∏Êäû‰∏≠...');
                
                // Ë©≥Á¥∞„Éá„Éê„ÉÉ„Ç∞: localStorageÁõ¥Êé•Á¢∫Ë™ç
                const directProject = localStorage.getItem('spine-editor-project-path');
                console.log('üîß localStorageÁõ¥Êé•Á¢∫Ë™ç project:', directProject);
                console.log('üîß this.savedPaths.project:', this.savedPaths.project);
                console.log('üîß ÂÄ§„ÅåÂêå„Åò„Åã:', directProject === this.savedPaths.project);
                
                try {
                    // ‰øùÂ≠ò„Åï„Çå„Åü„Éë„Çπ„ÇíÂàùÊúü„Éï„Ç©„É´„ÉÄ„Å®„Åó„Å¶‰ΩøÁî®ÔºàÊúâÂäπ„Å™Â†¥Âêà„ÅÆ„ÅøÔºâ
                    const initialPath = this.savedPaths.project || null;
                    console.log('üîß Project initial path:', initialPath);
                    console.log('üîß initialPath„Çø„Ç§„Éó:', typeof initialPath, 'Èï∑„Åï:', initialPath?.length);
                    const result = await window.projectLoader.selectFolder(initialPath);
                    if (result.success) {
                        this.currentProject = result.path;
                        
                        // „Éó„É≠„Ç∏„Çß„ÇØ„Éà„Éë„Çπ„Çí‰øùÂ≠ò
                        localStorage.setItem('spine-editor-project-path', result.path);
                        console.log('üíæ Project path saved:', result.path);
                        
                        // this.savedPaths„ÇÇÊõ¥Êñ∞
                        this.savedPaths.project = result.path;
                        console.log('üîÑ this.savedPaths.project updated:', this.savedPaths.project);
                        
                        // „Çµ„Éº„Éê„Éº„Å´„Éó„É≠„Ç∏„Çß„ÇØ„Éà„Éë„Çπ„ÇíË®≠ÂÆö
                        if (window.electronAPI && window.electronAPI.server) {
                            const serverResult = await window.electronAPI.server.setProjectPath(result.path);
                            console.log('üîß Server project path set:', serverResult);
                        }
                        
                        this.loadProjectFiles(result.files);
                        this.updateStatus('ready', `„Éó„É≠„Ç∏„Çß„ÇØ„ÉàË™≠„ÅøËæº„ÅøÂÆå‰∫Ü: ${result.files.length} „Éï„Ç°„Ç§„É´`);
                    } else if (result.canceled) {
                        this.updateStatus('ready', '„Éï„Ç©„É´„ÉÄÈÅ∏Êäû„Åå„Ç≠„É£„É≥„Çª„É´„Åï„Çå„Åæ„Åó„Åü');
                    } else {
                        this.updateStatus('error', '„Éï„Ç©„É´„ÉÄÈÅ∏Êäû„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                    }
                } catch (error) {
                    console.error('„Éï„Ç©„É´„ÉÄÈÅ∏Êäû„Ç®„É©„Éº:', error);
                    this.updateStatus('error', '„Éï„Ç©„É´„ÉÄÈÅ∏Êäû„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
            }

            async loadSpineFolder() {
                console.log('üé≠ loadSpineFolder() method called!');
                this.updateStatus('loading', 'Spine„Éï„Ç©„É´„ÉÄ„ÇíÈÅ∏Êäû‰∏≠...');
                
                // „Éá„Éê„ÉÉ„Ç∞: Èñ¢Êï∞Â≠òÂú®Á¢∫Ë™ç
                console.log('üîß window.projectLoader:', window.projectLoader);
                console.log('üîß selectSpineFolder exists:', typeof window.projectLoader?.selectSpineFolder);
                
                try {
                    // Èñ¢Êï∞Â≠òÂú®„ÉÅ„Çß„ÉÉ„ÇØ
                    if (!window.projectLoader || typeof window.projectLoader.selectSpineFolder !== 'function') {
                        console.error('‚ùå selectSpineFolder function not found, falling back to selectFolder');
                        // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ: ÂÖÉ„ÅÆÈñ¢Êï∞„Çí‰ΩøÁî®
                        const initialSpinePath = this.savedPaths.spine || null;
                        console.log('üîß Spine initial path (fallback):', initialSpinePath);
                        const result = await window.projectLoader.selectFolder(initialSpinePath);
                        
                        if (result.success && result.path) {
                            console.log('üé≠ Selected Spine folder (fallback):', result.path);
                            
                            // Spine„Éë„Çπ„Çí‰øùÂ≠ò
                            localStorage.setItem('spine-editor-spine-path', result.path);
                            console.log('üíæ Spine path saved:', result.path);
                            
                            // this.savedPaths„ÇÇÊõ¥Êñ∞Ôºà„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÂá¶ÁêÜÂÜÖÔºâ
                            this.savedPaths.spine = result.path;
                            console.log('üîÑ this.savedPaths.spine updated (fallback):', this.savedPaths.spine);
                            
                            // ‰ª•‰∏ã„ÅØÊó¢Â≠ò„Ç≥„Éº„Éâ„Å®Âêå„ÅòÂá¶ÁêÜ
                            console.log('üîß Starting Spine file detection...');
                            const spineFiles = await this.detectSpineFiles(result.path);
                            console.log('üîß Detection completed. Found files:', spineFiles);
                            
                            this.displaySpineCharacters(spineFiles);
                            console.log('üé≠ Detected Spine files:', spineFiles);
                            this.updateStatus('ready', `Spine„Ç≠„É£„É©„ÇØ„Çø„ÉºÊ§úÂá∫ÂÆå‰∫Ü: ${spineFiles.length} ÂÄã`);
                        } else if (result.canceled) {
                            this.updateStatus('ready', 'Spine„Éï„Ç©„É´„ÉÄÈÅ∏Êäû„Åå„Ç≠„É£„É≥„Çª„É´„Åï„Çå„Åæ„Åó„Åü');
                        } else {
                            this.updateStatus('error', 'Spine„Éï„Ç©„É´„ÉÄÈÅ∏Êäû„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                        }
                        return;
                    }
                    
                    // Ë©≥Á¥∞„Éá„Éê„ÉÉ„Ç∞: localStorageÁõ¥Êé•Á¢∫Ë™ç
                    const directSpine = localStorage.getItem('spine-editor-spine-path');
                    console.log('üîß localStorageÁõ¥Êé•Á¢∫Ë™ç spine:', directSpine);
                    console.log('üîß this.savedPaths.spine:', this.savedPaths.spine);
                    console.log('üîß ÂÄ§„ÅåÂêå„Åò„Åã:', directSpine === this.savedPaths.spine);
                    
                    // SpineÂ∞ÇÁî®„Éï„Ç©„É´„ÉÄÈÅ∏ÊäûÈñ¢Êï∞„Çí‰ΩøÁî®„Éª‰øùÂ≠ò„Åï„Çå„ÅüSpine„Éë„Çπ„ÇíÂàùÊúü„Éï„Ç©„É´„ÉÄ„Å®„Åó„Å¶‰ΩøÁî®ÔºàÊúâÂäπ„Å™Â†¥Âêà„ÅÆ„ÅøÔºâ
                    const initialSpinePath = this.savedPaths.spine || null;
                    console.log('üîß Spine initial path:', initialSpinePath);
                    console.log('üîß initialSpinePath„Çø„Ç§„Éó:', typeof initialSpinePath, 'Èï∑„Åï:', initialSpinePath?.length);
                    const result = await window.projectLoader.selectSpineFolder(initialSpinePath);
                    
                    if (result.success && result.path) {
                        console.log('üé≠ Selected Spine folder:', result.path);
                        
                        // Spine„Éë„Çπ„Çí‰øùÂ≠ò
                        localStorage.setItem('spine-editor-spine-path', result.path);
                        console.log('üíæ Spine path saved:', result.path);
                        
                        // this.savedPaths„ÇÇÊõ¥Êñ∞
                        this.savedPaths.spine = result.path;
                        console.log('üîÑ this.savedPaths.spine updated:', this.savedPaths.spine);
                        
                        console.log('üîß Starting Spine file detection...');
                        
                        // Spine„Éï„Ç°„Ç§„É´Ê§úÂá∫Âá¶ÁêÜÔºà‰æã: .json/.atlas/.pngÔºâ
                        const spineFiles = await this.detectSpineFiles(result.path);
                        console.log('üîß Detection completed. Found files:', spineFiles);
                        
                        if (spineFiles.length > 0) {
                            this.updateStatus('ready', `Spine„Éï„Ç°„Ç§„É´Ê§úÂá∫: ${spineFiles.length}ÂÄã„ÅÆ„Ç≠„É£„É©„ÇØ„Çø„Éº`);
                            console.log('üé≠ Detected Spine files:', spineFiles);
                            
                            // Â∑¶„Éë„Éç„É´„Å´Spine„Ç≠„É£„É©„ÇØ„Çø„Éº‰∏ÄË¶ßË°®Á§∫
                            this.displaySpineCharacters(spineFiles);
                        } else {
                            this.updateStatus('ready', 'Spine„Éï„Ç°„Ç§„É´„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü');
                            this.spineCharacterStatus.textContent = 'Spine„Éï„Ç°„Ç§„É´„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü';
                            this.spineCharacterList.style.display = 'none';
                        }
                    }
                } catch (error) {
                    console.error('üö® Spine„Éï„Ç©„É´„ÉÄÈÅ∏Êäû„Ç®„É©„Éº:', error);
                    this.updateStatus('error', 'Spine„Éï„Ç©„É´„ÉÄÈÅ∏Êäû„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
            }

            async detectSpineFiles(folderPath) {
                try {
                    console.log('üîç Scanning folder:', folderPath);
                    
                    // ElectronAPI„Åß„Éï„Ç©„É´„ÉÄÂÜÖ„ÅÆ„Éï„Ç°„Ç§„É´„Çí„Çπ„Ç≠„É£„É≥
                    const scanResult = await window.electronAPI.fs.scanDirectory(
                        folderPath, 
                        ['.json', '.atlas', '.png']
                    );
                    
                    console.log('üìã Scan result:', scanResult);
                    
                    if (!scanResult.success) {
                        console.warn('üö® Spine folder scan failed:', scanResult.error);
                        return [];
                    }
                    
                    // .json/.atlas/.png„ÅÆ„Çª„ÉÉ„Éà„ÇíÊ§úÂá∫
                    const jsonFiles = scanResult.files?.json || [];
                    const atlasFiles = scanResult.files?.atlas || [];
                    const pngFiles = scanResult.files?.png || [];
                    
                    console.log('üìÅ Found files:');
                    console.log('  JSON files:', jsonFiles);
                    console.log('  Atlas files:', atlasFiles);
                    console.log('  PNG files:', pngFiles);
                    
                    const spineCharacters = [];
                    
                    for (const jsonFile of jsonFiles) {
                        // „Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Éï„Ç©„É´„ÉÄ„ÇíÈô§Â§ñ
                        if (this.isBackupPath(jsonFile)) {
                            console.log('üö´ Skipping backup file:', jsonFile);
                            continue;
                        }
                        
                        const baseName = jsonFile.replace(/\.json$/, '').split('/').pop();
                        const atlasFile = atlasFiles.find(f => f.includes(baseName + '.atlas') && !this.isBackupPath(f));
                        const pngFile = pngFiles.find(f => f.includes(baseName + '.png') && !this.isBackupPath(f));
                        
                        if (atlasFile && pngFile) {
                            spineCharacters.push({
                                name: baseName,
                                jsonPath: jsonFile,
                                atlasPath: atlasFile,
                                texturePath: pngFile,
                                folderPath: this.getCharacterFolder(jsonFile)
                            });
                        }
                    }
                    
                    return spineCharacters;
                } catch (error) {
                    console.error('üö® Spine detection error:', error);
                    return [];
                }
            }

            // „Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Éë„ÇπÂà§ÂÆöÔºà„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Éï„Ç©„É´„ÉÄÈô§Â§ñÔºâ
            isBackupPath(filePath) {
                const backupKeywords = ['backup', 'bak', '„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó', 'archive', 'old'];
                const pathLower = filePath.toLowerCase();
                return backupKeywords.some(keyword => pathLower.includes(keyword));
            }

            // „Ç≠„É£„É©„ÇØ„Çø„Éº„Éï„Ç©„É´„ÉÄ„Éë„ÇπÂèñÂæó
            getCharacterFolder(jsonPath) {
                const parts = jsonPath.split('/');
                parts.pop(); // „Éï„Ç°„Ç§„É´Âêç„ÇíÈô§Âéª
                return parts.join('/');
            }

            /**
             * „Éà„Éº„Çπ„ÉàÈÄöÁü•Ë°®Á§∫ÔºàÂà•„Ç¶„Ç£„É≥„Éâ„Ç¶È¢®Ôºâ
             */
            showToastNotification(message) {
                // Êó¢Â≠ò„ÅÆ„Éà„Éº„Çπ„Éà„Åå„ÅÇ„Çå„Å∞ÂâäÈô§
                const existingToast = document.querySelector('.toast-notification');
                if (existingToast) {
                    existingToast.remove();
                }
                
                // „Éà„Éº„Çπ„ÉàË¶ÅÁ¥†„Çí‰ΩúÊàê
                const toast = document.createElement('div');
                toast.className = 'toast-notification';
                toast.textContent = message;
                
                // „Çπ„Çø„Ç§„É´Ë®≠ÂÆö
                toast.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #4CAF50;
                    color: white;
                    padding: 12px 20px;
                    border-radius: 8px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                    font-size: 14px;
                    font-weight: 500;
                    z-index: 10000;
                    opacity: 0;
                    transform: translateX(100px);
                    transition: all 0.3s ease;
                    max-width: 300px;
                    word-wrap: break-word;
                `;
                
                // „Éö„Éº„Ç∏„Å´ËøΩÂä†
                document.body.appendChild(toast);
                
                // „Éï„ÉØ„ÉÉ„Å®Áèæ„Çå„Çã„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
                setTimeout(() => {
                    toast.style.opacity = '1';
                    toast.style.transform = 'translateX(0)';
                }, 10);
                
                // 2ÁßíÂæå„Å´„Éï„Çß„Éº„Éâ„Ç¢„Ç¶„Éà„Åó„Å¶ÂâäÈô§
                setTimeout(() => {
                    toast.style.opacity = '0';
                    toast.style.transform = 'translateX(100px)';
                    
                    // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÂÆå‰∫ÜÂæå„Å´Ë¶ÅÁ¥†ÂâäÈô§
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.parentNode.removeChild(toast);
                        }
                    }, 300);
                }, 2000);
            }

            displaySpineCharacters(spineFiles) {
                console.log('üé≠ Displaying Spine characters:', spineFiles);
                
                // „Çπ„ÉÜ„Éº„Çø„ÇπË¶ÅÁ¥†„ÅØÈùûË°®Á§∫„Å´„Åô„ÇãÔºà‰ΩøÁî®„Åó„Å™„ÅÑÔºâ
                this.spineCharacterStatus.style.display = 'none';
                
                // Âà•„Ç¶„Ç£„É≥„Éâ„Ç¶È¢®„ÅÆ„Éà„Éº„Çπ„ÉàÈÄöÁü•„ÇíË°®Á§∫
                this.showToastNotification(`${spineFiles.length}ÂÄã„ÅÆ„Ç≠„É£„É©„ÇØ„Çø„Éº„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åó„Åü`);
                
                // „É™„Çπ„Éà„Çí„ÇØ„É™„Ç¢
                this.spineCharacterList.innerHTML = '';
                
                // ÂêÑ„Ç≠„É£„É©„ÇØ„Çø„Éº„Çí„É™„Çπ„Éà„Å´ËøΩÂä†
                spineFiles.forEach((character, index) => {
                    const item = document.createElement('div');
                    item.className = 'file-item spine-character-item';
                    item.draggable = true; // „Éâ„É©„ÉÉ„Ç∞ÂèØËÉΩ„Å´Ë®≠ÂÆö
                    item.dataset.characterId = character.name;
                    item.dataset.characterPath = character.jsonPath;
                    
                    item.innerHTML = `
                        <div class="character-icon">üé≠</div>
                        <div class="character-info">
                            <div class="character-name">${character.name}</div>
                            <div class="character-path">${character.folderPath.split('/').pop()}</div>
                        </div>
                    `;
                    
                    // „ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„ÉàÔºàË©≥Á¥∞Ë°®Á§∫Áî®Ôºâ
                    item.addEventListener('click', () => {
                        console.log('üé≠ Selected character:', character.name);
                        // TODO: „Ç≠„É£„É©„ÇØ„Çø„ÉºË©≥Á¥∞Ë°®Á§∫
                    });
                    
                    // „Éâ„É©„ÉÉ„Ç∞ÈñãÂßã„Ç§„Éô„É≥„ÉàÔºàÊ¨°„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„ÅßÂÆüË£ÖÔºâ
                    item.addEventListener('dragstart', (e) => {
                        console.log('üé≠ Drag started:', character.name);
                        e.dataTransfer.setData('application/json', JSON.stringify(character));
                        e.dataTransfer.effectAllowed = 'copy';
                        item.classList.add('dragging');
                    });
                    
                    // „Éâ„É©„ÉÉ„Ç∞ÁµÇ‰∫Ü„Ç§„Éô„É≥„Éà
                    item.addEventListener('dragend', (e) => {
                        item.classList.remove('dragging');
                    });
                    
                    this.spineCharacterList.appendChild(item);
                });
                
                // „É™„Çπ„Éà„ÇíË°®Á§∫
                this.spineCharacterList.style.display = 'block';
                
                console.log('‚úÖ Spine character list displayed');
            }

            loadProjectFiles(files) {
                console.log('üîß loadProjectFilesÂèó‰ø°:', files);
                console.log('üîß ÊúÄÂàù„ÅÆ„Éï„Ç°„Ç§„É´„Çµ„É≥„Éó„É´:', files[0]);
                
                // „Éï„Ç°„Ç§„É´ÂΩ¢Âºè„ÇíÂÆâÂÖ®„Å´„ÉÅ„Çß„ÉÉ„ÇØÔºà„Çà„ÇäÂØõÂÆπ„Å™Âà§ÂÆöÔºâ
                const safeFiles = files.filter(f => {
                    if (!f) {
                        console.log('üîß Null file detected');
                        return false;
                    }
                    
                    // name„Éó„É≠„Éë„ÉÜ„Ç£„Åæ„Åü„ÅØpath„Éó„É≠„Éë„ÉÜ„Ç£„ÇíÂèñÂæó
                    const name = f.name || f.path || f.toString();
                    
                    if (!name || typeof name !== 'string') {
                        console.log('üîß Invalid name for file:', f);
                        return false;
                    }
                    
                    const isHTML = name.toLowerCase().endsWith('.html') || name.toLowerCase().endsWith('.htm');
                    return isHTML;
                });
                
                console.log('üîß ÂÆâÂÖ®„Å™HTML„Éï„Ç°„Ç§„É´:', safeFiles.length, 'ÂÄã');
                
                if (safeFiles.length === 0) {
                    this.pageList.innerHTML = '<div class="loading">HTML„Éï„Ç°„Ç§„É´„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì</div>';
                    return;
                }
                
                // „Ç¢„Ç¶„Éà„É©„Ç§„Éä„ÉºÊñπÂºè„Åß„Éï„Ç°„Ç§„É´„ÇíÊï¥ÁêÜ„ÉªË°®Á§∫
                this.renderOutlinerView(safeFiles);
                
                // SpineÂà∂Âæ°„ÇíÊúâÂäπÂåñ
                this.btnAddSpine.disabled = false;
                this.btnExportPackage.disabled = false;
                this.btnPreviewPackage.disabled = false;
                
                console.log('üéØ „Éó„É≠„Ç∏„Çß„ÇØ„Éà„Éï„Ç°„Ç§„É´Ë™≠„ÅøËæº„ÅøÂÆå‰∫Ü:', safeFiles.length, 'ÂÄã');
            }
            
            /**
             * „Ç¢„Ç¶„Éà„É©„Ç§„Éä„ÉºÊñπÂºè„Åß„Éï„Ç°„Ç§„É´„ÇíÈöéÂ±§Ë°®Á§∫
             */
            renderOutlinerView(files) {
                console.log('üìÇ Creating outliner view for', files.length, 'files');
                
                // „Éï„Ç°„Ç§„É´„ÇíÈöéÂ±§Âà•„Å´ÂàÜÈ°û
                const hierarchy = this.organizeFilesHierarchy(files);
                
                // „Ç¢„Ç¶„Éà„É©„Ç§„Éä„ÉºUI„Çí‰ΩúÊàê
                this.pageList.innerHTML = '';
                
                // „É´„Éº„ÉàÁõ¥‰∏ã„Éï„Ç°„Ç§„É´ÔºàÂÑ™ÂÖàË°®Á§∫Ôºâ
                if (hierarchy.root.length > 0) {
                    const rootSection = this.createFileSection('üìÑ „É´„Éº„Éà„Éï„Ç°„Ç§„É´', hierarchy.root, true);
                    this.pageList.appendChild(rootSection);
                }
                
                // „Çµ„Éñ„Éï„Ç©„É´„ÉÄÔºàÊäò„Çä„Åü„Åü„ÅøË°®Á§∫Ôºâ
                Object.keys(hierarchy.folders).forEach(folderName => {
                    const folderFiles = hierarchy.folders[folderName];
                    const folderSection = this.createFileSection(`üìÅ ${folderName}`, folderFiles, false);
                    this.pageList.appendChild(folderSection);
                });
                
                console.log('üìÇ Outliner view created:', hierarchy);
            }
            
            /**
             * „Éï„Ç°„Ç§„É´„ÇíÈöéÂ±§Âà•„Å´Êï¥ÁêÜ
             */
            organizeFilesHierarchy(files) {
                const hierarchy = {
                    root: [],
                    folders: {}
                };
                
                files.forEach(file => {
                    const path = file.path || file.name || '';
                    const pathParts = path.split(/[\/\\]/);
                    
                    if (pathParts.length === 1) {
                        // „É´„Éº„ÉàÁõ¥‰∏ã„ÅÆ„Éï„Ç°„Ç§„É´
                        hierarchy.root.push(file);
                    } else {
                        // „Çµ„Éñ„Éï„Ç©„É´„ÉÄÂÜÖ„ÅÆ„Éï„Ç°„Ç§„É´
                        const topLevelFolder = pathParts[0];
                        if (!hierarchy.folders[topLevelFolder]) {
                            hierarchy.folders[topLevelFolder] = [];
                        }
                        hierarchy.folders[topLevelFolder].push(file);
                    }
                });
                
                return hierarchy;
            }
            
            /**
             * „Éï„Ç°„Ç§„É´„Çª„ÇØ„Ç∑„Éß„É≥‰ΩúÊàêÔºà„É´„Éº„ÉàÁî®„Éª„Éï„Ç©„É´„ÉÄÁî®Ôºâ
             */
            createFileSection(title, files, expanded = false) {
                const section = document.createElement('div');
                section.className = 'file-section';
                
                // „Çª„ÇØ„Ç∑„Éß„É≥„Éò„ÉÉ„ÉÄ„Éº
                const header = document.createElement('div');
                header.className = 'file-section-header';
                header.innerHTML = `
                    <span class="section-toggle ${expanded ? 'expanded' : 'collapsed'}">${expanded ? '‚ñº' : '‚ñ∂'}</span>
                    <span class="section-title">${title}</span>
                    <span class="section-count">(${files.length})</span>
                `;
                
                // „Çª„ÇØ„Ç∑„Éß„É≥ÂÜÖÂÆπ
                const content = document.createElement('div');
                content.className = `file-section-content ${expanded ? 'expanded' : 'collapsed'}`;
                
                // „Éï„Ç°„Ç§„É´„É™„Çπ„Éà‰ΩúÊàê
                files.forEach((file, index) => {
                    const item = document.createElement('div');
                    item.className = 'file-item';
                    item.textContent = file.name || file.path.split(/[\/\\]/).pop() || `File ${index + 1}`;
                    item.dataset.index = index;
                    
                    // „ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà
                    item.addEventListener('click', () => {
                        this.selectFileWithPreview(file, item);
                    });
                    
                    content.appendChild(item);
                });
                
                // „Éà„Ç∞„É´Ê©üËÉΩ
                header.addEventListener('click', () => {
                    const toggle = header.querySelector('.section-toggle');
                    const isExpanded = content.classList.contains('expanded');
                    
                    if (isExpanded) {
                        content.classList.remove('expanded');
                        content.classList.add('collapsed');
                        toggle.textContent = '‚ñ∂';
                        toggle.classList.remove('expanded');
                        toggle.classList.add('collapsed');
                    } else {
                        content.classList.remove('collapsed');
                        content.classList.add('expanded');
                        toggle.textContent = '‚ñº';
                        toggle.classList.remove('collapsed');
                        toggle.classList.add('expanded');
                    }
                });
                
                section.appendChild(header);
                section.appendChild(content);
                
                return section;
            }

            // Áµ±Âêà„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ: „Éï„Ç°„Ç§„É´‰∏ÄË¶ßË°®Á§∫ + HTML„Éó„É¨„Éì„É•„ÉºÊ©üËÉΩ
            renderFileListWithPreview(files) {
                console.log('üîß Direct rendering files:', files);
                this.pageList.innerHTML = '';
                
                files.forEach((file, index) => {
                    const item = document.createElement('div');
                    item.className = 'file-item';
                    item.textContent = file.name || file.path || `File ${index + 1}`;
                    item.dataset.index = index;
                    
                    item.addEventListener('click', () => {
                        this.selectFileWithPreview(file, item);
                    });
                    
                    this.pageList.appendChild(item);
                });
                
                // ÊúÄÂàù„ÅÆ„Éï„Ç°„Ç§„É´„ÇíËá™ÂãïÈÅ∏Êäû
                if (files.length > 0) {
                    const firstItem = this.pageList.firstChild;
                    this.selectFileWithPreview(files[0], firstItem);
                }
            }
            
            selectFileWithPreview(file, element) {
                // „Ç¢„Ç¶„Éà„É©„Ç§„Éä„ÉºÂÜÖ„ÅÆÂÖ®„Éï„Ç°„Ç§„É´„Ç¢„Ç§„ÉÜ„É†„Åã„ÇâÈÅ∏ÊäûÁä∂ÊÖã„ÇíÂâäÈô§
                this.pageList.querySelectorAll('.file-item').forEach(item => {
                    item.classList.remove('selected');
                });
                element.classList.add('selected');
                
                this.currentPage = file;
                console.log('üìã „Éï„Ç°„Ç§„É´ÈÅ∏Êäû:', file.name || file.path);
                
                // HTML„Éó„É¨„Éì„É•„ÉºË°®Á§∫
                this.loadHTMLPreview(file);
            }
            
            async loadHTMLPreview(file) {
                console.log('üñºÔ∏è „Éó„É¨„Éì„É•„ÉºË™≠„ÅøËæº„Åø:', file);
                this.updateStatus('loading', `„Éó„É¨„Éì„É•„ÉºË™≠„ÅøËæº„Åø‰∏≠: ${file.name || file.path}`);
                
                try {
                    const previewIframe = this.previewIframe;
                    const previewPlaceholder = this.previewPlaceholder;
                    
                    console.log('üîß „Éó„É¨„Éì„É•„ÉºÂá¶ÁêÜÈñãÂßã');
                    console.log('üîß file.fullPath:', file.fullPath);
                    console.log('üîß file.path:', file.path);
                    console.log('üîß file.name:', file.name);
                    console.log('üîß currentProject:', window.projectLoader.currentProject);
                    
                    // ÂÜÖËîµHTTP„Çµ„Éº„Éê„ÉºÁµåÁî±„Åß„ÅÆ„Éó„É¨„Éì„É•„ÉºÔºàSpine„Ç¢„Çª„ÉÉ„ÉàÂØæÂøúÔºâ
                    const currentPort = window.location.port || '8082';
                    const serverUrl = `http://localhost:${currentPort}`;
                    
                    // „Éó„É≠„Ç∏„Çß„ÇØ„Éà„Éï„Ç©„É´„ÉÄ„Åã„Çâ„ÅÆÁõ∏ÂØæ„Éë„Çπ„ÅßHTTP„Ç¢„ÇØ„Çª„ÇπÔºàWindowsÂå∫Âàá„ÇäÊñáÂ≠óÊ≠£Ë¶èÂåñÔºâ
                    if (file.path) {
                        const normalizedPath = file.path.replace(/\\/g, '/');  // WindowsÂå∫Âàá„ÇäÊñáÂ≠ó„ÇíÊ≠£Ë¶èÂåñ
                        const httpUrl = `${serverUrl}/${normalizedPath}`;
                        console.log('üîß Using HTTP server preview:', httpUrl);
                        console.log('üîß Path normalized:', file.path, '->', normalizedPath);
                        previewIframe.src = httpUrl;
                    } else if (file.name) {
                        const httpUrl = `${serverUrl}/${file.name}`;
                        console.log('üîß Using HTTP server preview (name):', httpUrl);
                        previewIframe.src = httpUrl;
                    } else {
                        throw new Error('File path not available');
                    }
                    
                    previewPlaceholder.style.display = 'none';
                    previewIframe.style.display = 'block';
                    
                    this.updateStatus('ready', `„Éó„É¨„Éì„É•„ÉºË°®Á§∫‰∏≠: ${file.name || file.path}`);
                } catch (error) {
                    console.error('üö® „Éó„É¨„Éì„É•„ÉºË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', error);
                    this.updateStatus('error', `„Éó„É¨„Éì„É•„Éº„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ${error.message}`);
                    
                    // „Ç®„É©„ÉºÊôÇ„ÅØ„Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄ„Éº„Å´Ë©≥Á¥∞Ë°®Á§∫
                    this.previewPlaceholder.innerHTML = `
                        <div style="color: #666; text-align: center; padding: 20px;">
                            <p>HTML„Éó„É¨„Éì„É•„Éº„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü</p>
                            <p style="font-size: 12px; color: #999;">„Éï„Ç°„Ç§„É´: ${file.name || file.path}</p>
                            <p style="font-size: 12px; color: #999;">„Ç®„É©„Éº: ${error.message}</p>
                        </div>
                    `;
                    this.previewPlaceholder.style.display = 'block';
                    this.previewIframe.style.display = 'none';
                }
            }

            addSpineCharacter() {
                this.updateStatus('loading', 'Spine„Ç≠„É£„É©„ÇØ„Çø„Éº„ÇíËøΩÂä†‰∏≠...');
                
                try {
                    // „Éó„É¨„Éì„É•„Éº„Ç®„É™„Ç¢„ÇíÂèñÂæó
                    const previewContent = document.querySelector('.preview-content');
                    if (!previewContent) {
                        throw new Error('„Éó„É¨„Éì„É•„Éº„Ç®„É™„Ç¢„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                    }
                    
                    // Êó¢Â≠ò„ÅÆ„Ç≠„É£„É©„ÇØ„Çø„Éº„Åå„ÅÇ„Çå„Å∞ÂâäÈô§
                    if (this.spineCharacter) {
                        this.spineRenderer.removeCharacter('dummy-character');
                        this.spineCharacter = null;
                    }
                    
                    // „ÉÄ„Éü„Éº„Ç≠„É£„É©„ÇØ„Çø„Éº„Éá„Éº„Çø
                    const characterData = {
                        name: 'Dummy Character',
                        type: 'demo',
                        version: 'v2.0'
                    };
                    
                    // Spine„Ç≠„É£„É©„ÇØ„Çø„Éº„ÇíÊèèÁîª
                    const success = this.spineRenderer.renderSpineCharacter(
                        'dummy-character',
                        characterData,
                        { x: this.spinePosition.x, y: this.spinePosition.y },
                        previewContent
                    );
                    
                    if (success) {
                        this.spineCharacter = 'dummy-character';
                        
                        // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÂàùÊúüÂåñ
                        this.spineRenderer.initializeAnimation('dummy-character', {
                            idle: 'taiki',
                            click: 'yarare'
                        });
                        
                        // „Éâ„É©„ÉÉ„Ç∞Ê©üËÉΩ„ÇíËøΩÂä†
                        this.setupSpineDragFunction();
                        
                        // UIÊõ¥Êñ∞
                        this.spineXInput.value = this.spinePosition.x;
                        this.spineYInput.value = this.spinePosition.y;
                        this.btnSavePosition.disabled = false;
                        
                        this.updateStatus('ready', 'Spine„Ç≠„É£„É©„ÇØ„Çø„ÉºËøΩÂä†ÂÆå‰∫Ü');
                        console.log('‚úÖ Spine„ÉÄ„Éü„Éº„Ç≠„É£„É©„ÇØ„Çø„ÉºËøΩÂä†ÂÆå‰∫Ü');
                        
                    } else {
                        throw new Error('Spine„Ç≠„É£„É©„ÇØ„Çø„Éº‰ΩúÊàêÂ§±Êïó');
                    }
                    
                } catch (error) {
                    console.error('‚ùå Spine„Ç≠„É£„É©„ÇØ„Çø„ÉºËøΩÂä†„Ç®„É©„Éº:', error);
                    this.updateStatus('error', `Spine„Ç≠„É£„É©„ÇØ„Çø„ÉºËøΩÂä†Â§±Êïó: ${error.message}`);
                }
            }

            /**
             * Spine„Éâ„É©„ÉÉ„Ç∞Ê©üËÉΩË®≠ÂÆö
             */
            setupSpineDragFunction() {
                const canvasElement = this.spineCore.canvasElements.get('spine-dummy-character');
                if (!canvasElement) {
                    console.warn('‚ö†Ô∏è Spine„Ç≠„É£„É≥„Éê„ÇπË¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                    return;
                }
                
                let isDragging = false;
                let dragStartX = 0;
                let dragStartY = 0;
                let elementStartX = 0;
                let elementStartY = 0;
                
                // „Éû„Ç¶„Çπ„ÉÄ„Ç¶„É≥Ôºà„Éâ„É©„ÉÉ„Ç∞ÈñãÂßãÔºâ
                canvasElement.addEventListener('mousedown', (e) => {
                    isDragging = true;
                    dragStartX = e.clientX;
                    dragStartY = e.clientY;
                    elementStartX = parseInt(canvasElement.style.left) || 0;
                    elementStartY = parseInt(canvasElement.style.top) || 0;
                    
                    canvasElement.style.cursor = 'grabbing';
                    e.preventDefault();
                });
                
                // „Éû„Ç¶„ÇπÁßªÂãïÔºà„Éâ„É©„ÉÉ„Ç∞‰∏≠Ôºâ
                document.addEventListener('mousemove', (e) => {
                    if (!isDragging) return;
                    
                    const deltaX = e.clientX - dragStartX;
                    const deltaY = e.clientY - dragStartY;
                    
                    const newX = elementStartX + deltaX;
                    const newY = elementStartY + deltaY;
                    
                    // Canvas„ÇíÁßªÂãï
                    canvasElement.style.left = newX + 'px';
                    canvasElement.style.top = newY + 'px';
                    
                    // ÂÜÖÈÉ®Â∫ßÊ®ô„ÇÇÊõ¥Êñ∞
                    this.spinePosition.x = newX;
                    this.spinePosition.y = newY;
                    
                    // UIÊõ¥Êñ∞
                    this.spineXInput.value = newX;
                    this.spineYInput.value = newY;
                });
                
                // „Éû„Ç¶„Çπ„Ç¢„ÉÉ„ÉóÔºà„Éâ„É©„ÉÉ„Ç∞ÁµÇ‰∫ÜÔºâ
                document.addEventListener('mouseup', (e) => {
                    if (isDragging) {
                        isDragging = false;
                        canvasElement.style.cursor = 'move';
                        
                        this.updateStatus('ready', `‰ΩçÁΩÆÊõ¥Êñ∞: (${this.spinePosition.x}, ${this.spinePosition.y})`);
                        console.log('üéØ „Éâ„É©„ÉÉ„Ç∞ÂÆå‰∫Ü:', this.spinePosition);
                    }
                });
                
                console.log('‚úÖ Spine„Éâ„É©„ÉÉ„Ç∞Ê©üËÉΩË®≠ÂÆöÂÆå‰∫Ü');
            }
            
            /**
             * Spine‰ΩçÁΩÆÊõ¥Êñ∞ÔºàÊï∞ÂÄ§ÂÖ•Âäõ„Åã„ÇâÔºâ
             */
            updateSpinePosition() {
                if (!this.spineCharacter) return;
                
                const canvasElement = this.spineCore.canvasElements.get('spine-dummy-character');
                if (canvasElement) {
                    canvasElement.style.left = this.spinePosition.x + 'px';
                    canvasElement.style.top = this.spinePosition.y + 'px';
                    
                    this.updateStatus('ready', `‰ΩçÁΩÆÊõ¥Êñ∞: (${this.spinePosition.x}, ${this.spinePosition.y})`);
                    console.log('üìç ‰ΩçÁΩÆÊï∞ÂÄ§Êõ¥Êñ∞:', this.spinePosition);
                }
            }

            savePosition() {
                if (!this.spineCharacter) {
                    this.updateStatus('error', 'Spine„Ç≠„É£„É©„ÇØ„Çø„Éº„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
                    return;
                }
                
                // localStorage‰øùÂ≠ò
                const positionData = {
                    characterId: this.spineCharacter,
                    position: this.spinePosition,
                    timestamp: Date.now()
                };
                
                try {
                    localStorage.setItem('spine-desktop-position', JSON.stringify(positionData));
                    console.log('üíæ ‰ΩçÁΩÆ‰øùÂ≠òÂÆå‰∫Ü:', positionData);
                    this.updateStatus('ready', `‰ΩçÁΩÆ‰øùÂ≠òÂÆå‰∫Ü: (${this.spinePosition.x}, ${this.spinePosition.y})`);
                } catch (error) {
                    console.error('‚ùå ‰ΩçÁΩÆ‰øùÂ≠ò„Ç®„É©„Éº:', error);
                    this.updateStatus('error', '‰ΩçÁΩÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
            }
            
            /**
             * ‰øùÂ≠ò„Åï„Çå„Åü‰ΩçÁΩÆ„ÇíÂæ©ÂÖÉ
             */
            restorePosition() {
                try {
                    const saved = localStorage.getItem('spine-desktop-position');
                    if (!saved) return false;
                    
                    const positionData = JSON.parse(saved);
                    this.spinePosition = positionData.position;
                    
                    // UIÊõ¥Êñ∞
                    this.spineXInput.value = this.spinePosition.x;
                    this.spineYInput.value = this.spinePosition.y;
                    
                    console.log('üìç ‰ΩçÁΩÆÂæ©ÂÖÉ:', this.spinePosition);
                    return true;
                    
                } catch (error) {
                    console.error('‚ùå ‰ΩçÁΩÆÂæ©ÂÖÉ„Ç®„É©„Éº:', error);
                    return false;
                }
            }

            async exportPackage() {
                this.updateStatus('loading', '„Éë„ÉÉ„Ç±„Éº„Ç∏„ÇíÂá∫Âäõ‰∏≠...');
                
                try {
                    // Âá∫Âäõ„Éë„Çπ„ÇíÈÅ∏Êäû
                    const saveResult = await window.electronAPI.saveFileDialog({
                        title: '„Éë„ÉÉ„Ç±„Éº„Ç∏„Çí‰øùÂ≠ò',
                        defaultPath: `spine-package-${Date.now()}.zip`,
                        filters: [
                            { name: 'ZIP Files', extensions: ['zip'] }
                        ]
                    });
                    
                    if (saveResult.canceled) {
                        this.updateStatus('ready', '„Éë„ÉÉ„Ç±„Éº„Ç∏Âá∫Âäõ„Åå„Ç≠„É£„É≥„Çª„É´„Åï„Çå„Åæ„Åó„Åü');
                        return;
                    }
                    
                    const outputPath = saveResult.filePath;
                    console.log('üì¶ Âá∫Âäõ„Éë„Çπ:', outputPath);
                    
                    // ÊúÄÂ∞è„Éë„ÉÉ„Ç±„Éº„Ç∏‰ΩúÊàê
                    const success = await this.createMinimalPackage(outputPath);
                    
                    if (success) {
                        this.updateStatus('ready', `„Éë„ÉÉ„Ç±„Éº„Ç∏Âá∫ÂäõÂÆå‰∫Ü: ${outputPath}`);
                    } else {
                        this.updateStatus('error', '„Éë„ÉÉ„Ç±„Éº„Ç∏Âá∫Âäõ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                    }
                    
                } catch (error) {
                    console.error('‚ùå „Éë„ÉÉ„Ç±„Éº„Ç∏Âá∫Âäõ„Ç®„É©„Éº:', error);
                    this.updateStatus('error', `„Éë„ÉÉ„Ç±„Éº„Ç∏Âá∫Âäõ„Ç®„É©„Éº: ${error.message}`);
                }
            }
            
            /**
             * ÊúÄÂ∞è„Éë„ÉÉ„Ç±„Éº„Ç∏‰ΩúÊàêÔºàPhase 0.2Áî®Ôºâ
             */
            async createMinimalPackage(outputPath) {
                console.log('üì¶ Creating minimal package...');
                
                try {
                    // „Éë„ÉÉ„Ç±„Éº„Ç∏Áî®HTML„Çí‰ΩúÊàê
                    const packageHTML = this.createPackageHTML();
                    
                    // „Éë„ÉÉ„Ç±„Éº„Ç∏Áî®CSS„Çí‰ΩúÊàê
                    const packageCSS = this.createPackageCSS();
                    
                    // JSZip „ÇíÂãïÁöÑË™≠„ÅøËæº„Åø
                    await this.loadJSZip();
                    
                    const zip = new JSZip();
                    
                    // „Éï„Ç°„Ç§„É´„ÇíZIP„Å´ËøΩÂä†
                    zip.file('index.html', packageHTML);
                    zip.file('styles.css', packageCSS);
                    zip.file('README.md', this.createPackageReadme());
                    
                    // ZIPÁîüÊàê
                    const content = await zip.generateAsync({ type: 'blob' });
                    
                    // „Éï„Ç°„Ç§„É´Êõ∏„ÅçËæº„Åø
                    const buffer = await content.arrayBuffer();
                    const uint8Array = new Uint8Array(buffer);
                    
                    const writeResult = await window.electronAPI.fs.writeFile(
                        outputPath, 
                        uint8Array
                    );
                    
                    if (writeResult.success) {
                        console.log('‚úÖ Package created successfully');
                        return true;
                    } else {
                        console.error('‚ùå File write failed:', writeResult.error);
                        return false;
                    }
                    
                } catch (error) {
                    console.error('‚ùå Package creation failed:', error);
                    return false;
                }
            }
            
            /**
             * JSZipÂãïÁöÑË™≠„ÅøËæº„Åø
             */
            async loadJSZip() {
                if (window.JSZip) return;
                
                return new Promise((resolve, reject) => {
                    const script = document.createElement('script');
                    script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js';
                    script.onload = () => {
                        console.log('üìú JSZip loaded');
                        resolve();
                    };
                    script.onerror = () => reject(new Error('JSZipË™≠„ÅøËæº„ÅøÂ§±Êïó'));
                    document.head.appendChild(script);
                });
            }
            
            /**
             * „Éë„ÉÉ„Ç±„Éº„Ç∏Áî®HTML‰ΩúÊàê
             */
            createPackageHTML() {
                return `<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spine Character Demo</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Spine Character Demo</h1>
        <div class="spine-area">
            <div id="spine-character" class="spine-placeholder">
                <div class="spine-icon">üé≠</div>
                <p>Spine Character</p>
                <p class="position">Position: (${this.spinePosition.x}, ${this.spinePosition.y})</p>
            </div>
        </div>
        <div class="info">
            <p>Generated by Spine Editor Desktop v2.0</p>
            <p>Character positioned at: X=${this.spinePosition.x}, Y=${this.spinePosition.y}</p>
        </div>
    </div>
</body>
</html>`;
            }
            
            /**
             * „Éë„ÉÉ„Ç±„Éº„Ç∏Áî®CSS‰ΩúÊàê
             */
            createPackageCSS() {
                return `/* Spine Editor Desktop v2.0 - Package CSS */

body {
    margin: 0;
    padding: 20px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background-color: #f5f5f5;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    padding: 30px;
}

h1 {
    text-align: center;
    color: #333;
    margin-bottom: 30px;
}

.spine-area {
    position: relative;
    width: 100%;
    height: 600px;
    background: linear-gradient(45deg, #f9f9f9 0%, #e8e8e8 100%);
    border: 2px solid #ddd;
    border-radius: 8px;
    overflow: hidden;
}

.spine-placeholder {
    position: absolute;
    left: ${this.spinePosition.x}px;
    top: ${this.spinePosition.y}px;
    width: 120px;
    height: 150px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 50%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: white;
    text-align: center;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    transform: translate(-50%, -50%);
    transition: all 0.3s ease;
}

.spine-placeholder:hover {
    transform: translate(-50%, -50%) scale(1.05);
}

.spine-icon {
    font-size: 48px;
    margin-bottom: 10px;
}

.spine-placeholder p {
    margin: 5px 0;
    font-size: 14px;
    font-weight: 500;
}

.position {
    font-size: 12px;
    opacity: 0.8;
}

.info {
    margin-top: 30px;
    padding: 20px;
    background-color: #f8f9fa;
    border-radius: 8px;
    text-align: center;
}

.info p {
    margin: 5px 0;
    color: #666;
    font-size: 14px;
}

@media (max-width: 768px) {
    .container {
        margin: 10px;
        padding: 20px;
    }
    
    .spine-area {
        height: 400px;
    }
    
    .spine-placeholder {
        width: 80px;
        height: 100px;
    }
    
    .spine-icon {
        font-size: 32px;
    }
}`;
            }
            
            /**
             * „Éë„ÉÉ„Ç±„Éº„Ç∏Áî®README‰ΩúÊàê
             */
            createPackageReadme() {
                return `# Spine Character Package

Generated by Spine Editor Desktop v2.0  
Created: ${new Date().toLocaleDateString()}

## Quick Start

1. Extract all files to your web server directory
2. Open \`index.html\` in a web browser
3. View your positioned Spine character

## Files

- \`index.html\` - Main HTML file
- \`styles.css\` - Character positioning styles  
- \`README.md\` - This documentation

## Character Position

- X: ${this.spinePosition.x}px
- Y: ${this.spinePosition.y}px

## Notes

This is a Phase 0.2 minimal package for demonstration purposes.
Future versions will include actual Spine WebGL rendering.

---
Created with Spine Editor Desktop v2.0`;
            }
            
            /**
             * „Éë„ÉÉ„Ç±„Éº„Ç∏„Éó„É¨„Éì„É•„ÉºÊ©üËÉΩ
             */
            async previewPackage() {
                this.updateStatus('loading', '„Éó„É¨„Éì„É•„Éº„ÇíÊ∫ñÂÇô‰∏≠...');
                
                try {
                    // ‰∏ÄÊôÇÁöÑ„Å™HTML„Çí‰ΩúÊàê„Åó„Å¶„Éó„É¨„Éì„É•„ÉºË°®Á§∫
                    const previewHTML = this.createPackageHTML();
                    const previewCSS = this.createPackageCSS();
                    
                    // „Éó„É¨„Éì„É•„ÉºHTML„Å´ CSS „ÇíÂüã„ÇÅËæº„Åø
                    const fullPreviewHTML = previewHTML.replace(
                        '<link rel="stylesheet" href="styles.css">',
                        `<style>${previewCSS}</style>`
                    );
                    
                    // Blob URL „Çí‰ΩúÊàê
                    const blob = new Blob([fullPreviewHTML], { type: 'text/html' });
                    const url = URL.createObjectURL(blob);
                    
                    // Electron APIÁµåÁî±„ÅßÊñ∞„Åó„ÅÑ„Ç¶„Ç£„É≥„Éâ„Ç¶„ÇíÈñã„Åè
                    if (window.electronAPI && window.electronAPI.openURL) {
                        await window.electronAPI.openURL(url);
                        this.updateStatus('ready', '„Éó„É¨„Éì„É•„Éº„Ç¶„Ç£„É≥„Éâ„Ç¶„ÇíÈñã„Åç„Åæ„Åó„Åü');
                    } else {
                        // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ: iframe „Åß„Éó„É¨„Éì„É•„Éº
                        this.showInlinePreview(fullPreviewHTML);
                        this.updateStatus('ready', '„Ç§„É≥„É©„Ç§„É≥„Éó„É¨„Éì„É•„Éº„ÇíË°®Á§∫„Åó„Åæ„Åó„Åü');
                    }
                    
                    // „É°„É¢„É™„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
                    setTimeout(() => URL.revokeObjectURL(url), 30000);
                    
                } catch (error) {
                    console.error('‚ùå „Éó„É¨„Éì„É•„Éº„Ç®„É©„Éº:', error);
                    this.updateStatus('error', `„Éó„É¨„Éì„É•„ÉºÂ§±Êïó: ${error.message}`);
                }
            }
            
            /**
             * „Ç§„É≥„É©„Ç§„É≥„Éó„É¨„Éì„É•„ÉºË°®Á§∫Ôºà„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÔºâ
             */
            showInlinePreview(html) {
                const blob = new Blob([html], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                
                // „Éó„É¨„Éì„É•„Éº„Ç®„É™„Ç¢„Å´Ë°®Á§∫
                this.previewIframe.src = url;
                this.previewPlaceholder.style.display = 'none';
                this.previewIframe.style.display = 'block';
                
                // „É°„É¢„É™„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
                setTimeout(() => URL.revokeObjectURL(url), 30000);
            }

            // „É¢„ÉÉ„ÇØ„Éá„Éº„ÇøÂá¶ÁêÜ„ÅØ demo-modules.js „Å´ÁßªË≠≤
        }

        // „Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥Ëµ∑Âãï
        document.addEventListener('DOMContentLoaded', () => {
            window.demoApp = new DemoApp();
            console.log('üéØ Demo App initialized');
        });
    </script>
</body>
</html>