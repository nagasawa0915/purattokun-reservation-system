# 📋 完全移植専門エージェント - 詳細作業手順書

## 🎯 手順書の目的
完全移植専門エージェントの実際の作業手順を、ステップバイステップで厳密に定義。AIによる移植作業でのミス・漏れ・勝手な改善を完全に防止する。

---

## 🚨 事前確認チェックリスト（必須）

### ✅ 移植要求の解析
```markdown
□ ソースファイルパス確認済み
□ ターゲットファイルパス確認済み
□ 移植行範囲の指定確認済み（例: 50-120行目）
□ 移植方式の確認済み（上書き・挿入・追記）
□ バックアップの必要性確認済み
```

### 🚫 禁止事項の確認（声に出して確認）
```markdown
❌ 「改善しよう」「最適化しよう」思考の完全停止
❌ 「エラーを修正しよう」先回り思考の完全停止
❌ 「コメントを追加しよう」思考の完全停止
❌ 「インデントを整理しよう」思考の完全停止
❌ 「Electron用に最適化」思考の完全停止
```

---

## 📊 Phase 1: 移植準備フェーズ（詳細手順）

### 🔍 Step 1.1: ソースファイル解析

#### 実行コマンド
```bash
# 1. ソースファイルの存在確認・読み込み
Read ツール: /path/to/source.js

# 2. 指定行範囲の確認（例: 50-120行目）
Read ツール: /path/to/source.js (offset: 49, limit: 71)
```

#### 必須確認項目
```markdown
□ ファイル読み込み成功確認
□ 指定行範囲の存在確認（開始行 ≤ 終了行）
□ 移植対象内容の抽出成功
□ 文字エンコーディングの確認
□ 改行コード（LF/CRLF）の確認
```

#### 抽出内容の記録
```markdown
📊 ソース解析結果:
├─ ファイル: [ソースファイルパス]
├─ 移植範囲: [開始行]-[終了行] ([X]行)
├─ 文字数: [Y]文字
├─ 改行数: [Z]個
└─ 特殊文字: [タブ・全角スペース等の有無]
```

### 🎯 Step 1.2: 移植内容の一時保存

#### 抽出内容の厳密保存
```markdown
## 移植対象コード（完全保存）
```
[ここに抽出したコードを完全に貼り付け]
```

**文字数確認**: [X]文字
**行数確認**: [Y]行
**改行コード**: [LF/CRLF]
```

#### 依存関係の初期分析（修正なし・報告のみ）
```bash
# 変数・関数参照の検索
Grep ツール: "変数名|関数名" pattern: "\b(変数名|関数名)\b"
```

### 🔧 Step 1.3: ターゲットファイル状態確認

#### 実行コマンド
```bash
# ターゲットファイルの読み込み
Read ツール: /path/to/target.js

# 移植予定位置の確認（該当する場合）
Read ツール: /path/to/target.js (offset: [予定位置], limit: 10)
```

#### 必須確認項目
```markdown
□ ターゲットファイル存在確認
□ ファイル書き込み権限確認
□ 移植予定位置の既存内容確認
□ バックアップ必要性の判定
□ 移植方式の最終確認（上書き・挿入・追記）
```

#### バックアップ作成（必要時）
```markdown
📋 移植前状態の記録:
ターゲットファイル: [ファイルパス]
現在のファイルサイズ: [X]文字
移植予定位置: [行番号または末尾]
既存内容への影響: [あり/なし]
```

---

## 🔵 Phase 2: 完全移植実行フェーズ（詳細手順）

### ⚡ Step 2.1: 移植実行直前の最終確認

#### 再確認チェックリスト
```markdown
□ Phase 1 で抽出した内容の再確認
□ 移植先位置の最終確認
□ Edit コマンドの実行準備完了
□ 「改善しない」「変更しない」意識の確認
□ 1回限りの実行であることの確認
```

#### 移植内容の最終検証
```markdown
移植実行内容の確認:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
[Phase 1で抽出した内容をここに再表示]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
↑この内容を1文字も変更せずに移植実行
```

### 🎯 Step 2.2: Edit コマンド実行

#### 実行コマンド例
```markdown
移植方式別のコマンド:

【パターンA: ファイル末尾追加】
Edit ツール:
file_path: /path/to/target.js
old_string: [ファイル末尾の既存内容]
new_string: [既存内容 + 抽出したコード]

【パターンB: 指定位置挿入】
Edit ツール:
file_path: /path/to/target.js  
old_string: [挿入位置の既存行]
new_string: [既存行 + 抽出したコード]

【パターンC: 範囲上書き】
Edit ツール:
file_path: /path/to/target.js
old_string: [既存の対象範囲]
new_string: [抽出したコード]
```

### ⚡ Step 2.3: 移植直後の即座検証

#### 即座実行項目（Edit直後）
```bash
# 1. 移植直後の即座読み込み
Read ツール: /path/to/target.js

# 2. 移植範囲の抽出・確認
Read ツール: /path/to/target.js (移植された範囲を指定)
```

#### 即座検証項目
```markdown
□ 移植範囲の存在確認
□ 文字数の一致確認（ソース vs 移植後）
□ 行数の一致確認
□ 改行コードの保持確認
□ インデント・空白の保持確認
```

#### 差分検出時の緊急対応
```markdown
🚨 差分検出時の自動実行項目:

1. 移植作業の即座停止
2. 差分詳細の記録:
   ├─ 差分位置: 行[X], 文字[Y]
   ├─ 期待値: [ソース内容]
   ├─ 実際値: [移植後内容]
   └─ 差分原因: [推定原因]

3. ロールバック実行（必要時）
4. エラー報告・再実行手順提示
```

---

## 🟡 Phase 3: 完全性確認フェーズ（詳細手順）

### 🔍 Step 3.1: 総合比較検証

#### ソース vs ターゲット完全比較
```markdown
実行手順:
1. ソースから移植対象範囲を再抽出
2. ターゲットから移植済み範囲を抽出  
3. 両内容の文字単位完全比較実行
4. 差分有無の判定・記録
```

#### 比較検証項目
```markdown
□ 文字数完全一致確認（[X]文字 = [X]文字）
□ 行数完全一致確認（[Y]行 = [Y]行）
□ 改行位置完全一致確認
□ インデント構造完全一致確認
□ 特殊文字完全一致確認（タブ・全角スペース等）
□ 文字単位での1文字ずつ比較完了
```

#### 検証結果の記録
```markdown
📊 完全性検証結果:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
ソース抽出内容:
[ソースから再抽出した内容]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
移植済み内容:
[ターゲットから抽出した内容]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 完全一致確認: [OK/NG]
🎯 差分検出: [なし/あり]
```

### 📋 Step 3.2: 移植境界・影響範囲確認

#### 移植範囲外への影響確認
```bash
# 移植範囲前後の内容確認
Read ツール: /path/to/target.js (移植範囲前後10行程度)
```

#### 確認項目
```markdown
□ 移植範囲前の内容変更なし確認
□ 移植範囲後の内容変更なし確認  
□ ファイル全体の構造保持確認
□ 構文エラーの有無確認（該当する場合）
□ 意図しない変更の検出・報告
```

### 🎯 Step 3.3: 依存関係分析（報告のみ）

#### 外部依存の検索・報告
```bash
# 移植コード内の変数・関数参照検索
Grep ツール: 移植コード内で使用される変数・関数の検索

# 外部モジュール・ライブラリ参照検索
Grep ツール: import/require文の検索
```

#### 分析結果の報告
```markdown
📋 依存関係分析結果:
├─ 未定義変数: [変数名一覧]
├─ 未定義関数: [関数名一覧]
├─ 外部モジュール参照: [モジュール名一覧]
├─ グローバル変数参照: [変数名一覧]
└─ DOM API使用: [API名一覧]

⚠️ 注意: これらは報告のみで、修正は行いません
💡 推奨: 別途依存関係解決作業が必要です
```

---

## 📋 完了報告フォーマット

### 🎯 標準完了報告
```markdown
# 🔄 完全移植作業完了報告

## 📊 移植作業サマリー
- **ソースファイル**: [ファイルパス]  
- **ターゲットファイル**: [ファイルパス]
- **移植範囲**: [開始行]-[終了行] ([X]行, [Y]文字)
- **移植方式**: [上書き/挿入/追記]
- **実行時刻**: [YYYY-MM-DD HH:MM:SS]

## ✅ Phase別完了状況
### Phase 1: 移植準備フェーズ ✅完了
- ソースファイル解析: 完了
- 移植内容抽出・保存: 完了  
- ターゲットファイル状態確認: 完了
- バックアップ作成: [実施/不要]

### Phase 2: 完全移植実行フェーズ ✅完了  
- 移植実行直前確認: 完了
- Edit コマンド実行: 完了（1回のみ）
- 即座検証: 完了
- 差分検出: [なし/検出済み対応完了]

### Phase 3: 完全性確認フェーズ ✅完了
- 総合比較検証: 完了
- 移植境界確認: 完了
- 依存関係分析: 完了
- 完了報告作成: 完了

## 🎯 検証結果
### 完全一致確認
- **文字数**: ✅ [X]文字 = [X]文字
- **行数**: ✅ [Y]行 = [Y]行  
- **改行・インデント**: ✅ 完全保持
- **特殊文字**: ✅ 完全保持
- **総合判定**: ✅ **100%完全一致**

### 影響範囲確認  
- **移植範囲外への影響**: ❌ なし
- **ファイル構造**: ✅ 保持
- **構文整合性**: ✅ 確認済み

## 📋 依存関係分析結果（参考情報）
[Step 3.3 の分析結果をここに転記]

## 🚨 重要確認事項
- ✅ **改善・最適化の不実施**: 1文字も変更していません
- ✅ **完全コピー実行**: オリジナルと100%一致確認済み
- ✅ **移植境界の正確性**: 指定範囲のみ正確に移植済み  
- ✅ **3段階検証完了**: すべての検証工程を完了済み

## 📁 関連ファイル
- ソースファイル: `/mnt/d/.../[ソースファイル]`
- ターゲットファイル: `/mnt/d/.../[ターゲットファイル]`

---
**🎯 移植作業完了: オリジナルコードの完全移植が成功しました**
```

---

## 🚨 エラー時対応手順

### ❌ Phase 1 エラー時
```markdown
エラーパターン別対応:

【ソースファイル読み込みエラー】
1. ファイルパスの再確認・修正
2. ファイル存在確認・権限確認
3. エラー詳細をユーザーに報告
4. 修正後にPhase 1から再実行

【指定行範囲エラー】  
1. 行番号の有効性再確認
2. ファイル総行数との照合確認
3. 修正された範囲でPhase 1から再実行
```

### ❌ Phase 2 エラー時
```markdown
【Edit実行エラー】
1. Edit コマンドの即座停止
2. ターゲットファイルの状態確認
3. 必要に応じてロールバック実行
4. エラー原因の詳細分析・報告
5. 修正後にPhase 2から再実行

【差分検出エラー】
1. 移植作業の即座停止
2. 差分箇所の詳細記録・報告
3. ロールバック実行
4. 原因分析・解決策提示
5. Phase 2から再実行
```

### ❌ Phase 3 エラー時  
```markdown
【完全性検証エラー】
1. 検証作業の詳細記録
2. 不一致箇所の特定・報告
3. 移植作業の失敗宣言
4. ロールバック・再実行手順提示

【依存関係分析エラー】
1. 分析可能範囲での報告継続
2. エラー箇所の記録・報告
3. 移植作業完了判定は実施
4. 依存関係は別途対応として報告
```

---

## 🔧 品質保証チェックポイント

### ⚡ 各Phase共通チェック
```markdown
□ 「改善しよう」思考の検出・停止
□ 「最適化しよう」思考の検出・停止
□ 独自判断による変更の検出・停止
□ 指定範囲外への作業拡大の検出・停止
□ 複数回編集の検出・停止
```

### 📊 最終品質確認
```markdown
□ 100%完全一致の確認
□ 移植範囲の正確性確認
□ 改善・変更の不実施確認  
□ 3段階検証の完了確認
□ 完了報告の作成・提出確認
```

---

**🎯 この詳細手順書により、AIによる移植作業での「改善したがり」問題を完全に防止し、1文字も変更しない完全移植を実現します。**