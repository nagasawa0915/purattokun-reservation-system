<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§ª SpineåŸºæœ¬èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ - ã·ã‚‰ã£ã¨ãã‚“</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }
        
        .title {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 24px;
            font-weight: bold;
        }
        
        .control-panel {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .control-button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            min-width: 120px;
        }
        
        .primary-button {
            background: linear-gradient(45deg, #FF6B6B, #FF8E53);
            color: white;
        }
        
        .primary-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255,107,107,0.4);
        }
        
        .secondary-button {
            background: linear-gradient(45deg, #4ECDC4, #44A08D);
            color: white;
        }
        
        .secondary-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(78,205,196,0.4);
        }
        
        .spine-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 400px;
            background: #f8f9fa;
            border-radius: 12px;
            margin-bottom: 20px;
            position: relative;
        }
        
        #spine-canvas {
            border: 2px solid #ddd;
            border-radius: 8px;
            background: transparent;
        }
        
        .log-container {
            background: #1e1e1e;
            color: #00ff88;
            font-family: 'Courier New', monospace;
            padding: 20px;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
            font-size: 12px;
            line-height: 1.4;
        }
        
        .info-panel {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .info-panel h3 {
            margin: 0 0 10px 0;
            color: #1976d2;
        }
        
        .info-panel ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .info-panel li {
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="title">
            ğŸ§ª SpineåŸºæœ¬èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ - ã·ã‚‰ã£ã¨ãã‚“
        </div>
        
        <div class="info-panel">
            <h3>ğŸ¯ ãƒ†ã‚¹ãƒˆå†…å®¹</h3>
            <ul>
                <li><strong>å¯¾è±¡ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼</strong>: ã·ã‚‰ã£ã¨ãã‚“ (purattokun)</li>
                <li><strong>ãƒ†ã‚¹ãƒˆæ–¹æ³•</strong>: æ—¢å­˜ã®æˆåŠŸãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½¿ç”¨</li>
                <li><strong>ãƒ•ã‚¡ã‚¤ãƒ«</strong>: assets/spine/characters/purattokun/</li>
                <li><strong>ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³</strong>: syutugenï¼ˆå‡ºç¾ï¼‰ â†’ taikiï¼ˆå¾…æ©Ÿï¼‰</li>
                <li><strong>ã‚¨ãƒ³ã‚¸ãƒ³</strong>: æ—¢å­˜ã®Spineçµ±åˆã‚·ã‚¹ãƒ†ãƒ </li>
            </ul>
        </div>
        
        <div class="control-panel">
            <button class="control-button primary-button" onclick="loadSpineBasic()">
                ğŸš€ åŸºæœ¬èª­ã¿è¾¼ã¿é–‹å§‹
            </button>
            <button class="control-button secondary-button" onclick="playAnimationTest('syutugen')">
                ğŸ¬ å‡ºç¾ã‚¢ãƒ‹ãƒ¡
            </button>
            <button class="control-button secondary-button" onclick="playAnimationTest('taiki')">
                ğŸ˜Š å¾…æ©Ÿã‚¢ãƒ‹ãƒ¡
            </button>
            <button class="control-button secondary-button" onclick="playAnimationTest('yarare')">
                ğŸ˜µ ã‚„ã‚‰ã‚Œã‚¢ãƒ‹ãƒ¡
            </button>
            <button class="control-button secondary-button" onclick="clearTestLog()">
                ğŸ—‘ï¸ ãƒ­ã‚°ã‚¯ãƒªã‚¢
            </button>
        </div>
        
        <div class="spine-container">
            <canvas id="spine-canvas" width="400" height="400"></canvas>
        </div>
        
        <div class="log-container" id="log-display">
            ğŸ§ª SpineåŸºæœ¬èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆãƒ­ã‚° - æº–å‚™ä¸­...\n
        </div>
    </div>

    <!-- Spine WebGL Runtimeï¼ˆCDNç‰ˆãƒ»index.htmlã¨åŒã˜ï¼‰ -->
    <script src="https://unpkg.com/@esotericsoftware/spine-webgl@4.1.24/dist/iife/spine-webgl.js"></script>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let canvas = null;
        let gl = null;
        let assetManager = null;
        let skeleton = null;
        let animationState = null;
        let logDisplay = null;
        
        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³çµ±åˆåˆ¶å¾¡
        let isAnimationRunning = false;

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            logDisplay = document.getElementById('log-display');
            testLog('ğŸ§ª SpineåŸºæœ¬èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ èµ·å‹•', 'success');
            testLog('ğŸ“ ä½¿ç”¨ãƒ•ã‚¡ã‚¤ãƒ«: assets/spine/characters/purattokun/', 'info');
        });
        
        // ã‚¢ã‚»ãƒƒãƒˆèª­ã¿è¾¼ã¿å¾…æ©Ÿç”¨ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ï¼ˆindex.htmlã‹ã‚‰ç§»æ¤ï¼‰
        function waitForAssets(assetManager) {
            return new Promise((resolve, reject) => {
                function check() {
                    if (assetManager.isLoadingComplete()) {
                        resolve();
                    } else if (assetManager.hasErrors()) {
                        reject(new Error('Asset loading failed: ' + assetManager.getErrors()));
                    } else {
                        setTimeout(check, 100);
                    }
                }
                check();
            });
        }

        // ãƒ­ã‚°è¡¨ç¤ºé–¢æ•°
        function testLog(message, type = 'info') {
            if (!logDisplay) return;
            
            const timestamp = new Date().toLocaleTimeString();
            const statusIcon = type === 'error' ? 'âŒ' : 
                              type === 'success' ? 'âœ…' : 
                              type === 'warning' ? 'âš ï¸' : 'â„¹ï¸';
            
            const logLine = `[${timestamp}] ${statusIcon} ${message}\n`;
            logDisplay.textContent += logLine;
            logDisplay.scrollTop = logDisplay.scrollHeight;
            
            console.log(`Spineãƒ†ã‚¹ãƒˆ: ${message}`);
        }

        // åŸºæœ¬çš„ãªSpineèª­ã¿è¾¼ã¿ï¼ˆæ—¢å­˜ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ™ãƒ¼ã‚¹ï¼‰
        async function loadSpineBasic() {
            testLog('ğŸš€ SpineåŸºæœ¬èª­ã¿è¾¼ã¿é–‹å§‹', 'info');
            
            try {
                // CanvasåˆæœŸåŒ–
                canvas = document.getElementById('spine-canvas');
                if (!canvas) {
                    throw new Error('Canvasè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
                
                testLog('ğŸ“ CanvasåˆæœŸåŒ–æˆåŠŸ', 'success');
                
                // WebGLåˆæœŸåŒ–ï¼ˆæœ€é©åŒ–è¨­å®šï¼‰
                gl = canvas.getContext('webgl', {
                    alpha: true,
                    premultipliedAlpha: true,
                    antialias: true,
                    depth: false,
                    stencil: false
                });
                
                if (!gl) {
                    throw new Error('WebGLåˆæœŸåŒ–å¤±æ•—');
                }
                
                testLog('âœ… WebGLåˆæœŸåŒ–æˆåŠŸï¼ˆæœ€é©åŒ–è¨­å®šé©ç”¨ï¼‰', 'success');
                
                // Spine WebGLãƒ©ã‚¤ãƒ–ãƒ©ãƒªç¢ºèª
                if (!window.spine) {
                    throw new Error('Spine WebGLãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
                }
                
                testLog('ğŸ“š Spine WebGLãƒ©ã‚¤ãƒ–ãƒ©ãƒªç¢ºèªæ¸ˆã¿', 'info');
                testLog(`ğŸ“‹ åˆ©ç”¨å¯èƒ½ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£: ${Object.keys(window.spine).join(', ')}`, 'info');
                
                // webglã‚µãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç¢ºèª
                if (window.spine.webgl) {
                    testLog(`ğŸ” spine.webgl ã‚¯ãƒ©ã‚¹: ${Object.keys(window.spine.webgl).join(', ')}`, 'info');
                } else {
                    testLog('âš ï¸ spine.webgl ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'warning');
                }
                
                // ã‚¢ã‚»ãƒƒãƒˆãƒãƒãƒ¼ã‚¸ãƒ£åˆæœŸåŒ–ï¼ˆindex.htmlã¨åŒã˜æ–¹å¼ï¼‰
                assetManager = new spine.AssetManager(gl, 'assets/spine/characters/purattokun/');
                
                // ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ï¼ˆãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹ç›¸å¯¾ï¼‰
                assetManager.loadTextureAtlas('purattokun.atlas');
                assetManager.loadJson('purattokun.json');
                
                testLog('ğŸ“ Spineãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿é–‹å§‹', 'info');
                
                // èª­ã¿è¾¼ã¿å®Œäº†å¾…æ©Ÿï¼ˆindex.htmlã¨åŒã˜ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ä½¿ç”¨ï¼‰
                await waitForAssets(assetManager);
                
                testLog('âœ… Spineã‚¢ã‚»ãƒƒãƒˆèª­ã¿è¾¼ã¿å®Œäº†', 'success');
                initializeSkeleton();
                
            } catch (error) {
                testLog(`âŒ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                console.error('SpineåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
            }
        }
        
        // ã‚¹ã‚±ãƒ«ãƒˆãƒ³åˆæœŸåŒ–
        function initializeSkeleton() {
            try {
                testLog('ğŸ¦´ ã‚¹ã‚±ãƒ«ãƒˆãƒ³åˆæœŸåŒ–é–‹å§‹', 'info');
                
                // ã‚¢ãƒˆãƒ©ã‚¹ãƒ»ã‚¹ã‚±ãƒ«ãƒˆãƒ³ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆindex.htmlã¨åŒã˜æ–¹å¼ï¼‰
                const atlas = assetManager.get('purattokun.atlas');
                const atlasLoader = new spine.AtlasAttachmentLoader(atlas);
                const skeletonJson = new spine.SkeletonJson(atlasLoader);
                
                const skeletonData = skeletonJson.readSkeletonData(assetManager.get('purattokun.json'));
                
                // ã‚¹ã‚±ãƒ«ãƒˆãƒ³ä½œæˆï¼ˆindex.htmlã¨åŒã˜æ–¹å¼ï¼‰
                skeleton = new spine.Skeleton(skeletonData);
                
                // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ä½ç½®è¨­å®šï¼ˆindex.htmlã¨åŒã˜ï¼‰
                skeleton.x = 0;
                skeleton.y = -100; // index.htmlã¨åŒã˜positionYå€¤
                skeleton.scaleX = skeleton.scaleY = 0.55; // index.htmlã¨åŒã˜scaleå€¤
                
                // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ãƒ†ãƒ¼ãƒˆåˆæœŸåŒ–
                const animationStateData = new spine.AnimationStateData(skeleton.data);
                animationState = new spine.AnimationState(animationStateData);
                
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
                animationState.setAnimation(0, 'taiki', true);
                
                testLog('âœ… ã‚¹ã‚±ãƒ«ãƒˆãƒ³åˆæœŸåŒ–å®Œäº†', 'success');
                testLog('ğŸ¬ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆtaikiï¼‰é–‹å§‹', 'info');
                
                // ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼åˆæœŸåŒ–ï¼ˆindex.htmlã¨åŒã˜æ–¹å¼ï¼‰
                const renderer = new spine.SceneRenderer(canvas, gl);
                
                // æç”»é–‹å§‹
                isAnimationRunning = true;
                let lastTime = Date.now() / 1000;
                
                function render() {
                    if (!isAnimationRunning || !skeleton || !animationState) {
                        return;
                    }
                    
                    try {
                        const now = Date.now() / 1000;
                        const delta = now - lastTime;
                        lastTime = now;
                        
                        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ›´æ–°
                        animationState.update(delta);
                        animationState.apply(skeleton);
                        skeleton.updateWorldTransform();
                        
                        // ç”»é¢ã‚¯ãƒªã‚¢ãƒ»ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆè¨­å®š
                        gl.clearColor(0, 0, 0, 0);
                        gl.clear(gl.COLOR_BUFFER_BIT);
                        gl.viewport(0, 0, canvas.width, canvas.height);
                        
                        // æç”»ï¼ˆindex.htmlã¨åŒã˜3æ®µéšæ–¹å¼ï¼‰
                        renderer.begin();
                        renderer.drawSkeleton(skeleton, true);
                        renderer.end();
                        
                    } catch (error) {
                        testLog(`âŒ æç”»ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                        console.error('æç”»ã‚¨ãƒ©ãƒ¼:', error);
                        isAnimationRunning = false;
                        return;
                    }
                    
                    requestAnimationFrame(render);
                }
                
                requestAnimationFrame(render);
                
                testLog('ğŸ‰ SpineåŸºæœ¬èª­ã¿è¾¼ã¿å®Œå…¨æˆåŠŸï¼', 'success');
                
            } catch (error) {
                testLog(`âŒ ã‚¹ã‚±ãƒ«ãƒˆãƒ³åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                console.error('ã‚¹ã‚±ãƒ«ãƒˆãƒ³åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
            }
        }
        
        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å†ç”Ÿãƒ†ã‚¹ãƒˆ
        function playAnimationTest(animationName) {
            if (!animationState) {
                testLog('âŒ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æœªåˆæœŸåŒ–ï¼ˆå…ˆã«åŸºæœ¬èª­ã¿è¾¼ã¿ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼‰', 'error');
                return;
            }
            
            testLog(`ğŸ¬ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ: ${animationName}`, 'info');
            
            try {
                if (animationName === 'syutugen') {
                    // å‡ºç¾ â†’ å¾…æ©Ÿã®è‡ªç„¶é·ç§»
                    animationState.setAnimation(0, 'syutugen', false);
                    animationState.addAnimation(0, 'taiki', true, 0);
                    testLog('ğŸ“‹ å‡ºç¾â†’å¾…æ©Ÿã®è‡ªç„¶é·ç§»è¨­å®š', 'info');
                } else {
                    // å˜ç™ºã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                    const loop = animationName === 'taiki';
                    animationState.setAnimation(0, animationName, loop);
                    testLog(`ğŸ“‹ ${animationName}ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šï¼ˆãƒ«ãƒ¼ãƒ—: ${loop}ï¼‰`, 'info');
                }
            } catch (error) {
                testLog(`âŒ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å†ç”Ÿã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                console.error('ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å†ç”Ÿã‚¨ãƒ©ãƒ¼:', error);
            }
        }
        
        // ãƒ­ã‚°ã‚¯ãƒªã‚¢
        function clearTestLog() {
            if (logDisplay) {
                logDisplay.textContent = 'ğŸ—‘ï¸ ãƒ­ã‚°ã‚¯ãƒªã‚¢ã•ã‚Œã¾ã—ãŸ\n';
            }
            testLog('ğŸ§ª ãƒ­ã‚°ã‚¯ãƒªã‚¢å®Ÿè¡Œ', 'info');
        }
        
        // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
        window.addEventListener('beforeunload', () => {
            isAnimationRunning = false;
            if (assetManager) {
                assetManager.dispose();
            }
        });
        
        // ãƒ‡ãƒãƒƒã‚°ç”¨ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°
        window.spineBasicDebug = {
            canvas: () => canvas,
            gl: () => gl,
            skeleton: () => skeleton,
            animationState: () => animationState,
            assetManager: () => assetManager
        };
        
        // åˆæœŸåŒ–å®Œäº†ãƒ­ã‚°
        console.log('ğŸ§ª SpineåŸºæœ¬èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†');
        console.log('ãƒ‡ãƒãƒƒã‚°ç”¨: window.spineBasicDebug ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½');
    </script>
</body>
</html>