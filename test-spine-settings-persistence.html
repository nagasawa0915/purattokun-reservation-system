<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpineSettingsPersistence ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .test-section h2 {
            color: #333;
            border-bottom: 2px solid #007acc;
            padding-bottom: 10px;
        }
        
        .control-group {
            margin: 15px 0;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 4px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .control-group input {
            width: 100px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
            margin-right: 10px;
        }
        
        .btn-group {
            margin: 20px 0;
        }
        
        .btn {
            padding: 10px 15px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            background: #007acc;
            color: white;
            cursor: pointer;
            font-size: 14px;
        }
        
        .btn:hover {
            background: #005999;
        }
        
        .btn.secondary {
            background: #6c757d;
        }
        
        .btn.danger {
            background: #dc3545;
        }
        
        .btn.success {
            background: #28a745;
        }
        
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        
        .status.success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        
        .status.error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        
        .status.info {
            background: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
        }
        
        .log-container {
            background: #000;
            color: #00ff00;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin: 10px 0;
        }
        
        .character-selector {
            margin: 10px 0;
        }
        
        .character-selector select {
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <h1>ğŸ¯ SpineSettingsPersistence ãƒã‚¤ã‚¯ãƒ­ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« ãƒ†ã‚¹ãƒˆ</h1>
    
    <!-- åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ -->
    <div class="test-section">
        <h2>ğŸ“‹ åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h2>
        
        <div class="character-selector">
            <label>ãƒ†ã‚¹ãƒˆå¯¾è±¡ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼:</label>
            <select id="characterSelect">
                <option value="nezumi">nezumi (ãƒã‚ºãƒŸ)</option>
                <option value="purattokun">purattokun (ã·ã‚‰ã£ã¨ãã‚“)</option>
                <option value="testCharacter">testCharacter (ãƒ†ã‚¹ãƒˆç”¨)</option>
            </select>
        </div>
        
        <div class="control-group">
            <label>Xè»¸ã‚¹ã‚±ãƒ¼ãƒ«:</label>
            <input type="number" id="scaleX" value="1.0" step="0.1" min="0.1" max="5.0">
            
            <label>Yè»¸ã‚¹ã‚±ãƒ¼ãƒ«:</label>
            <input type="number" id="scaleY" value="1.0" step="0.1" min="0.1" max="5.0">
            
            <label>Xåº§æ¨™:</label>
            <input type="number" id="positionX" value="0" step="10">
            
            <label>Yåº§æ¨™:</label>
            <input type="number" id="positionY" value="0" step="10">
            
            <label>Canvasã‚µã‚¤ã‚º:</label>
            <input type="number" id="canvasSize" value="800" step="50" min="100" max="1200">
        </div>
        
        <div class="btn-group">
            <button class="btn" onclick="testSave()">ğŸ’¾ è¨­å®šä¿å­˜</button>
            <button class="btn secondary" onclick="testRestore()">ğŸ“‚ è¨­å®šå¾©å…ƒ</button>
            <button class="btn danger" onclick="testClear()">ğŸ—‘ï¸ è¨­å®šå‰Šé™¤</button>
            <button class="btn" onclick="testExists()">ğŸ” å­˜åœ¨ç¢ºèª</button>
        </div>
        
        <div id="basicTestStatus" class="status info">
            ãƒ†ã‚¹ãƒˆçµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™
        </div>
    </div>
    
    <!-- é«˜åº¦æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ -->
    <div class="test-section">
        <h2>ğŸš€ é«˜åº¦æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h2>
        
        <div class="btn-group">
            <button class="btn" onclick="testGetAllSettings()">ğŸ“‹ å…¨è¨­å®šå–å¾—</button>
            <button class="btn secondary" onclick="testValidation()">âœ… ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ</button>
            <button class="btn" onclick="testCapacityCheck()">ğŸ’¾ å®¹é‡ãƒã‚§ãƒƒã‚¯</button>
            <button class="btn success" onclick="persistence.debug()">ğŸ”§ ãƒ‡ãƒãƒƒã‚°æƒ…å ±</button>
        </div>
        
        <div id="advancedTestStatus" class="status info">
            é«˜åº¦æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆçµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™
        </div>
    </div>
    
    <!-- ãƒ­ã‚°è¡¨ç¤º -->
    <div class="test-section">
        <h2>ğŸ“‹ å®Ÿè¡Œãƒ­ã‚°</h2>
        <button class="btn secondary" onclick="clearLog()">ğŸ§¹ ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
        <div id="logContainer" class="log-container">
            SpineSettingsPersistence ãƒ†ã‚¹ãƒˆé–‹å§‹...\n
        </div>
    </div>

    <script src="./micromodules/spine-settings-persistence/SpineSettingsPersistence.js"></script>
    <script>
        // SpineSettingsPersistence ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆï¼ˆãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰æœ‰åŠ¹ï¼‰
        const persistence = new SpineSettingsPersistence({
            debug: true,
            version: '1.0'
        });
        
        // ãƒ­ã‚°è¡¨ç¤ºé–¢æ•°
        function addLog(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}\n`;
            logContainer.textContent += logEntry;
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºé–¢æ•°
        function showStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status ${type}`;
        }
        
        // é¸æŠã•ã‚ŒãŸã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼IDå–å¾—
        function getSelectedCharacter() {
            return document.getElementById('characterSelect').value;
        }
        
        // å…¥åŠ›å€¤ã‹ã‚‰è¨­å®šã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
        function getSettingsFromInputs() {
            return {
                scaleX: parseFloat(document.getElementById('scaleX').value),
                scaleY: parseFloat(document.getElementById('scaleY').value),
                positionX: parseFloat(document.getElementById('positionX').value),
                positionY: parseFloat(document.getElementById('positionY').value),
                canvasSize: parseInt(document.getElementById('canvasSize').value)
            };
        }
        
        // è¨­å®šã‚’å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«åæ˜ 
        function applySettingsToInputs(settings) {
            if (settings) {
                document.getElementById('scaleX').value = settings.scaleX || 1.0;
                document.getElementById('scaleY').value = settings.scaleY || 1.0;
                document.getElementById('positionX').value = settings.positionX || 0;
                document.getElementById('positionY').value = settings.positionY || 0;
                document.getElementById('canvasSize').value = settings.canvasSize || 800;
            }
        }
        
        // ğŸ’¾ è¨­å®šä¿å­˜ãƒ†ã‚¹ãƒˆ
        function testSave() {
            const characterId = getSelectedCharacter();
            const settings = getSettingsFromInputs();
            
            addLog(`ğŸ’¾ ä¿å­˜ãƒ†ã‚¹ãƒˆé–‹å§‹: ${characterId}`);
            addLog(`è¨­å®šå†…å®¹: ${JSON.stringify(settings)}`);
            
            const result = persistence.save(characterId, settings);
            
            if (result) {
                addLog('âœ… ä¿å­˜æˆåŠŸ', 'success');
                showStatus('basicTestStatus', `âœ… ${characterId}ã®è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ`, 'success');
            } else {
                addLog('âŒ ä¿å­˜å¤±æ•—', 'error');
                showStatus('basicTestStatus', `âŒ ${characterId}ã®è¨­å®šä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ`, 'error');
            }
        }
        
        // ğŸ“‚ è¨­å®šå¾©å…ƒãƒ†ã‚¹ãƒˆ
        function testRestore() {
            const characterId = getSelectedCharacter();
            
            addLog(`ğŸ“‚ å¾©å…ƒãƒ†ã‚¹ãƒˆé–‹å§‹: ${characterId}`);
            
            const settings = persistence.restore(characterId);
            
            if (settings) {
                addLog(`âœ… å¾©å…ƒæˆåŠŸ: ${JSON.stringify(settings)}`, 'success');
                applySettingsToInputs(settings);
                showStatus('basicTestStatus', `âœ… ${characterId}ã®è¨­å®šã‚’å¾©å…ƒã—ã¾ã—ãŸ`, 'success');
            } else {
                addLog('â„¹ï¸ å¾©å…ƒãƒ‡ãƒ¼ã‚¿ãªã—');
                showStatus('basicTestStatus', `â„¹ï¸ ${characterId}ã®ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã¯ã‚ã‚Šã¾ã›ã‚“`, 'info');
            }
        }
        
        // ğŸ—‘ï¸ è¨­å®šå‰Šé™¤ãƒ†ã‚¹ãƒˆ
        function testClear() {
            const characterId = getSelectedCharacter();
            
            addLog(`ğŸ—‘ï¸ å‰Šé™¤ãƒ†ã‚¹ãƒˆé–‹å§‹: ${characterId}`);
            
            const result = persistence.clear(characterId);
            
            if (result) {
                addLog('âœ… å‰Šé™¤æˆåŠŸ', 'success');
                showStatus('basicTestStatus', `âœ… ${characterId}ã®è¨­å®šã‚’å‰Šé™¤ã—ã¾ã—ãŸ`, 'success');
            } else {
                addLog('âŒ å‰Šé™¤å¤±æ•—', 'error');
                showStatus('basicTestStatus', `âŒ ${characterId}ã®è¨­å®šå‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ`, 'error');
            }
        }
        
        // ğŸ” å­˜åœ¨ç¢ºèªãƒ†ã‚¹ãƒˆ
        function testExists() {
            const characterId = getSelectedCharacter();
            
            addLog(`ğŸ” å­˜åœ¨ç¢ºèªãƒ†ã‚¹ãƒˆé–‹å§‹: ${characterId}`);
            
            const exists = persistence.exists(characterId);
            
            addLog(`çµæœ: ${exists ? 'å­˜åœ¨ã™ã‚‹' : 'å­˜åœ¨ã—ãªã„'}`);
            showStatus('basicTestStatus', 
                `${characterId}ã®è¨­å®šã¯${exists ? 'å­˜åœ¨ã—ã¾ã™' : 'å­˜åœ¨ã—ã¾ã›ã‚“'}`, 
                exists ? 'success' : 'info'
            );
        }
        
        // ğŸ“‹ å…¨è¨­å®šå–å¾—ãƒ†ã‚¹ãƒˆ
        function testGetAllSettings() {
            addLog('ğŸ“‹ å…¨è¨­å®šå–å¾—ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            const allSettings = persistence.getAllForCurrentPage();
            const count = Object.keys(allSettings).length;
            
            addLog(`å–å¾—çµæœ: ${count}ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼`);
            addLog(`è©³ç´°: ${JSON.stringify(allSettings, null, 2)}`);
            
            showStatus('advancedTestStatus', 
                `ç¾åœ¨ãƒšãƒ¼ã‚¸ã«${count}ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®è¨­å®šãŒã‚ã‚Šã¾ã™`, 
                count > 0 ? 'success' : 'info'
            );
        }
        
        // âœ… ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ
        function testValidation() {
            addLog('âœ… ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            // ç„¡åŠ¹ãªãƒ‡ãƒ¼ã‚¿ã§ãƒ†ã‚¹ãƒˆ
            const invalidData = [
                { name: 'æ•°å€¤ç¯„å›²å¤–', data: { scaleX: 10.0, scaleY: 1.0 } },
                { name: 'å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä¸è¶³', data: { scaleX: 1.0 } },
                { name: 'å‹ä¸æ­£', data: { scaleX: 'invalid', scaleY: 1.0 } },
                { name: 'null', data: null }
            ];
            
            let passCount = 0;
            
            invalidData.forEach(test => {
                const isValid = persistence.validateSettings(test.data);
                const expected = false; // å…¨ã¦ç„¡åŠ¹ãƒ‡ãƒ¼ã‚¿ãªã®ã§ false ãŒæœŸå¾…å€¤
                
                if (isValid === expected) {
                    addLog(`âœ… ${test.name}: æœŸå¾…é€šã‚Š (${isValid})`);
                    passCount++;
                } else {
                    addLog(`âŒ ${test.name}: æœŸå¾…ã¨ç•°ãªã‚‹ (${isValid})`, 'error');
                }
            });
            
            // æœ‰åŠ¹ãªãƒ‡ãƒ¼ã‚¿ã§ã‚‚ãƒ†ã‚¹ãƒˆ
            const validData = { scaleX: 1.5, scaleY: 1.2, positionX: 100, positionY: 50 };
            const isValidForValid = persistence.validateSettings(validData);
            
            if (isValidForValid === true) {
                addLog('âœ… æœ‰åŠ¹ãƒ‡ãƒ¼ã‚¿: æœŸå¾…é€šã‚Š (true)');
                passCount++;
            } else {
                addLog('âŒ æœ‰åŠ¹ãƒ‡ãƒ¼ã‚¿: æœŸå¾…ã¨ç•°ãªã‚‹ (false)', 'error');
            }
            
            const totalTests = invalidData.length + 1;
            showStatus('advancedTestStatus', 
                `ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ: ${passCount}/${totalTests} æˆåŠŸ`, 
                passCount === totalTests ? 'success' : 'error'
            );
        }
        
        // ğŸ’¾ å®¹é‡ãƒã‚§ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ
        function testCapacityCheck() {
            addLog('ğŸ’¾ å®¹é‡ãƒã‚§ãƒƒã‚¯ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            const hasCapacity = persistence.checkStorageCapacity();
            
            addLog(`å®¹é‡ãƒã‚§ãƒƒã‚¯çµæœ: ${hasCapacity ? 'ä½™è£•ã‚ã‚Š' : 'å®¹é‡ä¸è¶³'}`);
            showStatus('advancedTestStatus', 
                `localStorageå®¹é‡: ${hasCapacity ? 'ä½¿ç”¨å¯èƒ½' : 'ä¸è¶³'}`, 
                hasCapacity ? 'success' : 'error'
            );
        }
        
        // ğŸ§¹ ãƒ­ã‚°ã‚¯ãƒªã‚¢
        function clearLog() {
            document.getElementById('logContainer').textContent = 'ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ...\n';
        }
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            addLog('ğŸ¯ SpineSettingsPersistence ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†');
            addLog('ä½¿ç”¨æ–¹æ³•: ä¸Šè¨˜ã®ãƒœã‚¿ãƒ³ã‚’ä½¿ã£ã¦å„æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„');
        });
    </script>
</body>
</html>