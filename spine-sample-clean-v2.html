<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spine ã‚µãƒ³ãƒ—ãƒ«ï¼ˆã‚·ã‚¹ãƒ†ãƒ æœªçµ±åˆï¼‰</title>
    <style>
        /* index.htmlã‹ã‚‰æœ€å°é™ã®æŠ½å‡º */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Noto Sans JP', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #fafafa;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #ff6b6b;
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        /* index.htmlã®ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãã®ã¾ã¾ */
        .hero {
            position: relative;
            display: flex;
            align-items: flex-start;
            justify-content: flex-start;
            padding: 40px 20px;
            overflow: hidden;
        }
        
        .background-container {
            position: relative;
            width: 100%;
            max-width: 100vw;
            overflow: hidden;
        }
        
        .background-image {
            width: 100%;
            height: auto;
            display: block;
            object-fit: cover;
        }
        
        /* index.htmlã®ã·ã‚‰ã£ã¨ãã‚“CSS - å®Œå…¨ã‚³ãƒ”ãƒ¼ */
        #purattokun-canvas {
            position: absolute;
            left: 18%;
            top: 49%;
            transform: translate(-50%, -50%);
            width: 120px;
            height: 120px;
            z-index: 10;
        }
        
        #purattokun-fallback {
            position: absolute;
            left: 18%;
            top: 49%;
            transform: translate(-50%, -50%);
            width: 120px;
            height: 120px;
            z-index: 10;
            display: none;
            object-fit: contain;
        }
        
        @media (max-width: 768px) {
            #purattokun-canvas {
                left: 50%;
                top: 65%;
                width: 80px;
                height: 80px;
            }
            
            #purattokun-fallback {
                left: 50% !important;
                top: 65% !important;
                width: 80px !important;
                height: 80px !important;
            }
        }
        
        .info {
            background: white;
            padding: 20px;
            margin-top: 20px;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ® Spine ã‚µãƒ³ãƒ—ãƒ«ï¼ˆã‚·ã‚¹ãƒ†ãƒ æœªçµ±åˆï¼‰</h1>
        <p>index.htmlã‹ã‚‰èƒŒæ™¯ã¨Spineã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®ã¿æŠ½å‡º</p>
    </div>

    <!-- index.htmlã®ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãã®ã¾ã¾ã‚³ãƒ”ãƒ¼ -->
    <section class="hero">
        <div class="background-container">
            <img src="assets/images/ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼TOP.png" alt="ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼èƒŒæ™¯" class="background-image">
            
            <!-- index.htmlã¨å…¨ãåŒã˜Spineè¦ç´  -->
            <canvas id="purattokun-canvas"></canvas>
            
            <img src="assets/images/purattokunn.png" 
                 alt="ã·ã‚‰ã£ã¨ãã‚“ç”»åƒ" 
                 id="purattokun-fallback"
                 style="position: absolute; left: 18%; top: 49%; transform: translate(-50%, -50%); width: 120px; height: 120px; z-index: 10; display: none; object-fit: contain;">
        </div>
    </section>
    
    <div class="info">
        <h2>ğŸ“Š ç¾åœ¨ã®çŠ¶æ…‹</h2>
        <p>âŒ Positioning System æœªçµ±åˆ - ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ä¸å¯</p>
        <p>âœ… åŸºæœ¬çš„ãªSpineè¡¨ç¤ºæ©Ÿèƒ½ã®ã¿</p>
    </div>

    <!-- index.htmlã¨å…¨ãåŒã˜Spine WebGL Runtime -->
    <script src="https://unpkg.com/@esotericsoftware/spine-webgl@4.1.*/dist/iife/spine-webgl.js"></script>
    
    <script>
        // index.htmlã®SpineåˆæœŸåŒ–ã‚³ãƒ¼ãƒ‰ã‚’ãã®ã¾ã¾ã‚³ãƒ”ãƒ¼
        
        // ã·ã‚‰ã£ã¨ãã‚“è¨­å®šèª­ã¿è¾¼ã¿
        function loadPurattokuConfing() {
            const configElement = document.getElementById('purattokun-config');
            if (configElement) {
                return {
                    x: parseFloat(configElement.dataset.x) || 18,
                    y: parseFloat(configElement.dataset.y) || 49,
                    scale: parseFloat(configElement.dataset.scale) || 0.25,
                    fadeDelay: parseInt(configElement.dataset.fadeDelay) || 1500,
                    fadeDuration: parseInt(configElement.dataset.fadeDuration) || 2000
                };
            }
            
            return {
                x: 18,
                y: 49,
                scale: 0.25,
                fadeDelay: 1500,
                fadeDuration: 2000
            };
        }
        
        // Spineã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åˆæœŸåŒ–ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰
        async function initSpineCharacter() {
            try {
                const canvas = document.getElementById('purattokun-canvas');
                const gl = canvas.getContext('webgl', { alpha: true });
                
                if (!gl) {
                    throw new Error('WebGLã‚µãƒãƒ¼ãƒˆãªã—');
                }
                
                // Canvas ã‚µã‚¤ã‚ºæ›´æ–°
                const updateCanvasSize = () => {
                    const rect = canvas.getBoundingClientRect();
                    canvas.width = rect.width;
                    canvas.height = rect.height;
                };
                
                updateCanvasSize();
                window.addEventListener('resize', updateCanvasSize);
                
                console.log('ğŸ“ Spineãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ä¸­...');
                
                // ã‚¢ã‚»ãƒƒãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼
                const basePath = 'assets/spine/characters/purattokun/';
                const assetManager = new spine.AssetManager(gl, basePath);
                assetManager.loadTextureAtlas('purattokun.atlas');
                assetManager.loadJson('purattokun.json');
                
                // ã‚¢ã‚»ãƒƒãƒˆèª­ã¿è¾¼ã¿å®Œäº†å¾…ã¡
                await new Promise((resolve, reject) => {
                    let checkCount = 0;
                    const maxChecks = 100;
                    
                    const checkAssets = () => {
                        checkCount++;
                        if (assetManager.isLoadingComplete()) {
                            resolve();
                        } else if (checkCount >= maxChecks) {
                            reject(new Error('ã‚¢ã‚»ãƒƒãƒˆèª­ã¿è¾¼ã¿ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ'));
                        } else {
                            setTimeout(checkAssets, 100);
                        }
                    };
                    
                    checkAssets();
                });
                
                console.log('ğŸ¬ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹...');
                
                // Atlaså–å¾—
                const atlas = assetManager.get('purattokun.atlas');
                const atlasLoader = new spine.AtlasAttachmentLoader(atlas);
                
                // SkeletonDataèª­ã¿è¾¼ã¿
                const skeletonJson = new spine.SkeletonJson(atlasLoader);
                const skeletonData = skeletonJson.readSkeletonData(assetManager.get('purattokun.json'));
                
                // Skeletonä½œæˆ
                const skeleton = new spine.Skeleton(skeletonData);
                skeleton.x = canvas.width / 2;
                skeleton.y = canvas.height / 2;
                skeleton.scaleX = skeleton.scaleY = 0.8;
                
                // AnimationStateä½œæˆ
                const animationStateData = new spine.AnimationStateData(skeleton.data);
                const animationState = new spine.AnimationState(animationStateData);
                
                // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
                if (skeleton.data.findAnimation('taiki')) {
                    animationState.setAnimation(0, 'taiki', true);
                    console.log('ğŸ­ taikiã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šå®Œäº†');
                }
                
                // ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ä½œæˆ
                const renderer = new spine.SceneRenderer(canvas, gl);
                let lastTime = Date.now() / 1000;
                
                // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ«ãƒ¼ãƒ—
                function render() {
                    const now = Date.now() / 1000;
                    const delta = now - lastTime;
                    lastTime = now;
                    
                    animationState.update(delta);
                    animationState.apply(skeleton);
                    skeleton.updateWorldTransform();
                    
                    gl.clearColor(0, 0, 0, 0);
                    gl.clear(gl.COLOR_BUFFER_BIT);
                    gl.viewport(0, 0, canvas.width, canvas.height);
                    
                    renderer.begin();
                    renderer.drawSkeleton(skeleton, true);
                    renderer.end();
                    
                    requestAnimationFrame(render);
                }
                
                render();
                console.log('âœ… SpineåˆæœŸåŒ–æˆåŠŸ');
                
            } catch (error) {
                console.error('SpineåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”»åƒã‚’è¡¨ç¤º
                const fallback = document.getElementById('purattokun-fallback');
                if (fallback) {
                    fallback.style.display = 'block';
                    canvas.style.display = 'none';
                }
            }
        }
        
        // åˆæœŸåŒ–å®Ÿè¡Œ
        window.addEventListener('load', () => {
            console.log('ğŸ“„ ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†');
            setTimeout(initSpineCharacter, 1000);
        });
    </script>
</body>
</html>