<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PureSpineLoader å˜ç‹¬ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            background: #f0f0f0;
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            max-width: 800px;
            margin: 0 auto;
        }
        .log {
            background: #f8f8f8;
            border: 1px solid #ddd;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        button {
            background: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #005a8a;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª PureSpineLoader ãƒã‚¤ã‚¯ãƒ­ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å˜ç‹¬ãƒ†ã‚¹ãƒˆ</h1>
        
        <div>
            <button onclick="runBasicTest()">åŸºæœ¬ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <button onclick="runLoadTest()">èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <button onclick="runCleanupTest()">Cleanupãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <button onclick="clearLog()">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
        </div>
        
        <div id="log" class="log"></div>
    </div>

    <!-- Spine WebGL Runtime -->
    <script src="https://unpkg.com/@esotericsoftware/spine-webgl@4.1.24/dist/iife/spine-webgl.js"></script>
    
    <!-- PureSpineLoader ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« -->
    <script src="PureSpineLoader.js"></script>
    
    <script>
        const logElement = document.getElementById('log');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : '';
            const logLine = `[${timestamp}] ${message}\n`;
            
            const span = document.createElement('span');
            span.className = className;
            span.textContent = logLine;
            logElement.appendChild(span);
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function clearLog() {
            logElement.innerHTML = '';
        }
        
        // ã‚ªãƒªã‚¸ãƒŠãƒ«ã®console.logã‚’ãƒ©ãƒƒãƒ—
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            log(args.join(' '), 'info');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            log(args.join(' '), 'error');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            log(args.join(' '), 'warning');
        };
        
        // ãƒ†ã‚¹ãƒˆé–¢æ•°
        async function runBasicTest() {
            log('=== åŸºæœ¬ãƒ†ã‚¹ãƒˆé–‹å§‹ ===', 'success');
            
            try {
                // 1. ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å­˜åœ¨ç¢ºèª
                if (typeof PureSpineLoader === 'undefined') {
                    throw new Error('PureSpineLoader ã‚¯ãƒ©ã‚¹ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
                }
                log('âœ… PureSpineLoader ã‚¯ãƒ©ã‚¹ç¢ºèªå®Œäº†');
                
                // 2. é™çš„ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
                const testResult = PureSpineLoader.test();
                if (testResult) {
                    log('âœ… é™çš„ãƒ†ã‚¹ãƒˆå®Œäº†', 'success');
                } else {
                    log('âŒ é™çš„ãƒ†ã‚¹ãƒˆå¤±æ•—', 'error');
                }
                
                log('=== åŸºæœ¬ãƒ†ã‚¹ãƒˆå®Œäº† ===', 'success');
                
            } catch (error) {
                log(`âŒ åŸºæœ¬ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`, 'error');
            }
        }
        
        async function runLoadTest() {
            log('=== èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆé–‹å§‹ ===', 'success');
            
            try {
                // purattokun ã§å®Ÿéš›ã®èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
                const config = {
                    basePath: './assets/spine/characters/purattokun/',
                    atlasPath: 'purattokun.atlas',
                    jsonPath: 'purattokun.json',
                    scale: 0.5
                };
                
                log('ğŸ“ ãƒ†ã‚¹ãƒˆè¨­å®š:', 'info');
                log(`  basePath: ${config.basePath}`);
                log(`  atlasPath: ${config.atlasPath}`);
                log(`  jsonPath: ${config.jsonPath}`);
                log(`  scale: ${config.scale}`);
                
                const loader = new PureSpineLoader(config);
                
                log('ğŸš€ execute() å®Ÿè¡Œä¸­...');
                const result = await loader.execute();
                
                log('ğŸ“Š èª­ã¿è¾¼ã¿çµæœ:');
                log(`  loaded: ${result.loaded}`);
                log(`  loading: ${result.loading}`);
                log(`  error: ${result.error}`);
                
                if (result.loaded && result.spineData) {
                    log(`  animations: ${result.spineData.animations.join(', ')}`);
                    log(`  animationCount: ${result.spineData.animationCount}`);
                    log(`  slotCount: ${result.spineData.slotCount}`);
                    log('âœ… èª­ã¿è¾¼ã¿æˆåŠŸï¼', 'success');
                } else if (result.error) {
                    log(`âš ï¸ èª­ã¿è¾¼ã¿å¤±æ•—: ${result.error}`, 'warning');
                    log('ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼‰', 'warning');
                } else {
                    log('âŒ ä¸æ˜ãªã‚¨ãƒ©ãƒ¼', 'error');
                }
                
                // cleanup ãƒ†ã‚¹ãƒˆ
                log('ğŸ§¹ cleanup() å®Ÿè¡Œ...');
                const cleanupResult = loader.cleanup();
                log(`cleanupçµæœ: ${cleanupResult}`);
                
                const afterCleanup = loader.getState();
                log(`cleanupå¾Œã®loaded: ${afterCleanup.loaded}`);
                
                log('=== èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆå®Œäº† ===', 'success');
                
            } catch (error) {
                log(`âŒ èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`, 'error');
                console.error('èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼è©³ç´°:', error);
            }
        }
        
        async function runCleanupTest() {
            log('=== Cleanupãƒ†ã‚¹ãƒˆé–‹å§‹ ===', 'success');
            
            try {
                const config = {
                    basePath: './test/',
                    atlasPath: 'test.atlas',
                    jsonPath: 'test.json',
                    scale: 1.0
                };
                
                // è¤‡æ•°ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆãƒ»å‰Šé™¤
                for (let i = 0; i < 3; i++) {
                    log(`ğŸ”„ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ ${i + 1}/3 ä½œæˆãƒ»å‰Šé™¤ä¸­...`);
                    
                    const loader = new PureSpineLoader(config);
                    const initialState = loader.getState();
                    
                    log(`  åˆæœŸçŠ¶æ…‹: loaded=${initialState.loaded}, loading=${initialState.loading}`);
                    
                    const cleanupResult = loader.cleanup();
                    log(`  cleanupçµæœ: ${cleanupResult}`);
                    
                    const finalState = loader.getState();
                    log(`  æœ€çµ‚çŠ¶æ…‹: loaded=${finalState.loaded}, loading=${finalState.loading}`);
                }
                
                log('âœ… è¤‡æ•°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆãƒ»å‰Šé™¤ãƒ†ã‚¹ãƒˆå®Œäº†', 'success');
                log('=== Cleanupãƒ†ã‚¹ãƒˆå®Œäº† ===', 'success');
                
            } catch (error) {
                log(`âŒ Cleanupãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`, 'error');
            }
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚
        window.addEventListener('load', () => {
            log('ğŸŒ ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†');
            log('ğŸ“‹ åˆ©ç”¨å¯èƒ½ãªãƒ†ã‚¹ãƒˆ:');
            log('  - åŸºæœ¬ãƒ†ã‚¹ãƒˆ: PureSpineLoader.test()ã®å®Ÿè¡Œ');
            log('  - èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ: å®Ÿéš›ã®Spineãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿');
            log('  - Cleanupãƒ†ã‚¹ãƒˆ: ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ãƒ»çŠ¶æ…‹å¾©å…ƒç¢ºèª');
            log('');
            log('ğŸ¯ ãƒã‚¤ã‚¯ãƒ­ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­è¨ˆã®ç¢ºèªãƒã‚¤ãƒ³ãƒˆ:');
            log('  1. å¤–éƒ¨ä¾å­˜ã‚¼ãƒ­ï¼ˆä»–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ»ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ç¦æ­¢ï¼‰');
            log('  2. å˜ä¸€è²¬å‹™ï¼ˆSpineãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿å°‚ç”¨ï¼‰');
            log('  3. cleanup()ã§å®Œå…¨å¾©å…ƒä¿è¨¼');
            log('  4. æ•°å€¤ãƒ»æ–‡å­—åˆ—ã®ã¿ã§ä»–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨é€šä¿¡');
            log('');
            log('â–¶ï¸ ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„');
        });
    </script>
</body>
</html>