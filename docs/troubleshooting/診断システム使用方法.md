---
title: 診断システム使用方法とSpine WebGL検証
status: 完成
tags: [診断, デバッグ, Spine, WebGL, 検証]
aliases: 
  - 診断システム
  - WebGL検証
  - Spine検証
  - ライブラリ検証
  - デバッグツール
created: 2025-08-28
updated: 2025-08-28
---

# 🎯 診断システム使用方法とSpine WebGL検証

## 📊 現在の状況
**ステータス**: 完成（包括的な診断システムとWebGL検証方法を確立）

## ⚡ 診断システムの使用方法

### 基本診断コマンド（ブラウザF12コンソール）

```javascript
// 1. Spine WebGL検証（新統一方式）
console.log('=== Spine WebGL検証 ===');
console.log('spine定義:', typeof spine);
console.log('AssetManager:', typeof spine?.AssetManager);
console.log('SkeletonRenderer:', typeof spine?.SkeletonRenderer);
console.log('PolygonBatcher:', typeof spine?.PolygonBatcher);
console.log('Skeleton:', typeof spine?.Skeleton);
console.log('AnimationState:', typeof spine?.AnimationState);
console.log('AtlasAttachmentLoader:', typeof spine?.AtlasAttachmentLoader);

// 2. 瞬間診断実行（PureSpineEditor使用時）
if (typeof runInstantDiagnosis === 'function') {
    runInstantDiagnosis(editor);
}

// 3. 座標状態確認
if (typeof checkCoordinateWrites === 'function') {
    checkCoordinateWrites(editor);
}

// 4. WebGL対応確認
const canvas = document.getElementById('purattokun-canvas');
const gl = canvas?.getContext('webgl') || canvas?.getContext('experimental-webgl');
console.log('WebGL対応:', !!gl);
```

## 🔍 WebGL検証条件の統一（2025-08-28改善）

### ✅ 新しい統一検証方式

今回のPureSpineLoader修正により確立された、CDN版・ローカル版両対応の検証方式：

```javascript
// ✅ 推奨：個別クラス検証方式（CDN・ローカル両対応）
function checkSpineWebGLAvailability() {
    if (!window.spine) {
        return { available: false, reason: 'Spineライブラリ未定義' };
    }
    
    const requiredClasses = [
        'AssetManager',
        'SkeletonRenderer', 
        'PolygonBatcher',
        'Skeleton',
        'AnimationState',
        'AtlasAttachmentLoader'
    ];
    
    for (const className of requiredClasses) {
        if (!spine[className]) {
            return { 
                available: false, 
                reason: `${className}クラスが見つかりません` 
            };
        }
    }
    
    return { available: true, reason: '全クラス確認済み' };
}

// 使用例
const result = checkSpineWebGLAvailability();
console.log('WebGL検証結果:', result);
```

### ❌ 古い検証方式（互換性問題あり）

```javascript
// ❌ 非推奨：CDN版のみ対応
if (!window.spine || !spine.webgl) {
    // ローカル版では spine.webgl が存在しないため失敗
    return false;
}

// ❌ 非推奨：曖昧な検証
if (!window.spine || !spine.AssetManager) {
    // AssetManagerのみでは不十分
    return false;
}
```

## 🎯 ライブラリバージョン別の構造差異

### CDN版（Unpkg等）
```javascript
// CDN版の構造
window.spine = {
    webgl: {
        AssetManager: class {},
        SkeletonRenderer: class {},
        // ...
    }
};

// アクセス方法
const manager = new spine.webgl.AssetManager(context);
```

### ローカル版（spine-webgl.js）
```javascript
// ローカル版の構造
window.spine = {
    AssetManager: class {},
    SkeletonRenderer: class {},
    PolygonBatcher: class {},
    // ...
};

// アクセス方法
const manager = new spine.AssetManager(context);
```

## 🔧 実践的な診断手順

### Step 1: 環境確認
```javascript
// 基本環境チェック
console.log('=== 環境診断 ===');
console.log('ブラウザ:', navigator.userAgent);
console.log('URL:', location.href);
console.log('HTTPサーバー:', location.protocol !== 'file:');
```

### Step 2: Spine検証
```javascript
// Spine検証実行
const spineCheck = checkSpineWebGLAvailability();
console.log('Spine検証:', spineCheck);

if (!spineCheck.available) {
    console.error('🚨 Spine問題:', spineCheck.reason);
    // 対処方法を表示
    console.log('💡 対処方法:');
    console.log('1. spine-webgl.jsファイルの読み込み確認');
    console.log('2. script タグの順序確認');
    console.log('3. ネットワークエラーの確認');
}
```

### Step 3: 要素確認
```javascript
// DOM要素の確認
const canvas = document.getElementById('purattokun-canvas');
const fallback = document.getElementById('purattokun-fallback');

console.log('=== DOM要素確認 ===');
console.log('Canvas要素:', !!canvas);
console.log('Fallback要素:', !!fallback);

if (canvas) {
    console.log('Canvas情報:', {
        width: canvas.width,
        height: canvas.height,
        style: canvas.style.cssText,
        display: canvas.style.display
    });
}
```

## 🚨 よくある問題パターンと解決法

### パターン1: 「Spine WebGLライブラリが読み込まれていません」
**症状**: 検証エラーでSpineが読み込まれない
**解決手順**:
1. 上記の統一検証コードを実行
2. 不足クラスを特定
3. ライブラリファイルの再読み込み

### パターン2: ローカルファイル使用時の検証失敗
**症状**: CDN版は正常、ローカル版のみ失敗
**解決策**: 個別クラス検証方式への変更（上記コード参照）

### パターン3: 瞬間移動問題
**症状**: キャラクターが一瞬別の場所に表示される
**診断方法**:
```javascript
// 座標監視開始
runInstantDiagnosis(editor);

// 3秒後に結果確認
```

## 📝 トラブルシューティング連携

診断結果に応じた詳細解決方法は以下を参照：

- **Spineライブラリ問題**: [Spineライブラリ読込問題.md](./Spineライブラリ読込問題.md)
- **座標・位置問題**: [座標系統合問題.md](./座標系統合問題.md) 
- **Canvas表示問題**: [Canvas表示問題.md](./Canvas表示問題.md)

## 🎯 成功事例：PureSpineLoader修正 (2025-08-28)

**問題**: ローカルspine-webgl.js使用時の検証失敗
**解決**: 個別クラス検証への変更
**結果**: ぷらっとくんが正常表示
**教訓**: ライブラリの実装詳細に依存しない汎用検証の重要性

---

**📖 参考**: 
- [diagnosis-integration.js](/diagnosis-integration.js) - 診断システム統合コード
- [micromodules/spine-loader/](/micromodules/spine-loader/) - PureSpineLoaderモジュール
