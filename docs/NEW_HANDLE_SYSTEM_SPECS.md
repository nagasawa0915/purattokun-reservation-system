# 🎯 新ハンドル操作システム仕様書

## 📋 仕様策定経緯

**日時**: 2025年1月29日  
**要求**: ユーザーからの直感的な編集操作改善要望  
**目標**: より柔軟で分かりやすいキャラクター編集システム

---

## 🎮 新しいUI/UX仕様

### 🆕 ハンドルシステム

#### ハンドル構成（9個）
- **🟢 緑ハンドル（4個）**: 角の対角拡縮用
- **🔵 青ハンドル（4個）**: 辺中央の片方向拡縮用  
- **🟠 橙ハンドル（1個）**: 中央の中心基準拡縮用

#### 視覚状態
- **非アクティブ**: `○` 中空の枠線のみ
- **アクティブ**: `●` 塗りつぶし + 光る効果

### 🖱️ 操作フロー

1. **Step 1**: ハンドル（○）をクリック → ●に変化してアクティブ化
2. **Step 2**: 画面の任意の場所をドラッグ → その場所を中心に拡大縮小  
3. **移動**: ハンドル以外の部分をドラッグ → キャラクター移動
4. **解除**: 他のハンドルクリック or 空白クリック

### 🔧 技術仕様

#### CSS実装
```css
/* 非アクティブハンドル */
.handle-inactive {
    border: 2px solid #color;
    background: transparent;
    border-radius: 50%;
    cursor: pointer;
}

/* アクティブハンドル */
.handle-active {
    border: 2px solid #color;
    background: #color;
    border-radius: 50%;
    box-shadow: 0 2px 8px rgba(color, 0.8);
    cursor: pointer;
}
```

#### JavaScript実装要件
- **ハンドルアクティブ状態管理**: クリック検出と状態切り替え
- **グローバルドラッグ検出**: document全体でのmousemove監視
- **拡縮基準点制御**: アクティブハンドルに応じた変形ロジック
- **競合回避**: 既存ドラッグ機能との衝突防止

---

## 📐 ハンドル種類と機能詳細

### 🟢 角ハンドル（対角拡縮）
- **位置**: 4隅（NW, NE, SW, SE）
- **機能**: 対角線基準で縦横比維持拡縮
- **用途**: 安全な基本拡縮（歪み防止）

### 🔵 辺ハンドル（片方向拡縮）
- **位置**: 辺中央（N, S, E, W）
- **機能**: 反対側基準で片方向拡縮
- **用途**: 縦横比を意図的に変更したい場合

### 🟠 中央ハンドル（中心拡縮）
- **位置**: キャラクター中央
- **機能**: 中心点基準で縦横比維持拡縮
- **用途**: 位置を変えずにサイズ調整

---

## 🎨 UIデザイン更新履歴

### spine-positioning-system-explanation-optimized.html 更新内容

1. **方法1の数値入力サンプル**
   - 2パネル構成（数値入力 + リアルタイムプレビュー）
   - ハンドル付きプレビュー表示
   - 利点説明追加

2. **方法3の詳細編集機能**
   - 新ハンドルシステムの詳細説明
   - ビフォー・アフター比較表示
   - 操作方法のステップ説明

3. **重複解消**
   - 冗長なドラッグ操作サンプルを統合
   - 簡潔で分かりやすい構成に再編

---

## 🛠️ 実装計画

### Phase 1: プロトタイプ実装
- **対象**: spine-sample-simple.html
- **期間**: 1-2時間
- **内容**: 新ハンドルシステムの基本機能実装

### Phase 2: 動作検証
- **期間**: 30分
- **内容**: ユーザビリティテスト・操作感確認

### Phase 3: 本格統合（必要に応じて）
- **対象**: 既存編集システム全体
- **期間**: 2-3時間
- **内容**: 全機能統合・回帰テスト

---

## ⚠️ 技術的考慮事項

### 実装上の課題
1. **グローバルイベント管理**: document全体でのマウス操作制御
2. **状態管理**: ハンドルアクティブ状態の適切な管理
3. **競合回避**: 既存機能との衝突防止
4. **モバイル対応**: タッチ操作での実装

### リスク軽減策
- **段階的実装**: プロトタイプ → 検証 → 統合の順序
- **フォールバック**: 既存システムとの並行稼働
- **十分なテスト**: 各段階での動作確認

---

## 📝 実装状況

- [x] 仕様策定・ユーザー要望確認
- [x] UIデザイン更新（説明ページ）
- [ ] プロトタイプ実装（spine-sample-simple.html）
- [ ] 動作テスト・検証
- [ ] 必要に応じて本格統合

**次のステップ**: spine-sample-simple.htmlでのプロトタイプ実装開始