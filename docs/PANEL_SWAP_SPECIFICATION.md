# パネル入れ替えシステム仕様書

## 🎯 概要
spine-editor-webappにおけるパネル入れ替え機能の正しい動作仕様

## 📐 基本原則

### 1. **空白ゼロ原則**
- 何もないエリアは絶対に作らない
- 空いた空間は隣接するパネルが自動的に拡張して埋める

### 2. **4つのドロップエリア**
各パネルには以下の4つのドロップエリアが存在する：
```
        ┌─ 上辺エリア ─┐
        │              │
 左辺エリア│   面エリア   │右辺エリア  
        │  （入れ替え）  │
        └─ 下辺エリア ─┘
```

### 3. **隣接チェック**
- 既に隣接しているエリアはハイライト不可
- 例：アウトライナーをプレビューに持っていく場合、左辺は無効

## 🔄 動作パターン（例：アウトライナー → プレビュー）

### デフォルト状態
```
┌─────────┬─────────┬─────────┐
│アウト   │プレビュー│プロパティ│
│ライナー │         │        │
├─────────┼─────────┼─────────┤
│      タイムライン            │
└─────────┴─────────┴─────────┘
```

### パターン1: 面エリア（入れ替え）
```
┌─────────┬─────────┬─────────┐
│プレビュー│アウト   │プロパティ│
│         │ライナー │        │
├─────────┼─────────┼─────────┤
│      タイムライン            │
└─────────┴─────────┴─────────┘
```

### パターン2: 右辺エリア
```
┌─────────────────┬─────────┬─────────┐
│プレビュー        │アウト   │プロパティ│
│（左に拡張）       │ライナー │        │
├─────────────────┼─────────┼─────────┤
│      タイムライン            │
└─────────────────┴─────────┴─────────┘
```
- プレビューが左に拡張してアウトライナーの元エリアを埋める

### パターン3: 上辺エリア
```
┌─────────────────┬─────────┐
│アウトライナー     │プロパティ│
│（横に拡張）       │        │
├─────────────────┤        │
│プレビュー        │        │
│（横に拡張）       │        │
├─────────────────┼─────────┤
│タイムライン（横長・デフォルト） │
└─────────────────────────────┘
```
- 左側エリアをアウトライナーとプレビューで上下2分割
- プロパティは縦長のまま（変化なし）
- タイムラインは横長のまま（変化なし）

### パターン4: 下辺エリア
```
┌─────────────────┬─────────┐
│プレビュー        │プロパティ│
│（横に拡張）       │        │
├─────────────────┤        │
│アウトライナー     │        │
│（横に拡張）       │        │
├─────────────────┼─────────┤
│タイムライン（横長・デフォルト） │
└─────────────────────────────┘
```
- 上辺エリアと同じ原理（上下の位置が逆）

## 🎯 実装ポイント

### ドロップエリア判定
1. **マウス位置から対象パネルを特定**
2. **パネル内の4つのエリアを判定**
   - 左辺：パネル幅の左20%
   - 右辺：パネル幅の右20%  
   - 上辺：パネル高さの上20%
   - 下辺：パネル高さの下20%
   - 面エリア：中央60% × 60%の領域
3. **隣接チェックで無効エリアを除外**

### レイアウト更新
1. **CSS Gridテンプレートの動的生成**
2. **パネル要素のgrid-area設定更新**
3. **自動拡張による空白埋め**

## 📋 技術仕様

### 必要なCSS Grid設定
- `grid-template-areas`: 動的に生成
- `grid-template-columns`: パネル幅に応じて調整
- `grid-template-rows`: パネル高さに応じて調整

### 状態管理
- パネル配置状態のlocalStorage保存
- ページリロード時の状態復元

---

**作成日**: 2025-09-10  
**バージョン**: 1.0  
**更新履歴**: 初版作成