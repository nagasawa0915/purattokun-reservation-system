# マイクロモジュール設計思想 v2.0
## 実用的AIプログラミング向け設計

**作成日**: 2025-08-25  
**背景**: AIプログラミングでの移植問題を解決しつつ、実用性を確保  
**最新版**: 🆕 [v3.0 ハイブリッド設計](./マイクロモジュール設計思想v3-ハイブリッド.md) が利用可能です

---

## 🎯 設計思想の進化

### v1.0の問題点（過度な分離）
- **外部依存ゼロの弊害**: 機能実現のための複雑な通信が必要
- **単一責務の限界**: UIとロジックの分離が非実用的
- **移植時の新たな問題**: モジュール間通信の再実装が必要

### v2.0の解決策（適度な統合）
- **機能単位モジュール**: 1つの実用機能を1モジュールで完結
- **内部結合許可**: モジュール内での密結合を許可
- **外部独立維持**: 他システムからの独立性は維持

---

## 📐 新設計原則

### 1. 機能単位モジュール設計
**定義**: ユーザーが使う1つの機能を1モジュールで完結させる

```javascript
// ✅ 良い例：機能として完結
class PureSpineEditor {
    // Spine表示 + 編集 + 保存を統合
    // ユーザーは「Spine編集機能」として認識
}

// ❌ 悪い例：過度な分離
class PureSpineLoader {}     // 読み込みだけ
class PureBoundingBox {}     // 表示だけ
class PurePositionSync {}    // 同期だけ
// → 3つ組み合わせないと機能しない
```

### 2. 依存関係の判断基準

#### 🟢 統合すべき（内部結合OK）
- **リアルタイム同期が必要**: UIとデータの即座反映
- **状態共有が必要**: 複数機能が同じデータを操作
- **ユーザー体験の一体性**: ドラッグ→移動のような直感的操作

#### 🔴 分離すべき（外部独立）
- **独立して価値がある**: 座標計算、ファイル操作など
- **複数箇所で再利用**: 汎用的なユーティリティ
- **異なる責務領域**: 描画とストレージなど

### 3. 行数制限ガイドライン
- **基本モジュール**: 300-500行（単機能）
- **統合モジュール**: 500-800行（複合機能）
- **上限**: 1,000行（これ以上は分割検討）

---

## 🏗️ モジュール分類

### 📦 Type A: 基礎モジュール（300-500行）
**特徴**: 単一機能・他モジュールから利用される

| モジュール | 行数 | 責務 | 依存 |
|-----------|------|------|------|
| PurePositionManager | 309行 | 座標計算専用 | なし |
| PureStorageManager | ~400行 | データ永続化専用 | なし |
| PureExportManager | ~400行 | ファイル出力専用 | なし |

### 🎯 Type B: 機能モジュール（500-800行）
**特徴**: 実用機能を統合・ユーザーが直接使う

| モジュール | 行数 | 統合機能 | 内部結合 |
|-----------|------|---------|----------|
| PureSpineEditor | ~700行 | Spine読込+編集+位置同期 | 密 |
| PureTimelineEditor | ~800行 | タイムライン+再生+編集 | 密 |
| PurePackageExporter | ~600行 | 検証+圧縮+出力 | 中 |

### 🔧 Type C: システムモジュール（800-1,000行）
**特徴**: 複数モジュールを統合制御

| モジュール | 行数 | 制御対象 | 役割 |
|-----------|------|---------|------|
| PureProjectManager | ~900行 | 全モジュール | プロジェクト管理 |
| PureApplicationCore | ~1,000行 | システム全体 | 初期化・状態管理 |

---

## 📁 推奨フォルダ構成

```
/micromodules/
├── core/                    # Type A: 基礎モジュール
│   ├── PurePositionManager.js
│   ├── PureStorageManager.js
│   └── PureExportManager.js
│
├── features/                # Type B: 機能モジュール
│   ├── PureSpineEditor.js
│   ├── PureTimelineEditor.js
│   └── PurePackageExporter.js
│
├── system/                  # Type C: システムモジュール
│   ├── PureProjectManager.js
│   └── PureApplicationCore.js
│
└── experimental/            # 実験中モジュール
    ├── PureSpineLoader.js   # v1.0実験（参考用）
    └── PureBoundingBox.js   # v1.0実験（参考用）
```

---

## 🚀 実装優先順位

### Phase 1: 基礎確立（実装済み）
- ✅ PurePositionManager（座標計算）

### Phase 2: 実用機能（次期実装）
- 🔄 **PureSpineEditor**（Spine編集統合）← 現在ここ
- ⏳ PureStorageManager（データ永続化）

### Phase 3: 高度機能
- ⏳ PureTimelineEditor（タイムライン制御）
- ⏳ PurePackageExporter（パッケージ出力）

### Phase 4: 統合制御
- ⏳ PureProjectManager（プロジェクト管理）
- ⏳ PureApplicationCore（アプリケーション制御）

---

## ✅ 移植性チェックリスト

### モジュール作成時の確認項目
- [ ] 外部システムへの依存なし
- [ ] グローバル変数の使用なし
- [ ] cleanup()で完全復元可能
- [ ] 単独テスト機能あり
- [ ] 機能として完結している
- [ ] 1,000行以内に収まっている

### AIプログラミング対策
- [ ] 環境依存コードの排除
- [ ] 明示的な依存関係宣言
- [ ] エラーハンドリング完備
- [ ] フォールバック機能

---

## 📊 設計効果測定

### 成功指標
- **移植成功率**: 90%以上（1ファイルコピーで動作）
- **開発速度**: v1.0比 2倍向上（統合による簡略化）
- **保守性**: バグ修正時間 50%削減（適切な粒度）
- **可読性**: 1モジュール = 1機能の明確性

### 失敗指標（これが起きたら設計見直し）
- 1,000行を超えるモジュールの頻発
- モジュール間の複雑な依存関係
- 移植時の動作不良
- 機能追加時の既存機能への影響

---

## 🎯 次期実装: PureSpineEditor

### 設計仕様
```javascript
class PureSpineEditor {
    // 統合機能
    - Spine読み込み（簡略版）
    - バウンディングボックス表示
    - ドラッグ操作 → Spine位置更新
    - リサイズ操作 → Spineスケール更新
    - 状態保存・復元
    
    // 目標仕様
    - 行数: 700行以内
    - 依存: Spine WebGLのみ
    - 移植: 1ファイルで完結
}
```

---

**v2.0結論**: 実用性と移植性のバランスを重視した「機能単位モジュール」設計  
**キーワード**: 適度な統合・内部結合許可・外部独立維持・AIプログラミング最適化