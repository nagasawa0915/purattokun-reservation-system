# 🎯 Spine SkeletonBounds 境界ボックス認識システム使用ガイド

## 📋 概要

Spine WebGL公式の**spine.SkeletonBounds**を使用した正確な境界ボックス検出システムが実装されました。これにより、Spineエディターで作成した境界ボックスが完全に認識・活用できます。

### 🚀 実装された機能

1. **公式API使用**: spine.SkeletonBounds による正確な境界ボックス検出
2. **部位別クリック検出**: 頭部、胸部、手部、足部などの個別認識
3. **部位別アニメーション**: 部位に応じたアニメーション自動実行
4. **座標変換システム**: Canvas DOM座標 → Spine内部座標の正確な変換
5. **デバッグ・可視化**: 境界ボックスの視覚表示とリアルタイム座標表示
6. **既存システム統合**: 2キャラクター対応、編集モード併用

---

## 🎮 基本的な使い方

### サーバー起動

```bash
python server.py
```

### アクセス方法

```
http://localhost:8000/index.html
```

### 境界ボックス機能の動作確認

1. **キャラクターをクリック**: ぷらっとくんやねずみをクリック
2. **部位別反応**: 頭部、胸部、手部、足部で異なるアニメーション
3. **コンソール確認**: F12でクリック検出情報を確認

---

## 🛠️ デバッグ・開発用コマンド

### ブラウザコンソール（F12）で使用可能

```javascript
// 境界ボックスのデバッグ表示ON/OFF
toggleBoundsDebug()

// 特定キャラクターの境界ボックス情報を表示
showBoundsInfo('purattokun')  // ぷらっとくんの場合
showBoundsInfo('nezumi')      // ねずみの場合

// 全キャラクターの境界ボックスを更新
updateAllBounds()
```

### デバッグ表示機能

- **赤い境界線**: 境界ボックスの輪郭
- **テキスト表示**: 境界ボックスの名前
- **黄い点**: 最後にクリックした座標

---

## 🔧 技術仕様

### 対応している部位名パターン

| 部位名パターン | アニメーション | 説明 |
|---------------|---------------|------|
| `head`, `atama`, `face` | `yarare` | 頭部・顔部分 |
| `chest`, `mune`, `body` | `yarare` | 胸部・体部分 |
| `hand`, `te`, `arm` | `yarare` | 手部・腕部分 |
| `foot`, `ashi`, `leg` | `yarare` | 足部・脚部分 |
| その他 | `yarare` | デフォルトアニメーション |

### 座標変換仕様

```javascript
// Canvas DOM座標 → Spine内部座標
const spineCoords = canvasToSpineCoords(characterName, canvasX, canvasY);

// 境界ボックス判定
const hitResult = checkBoundsHit(characterName, canvasX, canvasY);
```

### エラーハンドリング

- **境界ボックス未定義時**: デフォルトクリック処理にフォールバック
- **座標変換エラー**: ログ出力とnull返却
- **アニメーション失敗**: idleアニメーションへのフォールバック

---

## 📁 ファイル構成

```
/mnt/d/クラウドパートナーHP/
├── assets/spine/
│   └── spine-skeleton-bounds.js     # 核心システム
├── spine-bounds-integration.js      # index.html統合マネージャー
├── index.html                       # 統合済みメインファイル
└── docs/
    └── SKELETON_BOUNDS_USAGE_GUIDE.md  # このドキュメント
```

---

## 🎯 使用例

### 1. 基本的な部位クリック

```
1. サイトアクセス
2. ぷらっとくんの頭をクリック → やられアニメーション実行
3. ねずみの体をクリック → やられアニメーション実行
```

### 2. デバッグモード使用

```javascript
// F12コンソールで実行
toggleBoundsDebug()  // デバッグ表示ON
// キャラクターをクリック → 境界ボックスが赤い線で表示される
```

### 3. 境界ボックス情報の確認

```javascript
showBoundsInfo('purattokun')
// コンソールに詳細な境界ボックス情報が表示される
```

---

## 🚨 トラブルシューティング

### 境界ボックスが動作しない

1. **Spineファイル確認**: `.json`ファイルにBounding Boxアタッチメントが含まれているか
2. **コンソールエラー**: F12でエラーメッセージを確認
3. **デバッグモード**: `toggleBoundsDebug()`で境界ボックスが表示されるか確認

### クリックが反応しない

1. **Canvas要素**: Canvas要素が正しく配置されているか
2. **ポインターイベント**: `pointer-events: auto`が設定されているか
3. **座標変換**: 座標変換が正しく動作しているか確認

### パフォーマンス問題

1. **デバッグモード**: 本番環境では`toggleBoundsDebug()`でOFFに
2. **更新頻度**: 必要以上に`updateAllBounds()`を呼ばない
3. **境界ボックス数**: 大量の境界ボックスを避ける

---

## 📈 パフォーマンス最適化

### 推奨設定

- **リアルタイム更新**: アニメーションフレームごとに自動更新
- **キャッシュ利用**: 境界ボックス計算結果をキャッシュ
- **座標変換最適化**: 必要時のみ座標変換を実行

### メモリ管理

- **クリーンアップ**: ページ離脱時に`cleanup()`を実行
- **参照削除**: 不要なイベントリスナー削除
- **デバッグCanvas**: デバッグ終了時に自動削除

---

## 🔄 既存システムとの互換性

### 編集モードとの併用

```
http://localhost:8000/index.html?edit=true
```

編集モード起動時も境界ボックス機能は継続動作します。

### 従来クリック機能

境界ボックス検出に失敗した場合、従来のクリック処理が自動実行されます。

---

## 🎉 実装完了

**Spine WebGL公式のSkeletonBoundsを使用した境界ボックス認識システムが完全に実装されました！**

- ✅ 公式API使用による正確な境界ボックス検出
- ✅ 部位別クリック検出とアニメーション実行
- ✅ 座標変換システムの完全実装
- ✅ デバッグ・可視化機能
- ✅ 既存システムとの完全統合
- ✅ エラーハンドリングとフォールバック機能

システムは準備完了です。お楽しみください！