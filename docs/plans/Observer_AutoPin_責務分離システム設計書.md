# Observer+AutoPinè²¬å‹™åˆ†é›¢ã‚·ã‚¹ãƒ†ãƒ  è¨­è¨ˆæ›¸ãƒ»å®Ÿè£…ãƒ—ãƒ©ãƒ³

**ä½œæˆæ—¥**: 2025-09-08  
**ç›®çš„**: ç¾åœ¨ã®PureBoundingBoxAutoPin(710è¡Œ)ã®è¤‡é›‘åŒ–å•é¡Œã‚’ã€è²¬å‹™åˆ†é›¢ã«ã‚ˆã‚Šæ ¹æœ¬çš„ã«è§£æ±º

---

## 1. ğŸ¯ ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

### ç¾åœ¨ã®å•é¡Œ
- **PureBoundingBoxAutoPin**: 710è¡Œã®è¤‡é›‘ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
- **95%åº§æ¨™æ··å…¥å•é¡Œ**: ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºæ™‚ã®BBæ¯”ç‡å¤‰å‹•ãŒæœªè§£æ±º
- **è¤‡é›‘åŒ–**: é¸æŠUI + åº§æ¨™è¨ˆç®— + ä¿å­˜ã‚·ã‚¹ãƒ†ãƒ ãŒæ··åœ¨

### æ–°ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
**è²¬å‹™åˆ†é›¢ã«ã‚ˆã‚‹æ ¹æœ¬çš„è§£æ±º**: 
```
PureBoundingBoxAutoPin â†’ ã€Œé¸æŠUIå°‚ç”¨ã€ã«ç‰¹åŒ–ï¼ˆè»½é‡åŒ–ï¼‰
         â†“
    PinContractï¼ˆå¥‘ç´„æƒ…å ±ï¼‰
         â†“  
Observer â†’ ã€Œæ­£è¦åŒ–ãƒ»åº§æ¨™è¨ˆç®—å°‚ç”¨ã€ã«ç‰¹åŒ–ï¼ˆé«˜ç²¾åº¦ï¼‰
         â†“
    Spineé…ç½®ã‚·ã‚¹ãƒ†ãƒ 
```

---

## 2. ğŸ”§ è²¬å‹™åˆ†é›¢è¨­è¨ˆ

### 2.1 AutoPinï¼ˆé¸æŠUIç‰¹åŒ–ï¼‰
**ã‚„ã‚‹ã“ã¨:**
- âœ… ã‚¯ãƒªãƒƒã‚¯/å³ã‚¯ãƒªãƒƒã‚¯/ãƒ‰ãƒ©ãƒƒã‚°ã§åŸºæº–è¦ç´ æ±ºå®š
- âœ… ã‚¢ãƒ³ã‚«ãƒ¼ç¨®é¡ï¼ˆblock/inline/markerï¼‰ã¨9ã‚¢ãƒ³ã‚«ãƒ¼é¸æŠ
- âœ… è«–ç†åº§æ¨™ã§ã®åŸºæº–ç‚¹ä¿å­˜
- âœ… PinContractç”Ÿæˆãƒ»Observerã¸æ¸¡ã—

**ã‚„ã‚‰ãªã„ã“ã¨:**
- âŒ ã‚¹ã‚±ãƒ¼ãƒ«ãƒ»pxå€¤ã®å›ºå®šä¿å­˜ï¼ˆãƒªã‚µã‚¤ã‚ºã§ç ´ç¶»ã™ã‚‹ãŸã‚ï¼‰
- âŒ transform: scale()ç­‰ã®è¦‹ãŸç›®èª¿æ•´ï¼ˆObserverã«ä¸€å…ƒåŒ–ï¼‰
- âŒ è¤‡é›‘ãªåº§æ¨™è¨ˆç®—ï¼ˆObserverã®å°‚é–€é ˜åŸŸï¼‰

### 2.2 Observerï¼ˆæ­£è¦åŒ–ãƒ»è¨ˆç®—ç‰¹åŒ–ï¼‰
**ã‚„ã‚‹ã“ã¨:**
- âœ… PinContractã‚’å—ä¿¡ãƒ»è§£é‡ˆ
- âœ… ResizeObserver + MutationObserver + window resizeç›£è¦–
- âœ… object-fit/positionå®Œå…¨å¯¾å¿œ
- âœ… DPR/ã‚ºãƒ¼ãƒ è£œæ­£
- âœ… rAFã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°ï¼ˆ1ãƒ•ãƒ¬ãƒ¼ãƒ 1å›æ›´æ–°ï¼‰
- âœ… è«–ç†åº§æ¨™â†’å®Ÿãƒ”ã‚¯ã‚»ãƒ«å¤‰æ›ãƒ»Spineé…ç½®ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›

**å‡ºåŠ›ä¿è¨¼:**
- âœ… CSS pxãƒ™ãƒ¼ã‚¹çµ±ä¸€å‡ºåŠ›
- âœ… Â±0.5pxä»¥å†…ã®ç²¾åº¦
- âœ… content-boxåŸºæº–ã§ã®æ­£è¦åŒ–

---

## 3. ğŸ“‹ æŠ€è¡“ä»•æ§˜

### 3.1 PinContractï¼ˆå¥‘ç´„æƒ…å ±ï¼‰
```typescript
type AnchorKind = "block" | "inline-end" | "inline-start" | "marker";

type PinContract = {
  refElement: HTMLElement;          // åŸºæº–è¦ç´ ï¼ˆimg/div/h2/spanç­‰ï¼‰
  logicalSize: { w: number; h: number }; // è«–ç†åº§æ¨™ï¼ˆä¾‹:600Ã—400ï¼‰
  anchorKind: AnchorKind;           // å–ã‚Šæ–¹æŒ‡å®š
  at?: { x: number; y: number };    // è«–ç†åº§æ¨™ä¸Šã®ç‹™ã„ç‚¹
  align?: "LT"|"TC"|"RT"|"LC"|"CC"|"RC"|"LB"|"BC"|"RB"; // 9ã‚¢ãƒ³ã‚«ãƒ¼
  fit?: "contain"|"cover"|"fill"|"none"; // object-fitç›¸å½“
  objectPosition?: string;          // "50% 50%" ç­‰
  scaleMode?: "container"|"typography"; // ã‚¹ã‚±ãƒ¼ãƒ«åŸºæº–
  baseFontPx?: number;              // typographyç”¨åŸºæº–ãƒ•ã‚©ãƒ³ãƒˆ
};
```

### 3.2 Observer API
```typescript
export interface ObserveTarget {
  element: HTMLElement;
  logicalSize: LogicalSize;
  anchors?: Record<string, Anchor>;
  fit?: FitMode;
  box?: BoxMode;
  onUpdate: (u: UpdatePayload) => void;
}

export interface UpdatePayload {
  scaleX: number; scaleY: number;   // è«–ç†â†’å®Ÿã®å€ç‡
  offsetX: number; offsetY: number; // ã‚³ãƒ³ãƒ†ãƒŠåŸç‚¹ã‹ã‚‰ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆ
  width: number; height: number;    // contentå®Ÿå¯¸ï¼ˆpxï¼‰
  dpr: number;                      // devicePixelRatio
  resolve(anchor: Anchor): { x: number; y: number }; // å®Ÿpxåº§æ¨™å¤‰æ›
}

export function register(target: ObserveTarget): Unregister;
```

---

## 4. ğŸš€ å®Ÿè£…ãƒ—ãƒ©ãƒ³ï¼ˆæ®µéšåˆ¥ï¼‰

### Phase 0: åŸºç›¤ã‚¹ãƒ‘ã‚¤ã‚¯å®Ÿè£…ï¼ˆğŸ†• å¾®èª¿æ•´ææ¡ˆåæ˜ ï¼‰
**ç›®æ¨™**: å¾Œå·¥ç¨‹ã®æˆåŠŸç‡ã‚’ä¸Šã’ã‚‹2ã¤ã®æ ¸å¿ƒæ©Ÿèƒ½ã‚’å…ˆè¡Œç¢ºå®š

#### 4.0.1 resolveFittedContentå˜ä½“å®Ÿè£…ãƒ»ãƒ†ã‚¹ãƒˆ
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `micromodules/observer/utils/resolveFittedContent.js`
- **æ©Ÿèƒ½**: object-fit/positionä½™ç™½è£œæ­£ã®å®Œå…¨å®Ÿè£…
- **ãƒ†ã‚¹ãƒˆ**: contain/cover/fill/none Ã— object-position 0/50/100%
- **é‡è¦æ€§**: ã“ã“ãŒå¤–ã‚Œã‚‹ã¨å¾Œå·¥ç¨‹ãŒå…¨éƒ¨ãƒ–ãƒ¬ã‚‹
- **å·¥æ•°**: 0.3æ—¥

#### 4.0.2 findContainerå˜ä½“å®Ÿè£…ãƒ»ãƒ†ã‚¹ãƒˆ  
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `micromodules/observer/utils/findContainer.js`
- **æ©Ÿèƒ½**: åŸç‚¹ã‚³ãƒ³ãƒ†ãƒŠæ±ºå®šï¼ˆæœ€è¿‘æ¥positionedç¥–å…ˆ or bodyï¼‰
- **ãƒ†ã‚¹ãƒˆ**: è¤‡é›‘ãªãƒã‚¹ãƒˆæ§‹é€ ã§ã®æ­£ç¢ºãªåŸç‚¹å–å¾—
- **é‡è¦æ€§**: åº§æ¨™è¨ˆç®—ã®åŸºæº–ç‚¹æ±ºå®š
- **å·¥æ•°**: 0.2æ—¥

### Phase 1: åŸºç›¤ã‚·ã‚¹ãƒ†ãƒ æ§‹ç¯‰
**ç›®æ¨™**: Observeræ ¸å¿ƒæ©Ÿèƒ½å®Œæˆãƒ»åŸºæœ¬ãƒ†ã‚¹ãƒˆé€šé

#### 4.1.1 TypeScriptå‹å®šç¾©ä½œæˆ
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `micromodules/observer/types.ts`
- **å†…å®¹**: PinContract, AnchorKind, ObserveTarget, UpdatePayload
- **å·¥æ•°**: 0.5æ—¥

#### 4.1.2 Observeræ ¸å¿ƒãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè£…  
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `micromodules/observer/AutoPinObserver.js`
- **æ©Ÿèƒ½**: register(), Phase 0æˆæœç‰©çµ±åˆã€rAFã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°
- **é‡ç‚¹**: ResizeObserver/MutationObserver/window resizeçµ±åˆã€DPRè£œæ­£
- **å·¥æ•°**: 2æ—¥

#### 4.1.3 åŸºæœ¬ãƒ†ã‚¹ãƒˆç’°å¢ƒæ§‹ç¯‰
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `test-observer-basic.html`
- **ãƒ†ã‚¹ãƒˆå†…å®¹**: 
  - ç”»åƒ%å¹…ãƒ»containã§å·¦å³ä½™ç™½ã‚ã‚Š â†’ å³ä¸‹ã‚¢ãƒ³ã‚«ãƒ¼å›ºå®š
  - ã‚ºãƒ¼ãƒ 50-200%ãƒ»DPR1/2/3ã§Â±0.5pxä»¥å†…
- **å·¥æ•°**: 1æ—¥

#### ğŸ¯ Phase 1 DoDï¼ˆå®Œäº†æ¡ä»¶ãƒ»æ˜æ–‡åŒ–ï¼‰
- [ ] **APIå®Œå…¨æ€§**: scaleX/scaleY/offsetX/offsetY/resolve()ã‚’æ­£ç¢ºã«è¿”ã™
- [ ] **ç’°å¢ƒå¯¾å¿œ**: DPR/ã‚ºãƒ¼ãƒ ãƒ»srcset/sizesãƒ»è¦ªtransform:scale()ã§ä¸€è²«å‹•ä½œ
- [ ] **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: rAFã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°ï¼ˆ1ãƒ•ãƒ¬ãƒ¼ãƒ 1å›ï¼‰ã€ã‚¤ãƒ™ãƒ³ãƒˆåˆæµï¼ˆRO/MO/resize/fontsï¼‰
- [ ] **ã‚«ãƒãƒ¬ãƒƒã‚¸**: contain/cover/fill/none + object-position(0/50/100%)å®Œå…¨å¯¾å¿œ

### Phase 2: AutoPiné¸æŠUIç‰¹åŒ–
**ç›®æ¨™**: æ—¢å­˜AutoPinæ©Ÿèƒ½ã®ã‚·ãƒ³ãƒ—ãƒ«åŒ–ãƒ»Contractç”Ÿæˆ

#### 4.2.1 Contractä»•æ§˜å›ºå®šï¼ˆğŸ†• å¾®èª¿æ•´ææ¡ˆåæ˜ ï¼‰
- **ä»•æ§˜ç¢ºå®š**: `PinContract = { refElement, logicalSize, anchorKind, align(9ç‚¹), fit, objectPosition, scaleMode, baseFontPx }`
- **é‡è¦æ–¹é‡**: AutoPinã¯**æ•°å€¤ä¿å­˜ã§ã¯ãªãContractä¿å­˜**ã«å¾¹ã™ã‚‹ï¼ˆæ¯”ç‡ç ´ç¶»é˜²æ­¢ï¼‰
- **å·¥æ•°**: 0.2æ—¥

#### 4.2.2 AutoPiné¸æŠUIç‰¹åŒ–ç‰ˆå®Ÿè£…
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `micromodules/autopin/AutoPinSelector.js`
- **æ©Ÿèƒ½**: è¦ç´ é¸æŠã€ã‚¢ãƒ³ã‚«ãƒ¼é¸æŠã€Contractç”Ÿæˆ
- **æ—¢å­˜**: PureBoundingBoxAutoPin.jsã‹ã‚‰é¸æŠUIéƒ¨åˆ†ã‚’æŠ½å‡ºãƒ»è»½é‡åŒ–
- **ç›®æ¨™è¡Œæ•°**: 200è¡Œä»¥å†…ï¼ˆæ—¢å­˜710è¡Œã‹ã‚‰å¤§å¹…å‰Šæ¸›ï¼‰
- **å·¥æ•°**: 1.3æ—¥

#### 4.2.3 Contractå¤‰æ›ã‚·ã‚¹ãƒ†ãƒ 
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `micromodules/autopin/ContractGenerator.js`  
- **æ©Ÿèƒ½**: AutoPiné¸æŠçµæœ â†’ PinContractå¤‰æ›
- **å·¥æ•°**: 0.5æ—¥

#### ğŸ¯ Phase 2 DoDï¼ˆå®Œäº†æ¡ä»¶ãƒ»æ˜æ–‡åŒ–ï¼‰
- [ ] **Contractå®Œå…¨æ€§**: å…¨å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆrefElement, logicalSize, anchorKind, alignï¼‰ã®ç”Ÿæˆ
- [ ] **æ•°å€¤éä¿å­˜**: pxå€¤ãƒ»æ¯”ç‡ã®å›ºå®šå€¤ä¿å­˜ã‚’å®Œå…¨æ’é™¤
- [ ] **9ã‚¢ãƒ³ã‚«ãƒ¼å¯¾å¿œ**: LT/TC/RT/LC/CC/RC/LB/BC/RBé¸æŠã‚·ã‚¹ãƒ†ãƒ 
- [ ] **è»½é‡åŒ–**: æ—¢å­˜710è¡Œã‹ã‚‰200è¡Œä»¥å†…ã¸ã®å‰Šæ¸›é”æˆ

### Phase 3: ã‚·ã‚¹ãƒ†ãƒ çµ±åˆãƒ»ç·åˆãƒ†ã‚¹ãƒˆ
**ç›®æ¨™**: è²¬å‹™åˆ†é›¢ã‚·ã‚¹ãƒ†ãƒ ã®å®Œå…¨å‹•ä½œãƒ»æ—¢å­˜å•é¡Œè§£æ±ºç¢ºèª

#### 4.3.1 Spineçµ±åˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆå®Ÿè£…ï¼ˆğŸ†• å¾®èª¿æ•´ææ¡ˆåæ˜ ï¼‰
- **çµ±åˆé †åº**: `state.updateâ†’state.applyâ†’ï¼ˆã“ã“ã§scale/posï¼‰â†’updateWorldTransform()`
- **rootãƒœãƒ¼ãƒ³ç¢ºèª**: ã‚¹ã‚±ãƒ¼ãƒ«ã‚­ãƒ¼æœ‰ç„¡ã§ã®ä¸Šæ›¸ãæ¤œè¨¼
- **Canvas/WebGL**: DPRè¨­å®šã¨äºŒé‡ã‚¹ã‚±ãƒ¼ãƒ«ã®æ’é™¤
- **å·¥æ•°**: 0.5æ—¥

#### 4.3.2 çµ±åˆãƒ†ã‚¹ãƒˆç’°å¢ƒæ§‹ç¯‰
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `test-observer-autopin-integration.html`
- **ãƒ†ã‚¹ãƒˆå†…å®¹**:
  - è¦‹å‡ºã—H2ã®å³è‚© â†’ typographyç›¸å¯¾ã‚¹ã‚±ãƒ¼ãƒ«
  - æ®µè½æœ«å°¾è¿½å¾“ï¼ˆã‚¹ãƒãƒ›æ”¹è¡Œä½ç½®å¤‰åŒ–å¯¾å¿œï¼‰
  - ã‚µã‚¤ãƒ‰ãƒãƒ¼å›ã‚Šè¾¼ã¿ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¿½å¾“
- **å·¥æ•°**: 0.8æ—¥

#### 4.3.3 95%åº§æ¨™æ··å…¥å•é¡Œè§£æ±ºç¢ºèª
- **è¨ºæ–­**: æ–°ã‚·ã‚¹ãƒ†ãƒ ã§ã®åº§æ¨™ç´”åº¦100%é”æˆç¢ºèª
- **æ¯”è¼ƒ**: æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã¨ã®ç²¾åº¦ãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¯”è¼ƒ
- **å›å¸°ãƒ†ã‚¹ãƒˆ**: 95%å•é¡Œã®å†ç¾ã‚±ãƒ¼ã‚¹ã§å®Œå…¨è§£æ±ºç¢ºèª
- **å·¥æ•°**: 0.2æ—¥

#### ğŸ¯ Phase 3 DoDï¼ˆå®Œäº†æ¡ä»¶ãƒ»æ˜æ–‡åŒ–ï¼‰
- [ ] **Spineçµ±åˆ**: æ­£ã—ã„é©ç”¨é †åºãƒ»rootãƒœãƒ¼ãƒ³å¯¾å¿œãƒ»DPRäºŒé‡é©ç”¨å›é¿
- [ ] **æœ€å°ãƒ†ã‚¹ãƒˆãƒãƒˆãƒªã‚¯ã‚¹**: å˜ä½ç³»ï¼ˆ%/px/vw/vh/emï¼‰Ã—ç”»åƒï¼ˆcontain/cover/fill/noneï¼‰Ã—ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆè¦ªtransform/ã‚ºãƒ¼ãƒ /DPRï¼‰Ã—ãƒ†ã‚­ã‚¹ãƒˆï¼ˆinline-end/typographyï¼‰Ã—å¤‰æ›´ç³»ï¼ˆsrcset/ãƒ•ã‚©ãƒ³ãƒˆ/å›ã‚Šè¾¼ã¿ï¼‰å®Œå…¨é€šé
- [ ] **ç²¾åº¦ä¿è¨¼**: Â±0.5pxä»¥å†…ã®å…¨ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹é€šé
- [ ] **å•é¡Œè§£æ±º**: 95%åº§æ¨™æ··å…¥â†’100%åº§æ¨™ç´”åº¦é”æˆç¢ºèª

---

## 5. ğŸ§ª æœ€å°ãƒ†ã‚¹ãƒˆé …ç›®ï¼ˆå—ã‘å…¥ã‚ŒåŸºæº–ï¼‰

### 5.1 ç²¾åº¦ãƒ†ã‚¹ãƒˆ
- [ ] ã‚ºãƒ¼ãƒ ï¼ˆ50ã€œ200%ï¼‰ãƒ»DPRï¼ˆ1/2/3ï¼‰ã§Â±0.5pxä»¥å†…ã®èª¤å·®
- [ ] `img%å¹…`ã€èƒŒæ™¯`object-fit:contain/cover/fill`ã§ã‚ºãƒ¬ãªã—
- [ ] è¦ª`transform:scale()`é©ç”¨æ™‚ã®æ­£ç¢ºãªè£œæ­£

### 5.2 å‹•çš„å¯¾å¿œãƒ†ã‚¹ãƒˆ  
- [ ] `srcset/sizes`åˆ‡æ›¿ã§1ãƒ•ãƒ¬ãƒ¼ãƒ ä»¥å†…ã®æ­£ã—ã„å†é…ç½®
- [ ] CSSå·®ã—æ›¿ãˆï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ»ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ç­‰ï¼‰ã§ã®è¿½å¾“
- [ ] ãƒ•ã‚©ãƒ³ãƒˆèª­ã¿è¾¼ã¿å®Œäº†å¾Œã®å†è¨ˆæ¸¬

### 5.3 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
- [ ] 100è¦ç´ ç›£è¦–ã§60fpsã‚’ç¶­æŒ
- [ ] ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆå¤–è¦ç´ ã®æ›´æ–°åœæ­¢æ©Ÿèƒ½
- [ ] rAFã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°å‹•ä½œç¢ºèª

---

## 6. ğŸ“‚ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆï¼ˆäºˆå®šï¼‰

```
micromodules/
â”œâ”€â”€ observer/
â”‚   â”œâ”€â”€ types.ts                 # å‹å®šç¾©ï¼ˆPinContractç­‰ï¼‰
â”‚   â”œâ”€â”€ Observer.js              # æ ¸å¿ƒãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆ~500è¡Œï¼‰
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ resolveFittedContent.js
â”‚       â”œâ”€â”€ findContainer.js
â”‚       â””â”€â”€ getObjectPosition.js
â”œâ”€â”€ autopin/
â”‚   â”œâ”€â”€ AutoPinSelector.js       # é¸æŠUIç‰¹åŒ–ï¼ˆ~200è¡Œï¼‰
â”‚   â””â”€â”€ ContractGenerator.js     # Contractå¤‰æ›ï¼ˆ~100è¡Œï¼‰
â””â”€â”€ integration/
    â””â”€â”€ ObserverAutoPinBridge.js # çµ±åˆåˆ¶å¾¡ï¼ˆ~150è¡Œï¼‰

test-observer-basic.html          # ObserveråŸºæœ¬ãƒ†ã‚¹ãƒˆ
test-observer-autopin-integration.html # çµ±åˆãƒ†ã‚¹ãƒˆ
```

---

## 7. ğŸ¯ æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã¨ã®é–¢ä¿‚

### 7.1 æ®µéšçš„ç§»è¡Œæˆ¦ç•¥
1. **Phase 1-3**: æ–°ã‚·ã‚¹ãƒ†ãƒ ä¸¦è¡Œé–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆ
2. **Phase 4**: æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã¨ã®æ¯”è¼ƒãƒ»æ¤œè¨¼æœŸé–“
3. **Phase 5**: æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰ã®ç§»è¡Œãƒ»çµ±åˆ

### 7.2 æ—¢å­˜è³‡ç”£æ´»ç”¨
- **PureBoundingBoxUI.js**: å³ã‚¯ãƒªãƒƒã‚¯ãƒ¡ãƒ‹ãƒ¥ãƒ¼éƒ¨åˆ†ã‚’æµç”¨
- **test-bounding-box-autopin.html**: æ¯”è¼ƒãƒ†ã‚¹ãƒˆç”¨ã¨ã—ã¦ä¿æŒ
- **localStorageæ°¸ç¶šåŒ–**: æ–°ã‚·ã‚¹ãƒ†ãƒ ã§ã‚‚ç¶™æ‰¿

---

## 8. ğŸš¨ ãƒªã‚¹ã‚¯ãƒ»å¯¾ç­–

### 8.1 æŠ€è¡“ãƒªã‚¹ã‚¯
- **object-fitè¨ˆç®—è¤‡é›‘æ€§**: æ®µéšçš„å®Ÿè£…ãƒ»è©³ç´°ãƒ†ã‚¹ãƒˆã§å¯¾å¿œ
- **ãƒ–ãƒ©ã‚¦ã‚¶å·®ç•°**: Safariãƒ»Chromeãƒ»Firefoxæ¨ªæ–­ãƒ†ã‚¹ãƒˆå®Ÿæ–½
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: æ—©æœŸãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°ãƒ»æœ€é©åŒ–

### 8.2 ç§»è¡Œãƒªã‚¹ã‚¯  
- **æ—¢å­˜æ©Ÿèƒ½ç ´ç¶»**: ä¸¦è¡Œé–‹ç™ºæœŸé–“ã§ã®ååˆ†ãªæ¤œè¨¼
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“å¤‰åŒ–**: UIéƒ¨åˆ†ã¯æœ€å°é™å¤‰æ›´ã«æŠ‘åˆ¶

---

## 9. ğŸ“… é–‹ç™ºã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆğŸ†• å¾®èª¿æ•´ææ¡ˆåæ˜ ï¼‰

- **Phase 0**: 0.5æ—¥ï¼ˆåŸºç›¤ã‚¹ãƒ‘ã‚¤ã‚¯ãƒ»æˆåŠŸç‡å‘ä¸Šï¼‰
- **Phase 1**: 4æ—¥ï¼ˆåŸºç›¤ã‚·ã‚¹ãƒ†ãƒ ï¼‰
- **Phase 2**: 2æ—¥ï¼ˆAutoPinç‰¹åŒ–ï¼‰  
- **Phase 3**: 1.5æ—¥ï¼ˆçµ±åˆãƒ†ã‚¹ãƒˆï¼‰
- **äºˆå‚™**: 1æ—¥ï¼ˆèª¿æ•´ãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼‰
- **åˆè¨ˆ**: 9æ—¥

## 10. ğŸ§© ã™ãä½¿ãˆã‚‹æœ€å°çµ±åˆã‚³ãƒ¼ãƒ‰ï¼ˆå¿…è¦ç®‡æ‰€ã®ã¿ï¼‰

```javascript
// å—ã‘å–ã£ãŸ Contractï¼ˆAutoPinå‡ºåŠ›ï¼‰
const contract = /* PinContract */;
const unreg = observer.register({
  element: contract.refElement,
  logicalSize: contract.logicalSize,
  fit: contract.fit,
  onUpdate: ({ resolve, scaleX, scaleY }) => {
    const pin = resolve(anchorFromAlign(contract.align)); // 9ã‚¢ãƒ³ã‚«ãƒ¼â†’è«–ç†åº§æ¨™ç‚¹
    const s = contract.scaleMode === "typography"
      ? currentFontPx(contract.refElement) / (contract.baseFontPx ?? 16)
      : Math.min(scaleX, scaleY);

    state.update(dt);
    state.apply(skeleton);
    skeleton.scaleX = s; skeleton.scaleY = s;
    skeleton.x = pin.x;   skeleton.y = pin.y;
    skeleton.updateWorldTransform();
    renderer.draw(skeleton);
  }
});
```

---

**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—**: ã“ã®è¨­è¨ˆæ›¸ãƒ»ãƒ—ãƒ©ãƒ³ã§ã”æ‰¿èªã„ãŸã ã‘ã¾ã—ãŸã‚‰ã€Phase 1ã‹ã‚‰å®Ÿè£…é–‹å§‹ã„ãŸã—ã¾ã™ã€‚