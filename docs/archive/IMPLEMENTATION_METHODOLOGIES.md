# 実装方法論記録

**作成日**: 2025-09-04
**目的**: CLAUDE.mdから移動された実装手法・デバッグ方法の記録を保存

---

## 📋 段階的実装記録（2024年7月24日）

### 問題：白い果との動きの同期
**症状**: Canvas要素が`.hero-content`（白い果）と同じ動きをしてしまう

### 解決アプローチ：段階的モジュール化
❌ **避けた手法**: いきなりのフル構造変更（リスク大）  
✅ **採用した手法**: 段階的なモジュール化戦略（リスク分散）

#### Phase 1: 基盤構築（30分）
- `CanvasPositioningSystem`クラス作成
- JSON設定による配置管理システム
- **既存システム影響なし**

#### Phase 2: 段階的統合（15分）
- 既存`spine-character-manager.js`との統合
- フォールバック機能による安全性確保
- **既存機能完全保持**

#### Phase 3: 動作検証（完了）
- 新旧システムの並行動作確認
- ブラウザテストと調整機能確認

### 実装ルール（今後のガイドライン）
1. **最小変更の原則**: 問題解決に必要最小限の変更
2. **段階的実装**: 各段階でテスト・ロールバック準備
3. **フォールバック必須**: 新機能失敗時の安全機能
4. **ドキュメント化**: 解決プロセスの記録と予防策策定

### 将来拡張可能機能
- 動的キャラクター切り替え
- ページ遷移連動演出  
- 管理画面からの設定変更
- A/Bテスト対応

---

## 🌬 Spineアニメーション改良システム（2024年7月24日実装）

### アニメーションシーケンスの実装
ぷらっとくんのアニメーションを「登場→待機モーション」の自然な流れに改良しました。

#### 実装内容
- **syutugen（出現）**: キャラクターの登場アニメーション（1回のみ再生）
- **taiki（待機）**: アイドル状態のループアニメーション（無限ループ）
- **自動遷移**: syutugen完了後、自動的にtaikiに移行

#### 技術仕様
```javascript
// アニメーションシーケンスの開始
this.animationController.playSequence(name, ['syutugen', 'taiki']);

// Spine WebGL: AnimationState完了イベントで自動遷移
// Placeholder: タイマーベースで1秒後に遷移（1000ms）
```

#### クリック動作の変更
- **旧仕様**: クリック→click アニメーション→taiki復帰
- **更新仕様**:クリック→syutugen→taiki のフルシーケンス再生
- **最新仕様**: クリック→yarare（やられ）→taiki のダメージシーケンス再生

#### プレースホルダー対応
SpineWebGL読み込み失敗時もCSS keyframeアニメーションで同様の動作を実現：
- `placeholderAppear`: 出現アニメーション（1秒）
- `placeholderFloat`: 浮遊アニメーション（3秒ループ）

#### デバッグ確認方法
```javascript
// コンソールで確認できるログ
// "Playing syutugen (appearance) animation once for purattokun"
// "Syutugen animation completed, transitioning to taiki"
```

---

## 🎯 効果的なデバッグ手法：シンプルサンプル方式

### 実証済みの問題解決アプローチ
複雑な問題に対して「最小限のサンプルシーンを作成し、それに近づける」手法が非常に有効でした。

#### 成功事例：背景画像とSpineキャラクターの同期問題
1. **test-simple-spine.html** で最小限の成功パターンを作成
2. 成功パターンと本番コードの**構造的差異**を分析
3. 本番コードを成功パターンに段階的に近づける

#### この手法の利点
- **根本原因の特定**: 複雑な要因を排除して核心を見つける
- **安全な修正**: 成功パターンがあるため確実に動作する
- **学習効果**: 「なぜ動くのか」が明確になる
- **再現性**: 同様の問題に対して再利用可能

#### 適用すべき場面
- 複数要素が絡む位置ズレ問題
- レスポンシブ動作の不具合
- CSS/JavaScript統合の問題
- アニメーション同期の問題

#### 実装手順
1. **最小限のテストファイル作成** (`test-*.html`)
2. **成功パターンの確立** (動作することを確認)
3. **構造的差異の分析** (成功版 vs 本番版)
4. **段階的修正** (一つずつ差異を埋める)
5. **動作確認** (各段階でテスト実行)

**→ 今後の複雑な問題はこの手法を優先的に適用すること**

---

## 📝 開発時の注意事項

### 必須事項
- **HTTPサーバー必須**: file://プロトコルでは動作しません
- **ブラウザキャッシュ**: Spineファイル更新時は必ずハードリフレッシュ
- **F12コンソール**: エラー確認の習慣化

### パフォーマンス
- 画像遅延読み込み使用
- CSS Grid, Flexbox 使用
- モダンブラウザ対応（ES6+）

### デバッグ
- F12開発者ツールでコンソール確認
- 右上デバッグパネル（開発時のみ表示）
- レスポンシブ表示確認（デベロッパーツール）

---

**📝 注記**: このドキュメントは2025-09-04時点でCLAUDE.mdから移動された実装方法論の記録です。これらの手法は過去の成功事例として保存され、今後の開発においても有効な手法として参照できます。