# 🤖 サブエージェント完全ガイド

## 📚 このドキュメントについて

**目的**: Claude Code サブエージェントシステムの使い方と設定方法の完全ガイド  
**対象**: このプロジェクトを他の環境で使用する開発者  
**更新日**: 2025年1月29日

---

## 🎯 サブエージェントシステム概要

### 💡 サブエージェントとは

Claude Code の**専門特化型AI**です。特定のタスクに専念することで、より効率的で正確な作業を実現します。

#### ✅ **メリット**
- **専門知識**: 特定分野の深い知識とノウハウ
- **独立したコンテキスト**: メインの会話履歴に影響されない
- **並列実行**: 複数エージェントの同時利用可能
- **一貫性**: 同じ手順で確実な結果

#### 🔄 **通常AIとの違い**
| 項目 | 通常AI | サブエージェント |
|------|--------|----------------|
| 専門性 | 汎用的 | 特定分野に特化 |
| 手順 | 毎回異なる | 一定の手順を保持 |
| コンテキスト | 共有 | 独立 |
| 速度 | 状況による | 専門分野では高速 |

---

## 📁 ファイル構造と設置

### 🗂️ **ディレクトリ構造**
```
プロジェクトルート/
├── .claude/
│   ├── agents/
│   │   ├── trouble-diagnosis.md    # トラブル診断
│   │   ├── planning.md             # 作業計画  
│   │   ├── fast-fixer.md           # 高速修正
│   │   ├── careful-editor.md       # 慎重編集
│   │   └── review-first.md         # 設計レビュー
│   └── settings.local.json         # 権限設定
├── docs/
│   └── SUBAGENT_GUIDE.md           # このファイル
└── ...
```

### 📋 **設置手順**

#### Step 1: ディレクトリ作成
```bash
mkdir -p .claude/agents
```

#### Step 2: エージェントファイルを設置
このリポジトリの `.claude/agents/` フォルダを丸ごとコピー

#### Step 3: 権限設定確認
`.claude/settings.local.json` を確認（必要に応じて調整）

```json
{
  "permissions": {
    "allow": [
      "Bash(git add:*)",
      "Bash(git push:*)",
      "Bash(lsof:*)",
      "Bash(kill:*)",
      "Bash(find:*)",
      "Bash(curl:*)",
      "Bash(mkdir:*)",
      "Bash(mv:*)",
      "Bash(rm:*)",
      "Bash(ls:*)",
      "WebFetch(domain:docs.anthropic.com)"
    ],
    "deny": []
  }
}
```

---

## 🤖 エージェント詳細仕様

### 🔍 **1. トラブル診断エージェント**
**ファイル**: `trouble-diagnosis.md`  
**用途**: ぷらっとくん表示問題やSpine関連の診断

#### 📋 **専門分野**
- キャラクター表示問題
- 位置ずれ・レイアウト問題  
- Spine WebGL関連エラー
- Canvas操作問題
- 編集システム不具合

#### 🎯 **診断手順**
1. 既存トラブルシューティング文書の確認
2. 基本環境診断（サーバー・ファイル確認）
3. F12コンソールエラーチェック
4. 段階的動作確認
5. 既知パターンからの解決策適用

#### 💡 **使用例**
```
ユーザー: 「ぷらっとくんが表示されない」
Claude: トラブル診断エージェントを使用します
→ 体系的診断 → 既存事例照合 → 解決策提示
```

### 🧠 **2. 作業計画エージェント**
**ファイル**: `planning.md`  
**用途**: 複雑なタスクの計画立案（実装は行わない）

#### 📋 **専門分野**
- 要件分析と目標設定
- リスク評価と対策
- 段階的実装計画
- 他エージェントへの作業割り振り

#### 🎯 **計画手順**
1. 現状徹底調査（CLAUDE.md、docs/、既存コード）
2. 要件分析（真の目的・成功条件・制約）
3. リスク分析（高・中・低リスク分類）
4. 段階的計画（Phase1〜4に分割）

#### 💡 **使用例**
```
ユーザー: 「サイト全体をモバイル対応したい」
Claude: 作業計画エージェントを使用します
→ 現状分析 → 段階的計画 → 実装は他エージェントに委託
```

### ⚡ **3. 高速修正エージェント**
**ファイル**: `fast-fixer.md`  
**用途**: 明らかなバグの即座修正

#### 📋 **専門分野**
- シンタックスエラー修正
- 未定義変数エラー
- タイポ・誤字脱字
- コンソールログ追加/削除
- インデント修正

#### 🎯 **作業方針**
- 確認不要で即座実行
- 最小限の変更
- 既存機能に影響を与えない

#### 💡 **使用例**
```
ユーザー: 「コンソールにタイポエラーが出てる」
Claude: 高速修正エージェントを使用します
→ 即座修正 → 簡潔報告
```

### 🤝 **4. 慎重編集エージェント**
**ファイル**: `careful-editor.md`  
**用途**: 重要な変更を慎重に実行

#### 📋 **専門分野**
- ファイル構造変更
- 既存関数・クラス変更
- 設定ファイル変更
- 削除操作
- 大規模リファクタリング

#### 🎯 **作業方針**
- 全ての変更前に確認
- 影響範囲の詳細分析
- 段階的実装
- ロールバック方法の提示

#### 💡 **使用例**
```
ユーザー: 「docs/フォルダを整理してほしい」
Claude: 慎重編集エージェントを使用します
→ 整理計画提示 → 承認後段階的実行
```

### 📐 **5. 設計レビューエージェント**
**ファイル**: `review-first.md`  
**用途**: 新機能の設計検討

#### 📋 **専門分野**
- 新機能の要件確認
- 実装方法の比較検討
- 既存システムとの統合分析
- プラグイン vs 統合方式の判断

#### 🎯 **レビュープロセス**
1. 要件確認（何を作るか・実装規模）
2. 設計提案（選択肢・メリデメ・推奨案）
3. 影響分析（既存機能・パフォーマンス・保守性）
4. 実装計画（段階・確認ポイント・ロールバック）

#### 💡 **使用例**
```
ユーザー: 「キャラクター切り替え機能を追加したい」
Claude: 設計レビューエージェントを使用します
→ 要件確認 → 設計比較 → 推奨案提示 → 承認後実装
```

---

## 🚀 エージェント使用方法

### 📞 **呼び出し方法**

#### 1. **明示的指定**（推奨）
```
「トラブル診断エージェントを使って」
「作業計画エージェントで計画を立てて」
「高速修正エージェントで修正して」
```

#### 2. **Task tool使用**
```
> Use the トラブル診断 subagent
> Use the 作業計画 subagent
> Use the 高速修正 subagent
```

#### 3. **自動委託**
問題の内容に基づいてClaude Codeが自動選択

### 🎯 **使い分けガイド**

#### 🚨 **問題が起きた時**
```
表示されない・動かない → トラブル診断エージェント
```

#### 🧠 **複雑な作業を計画したい時**
```
大規模な変更・新機能 → 作業計画エージェント
```

#### ⚡ **明らかなバグがある時**
```
タイポ・エラー → 高速修正エージェント
```

#### 🤝 **重要なファイルを変更する時**
```
設定変更・削除 → 慎重編集エージェント
```

#### 📐 **新機能を作りたい時**
```
新しい機能追加 → 設計レビューエージェント
```

---

## 🛠️ カスタマイズ方法

### 📝 **エージェントファイル形式**

```markdown
---
name: エージェント名
description: いつ使うかの説明
tools: Read, Edit, Bash, Grep, LS
---

あなたは〜エージェントです。以下のルールに従って作業してください：

## 🚨 絶対禁止事項
- **既存の正しく動いている箇所には絶対に手をつけない**
- その他の制約

## 🎯 作業方針
- 具体的な方針

## 📋 作業手順
1. Step 1
2. Step 2
3. Step 3

## 💡 専門知識
- 専門分野の詳細なノウハウ
- 具体的なコマンド例
- よくある問題パターン
```

### 🔧 **新しいエージェント作成手順**

#### Step 1: ファイル作成
```bash
touch .claude/agents/new-agent.md
```

#### Step 2: YAML frontmatter設定
```yaml
---
name: 新エージェント名
description: 使用場面の説明
tools: 使用するツール一覧
---
```

#### Step 3: システムプロンプト記述
- 役割と責任を明確化
- 絶対禁止事項を必ず記載
- 具体的な手順を詳細に記述
- このプロジェクト固有の知識を盛り込む

#### Step 4: 動作テスト
```
「新エージェント名エージェントを使って」
```

### ⚙️ **既存エージェント修正**

#### 重要な注意点
- **既存の動作する部分は変更しない**
- 追加のみ推奨（削除・変更は慎重に）
- 変更後は必ず動作テスト

#### 修正例
```markdown
## 💡 新しい専門知識セクション
- 追加のノウハウ
- 新しいコマンド例
```

---

## 🌍 他環境での利用方法

### 📦 **移行手順**

#### Step 1: ファイルコピー
```bash
# このプロジェクトから
cp -r .claude/ /path/to/new/project/
cp docs/SUBAGENT_GUIDE.md /path/to/new/project/docs/
```

#### Step 2: プロジェクト固有設定の修正
各エージェントファイル内の以下を修正：

```markdown
## 🎯 特別な配慮事項
### このプロジェクト固有の注意点
- **Spine WebGL**: 複雑な技術、慎重な扱いが必要
- **編集システム**: 既に動作中、影響を与えない
- **1行追加**: ユーザーの強い要求、厳密に守る
- **docs/フォルダ**: 豊富な過去事例、必ず活用
- **レスポンシブ**: モバイル対応は複雑、段階的に
```

↓ 新プロジェクトの特徴に合わせて変更

#### Step 3: 参照ドキュメントの確認
```markdown
## 📚 問題解決時の必須参照文書
- docs/archive/CHARACTER_DISPLAY_TROUBLESHOOTING.md
- docs/archive/SPINE_TROUBLESHOOTING.md
- docs/_TROUBLESHOOTING.md（総合ガイド）
```

↓ 新プロジェクトのドキュメント構造に合わせて修正

#### Step 4: 動作テスト
新環境で各エージェントが正常に動作することを確認

### 🔄 **汎用化のポイント**

#### プロジェクト固有部分を分離
- ファイルパス
- 技術スタック
- 専門用語
- 既存ドキュメント参照

#### 汎用的な部分を保持
- 基本的な作業手順
- 安全制約（「既存機能を壊さない」等）
- エラー診断方法
- 段階的アプローチ

---

## 🚨 重要な注意事項

### ⚠️ **安全ガイドライン**

#### 全エージェント共通ルール
1. **既存の正しく動いている箇所には絶対に手をつけない**
2. 推測による修正は禁止
3. ユーザー確認なしの「解決済み」判断は禁止

#### 権限管理
- 高速修正：確認不要タスクのみ
- 慎重編集：確認必須タスク
- 設計レビュー：実装前の検討のみ
- 作業計画：計画立案のみ（実装禁止）

### 🔒 **セキュリティ**

#### ファイル権限
```bash
# .claude/agents/ は読み取り専用に設定推奨
chmod -R 644 .claude/agents/
```

#### 機密情報保護
- パスワード・APIキーは絶対に記載しない
- 機密性の高い設定ファイルは対象外
- 本番環境での実行時は特に注意

---

## 🔍 トラブルシューティング

### ❌ **エージェントが認識されない**

#### 原因と対策
1. **ファイル形式**: `.yml` ではなく `.md` を使用
2. **YAML形式**: frontmatter形式が正しいか確認
3. **ファイル位置**: `.claude/agents/` ディレクトリ内
4. **権限**: ファイルが読み取り可能か確認

### ❌ **エージェントが動作しない**

#### デバッグ手順
1. **ツール権限確認**: `settings.local.json` の確認
2. **構文エラー**: YAML frontmatterの構文確認
3. **名前重複**: 同名エージェントがないか確認
4. **Claude Code再起動**: セッションを一度終了

### ❌ **期待した動作をしない**

#### 改善方法
1. **説明文見直し**: descriptionを具体的に
2. **プロンプト強化**: システムプロンプトを詳細化
3. **使用例追加**: 具体的な使用例を記載
4. **制約明確化**: 禁止事項・注意事項を明記

---

## 📈 運用のベストプラクティス

### 🎯 **効果的な使い方**

#### エージェントの使い分け
```
簡単な問題 → 高速修正エージェント
複雑な問題 → トラブル診断エージェント → 他エージェントに委託
新機能 → 作業計画エージェント → 設計レビューエージェント → 実装
重要変更 → 慎重編集エージェント
```

#### 並列利用
```
大きなタスクの場合：
1. 作業計画エージェント（全体計画）
2. 複数の実装エージェント（並列実行）
3. レビューエージェント（品質確認）
```

### 📚 **継続的改善**

#### エージェントの育成
1. 新しい問題パターンをプロンプトに追加
2. 成功事例をノウハウとして蓄積
3. 失敗要因を制約として明記
4. プロジェクト特有の知識を拡充

#### パフォーマンス監視
- 解決時間の短縮効果
- エラー率の低下
- ユーザー満足度の向上
- 同じ問題の再発防止効果

---

## 🎉 まとめ

### ✅ **サブエージェントシステムの価値**

#### 開発効率の向上
- 専門知識による高速解決
- 一貫した品質保証
- 人的ミスの削減
- ナレッジの体系化

#### 保守性の向上
- 問題解決パターンの標準化
- ドキュメント化の促進
- 新メンバーの早期戦力化
- プロジェクト知識の継承

### 🔄 **継続的な価値創出**

このサブエージェントシステムは：
1. **学習する**: 新しい問題と解決策を蓄積
2. **進化する**: プロジェクトの成長に合わせて強化
3. **再利用できる**: 他のプロジェクトにも適用可能
4. **価値を創出し続ける**: 長期的な開発効率向上

---

## 📞 サポート

### 🆘 **問題が発生した場合**

1. **このドキュメントを確認**
2. **トラブルシューティングセクションを参照**
3. **元のプロジェクトの最新版を確認**
4. **必要に応じて専門家に相談**

### 🚀 **改善提案**

このシステムをより良くするための提案があれば：
- 新しいエージェントアイデア
- 既存エージェントの改善案
- ドキュメントの修正・追加
- 使用事例の共有

**継続的な改善により、より価値のあるシステムに育てていきましょう！**

---

**📝 最終更新**: 2025年1月29日  
**📊 エージェント数**: 5個  
**🎯 対応分野**: トラブル診断、作業計画、高速修正、慎重編集、設計レビュー