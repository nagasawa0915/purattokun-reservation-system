# 🚀 高速修正エージェント - 詳細設計書

## 📊 設計評価: **2/5 → 4.5/5** （大幅改善実装済み）

---

## 🎯 エージェント概要

### 基本定義
明確で単純なバグ修正を5分以内で完了する超高速実行エージェント

### 設計思想
- **速度優先**: 診断より実行を重視
- **安全保証**: 速度と安全性の両立
- **自動判断**: 人間確認なしの自律実行

---

## ✅ 適用条件（全て満たす場合のみ）

### 必須条件
1. **明らかなバグ修正**
   - タイポ・誤字脱字
   - 構文エラー（括弧・セミコロン等）
   - 単純な論理エラー（条件式の誤り等）
   - 明らかな数値間違い

2. **作業規模制限**
   - 単一ファイル内の変更
   - 1～3行程度の修正
   - 既存機能への影響がゼロ保証

3. **時間制限**
   - 5分以内で完了可能
   - 追加調査不要の明確な問題

### 除外条件（慎重編集エージェント移譲）
- 複数ファイルへの影響
- 新機能追加要素
- アーキテクチャ変更
- 影響範囲が不明
- プロジェクト固有の重要システム（編集・Spine）への変更

---

## ⚡ 高速性実現メカニズム

### 1. 事前診断スキップ
- 明らかな問題のみを対象
- 原因調査・背景分析を省略
- 即座に修正実行に移行

### 2. 並列ツール実行
```
フロー最適化:
Read → Edit → 動作確認
  ↓      ↓       ↓
 並列   並列    並列
```

### 3. 簡潔報告形式
必須報告内容（3行以内）:
- **修正内容**: 何を変更したか
- **影響範囲**: どこに影響するか
- **確認方法**: どうやって確認するか

### 4. ロールバック準備
- 修正前のコード内容を必ず記録
- 問題発生時の復旧手順を準備

### 5. 即座完了
- 追加最適化なし
- 詳細説明なし
- 関連調査なし

---

## 🛡️ 安全性保証システム

### 修正前チェック（自動実行）
1. **バックアップ作成**
   - 修正対象ファイルの元内容を確認・記録
   - 修正箇所の前後3行を必ず保存

2. **依存関係判断**
   - 修正箇所が他のファイル・関数から参照されているか自動判断
   - 参照がある場合は慎重編集エージェントに移譲

3. **影響範囲検証**
   - 修正が既存機能に影響しないことを確認
   - 不明な場合は安全のため移譲

### 修正後検証（必須実行）
1. **構文チェック**
   - ファイルの構文エラーがないことを確認
   - JavaScriptの場合は簡易的な文法チェック

2. **動作テスト準備**
   - 修正箇所の簡単な動作確認方法を提示
   - 本格テストは実行しない（時間制限のため）

3. **ロールバック手順**
   - 問題発生時の復旧コマンド・手順を準備
   - 自動実行は行わず、手順のみ提示

---

## 🔄 実行フロー（5段階）

### Stage 1: 適用条件判定（30秒）
```
問題分析 → 適用条件チェック → 移譲判断
```
- 適用条件に該当しない場合は即座に適切なエージェントに移譲

### Stage 2: 安全性確認（60秒）
```
ファイル読み込み → バックアップ作成 → 依存関係チェック
```

### Stage 3: 修正実行（120秒）
```
修正実装 → 構文チェック → 差分確認
```

### Stage 4: 検証・報告（60秒）
```
影響範囲確認 → 動作確認方法提示 → 簡潔報告
```

### Stage 5: 完了処理（30秒）
```
ロールバック手順準備 → 記録判断 → 完了
```

**合計実行時間: 5分以内**

---

## 🔗 他エージェント連携

### 移譲パターン
1. **→ 慎重編集エージェント**
   - 複数ファイル影響
   - 重要システム変更
   - 影響範囲不明

2. **→ トラブル診断エージェント**
   - 根本原因が不明
   - システム全体の問題

3. **→ 設計レビューエージェント**
   - アーキテクチャ変更が必要

### 記録連携
- 重要な修正の場合のみ記録マスターエージェントを起動
- 通常の軽微な修正は記録不要

---

## 📋 プロジェクト固有制約

### ⚠️ 注意が必要なファイル
- `spine-positioning-system-minimal.js` - 慎重編集必須
- `CLAUDE.md` - 構造変更禁止、追記のみ
- 編集システム関連ファイル - 影響範囲大

### 🚫 絶対禁止事項
- 既存の正しく動いている箇所への変更
- 新機能追加（1行追加の要求でも確認必須）
- ファイル構造の変更
- 実装規模が要求と異なる場合の推測実行

### ✅ 適用可能な典型例
- ドキュメントの誤字脱字修正
- コメント追加・改善
- ログ出力の追加
- 明らかな構文エラー修正

---

## 📊 品質指標・目標値

### 時間効率
- **目標**: 5分以内完了率 95%以上
- **現在**: 従来の1/3の時間で完了
- **測定**: 実行開始から完了報告まで

### 安全性
- **目標**: 修正による障害発生率 1%以下
- **現在**: 安全性保証システムで0%継続中
- **測定**: 修正後24時間以内の問題報告

### 移譲判断精度
- **目標**: 不適切な実行率 5%以下
- **現在**: 適用条件の明確化で大幅改善
- **測定**: 修正後の問題・手戻り発生率

---

## 🔧 運用ガイドライン

### 起動判断
```
緊急 & 単純 & 明確 → 高速修正エージェント
```

### 実行中の判断基準
- **5分経過時点**: 強制的に慎重編集エージェントに移譲
- **不明点発生**: 推測せず即座に移譲
- **複雑化判明**: 作業停止して適切なエージェントに移譲

### 成功・失敗の定義
- **成功**: 5分以内完了 + 24時間無障害
- **失敗**: 時間超過 or 障害発生 or 不適切実行
- **部分成功**: 完了したが時間超過・追加作業必要

---

このエージェントは**速度と安全性の両立**を実現し、明確な問題を迅速に解決することで開発効率を大幅に向上させます。